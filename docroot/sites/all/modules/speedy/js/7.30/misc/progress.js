(function(e){Drupal.progressBar=function(t,n,r,i){var s=this;this.id=t,this.method=r||"GET",this.updateCallback=n,this.errorCallback=i,this.element=e('<div class="progress" aria-live="polite"></div>').attr("id",t),this.element.html('<div class="bar"><div class="filled"></div></div><div class="percentage"></div><div class="message">&nbsp;</div>')},Drupal.progressBar.prototype.setProgress=function(t,n){t>=0&&t<=100&&(e("div.filled",this.element).css("width",t+"%"),e("div.percentage",this.element).html(t+"%")),e("div.message",this.element).html(n),this.updateCallback&&this.updateCallback(t,n,this)},Drupal.progressBar.prototype.startMonitoring=function(e,t){this.delay=t,this.uri=e,this.sendPing()},Drupal.progressBar.prototype.stopMonitoring=function(){clearTimeout(this.timer),this.uri=null},Drupal.progressBar.prototype.sendPing=function(){this.timer&&clearTimeout(this.timer);if(this.uri){var t=this;e.ajax({type:this.method,url:this.uri,data:"",dataType:"json",success:function(e){if(e.status==0){t.displayError(e.data);return}t.setProgress(e.percentage,e.message),t.timer=setTimeout(function(){t.sendPing()},t.delay)},error:function(e){t.displayError(Drupal.ajaxError(e,t.uri))}})}},Drupal.progressBar.prototype.displayError=function(t){var n=e('<div class="messages error"></div>').html(t);e(this.element).before(n).hide(),this.errorCallback&&this.errorCallback(this)}})(jQuery);