(function(e){Drupal.behaviors.fieldUIFieldOverview={attach:function(t,n){e("table#field-overview",t).once("field-overview",function(){Drupal.fieldUIFieldOverview.attachUpdateSelects(this,n)})}},Drupal.fieldUIFieldOverview={attachUpdateSelects:function(t,n){var r=n.fieldWidgetTypes,i=n.fields;e(".widget-type-select",t).each(function(){this.initialValue=this.options[0].text}),e(".field-type-select",t).each(function(){this.targetSelect=e(".widget-type-select",e(this).closest("tr")),e(this).bind("change keyup",function(){var e=this.options[this.selectedIndex].value,t=e in r?r[e]:[];this.targetSelect.fieldUIPopulateOptions(t)}),e(this).trigger("change",!1)}),e(".field-select",t).each(function(){this.targetSelect=e(".widget-type-select",e(this).closest("tr")),this.targetTextfield=e(".label-textfield",e(this).closest("tr")),this.targetTextfield.data("field_ui_edited",!1).bind("keyup",function(t){e(this).data("field_ui_edited",e(this).val()!="")}),e(this).bind("change keyup",function(e,t){var t=typeof t=="undefined"?!0:t,n=this.options[this.selectedIndex].value,s=n in i?i[n].type:null,o=n in i?i[n].widget:null,u=s&&s in r?r[s]:[];this.targetSelect.fieldUIPopulateOptions(u,o),t&&!this.targetTextfield.data("field_ui_edited")&&this.targetTextfield.val(n in i?i[n].label:"")}),e(this).trigger("change",!1)})}},jQuery.fn.fieldUIPopulateOptions=function(t,n){return this.each(function(){var r=!1;t.length==0&&(t=[this.initialValue],r=!0);var i=this.options[this.selectedIndex].text,s="";jQuery.each(t,function(e,t){var r=typeof n!="undefined"&&e==n||typeof n=="undefined"&&t==i;s+='<option value="'+e+'"'+(r?' selected="selected"':"")+">"+t+"</option>"}),e(this).html(s).attr("disabled",r?"disabled":!1)})},Drupal.behaviors.fieldUIDisplayOverview={attach:function(t,n){e("table#field-display-overview",t).once("field-display-overview",function(){Drupal.fieldUIOverview.attach(this,n.fieldUIRowsData,Drupal.fieldUIDisplayOverview)})}},Drupal.fieldUIOverview={attach:function(t,n,r){var i=Drupal.tableDrag[t.id];i.onDrop=this.onDrop,i.row.prototype.onSwap=this.onSwap,e("tr.draggable",t).each(function(){var t=this;if(t.id in n){var s=n[t.id];s.tableDrag=i;var o=new r[s.rowHandler](t,s);e(t).data("fieldUIRowHandler",o)}})},onChange:function(){var t=e(this),n=t.closest("tr").get(0),r=e(n).data("fieldUIRowHandler"),i={};i[r.name]=t.get(0);var s=r.getRegion();s!=r.region&&(e("select.field-parent",n).val(""),e.extend(i,r.regionChange(s)),r.region=s),Drupal.fieldUIOverview.AJAXRefreshRows(i)},onDrop:function(){var t=this,n=t.rowObject.element,r=e(n).data("fieldUIRowHandler");if(r!==undefined){var i=e(n).prevAll("tr.region-message").get(0),s=i.className.replace(/([^ ]+[ ]+)*region-([^ ]+)-message([ ]+[^ ]+)*/,"$2");s!=r.region&&(refreshRows=r.regionChange(s),r.region=s,Drupal.fieldUIOverview.AJAXRefreshRows(refreshRows))}},onSwap:function(t){var n=this;e("tr.region-message",n.table).each(function(){e(this).prev("tr").get(0)==n.group[n.group.length-1]&&(n.method!="keyboard"||n.direction=="down")&&n.swap("after",this),e(this).next("tr").is(":not(.draggable)")||e(this).next("tr").length==0?e(this).removeClass("region-populated").addClass("region-empty"):e(this).is(".region-empty")&&e(this).removeClass("region-empty").addClass("region-populated")})},AJAXRefreshRows:function(t){var n=[],r=[];e.each(t,function(e,t){n.push(e),r.push(t)});if(n.length){var i=e('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');e(r).addClass("progress-disabled").after(i),e("input[name=refresh_rows]").val(n.join(" ")),e("input#edit-refresh").mousedown(),e(r).attr("disabled",!0)}}},Drupal.fieldUIDisplayOverview={},Drupal.fieldUIDisplayOverview.field=function(t,n){return this.row=t,this.name=n.name,this.region=n.region,this.tableDrag=n.tableDrag,this.$formatSelect=e("select.field-formatter-type",t),this.$formatSelect.change(Drupal.fieldUIOverview.onChange),this},Drupal.fieldUIDisplayOverview.field.prototype={getRegion:function(){return this.$formatSelect.val()=="hidden"?"hidden":"visible"},regionChange:function(e){var t=this.$formatSelect.val();switch(e){case"visible":if(t=="hidden")var n=this.defaultFormatter!=undefined?this.defaultFormatter:"visible";break;default:var n="hidden"}n!=undefined&&this.$formatSelect.val(n);var r={};return r[this.name]=this.$formatSelect.get(0),r}}})(jQuery);
