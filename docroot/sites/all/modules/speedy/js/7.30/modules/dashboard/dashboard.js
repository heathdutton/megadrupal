function(e){Drupal.behaviors.dashboard={attach:function(t,n){e("#dashboard",t).once(function(){e(this).prepend('<div class="customize clearfix"><ul class="action-links"><li><a href="#">'+Drupal.t("Customize dashboard")+'</a></li></ul><div class="canvas"></div></div>'),e(".customize .action-links a",this).click(Drupal.behaviors.dashboard.enterCustomizeMode)}),Drupal.behaviors.dashboard.addPlaceholders(),Drupal.settings.dashboard.launchCustomize&&Drupal.behaviors.dashboard.enterCustomizeMode()},addPlaceholders:function(){e("#dashboard .dashboard-region .region").each(function(){var t="";e(".block",this).length==0?(e("#dashboard").hasClass("customize-mode")?t=Drupal.settings.dashboard.emptyRegionTextActive:t=Drupal.settings.dashboard.emptyRegionTextInactive,e(".placeholder",this).length==0&&e(this).append('<div class="placeholder"></div>'),e(".placeholder",this).html(t)):e(".placeholder",this).remove()})},enterCustomizeMode:function(){e("#dashboard").addClass("customize-mode customize-inactive"),Drupal.behaviors.dashboard.addPlaceholders(),e("#dashboard .customize .action-links").hide(),e("div.customize .canvas").load(Drupal.settings.dashboard.drawer,Drupal.behaviors.dashboard.setupDrawer)},exitCustomizeMode:function(){e("#dashboard").removeClass("customize-mode customize-inactive"),Drupal.behaviors.dashboard.addPlaceholders(),location.href=Drupal.settings.dashboard.dashboard},setupDrawer:function(){e("div.customize .canvas-content input").click(Drupal.behaviors.dashboard.exitCustomizeMode),e("div.customize .canvas-content").append('<a class="button" href="'+Drupal.settings.dashboard.dashboard+'">'+Drupal.t("Done")+"</a>");var t=e("#dashboard div.region");t.sortable({connectWith:t,cursor:"move",cursorAt:{top:0},dropOnEmpty:!0,items:"> div.block, > div.disabled-block",placeholder:"block-placeholder clearfix",tolerance:"pointer",start:Drupal.behaviors.dashboard.start,over:Drupal.behaviors.dashboard.over,sort:Drupal.behaviors.dashboard.sort,update:Drupal.behaviors.dashboard.update})},start:function(t,n){e("#dashboard").removeClass("customize-inactive");var r=e(n.item);r.hasClass("disabled-block")||r.css({height:"auto"})},over:function(t,n){var r=e(n.item);e(this).closest("#disabled-blocks").length?r.css("width",""):r.css("width",e(this).width())},sort:function(t,n){var r=e(n.item);t.pageX>n.offset.left+r.width()&&r.css("left",t.pageX)},update:function(t,n){e("#dashboard").addClass("customize-inactive");var r=e(n.item);if(r.hasClass("disabled-block")){var i,s,o;o=r.attr("class"),i=o.match(/\bmodule-(\S+)\b/)[1],s=o.match(/\bdelta-(\S+)\b/)[1],e.get(Drupal.settings.dashboard.blockContent+"/"+i+"/"+s,{},function(e){e&&r.html(e),r.find("div.content").is(":empty")&&r.find("div.content").html(Drupal.settings.dashboard.emptyBlockText),Drupal.attachBehaviors(r)},"html"),r.removeClass("disabled-block")}Drupal.behaviors.dashboard.addPlaceholders(),e.post(Drupal.settings.dashboard.updatePath,{form_token:Drupal.settings.dashboard.formToken,regions:Drupal.behaviors.dashboard.getOrder})},getOrder:function(){var t=[];return e("#dashboard div.region").each(function(){var n=e(this).parent().attr("id").replace(/-/g,"_"),r=e(this).sortable("toArray");e.each(r,function(){t.push(n+"[]="+this)})}),t=t.join("&"),t}}})(jQuery);
