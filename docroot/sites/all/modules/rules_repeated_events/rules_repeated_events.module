<?php

/**
 * @file
 * Main module file.
 */

/**
 * Implements hook_rules_category_info().
 */
function rules_repeated_events_rules_category_info() {
  return array(
    // Use the same icon as for the service plugin.
    'repeated_events' => array(
      'label' => t('Repeated Events'),
    ),
  );
}

/**
 * Implements hook_fluxservice_plugin_directory().
 */
function rules_repeated_events_fluxservice_plugin_directory() {
  return 'lib/Drupal/rules_repeated_events/Plugin';
}

/**
 * Get timestamp diff between local and server timezones.
 */
function rules_repeated_events_get_local_server_timestamp_diff() {
  $local_timezone = variable_get('date_default_timezone', date_default_timezone_get());
  $server_timezone = date_default_timezone_get();

  if ($local_timezone == $server_timezone) {
    // Server and local timezones are the same.
    return 0;
  }

  $local_date_timezone = new DateTimeZone($local_timezone);
  $server_date_timezone = new DateTimeZone($server_timezone);

  $local_date = new DateTime("now", $local_date_timezone);
  $server_date = new DateTime("now", $server_date_timezone);

  $local_offset = $local_date_timezone->getOffset($local_date);
  $server_offset = $server_date_timezone->getOffset($server_date);

  $diff = $local_offset - $server_offset;
  return $diff;
}
