<?php

/**
 * Implements hook_preprocess_page().
 */
function quick_login_preprocess_page() {
  // Reminder message.
  drupal_set_message(t('Your website security is vulnerable while Quick login module is enabled. Be careful not to use it on production server.'), 'warning');
}

/**
 * Implements hook_menu().
 */
function quick_login_menu() {
  $items['quick-login/%'] = array(
    'title' => 'Quick login link',
    'page callback' => 'quick_login_page_content',
    'page arguments' => array(1),
    'access callback' => TRUE,
  );
  return $items;
}

/**
 * Quick login page content callback.
 */
function quick_login_page_content($user_name) {
  $user_object = user_load_by_name($user_name);
  if ($user_object) {
    global $user;

    // Call logout hooks.
    module_invoke_all('user_logout', $user);

    // Switching user.
    $user = $user_object;
    drupal_session_regenerate();

    // Call all login hooks.
    $edit = array();
    user_module_invoke('login', $edit, $user);
  }
  else {
    drupal_set_message(t('There is no such user \'@user_name\'.', array('@user_name' => $user_name)), 'error');
  }
  drupal_goto('<front>');
}
