<?php

/**
 * @file
 * Replace tooltip to cool style.
 */

/**
 * Implements hook_help().
 */
function bettertip_help($path, $arg) {
  switch ($path) {
    case 'admin/help#bettertip':
      return '<p>' . t('This module is simply replace cool tooltip to all across the site that tags have [title] attribute.') . '</p>';
      break;
  }
}

/**
 * Implements hook_menu().
 */
function bettertip_menu() {
  $items = array();

  $items['admin/config/user-interface/bettertip'] = array(
    'title' => 'BetterTip',
    'description' => 'Configuration for tooltip style',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('bettertip_form'),
    'access arguments' => array('access bettertip content'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}
/**
 * Implements hook_permission().
 */
function bettertip_permission() {
  return array(
    'access bettertip content' => array(
      'title' => t('Access bettertip for Customize.'),
    ),
  );
}

/**
 * Configuration form.
 */
function bettertip_form($form, &$form_state) {
  $form['bettertip_color'] = array(
    '#type' => 'textfield',
    '#title' => t('Text Color'),
    '#default_value' => variable_get('bettertip_color', '#ffffff'),
    '#size' => 7,
    '#maxlength' => 7,
    '#description' => t('Define the color of text. like #ffffff'),
    '#required' => TRUE,
  );

  $form['bettertip_bg'] = array(
    '#type' => 'textfield',
    '#title' => t('Background Color'),
    '#default_value' => variable_get('bettertip_bg', '#000000'),
    '#size' => 7,
    '#maxlength' => 7,
    '#description' => t('Define the color for background. like #000000'),
    '#required' => TRUE,
  );

  return system_settings_form($form);
}

/**
 * Implements hook_init().
 */
function bettertip_init() {
  // Replacing CSS changed in config form.
  $color = variable_get('bettertip_color', '#ffffff');
  $bg = variable_get('bettertip_bg', '#000000');
  drupal_add_css(".bettertip {color: $color; background-color: $bg}", 'inline');
}

/**
 * Form validation handler for Configuration form.
 */
function bettertip_form_validate($form, &$form_state) {
  // Only accept hexadecimal CSS color strings to avoid XSS upon use.
  $hex = $form_state['values']['bettertip_color'];
  $hexb = $form_state['values']['bettertip_bg'];
  if (!preg_match('/^#([a-f0-9]{3}){1,2}$/iD', $hex)) {
    form_set_error('bettertip_color', t('Text Color must be a valid hexadecimal CSS color value. Like #ffffff'));
  }
  if (!preg_match('/^#([a-f0-9]{3}){1,2}$/iD', $hexb)) {
    form_set_error('bettertip_bg', t('Background Color must be a valid hexadecimal CSS color value. Like #ffffff'));
  }
}
