<?php
/**
 * @file
 * The installation file for Dynamic Zendesk Forms module.
 */

/**
 * Implements hook_uninstall().
 */
function dynamic_zendesk_forms_uninstall() {
  variable_del('dynamic_zendesk_forms_api_key');
  variable_del('dynamic_zendesk_forms_user_name');
  variable_del('dynamic_zendesk_forms_api_url');
  variable_del('dynamic_zendesk_forms_ticket_form_id');
  variable_del('dynamic_zendesk_forms_fields_configuration');
  variable_del('dynamic_zendesk_forms_cache_lifetime');
}

/**
 * Implements hook_requirements().
 */
function dynamic_zendesk_forms_requirements($phase) {
  $t = get_t();
  $requirements = array();
  $curl_available = function_exists('curl_init');
  $requirements_array = array(
    'title' => 'DYNAMIC ZENDESK FORMS',
    'description' => $t('Required PHP extension "CURL" is not installed or enabled.'),
  );

  switch ($phase) {
    case 'install':
      if (!$curl_available) {
        $requirements['dynamic_zendesk_forms_curl'] = $requirements_array;
        $requirements['dynamic_zendesk_forms_curl']['severity'] = REQUIREMENT_ERROR;
      }
      break;

    case 'runtime':
      $requirements['dynamic_zendesk_forms_curl'] = $requirements_array;

      if ($curl_available) {
        $requirements['dynamic_zendesk_forms_curl']['description'] = $t('Required PHP extension "CURL" is installed and enabled.');
        $requirements['dynamic_zendesk_forms_curl']['severity'] = REQUIREMENT_OK;
        $requirements['dynamic_zendesk_forms_curl']['value'] = $t('Extension enabled');
      }
      else {
        $requirements['dynamic_zendesk_forms_curl']['severity'] = REQUIREMENT_ERROR;
        $requirements['dynamic_zendesk_forms_curl']['value'] = $t('Extension missing');
      }
      break;

  }

  return $requirements;
}
