<?php

/**
 * @file
 * Install file for the batch module.
 */

/**
 * Implements hook_schema().
 */
function batch_jobs_schema() {
  $schema = array();

  $schema['batch_jobs'] = array(
    'description' => 'Stores information about the batch.',
    'fields' => array(
      'bid' => array(
        'type' => 'serial',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'description' => 'batch id',
      ),
      'title' => array(
        'description' => 'The batch title.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'uid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
        'description' => 'User id',
      ),
      'data' => array(
        'description' => 'A serialized array containing the processing data for the batch.',
        'type' => 'blob',
        'not null' => FALSE,
        'size' => 'big',
      ),
      'callbacks' => array(
        'description' => 'The callback function to be run when job is finished.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'status' => array(
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
        'description' => 'Return status.',
      ),
    ),
    'primary key' => array('bid'),
  );
  $schema['batch_task'] = array(
    'description' => 'Stores information about a batch task.',
    'fields' => array(
      'tid' => array(
        'type' => 'serial',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'description' => 'task id',
      ),
      'bid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
        'description' => 'batch id',
      ),
      'title' => array(
        'description' => 'The task title.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'start' => array(
        'description' => 'A Unix timestamp indicating when this task was started.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'end' => array(
        'description' => 'A Unix timestamp indicating when this task was completed.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'callbacks' => array(
        'description' => 'The callback function to be run.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'data' => array(
        'description' => 'A serialized array containing the processing data for the task.',
        'type' => 'blob',
        'not null' => FALSE,
        'size' => 'big',
      ),
      'status' => array(
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
        'description' => 'Return status.',
      ),
      'message' => array(
        'description' => 'A serialized array containing the processing data for the task.',
        'type' => 'text',
        'not null' => FALSE,
        'size' => 'medium',
      ),
    ),
    'primary key' => array('tid'),
  );

  return $schema;
}

/**
 * Adds the status column to {batch_jobs}.
 */
function batch_jobs_update_7000() {
  $status = array(
    'type' => 'int',
    'not null' => TRUE,
    'default' => 0,
    'description' => 'Return status.',
  );
  db_add_field('batch_jobs', 'status', $status);
}
