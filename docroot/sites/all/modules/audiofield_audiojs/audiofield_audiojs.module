<?php
/**
 * @file
 * Module that implements audio.js support for the Audiofield module.
 */

/**
 * Implements hook_audiofield_players().
 */
function audiofield_audiojs_audiofield_players(){
  $player['audiojs']=array(
    'path' => variable_get('audiofield_players_dir', 'sites/all/libraries/player') . "/audiojs/audio.min.js",
    'name' => 'audio.js',
    'download_link' => 'http://kolber.github.io/audiojs/',
    'filetypes' => array('mp3'),
    'callback' => 'audiofield_audiojs_example_player',
  );

  return $player;
}

/**
 * Generates makrup for the audio.js player.
 *
 * @param string $player_path
 *   PAth to the audio.js library.
 *
 * @param string $audio_file
 *   Path to the MP3 file to play.
 *
 * @return string
 *   Returns markup for the audio.js player
 */
function audiofield_audiojs_example_player($player_path, $audio_file){
  $player_base_path = variable_get('audiofield_players_dir', 'sites/all/libraries/player') . "/audiojs";

  drupal_add_js($player_base_path . '/audio.min.js');

  $markup = "<script> audiojs.events.ready(function(){ var as = audiojs.createAll(); }); </script>\n";
  $markup .= "<div><audio src='" . $audio_file . "' preload='auto' /></div>\n";

  return $markup;

}
