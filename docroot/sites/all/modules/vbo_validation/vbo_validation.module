<?php
/**
 * @file
 * VBO Validation module code.
 */

/**
 * Implements hook_form_alter().
 */
function vbo_validation_form_alter(&$form, &$form_state, $form_id) {
  if (array_key_exists('select', $form)) {
    foreach ($form['select'] as $key => $value) {
      if (strpos($key, 'action::') !== FALSE) {
        $form['select'][$key]['#validate'][] = 'vbo_validation_form_validate';
      }
    }
  }
}

/**
 * Implements hook_module_implements_alter().
 */
function vbo_validation_module_implements_alter(&$implementations, $hook) {
  if ($hook == 'form_alter' && isset($implementations['vbo_validation'])) {
    $group = $implementations['vbo_validation'];
    unset($implementations['vbo_validation']);
    $implementations['vbo_validation'] = $group;
  }
}

function vbo_validation_form_validate(&$form, &$form_state) {
  $vbo_name = str_replace('action::', '', $form_state['values']['operation']);
  module_invoke_all('vbo_validation_validate', $form, $form_state, $vbo_name);
  module_invoke_all('vbo_validation_' . $vbo_name . '_validate', $form, $form_state);
}