<?php

/**
 * @file
 * TODO
 */

/**
 * Implements hook_permission().
 */
function rotating_slogan_permission() {

  return array(

    'administer rotating slogan' => array(

      'title' => t('Administer rotating slogan'),
      'description' => t('Administer rotating slogan.'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function rotating_slogan_menu() {

  $items = array();

  $items['admin/config/rotating_slogan'] = array(

    'title' => 'Rotating Slogan',
    'description' => 'Adjust rotating slogan settings.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('rotating_slogan_settings'),
    'access arguments' => array('administer rotating slogan'),
    'file' => 'rotating_slogan.admin.inc',
  );

  return $items;
}

/**
 * Implements hook_theme_registry_alter().
 */
function rotating_slogan_preprocess_page(&$variables) {

  $list = array();
  $unclean_list = explode("\n", variable_get('rotating_slogan_list', ''));
  foreach ($unclean_list as $item) {
    if (trim($item) != '') {
      $list[] = t($item);
    }
  }

  if (empty($list)) {
    return;
  }

  $text = '';
  switch (variable_get('rotating_slogan_cycle', 'random')) {

    case 'random':
      $text = $list[array_rand($list)];
      break;

    case 'cycling':
      $index = variable_get('rotating_slogan_index', 0);
      ++$index;

      if ($index >= count($list)) {
        $index = 0;
      }

      variable_set('rotating_slogan_index', $index);

      $text = $list[$index];
      break;
  }

  $variables[variable_get('rotating_slogan_type', 'site_slogan')] = filter_xss($text);
}

