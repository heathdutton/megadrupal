<?php

/**
 * @file
 * Menu Position UUID installation and schema hooks.
 */

/**
 * Implements hook_install().
 */
function menu_position_uuid_install() {
  // Make sure this module runs after menu_position
  $weight = db_select("system", "s")
    ->fields("s", array("weight"))
    ->condition('s.name', 'menu_position')
    ->execute()
    ->fetchField();

  db_update("system")
    ->fields(array('weight' => $weight + 1))
    ->condition('name', 'menu_position_uuid')
    ->execute();

  $field = uuid_schema_field_definition();
  db_add_field('menu_position_rules', 'uuid', $field);
  db_add_index('menu_position_rules', 'uuid', array('uuid'));

}

/**
 * Implements hook_uninstall().
 */
function menu_position_uuid_uninstall() {
  db_drop_field('menu_position_rules', 'uuid');
  db_drop_index('menu_position_rules', 'uuid');
}

/**
 * Implements hook_enable().
 */
function menu_position_uuid_enable() {
  uuid_sync_all();
}

/**
 * Implements hook_schema_alter().
 */
function menu_position_uuid_schema_alter(&$schema = array()) {
  $field = uuid_schema_field_definition();
  $schema['menu_position_rules']['fields']['uuid'] = $field;
}
