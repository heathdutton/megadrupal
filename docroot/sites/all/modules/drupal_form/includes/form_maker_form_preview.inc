<?php/** * @file * Form preview. *//** * Form preview on form maker edit page. */function form_maker_form_preview() {  if (isset($_POST['theme_id'])) {    $theme_id = $_POST['theme_id'];  }  $css = db_query("SELECT css FROM {form_maker_themes} WHERE id=:id", array(':id' => $theme_id))->fetchField();  echo '<style>          #sliding_popup .form_maker_content { position:absolute; left:50%; top:20px; display:block;  height:100%; }          #sliding_popup .bigcalendar * { margin-left:300px; display:block;}          #sliding_popup .close { overflow:hidden; display:block; position:absolute; right:5%; bottom:95%; width:32px; height:32px; text-indent:1000px; background-image:url("' . base_path() . drupal_get_path('module', 'form_maker') . '/images/close.png"); }        </style>        <div style="width:100%;height:100%;background-color:#000000;opacity:0.8; position:fixed;"></div>        <div id="form_maker_fixed_popup" style="margin-left:5%; margin-top:50px; width:90%; background-color:#FFFFFF; overflow:scroll; position:fixed;">        <script>          var form_maker_fixed_popup = document.getElementById("form_maker_fixed_popup");          var height = jQuery(window).height() - 70;          form_maker_fixed_popup.style.height = height +"px";        </script>        <div id="div_content" class="form_maker_content" style="z-index:1000000;height:60%;">          <div id="form_id_viewpages" class="wdform_page_navigation" show_title="" show_numbers="" type=""></div>          <input type="hidden" id="counterform_id_view" value="" name="counterform_id_view" />          <div id="form_preview"></div>          <script>            document.getElementById("div_content").style.width="1000px";            document.getElementById("div_content").style.marginLeft=(-1000/2)+"px";            function form_maker_replaceSubstring(inSource, inToReplace, inReplaceWith) {              var outString = inSource;              while (true) {                var idx = outString.indexOf(inToReplace);                if (idx == -1) {                  break;                }                outString = outString.substring(0, idx) + inReplaceWith + outString.substring(idx + inToReplace.length);              }              return outString;            }            var string = document.getElementById("take").innerHTML;            string = form_maker_replaceSubstring(string,"temp","view");            for (i = 0; i < gen; i++) {              string = form_maker_replaceSubstring(string,\'id="\' + i + \'"\',\'id="\' + i + \'_preview"\');            }            document.getElementById("form_preview").innerHTML = string;            document.getElementById("form_id_viewpages").setAttribute("show_title", document.getElementById("pages").getAttribute("show_title"));            document.getElementById("form_id_viewpages").setAttribute("show_numbers", document.getElementById("pages").getAttribute("show_numbers"));            document.getElementById("form_id_viewpages").setAttribute("type", document.getElementById("pages").getAttribute("type"));            document.getElementById("counterform_id_view").value = gen;            form_view_countform_id_view = 0;            for (i = 1; i <= 30; i++) {              if (document.getElementById("form_id_viewform_view" + i)) {                form_view_countform_id_view++;                form_view_maxform_id_view = i;                document.getElementById("form_id_viewform_view" + i).parentNode.removeAttribute("style");              }            }            refresh_first();            if (form_view_countform_id_view > 1) {              for (i = 1; i <= form_view_maxform_id_view; i++) {                if (document.getElementById("form_id_viewform_view" + i)) {                  first_form_viewform_id_view = i;                  break;                }              }              generate_page_nav_preview(first_form_viewform_id_view, "form_id_view", form_view_countform_id_view, form_view_maxform_id_view);            }            function remove_add_(id) {              attr_name = new Array();              attr_value = new Array();              var input = document.getElementById(id);              atr = input.attributes;              for (v = 0; v < 30; v++) {                if (atr[v]) {                  if (atr[v].name.indexOf("add_") == 0) {                    attr_name.push(atr[v].name.replace("add_", ""));                    attr_value.push(atr[v].value);                    input.removeAttribute(atr[v].name);                    v--;                  }                }              }              for (v = 0; v < attr_name.length; v++) {                input.setAttribute(attr_name[v], attr_value[v])              }            }            function refresh_first() {              n = gen;              for (i = 0; i < n; i++) {                if (document.getElementById(i + "_preview")) {                  for (z = 0; z < document.getElementById(i + "_preview").childNodes.length; z++)                    if (document.getElementById(i + "_preview").childNodes[z].nodeType == 3) {                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[z]);                    }                  if (document.getElementById(i + "_preview").getAttribute("type") == "type_map") {                    if_gmap_init(i);                    for (q = 0; q < 20; q++)                      if (document.getElementById(i + "_elementform_id_view").getAttribute("long" + q)) {                        w_long = parseFloat(document.getElementById(i + "_elementform_id_view").getAttribute("long" + q));                        w_lat = parseFloat(document.getElementById(i + "_elementform_id_view").getAttribute("lat" + q));                        w_info = parseFloat(document.getElementById(i + "_elementform_id_view").getAttribute("info" + q));                        add_marker_on_map(i, q, w_long, w_lat, w_info, false);                      }                  }                  if (document.getElementById(i + "_preview").getAttribute("type") == "type_mark_map") {                    if_gmap_init(i);                    w_long = parseFloat(document.getElementById(i + "_elementform_id_view").getAttribute("long" + 0));                    w_lat = parseFloat(document.getElementById(i + "_elementform_id_view").getAttribute("lat" + 0));                    w_info = parseFloat(document.getElementById(i + "_elementform_id_view").getAttribute("info" + 0));                    add_marker_on_map(i, 0, w_long, w_lat, w_info, true);                  }                  if (document.getElementById(i + "_preview").getAttribute("type") == "type_captcha" || document.getElementById(i + "_preview").getAttribute("type") == "type_recaptcha") {                    if (document.getElementById(i + "_preview").childNodes[10]) {                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    }                    else {                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                      document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    }                    continue;                  }                  if (document.getElementById(i + "_preview").getAttribute("type") == "type_section_break") {                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    continue;                  }                  if (document.getElementById(i + "_preview").childNodes[10]) {                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[2]);                  }                  else {                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                    document.getElementById(i + "_preview").removeChild(document.getElementById(i + "_preview").childNodes[1]);                  }                }              }              for (i = 0; i <= n; i++) {                if (document.getElementById(i + "_preview")) {                  type = document.getElementById(i + "_preview").getAttribute("type");                  switch (type) {                    case "type_text":                    case "type_number":                    case "type_password":                    case "type_submitter_mail":                    case "type_own_select":                    case "type_country":                    case "type_hidden":                    case "type_map": {                      remove_add_(i + "_elementform_id_view");                      break;                    }                    case "type_submit_reset": {                      remove_add_(i + "_element_submitform_id_view");                      if (document.getElementById(i + "_element_resetform_id_view")) {                        remove_add_(i + "_element_resetform_id_view");                      }                      break;                    }                    case "type_captcha": {                      remove_add_("_wd_captchaform_id_view");                      remove_add_("_element_refreshform_id_view");                      remove_add_("_wd_captcha_inputform_id_view");                      break;                    }                    case "type_recaptcha": {                      remove_add_("wd_recaptchaform_id_view");                      break;                    }                    case "type_file_upload": {                      remove_add_(i + "_elementform_id_view");                      break;                    }                    case "type_textarea": {                      remove_add_(i + "_elementform_id_view");                      break;                    }                    case "type_name": {                      if (document.getElementById(i + "_element_titleform_id_view")) {                        remove_add_(i + "_element_titleform_id_view");                        remove_add_(i + "_element_firstform_id_view");                        remove_add_(i + "_element_lastform_id_view");                        remove_add_(i + "_element_middleform_id_view");                      }                      else {                        remove_add_(i + "_element_firstform_id_view");                        remove_add_(i + "_element_lastform_id_view");                      }                      break;                    }                    case "type_phone": {                      remove_add_(i + "_element_firstform_id_view");                      remove_add_(i + "_element_lastform_id_view");                      break;                    }                    case "type_address": {                      remove_add_(i + "_street1form_id_view");                      remove_add_(i + "_street2form_id_view");                      remove_add_(i + "_cityform_id_view");                      remove_add_(i + "_stateform_id_view");                      remove_add_(i + "_postalform_id_view");                      remove_add_(i + "_countryform_id_view");                      break;                    }                    case "type_checkbox":                    case "type_radio": {                      is = true;                      for (j = 0; j < 100; j++) {                        if (document.getElementById(i + "_elementform_id_view" + j)) {                          remove_add_(i + "_elementform_id_view" + j);                        }                      }                      break;                    }                    case "type_button": {                      for (j = 0; j < 100; j++)                        if (document.getElementById(i + "_elementform_id_view" + j)) {                          remove_add_(i + "_elementform_id_view" + j);                        }                      break;                    }                    case "type_time": {                      if (document.getElementById(i + "_ssform_id_view")) {                        remove_add_(i + "_ssform_id_view");                        remove_add_(i + "_mmform_id_view");                        remove_add_(i + "_hhform_id_view");                      }                      else {                        remove_add_(i + "_mmform_id_view");                        remove_add_(i + "_hhform_id_view");                      }                      break;                    }                    case "type_date": {                      remove_add_(i + "_elementform_id_view");                      remove_add_(i + "_buttonform_id_view");                      break;                    }                    case "type_date_fields": {                      remove_add_(i + "_dayform_id_view");                      remove_add_(i + "_monthform_id_view");                      remove_add_(i + "_yearform_id_view");                      break;                    }                  }                }              }              for (t = 1; t <= form_view_maxform_id_view; t++) {                if (document.getElementById("form_id_viewform_view" + t)) {                  form_view_element = document.getElementById("form_id_viewform_view" + t);                  xy = form_view_element.childNodes.length - 2;                  for (z = 0; z <= xy; z++) {                    if (form_view_element.childNodes[z]) {                      if (form_view_element.childNodes[z].nodeType != 3) {                        if (!form_view_element.childNodes[z].id) {                          del = true;                          GLOBAL_tr = form_view_element.childNodes[z];                          for (x = 0; x < GLOBAL_tr.firstChild.childNodes.length; x++) {                            table = GLOBAL_tr.firstChild.childNodes[x];                            tbody = table.firstChild;                            if (tbody.childNodes.length)                              del = false;                          }                          if (del) {                            form_view_element.removeChild(form_view_element.childNodes[z]);                          }                        }                      }                    }                  }                }              }              for (i = 1; i <= form_view_max; i++) {                if (document.getElementById("form_id_viewform_view" + i)) {                  document.getElementById("form_id_viewform_view" + i).parentNode.removeChild(document.getElementById("form_id_viewform_view_img" + i));                  document.getElementById("form_id_viewform_view" + i).removeAttribute("style");                }              }            }          </script>';  echo   '<style>' . $css . '</style>        </div>        </div>        <a class="close" href="javascript:form_maker_destroypopup(1000);" style="z-index:1000001"></a>';}