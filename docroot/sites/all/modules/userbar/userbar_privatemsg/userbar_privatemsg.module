<?php

/**
 * @file
 * Provides status of private messages in Userbar
 */

/**
 * Implements hook_userbar_info().
 */
function userbar_privatemsg_userbar_info() {
  return array('userbar_privatemsg' => array(
    'userbar_privatemsg_cnt' => array('tip' => t('Number of unread messages'), 'description' => t('Number of unread messages'),
      'display' => "/" . drupal_get_path('module', 'userbar_privatemsg') . '/images/pm_new.png', 'type' => 'image'),
    ));
}

/**
 * Implements hook_userbar_view().
 */
function userbar_privatemsg_userbar_view($indexes) {  
  $output = array('userbar_privatemsg' => array());
  if (in_array('userbar_privatemsg_cnt', $indexes)) {
    if ($cnt=privatemsg_unread_count() != 0) {
      $output['userbar_privatemsg']['userbar_privatemsg_cnt'] = array('tip' => t("You have !number unread messages", array("!number" => $cnt)), 'description' => t('Number of unread messages'),
        'callback' => 'messages', 'display' => "/" . drupal_get_path('module', 'userbar_privatemsg') . '/images/pm_new.png', 'type' => 'image');    
    }
    else {  
      $output['userbar_privatemsg']['userbar_privatemsg_cnt'] = array('description' => t('Private message inbox'), 'tip' => t('Private message inbox'),
        'callback' => 'messages',
        'display' => "/" . drupal_get_path('module', 'userbar_privatemsg') . '/images/pm.png', 'type' => 'image');
    }
  }
  return $output  ;
}
