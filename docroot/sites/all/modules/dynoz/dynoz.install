<?php

/**
 * @file
 * Install file of the dynOZ module
 */

/**
 * Implements hook_install().
 */
function dynoz_install() {
  drupal_set_message(st("dynoz settings are available under !link",
    array( '!link' => l(st('Administer > Structure > dynoz'),  'admin/structure/dynoz' ) )
  ));
}

/**
 * Implements hook_uninstall().
 */
function dynoz_uninstall() {
  variable_del('dynoz_access_pages');
  variable_del('dynoz_visibility');
}

/**
 * Drupal 5.x to 6.x update.
 */
function dynoz_update_6000() {
  $dynoz = 0;
  $pos = drupal_strlen('dynoz_block_');
  $settings = db_query("SELECT name FROM {variable} WHERE name LIKE 'dynoz\_block\_%'");
  while ($variable = db_fetch_object($settings)) {
    $data = explode(':', variable_get($variable->name, ''));

    $newdata = implode(':', array(drupal_substr($variable->name, $pos), $data[0], $data[1], $data[2]));
    variable_set('dynoz_block_' . $dynoz++, $newdata);

    // Raise the number of blocks in a type, if necessary
    variable_set('dynoz_number_blocks', max(variable_get('dynoz_number_blocks', 3), $dynoz));

    variable_del($variable->name);
  }
  $ret = array();
  return $ret;
}
