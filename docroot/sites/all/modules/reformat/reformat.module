<?php

/**
 * Implements hook_field_formatter_info().
 */
function reformat_field_formatter_info() {
  $formatters = array();
  $formats = filter_formats();
  foreach ($formats as $format_id => $format) {
    if ($format_id == 'php_code') {
      // Using this text format is not the best idea.
      continue;
    }
    $formatters['reformat:' . $format_id] = array(
      'label' => t('Reformat as @format', array('@format' => $format->name)),
      'field types' => array('text', 'text_long', 'text_with_summary'),
    );
  }
  return $formatters;
}

/**
 * Implements hook_field_formatter_view().
 */
function reformat_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $element = array();

  $format_id = str_replace('reformat:', '', $display['type']);

  if ($format_id != 'php_code') {
    foreach ($items as $delta => $item) {
      $output = check_markup($item['value'], $format_id, $langcode);
      $element[$delta] = array('#markup' => $output);
    }
  }
  return $element;
}
