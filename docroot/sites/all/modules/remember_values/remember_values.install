<?php

/**
 * @file
 * Install and uninstall functions for Remember values
 */


/**
 * Implements hook_schema().
 *
 * Define schema for remember_values tables.
 */
function remember_values_schema() {
  $schema['remember_values'] = array(
    'description' => 'Stores saved values from the forms.',
    'fields'      => array(
      'form_id' => array(
        'description' => 'ID of the form.',
        'type'        => 'varchar',
        'length'      => 128,
        'not null'    => TRUE,
        'default'     => '',
      ),
      'uid'   => array(
        'description' => 'User ID.',
        'type'        => 'int',
        'length'      => 10,
        'unsigned'    => TRUE,
        'not null'    => TRUE,
        'default'     => 0,
      ),
      'data'   => array(
        'description' => 'Serialized values to remember.',
        'type'        => 'blob',
        'not null'    => TRUE,
      ),
      'created'   => array(
        'description' => 'Time or the record creation.',
        'type'        => 'int',
        'length'      => 10,
        'unsigned'    => TRUE,
        'not null'    => TRUE,
        'default'     => 0,
      ),
      'lifespan'   => array(
        'description' => 'Lifespan of the record in hours.',
        'type'        => 'int',
        'length'      => 10,
        'unsigned'    => TRUE,
        'not null'    => TRUE,
        'default'     => 24,
      ),
    ),
    'primary key' => array('form_id', 'uid'),
  );

  return $schema;
}

/**
 * Implements hook_install().
 */
function remember_values_install() {
  variable_set('remember_values_status', 1);
  variable_set('remember_values_lifespan', 24);
}

/**
 * Implements hook_uninstall().
 */
function remember_values_uninstall() {
  db_query("DELETE FROM {variable} WHERE name LIKE 'remember_values_%'");
  cache_clear_all('variables', 'cache');

  drupal_uninstall_schema('remember_values');
}
