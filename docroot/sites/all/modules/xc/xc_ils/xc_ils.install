<?php
/**
 * @file
 * Installation file for XC ILS module
 *
 * @copyright (c) 2010-2011 eXtensible Catalog Organization
 */

/**
 * Implements hook_requirements().
 *
 * @param $phase
 */
function xc_ils_requirements($phase) {
  $requirements = array();
  if ($phase == 'runtime') {
    $bibid_mappings = xc_ils_get_all_mappings();

    if (empty($bibid_mappings)) {
      $requirements['xc_ils'] = array(
        'title' => t('XC ILS settings'),
        'value' => t('No mappings of bib ID and NCIP provider.'),
        'description' => t('You should map bib ID and NCIP provider !here, if you would like to retrieve circulation data through NCIP protocol!',
          array('!here' => l(t('here'), 'admin/xc/ils'))),
        'severity' => REQUIREMENT_WARNING,
      );
    }
  }
  return $requirements;
}

/**
 * Implements hook_schema().
 */
function xc_ils_schema() {
  $schema['xc_ils_settings'] = array(
    'description' => 'ILS settings',
    'fields' => array(
      'settings_id' => array(
        'description' => 'The identifier of the record.',
        'type' => 'serial',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'ncip_provider_id' => array(
        'description' => 'The NCIP server',
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'book_id_field' => array(
        'type' => 'varchar',
        'description' => 'The field to use for bib record identifier',
        'length' => 256,
        'not null' => TRUE,
      ),
      'is_enabled' => array(
        'description' => 'Enable-disable ILS settings',
        'type' => 'int',
        'size' => 'tiny',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 1,
      ),
    ),
    'indexes' => array(
      'facet_id' => array('settings_id'),
    ),
    'primary key' => array('settings_id'),
  );

  return $schema;
}
