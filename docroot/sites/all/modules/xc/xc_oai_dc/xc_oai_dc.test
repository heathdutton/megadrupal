<?php
/**
 * @file
 * Unit tests for the xc_oai_dc module.
 *
 * @copyright (c) 2010-2011 eXtensible Catalog Organization
 */

class XcOaiDCTestCase extends DrupalWebTestCase {
  function getInfo() {
    return array(
      'name' => t('XC OAI DC schema handler.'),
      'description' => t('Test OAI OAI DC schema handler.'),
      'group' => 'eXtensible Catalog Drupal Toolkit',
    );
  }

  public function setUp() {
    parent::setUp('xc_oai_dc');  // Enable any modules required for the test
    // Create and log in our user
    $privileged_user = $this->drupalCreateUser(array('create mymodule'));
    $this->drupalLogin($privileged_user);
  }

  /**
   * Test the xc_format_get
   * @return unknown_type
   */
  function testNamespaceURI() {
    require_once drupal_get_path('module', 'xc_metadata') . '/includes/xc_metadata.format.inc';
    $ns = 'http://www.openarchives.org/OAI/2.0/oai_dc';
    $format = xc_format_get('oai_dc');
    $formats = module_invoke_all('xc_format');
    xc_log_info('test', var_export($formats, TRUE));
    $this->assertEqual($ns, $format['namespaceURI'],
       t('%w and %r should be equals',
       array('%w' => $ns, '%r' => var_export($formats, TRUE)))
    );
  }

  function testRecord() {
    drupal_set_message(getcwd());
    $this->assertEqual(getcwd(), 'hi',
      t('%w and %r should be equals', array('%w' => getcwd(), '%r' => 'hi'))
    );
    return;
    $xml = '<record>'
      . '<header>'
      . '  <identifier>oai:zookeys.pensoftonline.net:article/8</identifier>'
      . '  <datestamp>2008-07-10T11:31:36Z</datestamp>'
      . '  <setSpec>journal:RESART</setSpec>'
      . '</header>'
      . '<metadata>'
      . '  <oai_dc:dc xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/oai_dc/  http://www.openarchives.org/OAI/2.0/oai_dc.xsd">'
      . '    <dc:title xml:lang="en_US">Eight new species of ..</dc:title>'
      . '    <dc:creator>Thelma O. Aken\'Ova; Department of ..</dc:creator>'
      . '    <dc:creator>Thomas H. Cribb; Department of Microbiology </dc:creator>'
      . '    <dc:creator>Rodney A. Bray; Department of Zoology, </dc:creator>'
      . '    <dc:subject xml:lang="en_US">Digenea; Opecoelidae; </dc:subject>'
      . '    <dc:description xml:lang="en_US">Nine morphologically </dc:description>'
      . '    <dc:publisher xml:lang="0">Pensoft Publishers </dc:publisher>'
      . '    <dc:contributor xml:lang="en_US">Ahmadu Bello </dc:contributor>'
      . '    <dc:date>2008-07-04</dc:date>'
      . '    <dc:type xml:lang="en_US">Peer-reviewed Article</dc:type>'
      . '    <dc:format>application/pdf</dc:format>'
      . '    <dc:identifier>http://pensoftonline.net/zookeys/index.php/journal/article/view/8</dc:identifier>'
      . '    <dc:source xml:lang="en_US">ZooKeys; ZooKeys 1 (2008)</dc:source>'
      . '    <dc:language>en</dc:language>'
      . '    <dc:coverage xml:lang="en_US">Australia</dc:coverage>'
      . '    <dc:coverage xml:lang="en_US">New species</dc:coverage>'
      . '    <dc:rights>Authors who publish with this journal agree ...</dc:rights>'
      . '  </oai_dc:dc>'
      . '</metadata>'
      . '</record>';
    $record = new OaiPmh_Dom_ListRecords($xml, TRUE);
    $recordArray = $record->parseRecord(NULL, FALSE);

    $identifier   = $record['header']['identifier'];
    $datestamp    = $record['header']['datestamp'];
    $setSpec      = $record['header']['setSpec'];
    $about        = $record['about'];
    $namespaceURI = $record['metadata']['namespaceURI'];
    $raw          = $record['metadata']['childNode'];

    // handling deleted records <header status="deleted">
    $status     = $record['header']['@status'];
    $is_deleted = (!is_null($status) && $status == 'deleted') ? TRUE : FALSE;

    $entity = new XCEntity(array(
        'source_id' => 4,
        'identifier' => $identifier,
        'raw' => $raw,
        'format' => $format
      )
    );
    // xc_util_dsm($entity);
  }

}