<?php
/**
 * @file
 * Install file for Drupal Powered.
 */

function _drupal_powered_download_wordmark() {
  $path = system_retrieve_file('https://raw.github.com/drupalnomad/drupal-wordmark-svg/master/wordmark.svg');
  if ($path) {
    variable_set('drupal_powered_wordmark', $path);
  }
  else {
    throw new DrupalUpdateException("Failed to download wordmark.");
  }
}

/**
 * Implements hook_requirements().
 */
function drupal_powered_requirements($phase) {
  if ($phase != 'install') {
    return array();
  }
  $requirements = array();
  if (!variable_get('drupal_powered_wordmark')) {
    try {
      _drupal_powered_download_wordmark();
    }
    catch (DrupalUpdateException $e) {
      $requirements['drupal_powered_wordmark'] = array(
        'description' => t("Unable to download Drupal wordmark."),
        'severity' => REQUIREMENT_ERROR,
      );
    }
  }
  return $requirements;
}

/**
 * Implements hook_install().
 */
function drupal_powered_install() {
  variable_set('drupal_powered_website', 'http://drupal.com/');
}

/**
 * Download wordmark.
 */
function drupal_powered_update_7100(array &$sandbox) {
  _drupal_powered_download_wordmark();
}

/**
 * Implements hook_uninstall().
 */
function drupal_powered_uninstall() {
  file_unmanaged_delete(variable_get('drupal_powered_wordmark'));
  variable_del('drupal_powered_wordmark');
  variable_del('drupal_powered_website');
}
