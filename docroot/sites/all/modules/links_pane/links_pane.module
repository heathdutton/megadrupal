<?php

/**
 * @file
 * Links pane module.
 */

/**
 * Implements hook_ctools_plugin_directory().
 */
function links_pane_ctools_plugin_directory($owner, $plugin_type) {
  if ($owner == 'ctools' && $plugin_type == 'content_types') {
    return 'plugins/' . $plugin_type;
  }

  return NULL;
}

/**
 * Implements hook_theme().
 */
function links_pane_theme() {
  return array('links_pane_config_form_table' => array('render element' => 'form'));
}

/**
 * Theme callback for the configuration form table.
 */
function theme_links_pane_config_form_table(&$variables) {
  $form = $variables['form'];
  $rows = array();
  $header = array();

  foreach (element_children($form) as $delta) {
    $row = array();

    foreach (element_children($form[$delta]) as $column_name) {
      $element = $form[$delta][$column_name];
      $header[$column_name] = $element['#title'];
      unset($element['#title']);
      $row[] = drupal_render($element);
    }

    $rows[] = array(
      'data' => $row,
      'class' => array('draggable'),
    );
  }

  $table_id = 'links_pane_config_form_table';

  $content = array(
    '#theme' => 'table',
    '#header' => $header,
    '#rows' => $rows,
    '#attributes' => array('id' => $table_id),
  );

  drupal_add_tabledrag($table_id, 'order', 'sibling', 'link-weight');

  return drupal_render($content);
}
