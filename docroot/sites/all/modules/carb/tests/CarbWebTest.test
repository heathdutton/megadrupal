<?php

/**
 * @file
 * Contains \CarbWebTest.
 */

/**
 * Tests the Cardinality Boost user interface overrides.
 */
class CarbWebTest extends DrupalWebTestCase {

  /**
   * {@inheritdoc}
   */
  protected $profile = 'testing';

  /**
   * {@inheritdoc}
   */
  static function getInfo() {
    return array(
      'description' => '',
      'name' => 'User interface overrides',
      'group' => 'Cardinality Boost',
    );
  }

  /**
   * {@inheritdoc}
   */
  function setUp(array $modules = array()) {
    parent::setUp($modules + array('carb', 'field', 'field_ui', 'text'));
  }

  /**
   * Tests the Cardinality Boost user interface overrides.
   */
  function testUserInterfaceOverrides() {
    $user = $this->drupalCreateUser(array('administer content types'));
    $this->drupalLogin($user);

    $content_type = $this->drupalCreateContentType();
    $field_name = 'foo_bar_baz';
    field_create_field(array(
      'field_name' => $field_name,
      'type' => 'text',
      'cardinality' => 1,
    ));
    field_create_instance(array(
      'field_name' => $field_name,
      'entity_type' => 'node',
      'bundle' => $content_type->type,
      'widget' => array(
        'type' => 'paymentform_line_item',
      ),
    ));

    $path = 'admin/structure/types/manage/' . $content_type->type . '/fields/' . $field_name;

    $cardinality = mt_rand(-1, CARB_MAXIMUM_CARDINALITY);
    $this->drupalPost($path, array(
      'field[cardinality]' => $cardinality,
    ), t('Save settings'));
    $field = field_read_field($field_name);
    $this->assertEqual($field['cardinality'], $cardinality);

    $cardinality = -1;
    $this->drupalPost($path, array(
      'field[cardinality]' => $cardinality,
    ), t('Save settings'));
    $field = field_info_field($field_name);
    $this->assertEqual($field['cardinality'], $cardinality);
  }

}
