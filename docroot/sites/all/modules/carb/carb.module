<?php

/**
 * @file
 * Contains hook implementations.
 */

/**
 * The maximum cardinality.
 *
 * This is limited by Field module's schema.
 */
define('CARB_MAXIMUM_CARDINALITY', 127);

/**
 * Implements hook_form_FORM_ID_alter().
 */
function carb_form_field_ui_field_edit_form_alter(array &$form, array &$form_state, $form_id) {
  $form['field']['cardinality']['#attributes']['pattern'] = '-1|([0-9]+)';
  $form['field']['cardinality']['#element_validate'][] = 'element_validate_integer';
  $form['field']['cardinality']['#element_validate'][] = 'carb_cardinality_validate';
  $form['field']['cardinality']['#size'] = 5;
  $form['field']['cardinality']['#type'] = 'textfield';
  unset($form['field']['cardinality']['#options']);
}

/**
 * Implements Form API #element_validate callback.
 */
function carb_cardinality_validate($element, &$form_state) {
  if (!form_get_error($element) && $element['#value'] < -1 && $element['#value'] > CARB_MAXIMUM_CARDINALITY) {
    form_error($element, t('%name must not be lower than -1 or higher than 255.', array(
      '%name' => $element['#title'],
    )));
  }
}
