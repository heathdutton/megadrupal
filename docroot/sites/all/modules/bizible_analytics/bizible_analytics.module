<?php
/**
 * @file
 * Bizible's .module file. http://bizible.com
 *
 * Adds Bizible's analytics script on non-admin pages. To add the analytics
 * script simply enable the module, disable the module to remove it. No
 * additional configuration is needed. Login to bizible.com to review analytics.
 */

/**
 * Implements hook_help().
 */
function bizible_analytics_help($path, $arg) {
  switch ($path) {
    case 'admin/help#bizible_analytics':
      return t('Enables <a href="@url">Bizible\'s</a> analytics script. There is no other configuration in Drupal for this module.', array('@url' => 'http://bizible.com'));
  }
}

/**
 * Implements hook_init().
 */
function bizible_analytics_init() {
  // If we're on an admin page return.
  if (path_is_admin(current_path())) {
    return;
  }

  // Use a PHP heredoc for readability of the JavaScript.
  $javascript = <<<HEREDOC
//Bizible's analytics script http://bizible.com
var _biz = _biz || [];
function _bizl(u) {
  var s = document.createElement('script');
  var f = document.getElementsByTagName('script')[0];
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + u;
  f.parentNode.insertBefore(s, f);
}
_bizl('//cdn.bizible.com/_biz-a.js');
HEREDOC;

  drupal_add_js($javascript, array('type' => 'inline', 'weight' => 999));
}
