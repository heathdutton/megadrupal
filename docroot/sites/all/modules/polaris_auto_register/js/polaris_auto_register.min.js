!function(e){function r(){e(".phone2").hide(),e(".progress").hide(),e(".alt_phone").click(function(){return e(".phone2").show(),e(".alt_phone").hide(),!1})}function a(){var r=e("#edit-polaris-auto-register-dob-month").val(),a=e("#edit-polaris-auto-register-dob-day").val(),o=e("#edit-polaris-auto-register-dob-year").val(),i=new Date(r+"-"+a+"-"+o),t=new Date,s=(t-i)/1e3/60/60/24/365;return 13>s?(e("#edit-polaris-auto-register-dob-month").addClass("error"),e("#edit-polaris-auto-register-dob-day").addClass("error"),e("#edit-polaris-auto-register-dob-year").addClass("error"),e(".dob_error").show(),!1):(e("#edit-polaris-auto-register-dob-month").removeClass("error"),e("#edit-polaris-auto-register-dob-day").removeClass("error"),e("#edit-polaris-auto-register-dob-year").removeClass("error"),e(".dob_error").hide(),void 0)}function o(){var r='<h3>Protect Your Account</h3><p>Your library card is an important personal item that needs protection. If you’ve lost your physical card, you can replace your card at any Richland Library location. Bring a photo ID and we will give you a new card right away. There is a $1 replacement fee. If you would like to protect your account, contact us with your full name and we can block your account from use until you can get by to replace it.</p><h3>Reprint Your Card</h3><p>In order to reprint your library card, <a href="/my-account">sign in to your account</a> on our website. Once signed in, go back up to the orange "My Account" button and click to reveal the drop-down menu. Select "Reprint my Library card" and then print the page that appears. Cut out or fold up your card and use it to check out just as you would your plastic card. Don\'t toss your paper card in the trash without shredding it. We have plastic sleeves to hold a paper card, just ask for one at the checkout desk.</p>',a=e("#edit-polaris-auto-register-name-first").val(),o=e("#edit-polaris-auto-register-name-middle").val(),i=e("#edit-polaris-auto-register-name-last").val(),t=e("#edit-polaris-auto-register-phone-voice-1").val(),s=e("#edit-polaris-auto-register-email").val(),l=/^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i,u=e("#edit-polaris-auto-register-dob-month").val(),d=e("#edit-polaris-auto-register-dob-day").val(),p=e("#edit-polaris-auto-register-dob-year").val(),c=u+"-"+d+"-"+p;return l.test(s)?(e(".progress").show(),e("#edit-polaris-auto-register-email").removeClass("error"),e(".email_msg").html("").slideUp(),e.ajax({url:"/polaris-auto-register/check-email",type:"POST",data:{email:s,fname:a,mname:o,lname:i,phone:t,dob:c},success:function(o){if(e(".progress").hide(),0==o["return"]){e.cookie("polaris_auto_register_ity_name",a);var i=o.barcode;e.cookie("polaris_auto_register_ity_barcode",i);var t=o.email;e.cookie("polaris_auto_register_ity_email",t);var s=t.split("@"),l=t.slice(0,1);t=l+"******@"+s[1],i="***** ***** "+i.slice(-4),null===o.polaris_name&&(o.polaris_name=""),""!=o.email?newMsg='<h3>Is This You?</h3><p>It appears that you may already have a library card at Richland Library.</p><ul style="list-style-type:none"><li><div class="registrant">Name: '+o.polaris_name+'</div></li><li><div class="registrant">Library Card: '+i+'</div></li><li><div class="registrant">Email: '+t+'</div></li></ul><input class="emailBtn form-submit" type="button" value="Email My Library Card Number to Me" /><p>If you have any difficulties, please <a href="/ask-us">Ask a Librarian</a>.</p>'+r:newMsg='<h3>Is This You?</h3><p>It appears that you may already have a library card at Richland Library.</p><ul style="list-style-type:none"><li><div class="registrant">Name: '+o.polaris_name+'</div></li><li><div class="registrant">Library Card: '+i+'</div></li></ul><p>It appears that you may already have a Richland Library customer account, but the account may not have an associated email address. You will need an email on file for automatic retrieval of your library card. If you don’t have one, please visit one of our branch locations with a valid photo ID to get your library card number.</p><p>If you have any difficulties, please <a href="/ask-us">Ask a Librarian</a>.</p>'+r,e("#edit-polaris-auto-register-email").addClass("error"),e(".email_msg").html(newMsg).slideDown()}}}).always(function(){e("body").hasClass("page-polaris-auto-register-lost-card-number")&&n(r)}),!1):(e("#edit-polaris-auto-register-email").addClass("error"),e(".email_msg").html("Please enter a valid email address").slideDown(),!1)}function i(){var r=e("#edit-polaris-auto-register-phone-voice-1").val();return e(".progress").show(),e("#edit-polaris-auto-register-email").removeClass("error"),e(".email_msg").html("").slideUp(),e.ajax({url:"/polaris-auto-register/telephone-lookup-ajax",type:"POST",data:{phone:r},success:function(r){e(".progress").hide(),0==r["return"]?(null===r.polaris_name&&(r.polaris_name=""),newMsg='<h3>Matching Customers:</h3><ul style="list-style-type:none"><li><div class="registrant">Name: '+r.name+'</div></li><li><div class="registrant">Phone Number: '+r.phone+'</div></li><li><div class="registrant">Library Card:<br><b>'+r.barcode+"</b></div></li></ul>"):newMsg="<h3>No Matches Found.</h3>",e(".email_msg").html(newMsg).slideDown()}}),!1}function t(){var r=e.cookie("polaris_auto_register_ity_barcode"),a=e.cookie("polaris_auto_register_ity_email"),o=e.cookie("polaris_auto_register_ity_name");return e.ajax({url:"/polaris-auto-register/send-email",type:"POST",data:{f_name:o,x_barcode:r,x_email:a},success:function(r,a){1==r&&(e.cookie("polaris_auto_register_ity_name",""),e.cookie("polaris_auto_register_ity_barcode",""),e.cookie("polaris_auto_register_ity_email",""),newMsg2='<h3>Your Email Has Been Sent</h3><p>An email has been sent to your email address on file  containing your barcode.</p><input class="closeBtn form-submit" type="button" value="Close This Page" /><p>If you have any difficulties, please <a href="/ask-us">Ask a Librarian</a>.</p>',e("#edit-polaris-auto-register-email").removeClass("error"),e(".email_msg").html(newMsg2).slideDown())}}),!1}function s(){var r=e("#edit-polaris-auto-register-phone-voice-1").val();r=r.toString(),r=r.replace(/\D/g,""),r=r.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"),12!=r.length?(e("#edit-polaris-auto-register-phone-voice-1").addClass("error"),e("#edit-polaris-auto-register-phone-voice-1").focus(),e(".phone1-error").show(),e(".phone1_error").html("Please enter a 10 digit phone number (e.g., 555-555-55555).").slideDown()):(e(".phone1-error").hide(),e(".phone1_error").html("").slideUp(),e("#edit-polaris-auto-register-phone-voice-1").removeClass("error"),e("#edit-polaris-auto-register-phone-voice-1").val(r))}function l(){var r=e("#edit-polaris-auto-register-phone-voice-2").val();r=r.toString(),r=r.replace(/\D/g,""),r=r.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"),r.length>=1&&12!=r.length?(e("#edit-polaris-auto-register-phone-voice-2").addClass("error"),e("#edit-polaris-auto-register-phone-voice-2").focus(),e(".phone2-error").show(),e(".phone2_error").html("Please enter a 10 digit phone number (e.g., 555-555-55555).").slideDown()):(e(".phone2-error").hide(),e(".phone2_error").html("").slideUp(),e("#edit-polaris-auto-register-phone-voice-2").removeClass("error"),e("#edit-polaris-auto-register-phone-voice-2").val(r))}function n(r){if(e(".email_msg").is(":empty")){var a=e("#polaris_markup2").html();e(".email_msg").html("Sorry, we were not able to find any matching information in our system. "+a+r).slideDown()}}Drupal.behaviors.polaris_auto_register={attach:function(t){r(),e("body:not(.page-polaris-auto-register-lost-card-number, .page-connected) #edit-polaris-auto-register-dob-year").focusout(function(){a()}),e("#edit-polaris-auto-register-email").focusout(function(){o()}),e("#edit-polaris-auto-register-phone-voice-1").focusout(function(){s()}),e("#edit-polaris-auto-register-phone-voice-2").focusout(function(){l()}),e("#polaris-auto-register-lost-card-lookup").click(function(){return o(),!1}),e(".page-polaris-auto-register-telephone-lookup #edit-polaris-auto-register-phone-voice-1").focusout(function(){i()}),e("#polaris-auto-register-staff-telephone-lookup").click(function(){return i(),!1})}},e(".email_msg").on("click",".emailBtn",function(){t()}),e(".email_msg").on("click",".closeBtn",function(){location.href=window.location.origin})}(jQuery);