<?php

/**
 * @file openid_ee.module
 */


/**
 * openid.ee login form 
 */
function openid_ee_login_form($form, &$form_state) {

  global $user;

  if (!$user->uid > 0) {

    drupal_add_css(drupal_get_path('module', 'openid_ee') . '/openid_ee.css');
        
    $form['openid_identifier'] = array(
      '#type' => 'hidden',
      '#default_value' => 'https://openid.ee:10443', // @todo make URL into a variable
      '#id' => 'edit-openid-ee-identifier-card',
    );

    $form['submit'] = array(
      '#type' => 'submit',
      '#value' => t('ID card'),
      '#attributes' => array('class' => array('openid-ee-button')), 
    
  );
    
    $form['openid.return_to'] = array(
      '#type' => 'hidden',
      '#value' => url('openid/authenticate', array('absolute' => TRUE, 'query' => user_login_destination())),
    );


    $form['#validate'] = array('openid_login_validate');

    return $form;

  }

}


/**
 * Implements hook_block_info().
 */
function openid_ee_block_info() {
  $blocks['openid_ee'] = array(
    'info' => t('Estonian ID card login'),
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function openid_ee_block_view($delta) {
  switch ($delta) {
    case 'openid_ee':
      return array(
        'subject' => NULL,
        'content' => drupal_get_form('openid_ee_login_form'),
      );
  }
}

// print_r(drupal_get_form('openid_ee_login_form'));