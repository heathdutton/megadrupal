<?php
/**
 * @file
 * General functionality of the module
 */


/**
 * Implements hook_menu().
 */
function little_helper_menu() {

  $arr_adminpages = array();

  $arr_adminpages['admin/config/user-interface/little-helper'] = array(
    'title' => 'Little Helper Settings',
    'description' => 'Configure your little helper\'s appearance',
    'file' => 'little_helper.admin.inc',
    'menu_name' => 'management',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('little_helper_generate_settings_form'),
    'access arguments' => array('config_little_helper'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $arr_adminpages;
}

/**
 * Implements hook_block_info().
 */
function little_helper_block_info() {
  $arr_blocks['little_helper_tip_block'] = array(
    'info' => t('My Little Helper'),
  );

  return $arr_blocks;
}

/**
 * Implements hook_block_view().
 */
function little_helper_block_view($delta = '') {

  switch ($delta) {
    case 'little_helper_tip_block':
      drupal_add_css(drupal_get_path('module', 'little_helper') . '/little_helper_starter_style.css');

      $arr_block['subject'] = '';
      $arr_block['content'] = theme(
        'little_helper_template',
        array(
          'cartoon_image' => little_helper_get_chatter_image(),
          'helper_quote' => little_helper_get_quote(),
        )
      );

      break;
  }

  return $arr_block;
}

/**
 * Helper function.
 * @return: The html needed to display the helper's image.
 * (string)
 */
function little_helper_get_chatter_image() {

  $i_fid = variable_get('little_helper_config_img');
  $s_imagehtml = '';

  // Check if the admin has uploaded the file.
  if ($i_fid != NULL) {

    $o_file = file_load((string) $i_fid);

    if ($o_file != FALSE) {

      $s_imagehtml = theme_image(
        array(
          'path' => file_create_url($o_file->uri),
          'alt' => t('Hello! I am here to help!'),
          'attributes' => array('id' => 'helper-image'),
        )
      );
    }
  }

  return $s_imagehtml;
}

/**
 * Helper function.
 * @return: A random quote.
 * (string)
 */
function little_helper_get_quote() {

  $s_chosenquote = '';
  $s_quotes = variable_get('little_helper_config_tips');

  if ($s_quotes != NULL) {

    $arr_quotes = explode("\n", $s_quotes);
    $i_rand = rand(0, count($arr_quotes) - 1);
    $s_chosenquote = $arr_quotes[$i_rand];

  }

  return $s_chosenquote;

}

/**
 * Implements hook_theme().
 */
function little_helper_theme() {

  return array(
    'little_helper_template' => array(
      'template' => 'little_helper_html',
      'type' => 'module',
      'variables' => array('cartoon_image' => NULL, 'helper_quote' => NULL),
    ),

  );

}


/**
 *	Implements hook_permission().
 */
function little_helper_permission() {
  $arr_permissions = array();

  $arr_permissions['config_little_helper'] = array('title' => t('Configure Funny Tips'));

  return $arr_permissions;
}
