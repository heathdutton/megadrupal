<?php
/**
 * @file
 * Code for creating javascript field formatters
 */

/**
 * Implements hook_field_formatter_info().
 */
function jsfieldformatter_field_formatter_info() {
  return array(
    'jsfieldformatter_formatter_behaviour' => array(
      'label' => t('Javascript Behaviour'),
      'field types' => array('text_long', 'text'),
    ),
  );
}

/**
 * Implements hook_field_formatter_view().
 */
function jsfieldformatter_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $element = array();
  if ($display['type'] == 'jsfieldformatter_formatter_behaviour') {
    foreach ($items as $delta => $item) {
      $element[$delta] = array(
        '#markup' => '
<script>
  (function ($) {
    Drupal.behaviors.jsfieldformatter_behavior_' . uniqid() . ' = {
      attach: function (context, settings) {
        ' . $item['value'] . '
      }
    };
  })(jQuery);</script>',
      );
    }
  }
  return $element;
}
