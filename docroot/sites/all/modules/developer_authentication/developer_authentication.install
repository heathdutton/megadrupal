<?php

/**
 * @file
 * Define requirements for installing the module.
 */

/**
 * Implements hook_requirements().
 */
function developer_authentication_requirements($phase) {
  $requirements = array();
  // Ensure translations don't break at install time.
  $t = get_t();

  $requirements['php-ldap'] = array(
    'title' => $t('PHP LDAP extension'),
    'value' => $t('Enabled'),
    'description' => $t('Your PHP installation has support for LDAP binding.'),
    'severity' => REQUIREMENT_OK,
  );

  // Check for LDAP support.
  if (!function_exists('ldap_bind')) {
    if (!variable_get('developer_authentication_admin_pwd', FALSE)) {
      $requirements['php-ldap']['severity'] = REQUIREMENT_ERROR;
    }
    else {
      $requirements['php-ldap']['severity'] = REQUIREMENT_WARNING;
    }
    $requirements['php-ldap']['description'] = $t('Your PHP installation does not have support for LDAP binding.');
    $requirements['php-ldap']['value'] = $t('Not enabled');
  }

  return $requirements;
}

/**
 * Implements hook_uninstall().
 */
function developer_authentication_uninstall() {
  // Remove the variables added by the module.
  variable_del('developer_authentication_admin_pwd');
  variable_del('developer_authentication_ldap_server');
  variable_del('developer_authentication_ldap_port');
  variable_del('developer_authentication_username_field');
  variable_del('developer_authentication_basedn');
}
