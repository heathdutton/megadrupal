<?php

/**
 * Implements hook_menu()
 */
function admin_notification_menu() {
  $items['admin/config/administration/admin_notification'] = array(
    'title' => 'Admin notification',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('admin_notification_admin'),
    'access arguments' => array('administer admin notification'),
  );
  return $items;
}

function admin_notification_init() {
  if (user_is_logged_in() && variable_get('admin_notification_enabled', FALSE)) {
    $message = variable_get('admin_notification_message', '');
    if (!empty($message)) {
      $type = variable_get('admin_notification_type', 'status');
      drupal_set_message($message, $type, FALSE);
    }
  }
}

/**
 * Implements hook_permission()
 */
function admin_notification_permission() {
  return array(
    'administer admin notification' => array(
      'title' => t('Administer admin notification'),
    ),
  );
}

function admin_notification_admin() {
  $form = array();
  $form['admin_notification_enabled'] = array(
    '#type' => 'checkbox',
    '#title' => t('Show admin notification'),
    '#default_value' => variable_get('admin_notification_enabled', FALSE),
  );
  $form['admin_notification_message'] = array(
    '#type' => 'textfield',
    '#title' => t('Admin notification message'),
    '#description' => t('Message shown to logged-in users'),
    '#default_value' => variable_get('admin_notification_message', ''),
  );
  $types = array(
    'status' => t('Status'),
    'warning' => t('Warning'),
    'error' => t('Error'),
  );
  $form['admin_notification_type'] = array(
    '#type' => 'select',
    '#options' => $types,
    '#title' => t('Admin notification type'),
    '#description' => t('Message type, defines how the message is formatted'),
    '#default_value' => variable_get('admin_notification_type', 'status'),
  );
  return system_settings_form($form);
}
