<?php

/**
 * @file
 * Main module file for Gitlab Accounts UI.
 */

define('GITLAB_ACCOUNTS_UI_ADMIN_PAGE_URL', 'admin/config/services/gitlab-accounts');

/**
 * Implements hook_menu().
 */
function gitlab_accounts_ui_menu() {
  $items = array();
  $items['admin/config/services/gitlab-accounts'] = array(
    'title' => 'GitLab Accounts',
    'description' => 'Manage GitLab Accounts in the system.',
    'page callback' => 'gitlab_accounts_ui_accounts_admin_page',
    'access arguments' => array('administer gitlab accounts'),
    'file' => 'gitlab_accounts_ui.admin.inc',
  );
  $items['admin/config/services/gitlab-accounts/account/add'] = array(
    'title' => 'Add account',
    'description' => 'Add GitLab account',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('gitlab_accounts_ui_add_account_form'),
    'access arguments' => array('administer gitlab accounts'),
    'file' => 'gitlab_accounts_ui.admin.inc',
    'type' => MENU_LOCAL_ACTION,
  );
  $items['admin/config/services/gitlab-accounts/account/%gitlab_accounts_ui_account/edit'] = array(
    'title' => 'Edit GitLab account',
    'description' => 'Edit GitLab account',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('gitlab_accounts_ui_edit_account_form', 5),
    'access callback' => 'gitlab_accounts_ui_account_access',
    'access arguments' => array('administer gitlab accounts', 5),
    'file' => 'gitlab_accounts_ui.admin.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  $items['admin/config/services/gitlab-accounts/account/%gitlab_accounts_ui_account/delete'] = array(
    'title' => 'Delete GitLab account',
    'description' => 'Delete GitLab account',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('gitlab_accounts_ui_delete_account_form', 5),
    'access callback' => 'gitlab_accounts_ui_account_access',
    'access arguments' => array('administer gitlab accounts', 5),
    'file' => 'gitlab_accounts_ui.admin.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  return $items;
}

/**
 * Load callback to load Gitlab account entity by its id.
 *
 * @see gitlab_accounts_ui_menu()
 */
function gitlab_accounts_ui_account_load($account_id) {
  $accounts = entity_load('gitlab_account', array($account_id));
  if (!empty($accounts[$account_id])) {
    return $accounts[$account_id];
  }
  return NULL;
}

/**
 * Page access check function for GitLab accounts related modifications.
 *
 * @see gitlab_accounts_ui_menu()
 */
function gitlab_accounts_ui_account_access($permission, $account) {
  if (!user_access($permission) || empty($account)) {
    return FALSE;
  }
  return TRUE;
}
