<?php

/**
 * @file
 * Contains module logic for shortcode_date.
 */

/**
 * Implements hook_help().
 */
function shortcode_date_help($path, $arg) {

  switch ($path) {
    case 'admin/help#shortcode_date':
      $help = t("All Utility type code for his site is written here.");
      return $help;
  }
}

/**
 * Implements hook_shortcode_info().
 */
function shortcode_date_shortcode_info() {
  $shortcodes['date'] = array(
    'title' => t('Date'),
    'description' => t('Embeds date with given time and format. For example: [date format="Y-m-d" /] or [date time="now" format="Y-m-d" /]. Default is time="now" format="Y-m-d". <strong>time</strong> can be any string which supports by <a href="http://php.net/manual/en/function.strtotime.php" target="_blank" >strtotime()</a> and <strong>format</strong> can be any string which supports by <a href="http://php.net/manual/en/function.date.php" target="_blank" >date()</a>.'),
    'process callback' => '_shortcode_date',
    // 'settings callback' => '_shortcode_settings_form', TODO
    // 'attributes callback' => "_shortcode_date_attributes",
    'tips callback' => '_shortcode_date_tip',
  );
  return $shortcodes;
}

/**
 * Implements callback function for hook_filter_info().
 */
function _shortcode_date($attrs, $text) {

  // watchdog('shortcode_date', '<pre>'. print_r($attrs, TRUE) .'</pre>');
  $attrs = shortcode_attrs(array(
    'time' => 'now',
    'format' => 'Y-m-d',
      ), $attrs
  );
  // watchdog('shortcode_date', '<pre>'. print_r($attrs, TRUE) .'</pre>');
  $time = check_plain($attrs['time']);
  $format = check_plain($attrs['format']);
  $date_string = date($format, strtotime($time));
  // watchdog('shortcode_date', $date_string);
  return $date_string;
}

/**
 * Implements callback function for for tips.
 */
function _shortcode_date_tip($format, $long) {
  $output = array();
  $output[] = '<p><strong>' . t('[date time="now" format="Y-m-d" /]') . '</strong> ';
  if ($long) {
    $output[] = t('Embeds date with given time and format.') . '</p>';
  }
  else {
    $output[] = t('Embeds date with given time and format. For example: [date format="Y-m-d" /] or [date time="now" format="Y-m-d" /]. Default is time="now" format="Y-m-d". <strong>time</strong> can be any string which supports by <a href="http://php.net/manual/en/function.strtotime.php" target="_blank" >strtotime()</a> and <strong>format</strong> can be any string which supports by <a href="http://php.net/manual/en/function.date.php" target="_blank" >date()</a>.') . '</p>';
  }
  return implode(' ', $output);
}
