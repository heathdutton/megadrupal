<?php

/**
 * @file
 */
/**
 * Implements with use of hook_permission().
 */
function commerce_axisbank_permission() {
  return array(
    'access commerce_axisbank page' => array(
    'title' => t('Access page'),
    'description' => t('Allow users to access page'),
    ),
  );
}
/**
 * Implements hook_menu().
 */
function commerce_axisbank_menu() {

  $items['send_response_page'] = array(
    'page callback' => 'page_send_response_data',
    'access arguments' => array('access commerce_axisbank page'),
    'file' => 'includes/vpc_php_serverhost_do.inc',
  );
  $items['get_response_page'] = array(
    'page callback' => 'page_get_response_data',
    'access arguments' => array('access commerce_axisbank page'),
    'file' => 'includes/vpc_php_serverhost_dr.inc',
  );
  return $items;
}
/**
 * Payment method callback: settings form.
 */
function axisbank_settings_form($settings = NULL) {
  
  $form = array();
  $settings = (array) $settings + array(
    'vpc_Version' => '',
    'vpc_Command' => '',
     'vpc_MerchTxnRef' => '',
    'transaction_order_info' => '',
    'vpc_Merchant' => '',
    'vpc_AccessCode' => '',
    'virtualPaymentClientURL' => '',
    'site_url' => '',
    'secure_ssh' => '',
  );
  $form['vpc_Merchant'] = array(
    '#type' => 'textfield',
    '#title' => t('Merchant ID'),
    '#default_value' => $settings['vpc_Merchant'],
    '#required' => TRUE,
  );
  $form['vpc_AccessCode'] = array(
    '#type' => 'textfield',
    '#title' => t('Merchant Access Code'),
    '#default_value' => $settings['vpc_AccessCode'],
    '#required' => TRUE,
  );
  $form['virtualPaymentClientURL'] = array(
    '#type' => 'textfield',
    '#title' => t('VirtualPaymentClientURL'),
    '#default_value' => $settings['virtualPaymentClientURL'],
    '#required' => TRUE,
  );
  $form['vpc_Version'] = array(
    '#type' => 'textfield',
    '#title' => t('VPC Version'),
    '#default_value' => $settings['vpc_Version'],
    '#required' => TRUE,
  );
  $form['vpc_Command'] = array(
    '#type' => 'textfield',
    '#title' => t('VPC Command'),
    '#default_value' => $settings['vpc_Command'],
    '#required' => TRUE,
  );
  $form['vpc_MerchTxnRef'] = array(
    '#type' => 'textfield',
    '#title' => t('Merchant Transfer Refrence'),
    '#default_value' => $settings['vpc_MerchTxnRef'],
    '#required' => TRUE,
  );
  $form['site_url'] = array(
    '#type' => 'textfield',
    '#title' => t('Site URL'),
    '#default_value' => $settings['site_url'],
    '#required' => TRUE,
    '#description' => t('Please remove last slash from the site url'),
  );
  $form['secure_ssh'] = array(
    '#type' => 'textfield',
    '#title' => t('SECURE SSH CODE'),
    '#default_value' => $settings['secure_ssh'],
    '#required' => TRUE,
  );
  return $form;
}
/**
 * Implements hook_commerce_payment_method_info().
 */
function commerce_axisbank_commerce_payment_method_info() {
  
  $payment_methods = array();
  $payment_methods['axisbank'] = array(
    'base' => 'axisbank',
    'title' => t("Commerce AXISBANK Payment Gateway"),
    'display_title' => "Commerce AXISBANK Payment Gateway",
    'short_title' => 'Commerce AXISBANK Payment Gateway',
    'description' => t("Payment method - Commerce AXISBANK Payment Gateway"),
    'terminal' => TRUE,
    'offsite' => TRUE,
    'offsite_autoredirect' => TRUE,
  );
  return $payment_methods;
}
/**
 * Payment method callback: redirect form.
 */
function axisbank_redirect_form($form, &$form_state, $order, $payment_method) {

  $vpc_merchant = $payment_method['settings']['vpc_Merchant'];
  $vpc_accesscode = $payment_method['settings']['vpc_AccessCode'];
  $virtualpaymentclienturl =$payment_method['settings']['virtualPaymentClientURL'];
  $vpc_version = $payment_method['settings']['vpc_Version'];
  $vpc_command = $payment_method['settings']['vpc_Command'];
  $vpc_merchtxnref = $payment_method['settings']['vpc_MerchTxnRef'];
  $site_url = $payment_method['settings']['site_url'];
  $secure_ssh = $payment_method['settings']['secure_ssh'];
  $return_url = $site_url . '/get_response_page';
  
  $form['vpc_Merchant'] = array(
    '#type' => 'hidden',
    '#value' => $vpc_merchant,
  );
  $form['vpc_AccessCode'] = array(
    '#type' => 'hidden',
    '#value' => $vpc_accesscode,
  );
  $form['secure_secret'] = array(
    '#type' => 'hidden',
    '#value' => $secure_ssh,
  );
  $form['virtualPaymentClientURL'] = array(
    '#type' => 'hidden',
    '#value' => $virtualpaymentclienturl,
  );
  $form['vpc_Version'] = array(
    '#type' => 'hidden',
    '#value' => $vpc_version,
  );
  $form['vpc_Command'] = array(
    '#type' => 'hidden',
    '#value' => $vpc_command,
  );
  $form['vpc_MerchTxnRef'] = array(
    '#type' => 'hidden',
    '#value' => $vpc_merchtxnref,
  );
  $form['site_url'] = array(
    '#type' => 'hidden',
    '#value' => $site_url,
  );
  $form['vpc_ReturnURL'] = array(
    '#type' => 'hidden',
    '#value' => $return_url,
  );
  $form['vpc_Amount'] = array(
    '#type' => 'hidden',
    '#value' => $order->commerce_order_total['und'][0]['amount'],
  );
  $form['vpc_OrderInfo'] = array(
   '#type' => 'hidden',
   '#value' => $order->order_id,
  );
  $link = $site_url . '/send_response_page';
  $form['#action'] = $link;
  return $form;
}
