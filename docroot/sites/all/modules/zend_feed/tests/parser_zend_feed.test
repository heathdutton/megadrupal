<?php

/**
 * @file
 */

/**
 * ZendFeedTestCase class.
 */
class ParserZendFeedTestCase extends DrupalTestCase {
  
  function get_info() {
    return array(
      'name' => 'Zend_Feed Parser test cases',
      'desc' => 'Makes sure that Zend_Feed Parser is working.',
      'group' => 'FeedAPI Add On',
    );
  }
  
  /**
   * Test RSS feed.
   */ 
  function testParserZendFeedParseRss() {
    global $base_url;
    
    $rss_url = url('rss.xml', NULL, NULL, 1);
    $zend_feed_abstract = zend_feed_import($rss_url);
    if (is_object($zend_feed_abstract)) {
      $feed = parser_zend_feed_parse($zend_feed_abstract);
      $feed_info = array(
        'title'       => $feed->title,
        'description' => $feed->description,
        'link'        => $feed->options->link,
      );
      $channel_defaults = array(
        'title'       => variable_get('site_name', 'Drupal') .' - '. variable_get('site_slogan', ''),
        'description' => variable_get('site_mission', ''),
        'link'        => $base_url,
      );
      $this->assertEqual($feed_info, $channel_defaults, 'Get information from RSS feed test');
    }
  }
  
  /**
   * Test Atom feed.
   */
  function testParserZendFeedParseAtom() {
    global $base_url;
    
    $atom_url = url('rss.xml', NULL, NULL, 1);
    $zend_feed_abstract = zend_feed_import($atom_url);
    if (is_object($zend_feed_abstract)) {
      $feed = parser_zend_feed_parse($zend_feed_abstract);
      $feed_info = array(
        'title'       => $feed->title,
        'description' => $feed->description,
        'link'        => $feed->options->link,
      );
      $channel_defaults = array(
        'title'       => variable_get('site_name', 'Drupal') .' - '. variable_get('site_slogan', ''),
        'description' => variable_get('site_mission', ''),
        'link'        => $base_url,
      );
      $this->assertEqual($feed_info, $channel_defaults, 'Get information from Atom feed test');
    }
  }
  
  function testParserZendFeedImage() {
    $rss_url = 'http://feeds.feedburner.com/BurnThisRSS2';
    $zend_feed_abstract = zend_feed_import($rss_url);
    if (!is_object($zend_feed_abstract)) {
      return;
    }
    $feed = parser_zend_feed_parse($zend_feed_abstract);
    $this->assertEqual($feed->options->image, "http://www.feedburner.com/fb/feed-styles/images/footer_logo.gif", 'Get image url test');
  }
  
  function testParserZendFeedCategory() {
    $zend_feed_abstract = zend_feed_import('http://sosyalmekan.wordpress.com/feed/');
    if (!is_object($zend_feed_abstract)) {
      return;
    }
    $feed = parser_zend_feed_parse($zend_feed_abstract);
    
    $tags = array('enteresan', 'teknik');
    $this->assertEqual($feed->items[4]->options->tags, $tags, 'Get categories test');
  }
  
  function testParserZendFeedLink() {
    $rss_url = 'http://sosyalmekan.wordpress.com/feed/';
    $zend_feed_abstract = zend_feed_import($rss_url);
    if (!is_object($zend_feed_abstract)) {
      return;
    }
    $feed = parser_zend_feed_parse($zend_feed_abstract);
    
    $link = 'http://sosyalmekan.wordpress.com';
    $this->assertEqual($feed->options->link, $link, 'Get link test');
  }
  
  function testParserZendFeedLink2() {
    $rss_url = 'http://handlet.blogspot.com/feeds/posts/default';
    $zend_feed_abstract = zend_feed_import($rss_url);
    if (!is_object($zend_feed_abstract)) {
      return;
    }
    $feed = parser_zend_feed_parse($zend_feed_abstract);
    
    $link = 'http://handlet.blogspot.com/';
    $this->assertEqual($feed->options->link, $link, 'Get link test');
  }
  
  function testParserZendFeedOrigLink() {
    $rss_url = 'http://feeds.feedburner.com/beyn';
    $zend_feed_abstract = zend_feed_import($rss_url);
    if (!is_object($zend_feed_abstract)) {
      return;
    }
    $feed = parser_zend_feed_parse($zend_feed_abstract);
    
    $link = 'http://beyn.org/on-baglanti-16/';
    $this->assertEqual($feed->items[0]->options->link, $link, 'Get origLink test');
  }
}
