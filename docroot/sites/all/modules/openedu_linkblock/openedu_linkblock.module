<?php
/**
 * @file
 * Code for the OpenEDU Linkblock feature.
 */

include_once 'openedu_linkblock.features.inc';

/**
 * openedu_linkblock.module
 * Developed @ ImageX Media http://www.imagexmedia.com/
 * @package OpenEDU
 * @version 7.x-1.x
 * @link http://www.drupal.org/project/openedu_linkblock/
 *
 * Description:
 *
 * This module creates the ability for content authors to create blocks with a
 * list of links.
 *
 */

/**
 * Implements hook_help().
 */
function openedu_linkblock_help($path, $arg) {
  switch ($path) {
    // Main module help for the block module
    /*
     *case 'admin/help#block':
     *  return '<p>' . t('Blocks are boxes of content rendered into an area, or region, of a web page. The default theme Bartik, for example, implements the regions "Sidebar first", "Sidebar second", "Featured", "Content", "Header", "Footer", etc., and a block may appear in any one of these areas. The <a href="@blocks">blocks administration page</a> provides a drag-and-drop interface for assigning a block to a region, and for controlling the order of blocks within regions.', array('@blocks' => url('admin/structure/block'))) . '</p>';
     */
    case 'admin/help#openedu_linkblock':
      return '<p>' . t('Please visit: %l', array('%l' => l('ImageX Media', 'http://www.imagexmedia.com/openedu/'))) . '</p>';
  }
}


/**
 * Link field has issue with rendering the <front> option. Lets give it a bit
 * of help
 * @param  $variables  preprocess variables
 * @param  $hook
 */

function openedu_linkblock_preprocess_field(&$vars, $hook) {
  global $language;
  $lang = $language->language;

  // If link field...
  if($vars['element']['#field_type'] == "link_field") {
    $field_name = $vars['element']['#field_name'];
    foreach($vars['element']['#object']->{$field_name}[$lang] as $k => $v) {
      if($v['url'] == "&lt;front&gt;") {
        if(isset($v['attributes']['target']) && $v['attributes']['target'] == "user") {
          unset($v["attributes"]['target']);
        }
        $vars['items'][$k]["#markup"] = l($v['title'], "<front>", array('attributes' => $v['attributes'], 'html' => TRUE, 'language' => $language));
      }
    }
  }

}
