<?php
/**
 * @file
 * Hooks into existing forms and adds Token callbacks and elements.
 */

/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */
function manymail_token_form_manymail_send_form_alter(&$form, &$form_state, $form_id) {
  if (!empty($form['content'])) {
    // Globals like current-user get added anyway.
    $form['content']['body']['#token_types'] = array('manymail-recipient');
    $form['content']['body']['#element_validate'] = array('token_element_validate');

    $form['content']['token_help'] = array(
      '#title' => t('Replacement patterns'),
      '#type' => 'fieldset',
      '#collapsible' => TRUE,
      '#collapsed' => TRUE,
      '#description' => t('Replacement tokens for the message body.'),
    );

    $form['content']['token_help']['help'] = array(
      '#theme' => 'token_tree',
      '#global_types' => FALSE,
      '#token_types' => array(
        'current-user',
        'current-date',
        'site',
        'manymail-recipient',
      ),
    );
  }

  if (!empty($form['signature'])) {
    $form['signature']['token_help'] = array(
      '#title' => t('Replacement patterns'),
      '#type' => 'fieldset',
      '#collapsible' => TRUE,
      '#collapsed' => TRUE,
      '#description' => t('Replacement tokens for the signature.'),
    );

    $form['signature']['token_help']['help'] = array(
      '#theme' => 'token_tree',
      '#global_types' => FALSE,
      '#token_types' => array(
        'current-user',
        'current-date',
        'site',
        'manymail-recipient',
      ),
    );
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function manymail_token_form_manymail_config_defaults_form_alter(&$form, &$form_state, $form_id) {
  $form['default_content']['manymail_default_body']['#token_types'] = array('manymail-recipient');
  $form['default_content']['manymail_default_body']['#element_validate'] = array('token_element_validate');
  $form['default_content']['manymail_default_signature']['#token_types'] = array('manymail-recipient');
  $form['default_content']['manymail_default_signature']['#element_validate'] = array('token_element_validate');

  $form['default_content']['token_help'] = array(
    '#title' => t('Replacement patterns'),
    '#type' => 'fieldset',
    '#collapsible' => TRUE,
    '#collapsed' => TRUE,
    '#description' => t('Replacement tokens for the body and signature.'),
  );

  $form['default_content']['token_help']['help'] = array(
    '#theme' => 'token_tree',
    '#global_types' => FALSE,
    '#token_types' => array(
      'current-user',
      'current-date',
      'site',
      'manymail-recipient',
    ),
  );
}
