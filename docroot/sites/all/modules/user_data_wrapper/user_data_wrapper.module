<?php
/**
 * @file
 * Module to extend entity meta wrapper to get hold of user data.
 */

/**
 * Implements hook_entity_property_info_alter().
 *
 * Add the data handler to entity api.
 */
function user_data_wrapper_entity_property_info_alter(&$info) {
  $properties = & $info['user']['properties'];

  $definitions = module_invoke_all('user_data_info');

  foreach ($definitions as $key => $definition) {
    $properties[$key] = array(
      'label' => $definition['label'],
      'type' => $definition['type'],
      'getter callback' => 'user_data_wrapper_get',
      'setter callback' => 'user_data_wrapper_set',
    );
  }
}

/**
 * Callback for getting user properties.
 *
 * @see entity_metadata_user_entity_info_alter()
 */
function user_data_wrapper_get($account, array $options, $name, $entity_type) {
  $user_data = new UserDataWrapper($account, $name);
  return $user_data->getData();
}

/**
 * Callback for setting user properties.
 *
 * @see entity_metadata_user_entity_info_alter()
 */
function user_data_wrapper_set($account, $name, $value) {
  $user_data = new UserDataWrapper($account, $name);
  $user_data->setData($value);
}
