<?php

/**
 * @file
 * "Yet Another Yellow Box"
 *
 * This file contains custom functionality for creating an alert block.
 *
 * @ingroup hfcc_modules
 */

/**
 * Implements hook_perm().
 */
function yayb_permission() {
  return array(
    'post yayb messages' => array(
      'title' => t('Post alert messages.'),
      'description' => t('Post site alert messages using warning box.'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function yayb_menu() {
  $items = array();
  $items['admin/config/system/yayb'] = array(
    'title' => 'Alert Message Configuration',
    'description' => 'Administer site alert messages.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('yayb_admin_settings'),
    'access arguments' => array('post yayb messages'),
    'type' => MENU_NORMAL_ITEM,
  );
  return $items;
}

/**
 * Page callback for yayb_admin_settings.
 */
function yayb_admin_settings() {
  $options = array('1' => t('Show Yellow Box'), '0' => t('Hide Yellow Box'));
  $form = array();
  $form['yayb_toggle'] = array(
    '#type' => 'radios',
    '#title' => t('Display Options'),
    '#default_value' => variable_get('yayb_toggle', 0),
    '#options' => $options,
    '#description' => t('Current message visibility.'),
  );
  $form['yayb_title'] = array(
    '#type' => 'textfield',
    '#title' => t('Title'),
    '#default_value' => variable_get('yayb_title', t('Important Message')),
    '#description' => t('Title for message block.'),
  );
  $form['yayb_message'] = array(
    '#type' => 'textarea',
    '#title' => t('Message'),
    '#default_value' => variable_get('yayb_message', NULL),
    '#description' => t('Message to display to users. This will be passed through the default input filter.'),
  );
  // @todo: Add a field for posting an expiration timestamp.
  // If present, cron would disable message after this time.
  return system_settings_form($form);
}

/**
 * Implements hook_block_info().
 */
function yayb_block_info() {
  return array(
    'yayb' => array(
      'info' => t('Yet Another Yellow Box'),
      //'cache' => DRUPAL_NO_CACHE,
    ),
  );
}

/**
 * Implements hook_block_view().
 */
function yayb_block_view($delta = '') {
  $block = array();
  switch ($delta) {
    case 0:
      if (variable_get('yayb_toggle', 0)) {
        if (variable_get('yayb_title', NULL)) {
          $block['subject'] = check_plain(variable_get('yayb_title', NULL));
        }
        if (variable_get('yayb_message', NULL)) {
          $block['content'] = array('#markup' => check_markup(variable_get('yayb_message', NULL)));
        }
      }
      break;
  }
  return $block;
}
