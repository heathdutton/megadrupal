<?php

/**
 * @file
 * Inline styles cleaner module.
 */

/**
 * Implements hook_menu().
 */
function inline_styles_cleaner_menu() {
  module_load_include('inc', 'inline_styles_cleaner', 'includes/inline_styles_cleaner.common');

  $items = array();

  $items['admin/config/content/inline-styles-cleaner'] = array(
    'title' => 'Inline styles cleaner',
    'description' => 'Inline styles cleaner settings form',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('inline_styles_cleaner_config_form'),
    'access arguments' => array('administer site configuration'),
    'file' => 'includes/inline_styles_cleaner.admin.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  $items[INLINE_STYLES_CLEANER_DOWNLOAD_LINK . '/%file'] = array(
    'page callback' => 'inline_styles_cleaner_download_file',
    'page arguments' => array(5),
    'access arguments' => array('administer site configuration'),
    'type' => MENU_CALLBACK,
  );

  return $items;
}

/**
 * Callback function for download link.
 *
 * @param \stdClass $file
 *   File object.
 */
function inline_styles_cleaner_download_file(stdClass $file) {
  if ($file) {
    $css_file_settings = variable_get('inline_styles_cleaner_css_file', array());
    $css_file_settings['download_needed'] = FALSE;
    variable_set('inline_styles_cleaner_css_file', $css_file_settings);

    file_transfer($file->uri, array(
      'Content-disposition' => 'attachment; filename=' . $file->filename,
    ));
  }
}
