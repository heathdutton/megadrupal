<?php

/**
 * @file
 * Clean summary test.
 */

/**
 * Class CleanSummaryWebTestCase.
 */
class CleanSummaryWebTestCase extends InlineStylesCleanerWebTestCase {
  private $markupSimple = '<div class="simple-markup" style="background: green; border: solid 2px red;">Test</div>';
  private $markupSimpleWithoutStyles = '<div class="simple-markup" >Test</div>';

  /**
   * Standard simpletest function.
   *
   * @return array
   *   Array with test info.
   */
  public static function getInfo() {
    return array(
      'name' => 'Clean summary',
      'description' => 'Check summary cleaning',
      'group' => 'Inline Styles Cleaner',
    );
  }

  /**
   * Check if 'Clean summary' not checked summary should not be cleaned.
   */
  public function testNoSummaryCleaning() {
    $settings = array(
      'batch_edit' => array(
        'inline_styles_cleaner_fields_for_clean[body]' => 'body',
        'inline_styles_cleaner_clean_text_field_summary' => FALSE,
      ),
      'nodes' => array(
        0 => array(
          'nid' => 1,
          'node_type' => 'article',
          'edit' => array(
            'title' => 'Test',
            'body[und][0][summary]' => $this->markupSimple,
            'body[und][0][value]' => $this->markupSimple,
          ),
          'fields_for_check' => array(
            'body[und][0][summary]' => array(
              'field_value' => $this->markupSimple,
              'assert_message' => 'Inline styles in body[und][0][summary] found.',
            ),
            'body[und][0][value]' => array(
              'field_value' => $this->markupSimpleWithoutStyles,
              'assert_message' => 'Inline styles in body[und][0][value] not found.',
            ),
          ),
        ),
      ),
    );

    $this->assertFieldsAfterCleaning($settings);
  }

  /**
   * Check if 'Clean summary' checked summary should be cleaned.
   */
  public function testSummaryCleaning() {
    $settings = array(
      'batch_edit' => array(
        'inline_styles_cleaner_fields_for_clean[body]' => 'body',
        'inline_styles_cleaner_clean_text_field_summary' => TRUE,
      ),
      'nodes' => array(
        0 => array(
          'nid' => 1,
          'node_type' => 'article',
          'edit' => array(
            'title' => 'Test',
            'body[und][0][summary]' => $this->markupSimple,
            'body[und][0][value]' => $this->markupSimple,
          ),
          'fields_for_check' => array(
            'body[und][0][summary]' => array(
              'field_value' => $this->markupSimpleWithoutStyles,
              'assert_message' => 'Inline styles in body[und][0][summary] not found.',
            ),
            'body[und][0][value]' => array(
              'field_value' => $this->markupSimpleWithoutStyles,
              'assert_message' => 'Inline styles in body[und][0][value] not found.',
            ),
          ),
        ),
      ),
    );

    $this->assertFieldsAfterCleaning($settings);
  }
}
