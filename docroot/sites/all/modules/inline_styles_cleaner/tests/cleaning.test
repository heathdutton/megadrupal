<?php

/**
 * @file
 * Cleaning test.
 */

/**
 * Class CleaningWebTestCase.
 */
class CleaningWebTestCase extends InlineStylesCleanerWebTestCase {
  private $markupSimple = '<div class="simple-markup" style="background: green; border: solid 2px red;">Test</div>';
  private $markupSimpleWithoutStyles = '<div class="simple-markup" >Test</div>';
  private $markupComplex = '<div class="complex-markup" style="background: green; border: solid 2px red;"><p>Some text in p tag</p><div class="nested-block" style="background: yellow;"><span>Test <span style="font-size: 20px; color: green;">text</span></span><div class="some-wrapper"><strong>strong text</strong><span class="span-like-div" style="display: block; background: lightblue;">Span text</span></div></div></div>';
  private $markupComplexWithoutStyles = '<div class="complex-markup" ><p>Some text in p tag</p><div class="nested-block" ><span>Test <span >text</span></span><div class="some-wrapper"><strong>strong text</strong><span class="span-like-div" >Span text</span></div></div></div>';

  /**
   * Standard simpletest function.
   *
   * @return array
   *   Array with test info.
   */
  public static function getInfo() {
    return array(
      'name' => 'Cleaning',
      'description' => 'Check cleaning of html markup',
      'group' => 'Inline Styles Cleaner',
    );
  }

  /**
   * Check styles cleaning.
   */
  public function testCleaning() {
    $settings = array(
      'batch_edit' => array(
        'inline_styles_cleaner_fields_for_clean[field_text_field]' => 'field_text_field',
        'inline_styles_cleaner_fields_for_clean[field_text_long_field]' => 'field_text_long_field',
      ),
      'nodes' => array(
        0 => array(
          'nid' => 1,
          'node_type' => 'page',
          'edit' => array(
            'title' => 'Simple markup',
            'field_text_field[und][0][value]' => $this->markupSimple,
          ),
          'fields_for_check' => array(
            'field_text_field[und][0][value]' => array(
              'field_value' => $this->markupSimpleWithoutStyles,
              'assert_message' => 'Inline styles in node/1 not found.',
            ),
          ),
        ),
        1 => array(
          'nid' => 2,
          'node_type' => 'article',
          'edit' => array(
            'title' => 'Complex markup',
            'field_text_long_field[und][0][value]' => $this->markupComplex,
          ),
          'fields_for_check' => array(
            'field_text_long_field[und][0][value]' => array(
              'field_value' => $this->markupComplexWithoutStyles,
              'assert_message' => 'Inline styles in node/2 not found.',
            ),
          ),
        ),
      ),
    );

    $this->assertFieldsAfterCleaning($settings);
  }
}
