<?php

/**
 * @file
 * Main file for User Pic Kit Facebook.
 */

/**
 * Implements hook_userpickit_info().
 */
function userpickit_facebook_userpickit_info() {
  $picture_types = array();

  $picture_types['facebook'] = array(
    'title' => t('Facebook'),
    'description' => t('Your Facebook picture.'),
    'callback' => 'userpickit_facebook_userpickit_picture',
  );

  return $picture_types;
}

/**
 * Callback.
 *
 * @see userpickit_facebook_userpickit_info().
 */
function userpickit_facebook_userpickit_picture($picture_type, $account) {
  if ($account->uid && $facebook_id = fb_get_fbu($account->uid)) {
    if (is_numeric($facebook_id)) {
      $url = 'http://graph.facebook.com/' . $facebook_id . '/picture?type=large';
      $headers = get_headers($url, 1);
      if(isset($headers['Location'])) {
        return array(
          'uri' => $headers['Location'],
        );
      }
    }
  }
}