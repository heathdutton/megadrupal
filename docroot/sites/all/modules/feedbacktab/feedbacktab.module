<?php
// $Id:$

/**
 * @file
 *  Creates a tab by the scrollbar for feedback and suggestions.
 */

/**
 * Implementats hook_theme_registry_alter().
 */
function feedbacktab_theme_registry_alter(&$theme_registry) {
  // Make the array of the page hook's preprocess functions easier to
  // get to.
  $funcs = &$theme_registry['page']['preprocess functions'];

  // Move 'feedbacktab_preprocess_page' to be the first callback
  // function.
  $key = array_search('feedbacktab_preprocess_page', $funcs);
  unset($funcs[$key]);
  array_unshift($funcs, 'feedbacktab_preprocess_page');
}

/**
 * Preprocess function for the page theme hook.
 *
 * This function doesn't use the arguments, and doesn't return
 * anything.  It adds JS and CSS to the page.  It must do this before
 * the page hook's other preprocess functions, so that the JS and CSS
 * is added before they render $styles, $script and $closure.
 */
function feedbacktab_preprocess_page($content, $show_blocks, $show_messages = TRUE) {
  // @todo Make these settings extensible and configurable with an
  // admin/settings/feedbacktab UI.
  $settings = array('iframeUri' => variable_get('feedbacktab_iframe_uri', FALSE));
  drupal_add_js(array('feedbacktab' => $settings), 'setting');

  $path = drupal_get_path('module', 'feedbacktab') . '/includes';

  // Include neccessary core JS (JQuery UI) libraries.
  drupal_add_library('system', 'effects');
  drupal_add_library('system', 'ui.dialog');

  // This module's own stuff.
  drupal_add_js("$path/feedbacktab.js", 'file');
  drupal_add_css("$path/feedbacktab.css");
}