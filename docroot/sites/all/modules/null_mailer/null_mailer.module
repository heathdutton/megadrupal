<?php

function null_mailer_name() {
  return l(t('Null mailer'), 'http://drupal.org/project/null_mailer');
}

function null_mailer_message() {
  return t('Drupal mail system has been disabled by !name module.', array('!name' => null_mailer_name()));
}

/**
 * Implements hook_init().
 */
function null_mailer_init() {
  if (null_mailer_is_active() && $_GET['q'] == 'admin') {
    drupal_set_message(null_mailer_message(), 'warning');
  }
}

/**
 * Returns TRUE if Null mailer is active.
 */
function null_mailer_is_active() {
  $mailer = variable_get('mail_system', FALSE);

  if (isset($mailer['default-system']) && $mailer['default-system'] == 'NullMailSystem') {
    return TRUE;
  }
}

/**
 * Implements hook_requirements().
 */
function null_mailer_requirements($phase) {
  if ($phase == 'runtime') {
    $enabled = null_mailer_is_active();
    if ($enabled) {
      $message = null_mailer_message();
    }
    else {
      $message = t('Drupal mail system is active but !name module is enabled. It seems like "mail_system" system variable has been overridden by another module.', array('!name' => null_mailer_name()));
    }

    $requirements['null_mailer'] = array(
      'title' => t('Null mailer'),
      'value' => $enabled ? t('Enabled') : t('Disabled'),
      'description' => $message,
      'severity' => REQUIREMENT_WARNING,
    );
    return $requirements;
  }
}
