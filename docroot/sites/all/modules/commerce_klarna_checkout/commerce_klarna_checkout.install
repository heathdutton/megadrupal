<?php

/**
 * @file
 * Installation instructions for the Commerce Klarna Checkout module.
 */

/**
 * Implements hook_requirements().
 *
 * This will check that the necessary libraries has been included.
 */
function commerce_klarna_checkout_requirements($phase) {
  $requirements = array();

  if ($phase == 'runtime') {
    // Get the appropriate function for translating, to make sure this work during
    // a Drupal installation.
    $t = get_t();

    $requirements['klarna_checkout_api'] = array(
      'title' => $t('Klarna Checkout API'),
    );
    // Get the path to the Klarna API directory.
    $klarna_path = libraries_get_path('klarna_checkout');

    if (is_file($klarna_path . '/Checkout.php')) {
      // The file was found.
      $requirements['klarna_checkout_api']['value'] = $t('Included');
      $requirements['klarna_checkout_api']['severity'] = REQUIREMENT_OK;
    }
    else {
      // The file wasn't found.
      $requirements['klarna_checkout_api']['value'] = $t('Not included');
      if (function_exists('l')) {
        $download_url = l('https://docs.klarna.com/en/downloads/php',
          'https://docs.klarna.com/en/downloads/php');
      }
      else {
        $download_url = 'https://docs.klarna.com/en/downloads/php';
      }
      $requirements['klarna_checkout_api']['description'] = $t("Klarna PHP example hasn't been downloaded. Download from !download_url, rename the downloaded folder to klarna_checkout, and place it in the libraries directory.", array('!download_url' => $download_url));
      $requirements['klarna_checkout_api']['severity'] = REQUIREMENT_ERROR;
    }

    $requirements['mobile_detect'] = array(
      'title' => $t('Mobile Detect'),
    );
    if (libraries_get_path('Mobile-Detect', FALSE)) {
      $requirements['mobile_detect']['value'] = t('Included');
        $requirements['mobile_detect']['severity'] = REQUIREMENT_OK;
    }
    else {
      $requirements['mobile_detect']['value'] = t('Not found');
      $requirements['mobile_detect']['severity'] = REQUIREMENT_INFO;
    }
  }

  return $requirements;
}
