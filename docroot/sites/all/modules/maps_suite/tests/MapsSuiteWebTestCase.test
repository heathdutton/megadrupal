<?php

/**
 * @file
 * Base class for functional tests on MaPS Suite modules.
 */

use Drupal\maps_import\Profile\Profile;

/**
 * Test case for MaPS Suite functional tests.
 */
class MapsSuiteWebTestCase extends DrupalWebTestCase implements MapsSuiteTestInterface {

  protected $privilegedUser;

  /**
   * SimpleTest setUp.
   *
   * We only accept an array of modules as first parameter,
   * but no more a list of parameters, as this second option
   * will be removed in D8.
   *
   * @param array $modules
   *   The list of modules to enable.
   * @param array $permissions
   *   The list of permissions to give to the logged-in user.
   */
  protected function setUp(array $modules = array(), array $permissions = array()) {
    parent::setUp($modules);

    $permissions[] = 'administer maps suite';
    $this->privilegedUser = $this->drupalCreateUser($permissions);
    $this->drupalLogin($this->privilegedUser);
  }

  /**
   * Override verbose method.
   *
   * Adds a extra parameter $args for placeholder replacements.
   *
   * @see format_string()
   * @see maps_suite_format_string()
   */
  protected function verbose($message, array $args = array()) {
    maps_suite_format_string($message, $args);
    parent::verbose(format_string($message, $args));
  }

  /**
   * Creates a random URL.
   *
   * @return string
   *   Random URL.
   */
  protected function randomUrl() {
    return 'http://www.' . $this->randomName(6) . '.com/' . $this->randomName(10);
  }

  /**
   * Create MaPS SystemÂ® configuration for languages.
   *
   * @param int $number
   *   The number of languages to enable.
   *
   * @return array
   *   An array whose keys are langcodes and whose values are language names.
   */
  protected function createLanguages(Profile $profile, $number = 4) {
    include_once DRUPAL_ROOT . '/includes/iso.inc';
    $predefined = _locale_get_predefined_list();
    unset($predefined['en']);
    $languages = array();

    foreach (array_rand($predefined, $number) as $langcode) {
      locale_add_language($langcode);
      $languages[$langcode] = $predefined[$langcode][0];
    }

    return $languages;
  }

}
