<?php

/**
 * @file
 * Irchwebchat module functions and hooks
 */


define('IRCHWEBCHAT_DISPLAY_TYPE_FORM', 0);
define('IRCHWEBCHAT_DISPLAY_TYPE_EMBED', 1);

/**
 * Implements hook_help().
 */
function irchwebchat_help($path, $arg) {
  $output = '';
  switch ($path) {
    case "admin/help#irchwebchat":
      $output = '<p>'. t("This module integrates IRC-Hispano webchat on your Drupal site. It includes configurable options in an admin interface.") .'</p>';
      $output .= '<p>'. t("It provides both a block and a page, allowing you to embed the chat in a page or provide a login form in a block.") .'</p>';
      break;
    case 'admin/modules#description':
      $output = t("Allows you to integrate IRC-Hispano webchat in your site.");
      break;
  }

  return $output;
} // function irchwebchat_help

/**
 * Implements hook_enable().
 */
function irchwebchat_enable() {
  drupal_set_message(t("IRC-Hispano webchat module enabled. You can now configure it on !settings", array('!settings' => l('admin/config/irchwebchat', 'admin/config/irchwebchat'))));
}

/**
 * Implements hook_perm().
 */
function irchwebchat_permission() {
  return array(
    'access irc-hispano webchat' => array (
      'title' => t('access irc-hispano webchat'),
    ),
    'administer irc-hispano webchat' => array(
      'title' => t('administer irc-hispano webchat'),
    )
  );
} // function irchwebchat_perm()

/**
 * Implements hook_menu().
 */
function irchwebchat_menu() {
  global $user;
  $items = array();
  // opción de menu para la pagina de administracion
  $items['admin/config/irchwebchat'] = array(
    'title' => 'IRC-Hispano webchat',
    'description' => 'IRC-Hispano webchat configuration',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('irchwebchat_admin_page'), // funcion que genera el form de administracion del webchat
    'access callback' => 'user_access',
    'access arguments' => array('administer irc-hispano webchat'),
    'type' => MENU_NORMAL_ITEM,
    'weight' => 0,
    'file' => 'irchwebchat.admin.inc',
  );

  // opción de menu para la pagina del webchat
  $items['irchwebchat'] = array(
    'title' => 'IRC-Hispano Chat',
    'description' => 'IRC-Hispano webchat page',
    'page callback' => 'irchwebchat_page', // funcion que genera la pagina del webchat
    'access callback' => 'user_access',
    'access arguments' => array('access irc-hispano webchat'),
    'weight' => 0,
    'file' => 'irchwebchat.page.inc',
  );

  return $items;
}

/*
 * Implements hook_block_info().
 */
function irchwebchat_block_info() {
  $blocks['irchwebchat'] = array(
    'info' => t('IRC-Hispano Chat'),
    'visibility' => BLOCK_VISIBILITY_NOTLISTED,
    'pages' => 'irchwebchat',
  );
  return $blocks;
}
/*
 * Implements hook_block_view().
 */
function irchwebchat_block_view($delta = '') {
  $block = array();

  switch ($delta) {
    case 'irchwebchat':
      if (user_access('access irc-hispano webchat')) {
        $block['subject'] = t('IRC-Hispano Chat');
        $block['content'] = _irchwebchat_block_contents();
      }
      break;
  }
  
  return $block;
}

/**
 * Block contents
 */
function _irchwebchat_block_contents() {
  require_once('irchwebchat.functions.inc');

  return _irchwebchat_generate_chat_form(IRCHWEBCHAT_DISPLAY_TYPE_FORM);
}
