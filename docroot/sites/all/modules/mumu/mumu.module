<?php
// mumu: mumu.module 2/9/12 3:10 PM johnvsc@gmail.com

/*
 * Implementation of hook_help()
 */

function mumu_help($path, $arg) {
  switch ($path) {
    // Main module help for the block module
    case 'admin/help#mumu':
      drupal_set_title(t('About Make Up Mark Up (MUMU)'));
      return '<p>' . t('Make Up Mark Up (mumu) enables you to add a single css and a single js file to your Drupal site through the admin interface.') . '</p><p>' . t('Used with the "Display Suite", MUMU will allow you over ride CSS rules in the currently enabled theme or, more dramatically, to bypass the need for a sub-theme, altogether.') . '</p>';
    case 'admin/appearance/mumu':
      return '<p>' . t('Simply upload a single CSS and/or JS file through this admin interface to alter and change the style or browser functionality without having to add or create a sub theme.') . '</p>';
  }
}

function mumu_disable() {
  variable_del('mumu_css');
  variable_del('mumu_js');
  cache_clear_all();
}

/**
 * @return array
 */
function mumu_menu() {
  $items = array();

  $items['admin/appearance/mumu'] = array(
    'title'            => t('MuMu'),
    'description'      => t('Add a CSS and JavaScript file to override this sites theme!'),
    'type'             => MENU_LOCAL_TASK,
    'page callback'    => 'drupal_get_form',
    'page arguments'   => array('mumu_admin_form'),
    'access arguments' => array('access administration pages'),
    'file'             => 'mumu.admin.inc',
  );
  return $items;
}

/**
 *
 */
function mumu_init() {
  $message = FALSE;
  if (arg(0) == 'admin' && arg(1) == 'appearance') {
    $message = TRUE;
  }
  // get the values, if there are any
  $mumu_css = variable_get('mumu_css');
  $mumu_js  = variable_get('mumu_js');

  if ($mumu_css) {
    $mumu_css = file_load($mumu_css);
    drupal_add_css($mumu_css->uri, array(
                                        'type'       => 'file',
                                        'media'      => 'all',
                                        'preprocess' => TRUE,
                                        'every_page' => TRUE,
                                        'weight'     => 'CSS_THEME',
                                        'group'      => 100
                                   ));
    if ($message) {
      drupal_set_message(t('A MuMu CSS is active for this install: ') . l($mumu_css->filename, 'admin/appearance/mumu'));
    }
  }

  if ($mumu_js) {
    $mumu_js = file_load($mumu_js);
    drupal_add_js($mumu_js->uri);
    if ($message) {
      drupal_set_message(t('A MuMu JS is active for this install: ') . l($mumu_jss->filename, 'admin/appearance/mumu'));
    }
  }
}