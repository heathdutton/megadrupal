<?php

/**
 * @file
 * Defines demo functionality.
 */

/**
 * Implements hook_menu()
 */
function drpg_demo_menu() {
  $items['drpg/play'] = array(
    'title' => 'DRPG Demo Game',
    'page callback' => 'drpg_demo_play_callback',
    'access callback' => 'user_is_logged_in',
  );

  return $items;
}

function drpg_demo_play_callback() {
  global $user, $base_url;

  if (drpg_avatar_get_user_active_avatar($user->uid) == null) {
    drpg_avatar_create_default($user->uid);
  }

  $path = drupal_get_path('module', 'drpg_demo');

  $output = array();

  $output['game_screen'] = array(
    '#type' => 'container',
    '#attributes' => array(
      'id' => 'game-screen',
    ),
    '#attached' => array(
      'js' => array(
        $path . '/js/game.js',
        array(
          'data' => array(
            'drpgServerUrl' => $base_url . '/',
            'drpgImagePath' => $path . '/images/',
          ),
          'type' => 'setting',
        ),
      ),
      'css' => array(
        $path . '/css/game.css',
      ),
    ),
  );

  $output['game_screen']['instructions'] = array(
    '#type' => 'markup',
    '#markup' => '<p>Press W, A, S, and D to move; E to interact with items. <a id="drpg-game-focus" href="#">Give focus to the game screen</a></p>',
  );

  $output['game_screen']['canvas'] = array(
    '#type' => 'markup',
    '#markup' => '<canvas id="drpg-game-canvas" width="352" height="256" tabindex="1"></canvas>',
  );

  $output['game_screen']['console'] = array(
    '#type' => 'container',
    '#attributes' => array(
      'id' => 'drpg-game-console',
    ),
  );

  $output['game_screen']['credits'] = array(
    '#type' => 'markup',
    '#markup' => '<p>Game assets taken from <a href="http://opengameart.org/content/dungeon-crawl-32x32-tiles">Dungeon Crawl 32x32 tiles by Chris Hamons</a>.</p>',
  );

  return $output;
}
