<?php
/**
 * @file
 * Code for the Restaurant Location Demo feature.
 */

/**
 * Implements hook_migrate_api().
 */
function restaurant_location_demo_migrate_api() {
  return array(
    'api' => 2,
    'groups' => array(
      'restaurant_location_demo' => array(
        'title' => t('Restaurant Location demo content'),
      ),
    ),
    'migrations' => restaurant_location_get_migrations(),
  );
}

/**
 * Returns an array of migrations.
 */
function restaurant_location_get_migrations() {
  return array(
    'RestaurantLocationMigrateLocationMigration' => array(
      'class_name' => 'RestaurantLocationMigrateLocationMigration',
      'group_name' => 'restaurant_location_demo',
    ),
    'RestaurantLocationMigrateSlideshowMigration' => array(
      'class_name' => 'RestaurantLocationMigrateSlideshowMigration',
      'group_name' => 'restaurant_location_demo',
    ),
    'RestaurantLocationMigrateSlideMigration' => array(
      'class_name' => 'RestaurantLocationMigrateSlideMigration',
      'group_name' => 'restaurant_location_demo',
    ),
    'RestaurantLocationMigrateTextMigration' => array(
      'class_name' => 'RestaurantLocationMigrateTextMigration',
      'group_name' => 'restaurant_location_demo',
    ),
  );
}

/**
 * Returns a list of demo menus.
 */
function restaurant_location_get_migrated_menus() {
  // If module is not enabled return empty array.
  if (!module_exists('restaurant_menu_demo')) {
    return array();
  }

  // Find all migrated menu nodes.
  $results = db_select('migrate_map_restaurantmenumigratemenu', 'mr')
    ->fields('mr', array('destid1'))
    ->execute()
    ->fetchAllAssoc('destid1');

  return array_keys($results);
}
