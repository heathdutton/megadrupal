<?php
/**
 * @file
 * Update and install functions for OpenLucius Inline Images.
 */

/**
 * Implements hook_install().
 */
function openlucius_inline_images_install() {
  // OpenLucius Inline Images needs to load quite late.
  //  db_query("UPDATE {system} SET weight = 99 WHERE type = 'module' AND name
  // = 'openlucius_inline_images'");
}

/**
 * Implements hook_enable().
 */
function openlucius_inline_images_enable() {
  _openlucius_inline_images_enable_button();
}

/**
 * Implements hook_disable().
 */
function openlucius_inline_images_disable() {
  // Fetch all profiles using tinymce.
  $profiles = db_select('wysiwyg', 'w')
    ->fields('w')
    ->condition('editor', 'tinymce', '=')
    ->execute()
    ->fetchAll();

  // Loop through the profiles.
  foreach ($profiles as $profile) {

    // Get Settings.
    $settings = unserialize($profile->settings);

    // Check if enabled if not enable.
    if (!empty($settings['buttons']['openlucius_inline_image'])) {
      unset($settings['buttons']['openlucius_inline_image']);
    }

    // Serialize settings.
    $settings = serialize($settings);

    // Enable setting.
    db_update('wysiwyg')
      ->fields(array('settings' => $settings))
      ->condition('format', $profile->format)
      ->condition('editor', 'tinymce')
      ->execute();
  }
}
