<?php

/**
 * @file
 * Intended to be used with the .mobi theme
 *
 * @author David Kent Norman <http://deekayen.net/>
 * @link http://deekayen.net/
 * @link http://m.deekayen.net/
 */

/**
 * Implementation of hook_menu().
 */
function mobi_loader_menu() {
  $items['admin/settings/mobi_loader'] = array(
    'title' => '.mobi loader',
    'description' => 'Toggle settings for the .mobi theme',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('mobi_loader_admin_settings'),
    'access arguments' => array('administer site configuration'),
    'type' => MENU_NORMAL_ITEM
  );
  return $items;
}

/**
 * Overrides the default theme to use the mobi theme
 * when a domain ending in .mobi is requested
 */
function mobi_loader_boot() {
  if (isset($_SERVER['HTTP_HOST'])) {
    if ($_SERVER['HTTP_HOST'] == variable_get('mobi_loader_domain', '')) {
      global $conf;
      $conf['theme_default'] = 'mobi';
    }
  }
}

/**
 * Implementation of hook_settings().
 *
 * @return array
 */
function mobi_loader_admin_settings() {
  $form['mobi_loader_domain'] = array(
    '#type' => 'textfield',
    '#title' => t('Mobile domain'),
    '#default_value' => variable_get('mobi_loader_domain', ''),
    '#description' => t('Just the domain. No http:// stuff.')
  );
  return system_settings_form($form);
}
