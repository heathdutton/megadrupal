<?php
/**
 * @file
 * Install, update and uninstall functions for the Context by Node module.
 */

/**
 * Implements hook_schema_alter().
 */
function context_by_node_schema_alter(&$schema) {
  $schema['context']['fields']['hidden'] = array(
    'description' => t('Hidden context of the list'),
    'type' => 'int',
    'default' => 0,
  );
  $schema['context']['export']['load all callback'] = 'context_by_node_export_load_all';
}

/**
 * Implements hook_install().
 */
function context_by_node_install() {
  // Clear the schema cache and rebuild
  $schema = drupal_get_schema('context', TRUE);
  $schema = array('context' => $schema);

  context_by_node_schema_alter($schema);

  // Add the new Column
  db_add_field('context', 'hidden', $schema['context']['fields']['hidden']);

  // If already exist some contexts generated by this module we must hidde them again
  db_update('context')
    ->fields(array(
      'hidden' => 1,
    ))
    ->condition('tag', 'Context by Node')
    ->execute();

  // Set the Content Type "Page" for default
  variable_set('context_by_node_content_types', array('page'));
}

/**
 * Implements hook_uninstall().
 */
function context_by_node_uninstall() {
  db_drop_field('context', 'hidden');

  variable_del('context_by_node_content_types');
  variable_del('context_by_node_hide_context_ui_admin');
}
