<?php

define('QUIZ_AUTO', '1 - quiz_auto');

/**
 * Implements hook_quiz_option().
*/
function auto_quiz_option() {
  $lang_name = flipcard_lang_name();
  $option[] = array(
    'key' => QUIZ_AUTO,
    'prompt' => t('Automatic (Starts words using multi-choice, later uses ' . $lang_name . 
      ' to English, then uses English to ' . $lang_name . ')'),
    'weight' => -50,
  );

  return $option;
}

/**
 * Implements hook_view_quiz_question().
 */
function auto_view_quiz_question($quiz_type, $node, $tid) {
  global $user;
  
  $form = array();

  if ($quiz_type == QUIZ_AUTO) {
    $question_quiz_type = _auto_select_question_quiz_type($node->nid);
    variable_set('flipcard_auto_quiz_question_type_' . $user->uid, $question_quiz_type);

    switch ($question_quiz_type) {
      case QUIZ_MULTI_CHOICE:
        $form = multi_choice_view_quiz_question($question_quiz_type, $node, $tid);
        break;
      case QUIZ_THAI_TO_ENGLISH:
        $form = thai_to_english_view_quiz_question($question_quiz_type, $node, $tid);
        break;
      case QUIZ_ENGLISH_TO_THAI:
        $form = english_to_thai_view_quiz_question($question_quiz_type, $node, $tid);
        break;
    }
  }

  return $form;
}

/**
 * Implements hook_view_quiz_answer().
 */
function auto_view_quiz_answer($quiz_type, $node) {
  global $user;
  
  $form = array();

  if ($quiz_type == QUIZ_AUTO) {
    $question_quiz_type = variable_get('flipcard_auto_quiz_question_type_' . 
      $user->uid, QUIZ_MULTI_CHOICE);

    switch ($question_quiz_type) {
      case QUIZ_MULTI_CHOICE:
        $form = multi_choice_view_quiz_answer($question_quiz_type, $node);
        break;
      case QUIZ_THAI_TO_ENGLISH:
        $form = thai_to_english_view_quiz_answer($question_quiz_type, $node);
        break;
      case QUIZ_ENGLISH_TO_THAI:
        $form = english_to_thai_view_quiz_answer($question_quiz_type, $node);
        break;
    }
  }

  return $form;
}

/**
 * Select another quiz type based on the level of the word
 */
function _auto_select_question_quiz_type($nid) {
  $card = new Card($nid);
  $level = $card->box();

  switch ($level) {
    case 1:
    case 2:
    case 3:
      $quiz_type = QUIZ_MULTI_CHOICE;
      break;
    case 4:
    case 5:
    case 6:
    case 7:
    case 8:
      $quiz_type = QUIZ_THAI_TO_ENGLISH;
      break;
    case 9:
    case 10:
      $quiz_type = QUIZ_ENGLISH_TO_THAI;
      break;
    // The default case should never be called
    default:
      $quiz_type = QUIZ_MULTI_CHOICE;
      break;
  }
   
  return $quiz_type;
}