<?php

/**
 * @file
 * Adds additional theme template suggestions based on content type groups.
 */

/**
 * Implements hook_preprocess_HOOK() for nodes.
 */
function content_type_groups_theme_preprocess_node(&$variables) {
  $node = &$variables['node'];

  // @todo: Add support for if a content type is within multiple groups.
  // However, I'm not sure how to handle which groups should take priority.

  // Check to see if the content type is within the "Events" content type
  // group.
  $content_type_group = db_select('content_type_groups_types', 'g')
    ->fields('g', array('group_type'))
    ->condition('group_type', 'events')
    ->condition('content_type', $node->type)
    ->execute()
    ->fetchField();

  if ($content_type_group) {
    // Add specific theme hook suggestions for the content type group.
    array_unshift($variables['theme_hook_suggestions'], 'node__content_type_groups__' . $content_type_group . '__' . $variables['view_mode']);
    array_unshift($variables['theme_hook_suggestions'], 'node__content_type_groups__' . $content_type_group);
  }
}
