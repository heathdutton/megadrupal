<?php

/**
 * @file
 * Definition list hook implementations.
 */

/**
 * Implements hook_theme().
 */
function definition_list_theme($existing, $type, $theme, $path) {
  return array(
    'definition_list' => array(
      'variables' => array(
        'items'      => array(),
        'title'      => '',
        'attributes' => array(),
      ),
    ),
  );
}

/**
 * Definition list themeing function.
 */
function theme_definition_list($variables) {

  $items = $variables['items'];
  $title = $variables['title'];
  $attributes = $variables['attributes'];

  // Only output the list container and title, if there are any list items.
  // Check to see whether the block title exists before adding a header.
  // Empty headers are not semantic and present accessibility challenges.
  $output = array('<div class="definition-list">');
  if (isset($title) && $title !== '') {
    array_push($output, '<h3>' . $title . '</h3>');
  }

  // If there are items to be listed...
  if (!empty($items)) {

    array_push($output, "<dl" . drupal_attributes($attributes) . '>');
    $num_items = count($items);
    $i = 0;

    // Add each of the items...
    foreach ($items as $item) {

      $attributes = array(
        'term' => array(),
        'desc' => array(),
      );
      $data = array(
        'term' => array(),
        'desc' => array(),
      );
      $i++;
      foreach ($item as $key => $value) {
        if (in_array($key, array('term', 'desc'))) {
          if (is_array($value)) {
            foreach ($value as $key2 => $value2) {
              if ($key2 == 'data') {
                $data[$key] = $value2;
              }
              else {
                $attributes[$key][$key2] = $value2;
              }
            }
          }
          else {
            $data[$key] = $value;
          }
        }
        $attributes['wrap'] = array_key_exists('wrap', $item) ? $item['wrap'] : array();
      }

      // Add first/last classes to wrapping div.
      if ($i == 1) {
        $attributes['wrap']['class'][] = 'first';
      }
      if ($i == $num_items) {
        $attributes['wrap']['class'][] = 'last';
      }

      // Add wrapping div to term/definition pair.
      array_push($output, '<div' . drupal_attributes($attributes['wrap']) . '>');

      // Add term & definition.
      array_push($output, '<dt' . drupal_attributes($attributes['term']) . '>' . (is_array($data['term']) ? render($data['term']) : $data['term']) . '</dt>');
      array_push($output, '<dd' . drupal_attributes($attributes['desc']) . '>' . (is_array($data['desc']) ? render($data['desc']) : $data['desc']) . '</dd>');

      // Close wrapping div.
      array_push($output, "</div>\n");
    }
    array_push($output, "</dl>");
  }
  array_push($output, '</div>');
  return implode("\n", $output);
}
