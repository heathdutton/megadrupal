<?php

/**
 * Implements hook_preprocess_html().
 *
 */
function client_autorestore_preprocess_html(&$vars) {
  $next_time = variable_get('hosting_autorestore_next_restore_time', time() + 60 * 180);
  $next_minutes = round(($next_time - time()) / 60);
  
  if ($next_minutes < 1) {
    drupal_set_message(t('Warning: this website is about to be reset, please wait'), 'error', FALSE);
  }
  else {
    drupal_set_message(t('This website will be reset in <span class="restore_time">@time_to_restore</span> minutes', array(
      '@time_to_restore' => $next_minutes)), 'warning', FALSE);
  }
  // To be sure to not get cached, update this time as well in js
  drupal_add_js(array('client_autorestore' => array('next_time' => $next_time)), 'setting');
  drupal_add_js(drupal_get_path('module', 'client_autorestore') . '/client_autorestore.js');
}