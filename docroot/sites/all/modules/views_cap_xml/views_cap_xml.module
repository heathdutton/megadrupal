<?php

/**
 * Implements hook_views_api().
 */
function views_cap_xml_views_api() {
  return array(
    'api' => 3,
    'path' => drupal_get_path('module', 'views_cap_xml') . '/views',
    'template path' => drupal_get_path('module', 'views_cap_xml') . '/views',
  );
}



/**
 * Preprocess CAPXML feed
 */
function views_cap_xml_preprocess_views_style_cap_xml(&$vars) {
  $view     = &$vars['view'];
  $options  = &$vars['options'];
  $items    = &$vars['rows'];
  $style    = &$view->style_plugin;

  // During live preview we don't want to output the header since the contents
  // of the feed are being displayed inside a normal HTML page.
  if (empty($vars['view']->live_preview)) {
    drupal_add_http_header('Content-Type', 'text/xml; charset=utf-8');
  }
  else {

  }

}

/**
 * Default theme function for all CAPXML rows.
 */
function views_cap_xml_preprocess_views_row_cap_xml(&$vars) {
  $view           = &$vars['view'];
  $options        = &$vars['options'];
  $contentObject  = &$vars['contentObject'];

  $vars['rowXml'] = empty($contentObject->elements) ? '' : format_xml_elements($contentObject->elements);
}
