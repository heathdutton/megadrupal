<?php

/**
 * @file
 * Installation instructions for the Commerce Klarna module.
 */

/**
 * Implements hook_requirements().
 *
 * This will check that the Klarna API has been included.
 */
function commerce_klarna_requirements($phase) {
  // Get the appropriate function for translating, to make sure this work during
  // a Drupal installation.
  $t = get_t();
  
  $requirements['klarna_api'] = array(
    'title' => $t('Klarna API'),
  );
  
  // Get the path to the Klarna API directory. Use Libraries API if it's
  // available.
  $klarna_path = function_exists('libraries_get_path') ? libraries_get_path('klarna') : '/sites/all/libraries/klarna';

  if (is_file($klarna_path . '/Klarna.php')) {
    // The file was found.
    $requirements['klarna_api']['value'] = $t('Included');
    $requirements['klarna_api']['severity'] = REQUIREMENT_OK;
  }
  else {
    // The file wasn't found.
    $requirements['klarna_api']['value'] = $t('Not included');
    $download_url = function_exists('l') ? l('http://integration.klarna.com/en/download/api-download', 'http://integration.klarna.com/en/download/api-download') : 'http://integration.klarna.com/en/download/api-download';
    $requirements['klarna_api']['description'] = $t("Klarna API hasn't been downloaded. Download version 2 or above from !download_url, rename the downloaded folder to klarna, and place it in the libraries directory.", array('!download_url' => $download_url));
    $requirements['klarna_api']['severity'] = REQUIREMENT_ERROR;
  }

  return $requirements;
}
