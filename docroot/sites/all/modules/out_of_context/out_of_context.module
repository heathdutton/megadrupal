<?php
/**
 * Implementation of hook_page_build().
 */
function out_of_context_page_build(&$page) {
  // Adds layout tools for administrators on non-admin pages.
  if (user_access('administer content') && strpos($_GET['q'], 'admin') === FALSE) {
    module_load_include('inc', 'out_of_context', 'out_of_context.palette');
    add_pallete_to_dom();
  }
  
  // Set contents layouts by confogurations.
  if (is_layout()) {
    // Set layout regions.
    module_load_include('inc', 'out_of_context', 'out_of_context.layout');
    out_of_context_editable_region($page);
  }
}

/**
 * Implementation of hook_system_info_alter().
 */
function out_of_context_system_info_alter(&$info, $file, $type) {
  // Adds custom regions for content area layouts.
  if (is_layout()) {
    module_load_include('inc', 'out_of_context', 'out_of_context.layout');
    _add_custom_regions($info, $file, $type);
  }
}

/**
 * Implementation of hook_menu().
 */
function out_of_context_menu() {
  module_load_include('inc', 'out_of_context', 'out_of_context.admin');
  $items = array();
  $items = _out_of_context_admin_menu();
  return $items;
}

/**
 * Implementation of hook_theme().
 */
function out_of_context_theme($existing, $type, $theme, $path) {
  module_load_include('inc', 'out_of_context', 'out_of_context.palette');
  $themes = array();
  $themes += _out_of_context_palette_theme();  
  return $themes;
}

/**
 * Implementation of hook_node_view().
 */
function out_of_context_node_view($node, $view_mode, $langcode) {
  module_load_include('inc', 'out_of_context', 'out_of_context.layout');
  _out_of_context_node_view($node, $view_mode);
}

/**
 * Implementation of hook_block_info()
 */
function out_of_context_block_info() {
  module_load_include('inc', 'out_of_context', 'out_of_context.palette');
  $blocks = array();
  $blocks += _out_of_context_palette_block_info();
  return $blocks;
}

/**
 * Implementaion of hook_block_view()
 */
function out_of_context_block_view($delta = '') {
  module_load_include('inc', 'out_of_context', 'out_of_context.palette');
  $block = array();
  $block += _out_of_context_palette_block_view($delta);
  return $block;
}

function is_layout() {
  $is_layout = variable_get("out_of_context_page_layout", 0);
  // Checking if the layout is turn on and adds the custom regions.
  if (empty($is_layout)) {
    return FALSE;
  }
  return TRUE;
}