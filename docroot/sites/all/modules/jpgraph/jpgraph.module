<?php
/**
 * @file
 * Main module file for the jpgraph.module.
 */

/**
 * Loads the JpGraph library.
 *
 * @return
 *   Returns the filename of the included geoPHP library when successful, FALSE
 *   otherwise.
 */
function jpgraph_load($files = array('jpgraph.php')) {
  if (module_exists('libraries')) {
    $path = libraries_get_path('jpgraph');
    // Load others files.
    $files = (array) $files;
    // Always load the jpgraph.php before others.
    array_unshift($files, 'jpgraph.php');
    $files = array_unique($files);
    foreach ($files as $file) {
      // To prevent security issues, we make sure that it's the last part
      // of the path that we need that is loaded.
      $file = array_pop(explode('/', $file));
      $file = isset($file) ? $path . '/src/' . $file : $path . '/src/' . 'jpgraph.php';
      if (file_exists($file)) {
        require_once($file);
      }
    }
  }
}

/**
 * Implementation of hook_requirements().
 */
function jpgraph_requirements($phase) {
  $requirements = array();

  $jpgraph = jpgraph_load();
  if ($jpgraph) {
    if (JPG_VERSION != 0) {
      $requirements['jpgraph'] = array(
        'title' => 'JpGraph Library Installed',
        'severity' => REQUIREMENT_OK,
        'value' => t('JpGraph %version library installed at %path', array('%path' => $jpgraph, '%version' => JPG_VERSION)),
      );
    }
  } else {
    $requirements['jpgraph'] = array(
      'title' => t('JpGraph'),
      'severity' => REQUIREMENT_ERROR,
      'value' => t('JpGraph library was not found. Please download a copy of JpGraph at %link and place in the libraries directory.', array('%link' => 'https://jpgraph.net/')),
    );
  }

  return $requirements;
}
