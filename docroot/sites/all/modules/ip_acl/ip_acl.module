<?php

/**
 * Implementation of hook_perm().
 */
function ip_acl_init() {
  $p = menu_get_item();
  $ips = variable_get('ip_acl_ips', array());
  $paths = variable_get('ip_acl_paths', array('/^admin/i'));
  if (!empty($ips)) {
    foreach($paths as $path) {
      if (preg_match($path, $p['path']) && !in_array($_SERVER['REMOTE_ADDR'], $ips)) {
        header('HTTP/1.1 500 Internal Server Error');
        echo variable_get('ip_acl_error', "Error");
        die();
      }
    }
  }
}
