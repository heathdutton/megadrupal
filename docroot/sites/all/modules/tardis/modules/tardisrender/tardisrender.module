<?php

/**
 * @file
 * TARDIS Render module file.
 * 
 * Alters the TARDIS query, filtering it by View mode.
 */

/**
 * Implements hook_form_FORM_ID_alter().
 * 
 * This function is preferred over hook_form_alter() since it's more targeted.
 */
function tardisrender_form_tardis_page_settings_alter(&$form, &$form_state, $form_id) {
  // Which view mode is being used to display nodes?
  $tardisrender_view_mode = $form['tardisrender_update']['#value'];

  // TARDIS Render vertical tab.
  $form['tardis_modules_tardisrender'] = array(
    '#type' => 'fieldset',
    '#title' => t('TARDIS Render'),
    '#group' => 'tardis_submodules',
  );

  // Get all available view modes.
  $tardisrender_options = entity_get_info('node');
  $tardisrender_options = $tardisrender_options['view modes'];
  $tardisrender_view_modes = array();

  // And define an options array to be populated with them.
  foreach ($tardisrender_options as $key => $value) {
    $tardisrender_view_modes[$key] = $value['label'];
  }

  // Then render as a set of checkboxes.
  $form['tardis_modules_tardisrender']['tardisrender_view_mode'] = array(
    '#type' => 'select',
    '#title' => t('View mode to render'),
    '#options' => $tardisrender_view_modes,
    '#default_value' => $tardisrender_view_mode,
    '#description' => t('Choose a view mode to render results in your TARDIS page. Remember: nodes that do not have that view mode will display as full nodes.'),
  );

  return (system_settings_form($form));
}
