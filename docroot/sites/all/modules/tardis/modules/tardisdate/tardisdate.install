<?php

/**
 * @file
 * Install file.
 */

/**
 * Implements hook_schema_alter().
 */
function tardisdate_schema_alter(&$schema) {
  // Defines new Date fields for TARDIS blocks and pages.
  $schema['tardis_blocks']['fields']['tardisdate_field'] = array(
    'type' => 'varchar',
    'length' => 64,
    'default' => '',
    'description' => t('Sets a date field for use with TARDIS blocks.'),
  );

  $schema['tardis_pages']['fields']['tardisdate_field'] = array(
    'type' => 'varchar',
    'length' => 64,
    'default' => '',
    'description' => t('Sets a date field for use with TARDIS blocks.'),
  );
}

/**
 * Implements hook_install().
 */
function tardisdate_install() {
  // Installs new Date fields for TARDIS blocks and pages.
  $schema_blocks = drupal_get_schema('tardis_blocks');
  db_add_field(
    'tardis_blocks',
    'tardisdate_field',
    $schema_blocks['fields']['tardisdate_field']
  );

  $schema_pages = drupal_get_schema('tardis_pages');
  db_add_field(
    'tardis_pages',
    'tardisdate_field',
    $schema_pages['fields']['tardisdate_field']
  );
}

/**
 * Implements hook_uninstall().
 */
function tardisdate_uninstall() {
  db_drop_field('tardis_blocks', 'tardisdate_field');
  db_drop_field('tardis_pages', 'tardisdate_field');
}

/**
 * Creates the TARDIS Date page and block fields in the tables.
 */
function tardisdate_update_7200() {
  db_add_field(
    'tardis_blocks',
    'tardisdate_field',
    array(
      'type' => 'varchar',
      'length' => 64,
      'default' => '',
      'description' => t('Sets a date field for use with TARDIS blocks.'),
    )
  );

  db_add_field(
    'tardis_pages',
    'tardisdate_field',
    array(
      'type' => 'varchar',
      'length' => 64,
      'default' => '',
      'description' => t('Sets a date field for use with TARDIS pages.'),
    )
  );

  return t('TARDIS Date page and block fields added successfully.');
}

/**
 * Removes outdated variables.
 */
function tardisdate_update_7201() {
  variable_del('tardisdate_field');
  return t('TARDIS variables removed successfully.');
}
