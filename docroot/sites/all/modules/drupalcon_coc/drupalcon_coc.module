<?php
// $Id$

/**
 * @file
 * DrupalCon Code of Conduct hooks
 */

/**
 * Implements hook_menu().
 */
function drupalcon_coc_menu() {
  
  $items['admin/config/content/drupalcon_coc'] = array(
    'title' => 'Code of Conduct Configuration',
    'description' => 'Configuration options for Code of Conduct module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('drupalcon_coc_admin_settings'),
    'access arguments' => array('access administration pages'),
  );
  
  $items['code_of_conduct'] = array(
    'title' => t('Code of Conduct'),
    'description' => 'Displays Code of Conduct',
    'page callback' => 'drupalcon_coc_display',
    'access arguments' => array('access content'),
  );
    
  return $items;
}


/**
 * Builds the drupalcon_coc administration settings form.
 */
function drupalcon_coc_admin_settings($form, &$form_state) {
  $form = array();
  
  //Event Name
  $form['drupalcon_coc_event_name'] = array(
    '#type' => 'textfield',
    '#title' => t('Event Name'),
    '#default_value' => variable_get('drupalcon_coc_event_name', 'DrupalCon'),
    '#description' => t('Replaces DrupalCon with your event\'s name.'),
    '#weight' => -99,
  );
  
  //Contacts
  $form['sales_contact'] = array(
    '#type' => 'fieldset',
    '#title' => t('Sales Contact'),
    '#weight' => -50,
    '#collapsible' => FALSE,
    '#collapsed' => FALSE,
  );
  
  $form['sales_contact']['drupalcon_coc_sales_contact_name'] = array(
    '#type' => 'textfield',
    '#title' => t('Name'),
    '#default_value' => variable_get('drupalcon_coc_sales_contact_name', 'Megan Sanicki'),
    '#description' => t(''),
    '#required' => TRUE,
  );
  
  $form['sales_contact']['drupalcon_coc_sales_title'] = array(
    '#type' => 'textfield',
    '#title' => t('Title'),
    '#default_value' => variable_get('drupalcon_coc_sales_title', 'Sales & Business Development Director'),
    '#description' => t(''),
    '#required' => TRUE,
  );
  
   $form['sales_contact']['drupalcon_coc_sales_url'] = array(
    '#type' => 'textfield',
    '#title' => t('URL'),
    '#default_value' => variable_get('drupalcon_coc_sales_url', 'https://association.drupal.org/user/32709/contact'),
    '#description' => t(''),
    '#required' => TRUE,
  );
  
  //Allow Up to 5 Additional Contacts
  $count = 0;
  $required = TRUE;
  
  while ($count <= 4) {
    $count++;
    //Require at least 1 additional contact
    if ($count > 1) {
      $required = FALSE;
    }
    
    $form['additional_contact' . $count] = array(
      '#type' => 'fieldset',
      '#title' => t('Additional Contact #') . $count,
      '#weight' => $count,
      '#collapsible' => FALSE,
      '#collapsed' => FALSE,
    );
  
    $form['additional_contact' . $count]['drupalcon_coc_additional_contact_name' . $count] = array(
      '#type' => 'textfield',
      '#title' => t('Name'),
      '#default_value' => variable_get('drupalcon_coc_additional_contact_name' . $count, NULL),
      '#description' => t(''),
      '#required' => $required,
    );
  
    $form['additional_contact' . $count]['drupalcon_coc_additional_title' . $count] = array(
      '#type' => 'textfield',
      '#title' => t('Title'),
      '#default_value' => variable_get('drupalcon_coc_additional_title' . $count, NULL),
      '#description' => t(''),
      '#required' => $required,
    );
  
    $form['additional_contact' . $count]['drupalcon_coc_additional_url' . $count] = array(
      '#type' => 'textfield',
      '#title' => t('URL'),
      '#default_value' => variable_get('drupalcon_coc_additional_url' . $count, NULL),
      '#description' => t(''),
      '#required' => $required,
    );
  }
  return system_settings_form($form);
}


/**
 * Displays Code of Conduct.
 */
function drupalcon_coc_display(){
   
  $event_name = variable_get('drupalcon_coc_event_name', 'DrupalCon');
  
  drupal_set_title($event_name . t(' Code of Conduct'));
  
  $output = '<p>' . t('@event_name brings together people from around the world who use, develop, design, and support the Drupal platform. Many attendees at @event_name are newcomers evaluating both our platform and our community.', array('@event_name' => $event_name)) . '</p>';

  $output .= '<p>' . t('The !linked_dcoc outlines our shared ideals and values. This document expresses how we hope to make these ideals real at our conferences and other events. Our goal is to ensure that all participants can freely and openly share ideas in a friendly, safe, and welcoming environment that encourages and inspires mutual respect and collaboration.', array('!linked_dcoc' => l(t('Drupal Code of Conduct'), 'http://drupal.org/dcoc'))) . '</p>';

  $output .= '<h2>' . t('Come for the software, stay for the community.') . '</h2>';

  $output .= '<p>' . t('Drupal would simply not exist without its community. We want all attendees at @event_name to have an awesome experience, both in and out of formal conference sessions.', array('@event_name' => $event_name)) . '</p>';

  $output .= '<p>' . t('The purpose of this document is not to restrict the diversity of ideas and expression in the Drupal community; rather, it\'s to raise awareness of the potential for actions that could alienate valuable members - and potential members - of the community.') . '</p>';

  $output .= '<h2>' .t('Be considerate.') . '</h2>';

  $output .= '<p>' . t('@event_name is an international event that attracts diverse people from a wide variety of ethnic, cultural, and religious backgrounds. We acknowledge that cross-cultural communication can often be complicated and encourage everyone to consider both the impact of their actions on those with different backgrounds and experiences and the honest intentions of those who may have unknowingly caused offense.', array('@event_name' => $event_name)) . '</p>';

  $output .= '<h2>' . t('Be welcoming.') . '</h2>';
   
  $output .= '<p>' . t('One of the greatest strengths of the Drupal community is our inclusiveness. Making all attendees feel welcome and included at @event_name is everyone\'s job, including exhibitors and sponsors. If you are sponsoring @event_name and have questions or concerns about working with our community, please reach out to !linked_sales_contact', array('@event_name' => $event_name, '!linked_sales_contact' => l(variable_get('drupalcon_coc_sales_contact_name', 'Megan Sanicki') . ' ' . variable_get('drupalcon_coc_sales_title', 'Sales & Business Development Director'), variable_get('drupalcon_coc_sales_url', 'https://association.drupal.org/user/32709/contact')))) . '</p>';

  $output .= '<h2>' .  t('Be respectful.') . '</h2>';

  $output .= '<p>' . t('Sponsors, volunteers, speakers, attendees, and other participants should strive to treat all people with dignity and respect, regardless of their culture, religion, physical appearance, disability, race, ethnicity, gender, or sexual orientation.') . '</p>';

  $output .= '<h2>' .t('Be collaborative.') . '</h2>';

  $output .= '<p>' . t('If and when misunderstandings occur, we encourage people to work things out between themselves whenever possible. People are encouraged to take responsibility for their words and actions and listen to constructively-presented criticism with an open mind, courtesy, and respect.') . '</p>';

  $output .= '<h2>' .t('When we disagree, we consult others.') . '</h2>';

  $output .= '<p>' . t('If people are unable to work out issues between themselves, they are encouraged to seek the advice of a mutually trusted third party or a designated community volunteer to help mediate.') . '</p>';

  $output .= '<h2>' . t('When we need it, we ask for help.') . '</h2>';

  $output .= '<p>' . t('We do not tolerate harassment of conference participants in any form. If you feel threatened or violated as a result of intimidating, harassing, abusive, discriminatory, derogatory or demeaning conduct, please immediately notify a conference staff member. Likewise, please immediately notify a staff member if you notice that someone else is being subjected to such behavior.') . '</p>';

  $output .= '<p><strong>' . t('If the matter is especially urgent, please call/contact any of these individuals:') . '</strong> <br />';

  $count = 0;
  while ($count <= 4) {
    $count++;
    if (variable_get('drupalcon_coc_additional_contact_name' . $count, NULL)) {
      $output .= l(variable_get('drupalcon_coc_additional_contact_name' . $count, NULL) . ' - ' . variable_get('drupalcon_coc_additional_title' . $count, NULL), variable_get('drupalcon_coc_additional_url' . $count, NULL)) . '<br />';
    }
  }

  $output .= '</p>';
  
  $output .= '<p>' . t('The @event_name team wants everyone to feel safe for the duration of the conference. If necessary, conference staff are empowered to take appropriate actions that may include, but are not limited to, warnings, expulsion from the conference without refund, and referrals to venue security or local law enforcement.', array('@event_name' => $event_name)) . '</p>';
 
  $output .= '<h2>' . t('We\'re all in this together.') . '</h2>';

  $output .= '<h2>' . t('Thanks for making @event_name awesome for everyone!', array('@event_name' => $event_name)) . '</h2>';

  $output .= '<p>';
  if ($event_name != 'DrupalCon') {
    $output .= t('The @event_name Code of Conduct was adpated from the DrupalCon Code of Conduct. ', array('@event_name' => $event_name));
  }
  $output .= t('The DrupalCon Code of Conduct is licensed under a !linked_license and is available for others to use and adapt for their own events.', array('!linked_license' => l(t('Creative Commons Attribution 3.0 Unported License'), 'http://creativecommons.org/licenses/by-sa/3.0/'))) . '</p>';
  
  return $output;
}
