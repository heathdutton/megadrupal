<?php
/**
 * @file wiredocs_file.module
 * The file editing widget is provided as a field in the node edit form.
 */

/**
 * Implements hook_field_widget_info().
 */
function wiredocs_file_field_widget_info() {
  return array(
    'file_wiredocs' => array(
      'label' => t('File Edit'),
      'field types' => array('file'),
      'settings' => array(
        'progress_indicator' => 'throbber',
      ),
      'behaviors' => array(
        'multiple values' => FIELD_BEHAVIOR_CUSTOM,
        'default value' => FIELD_BEHAVIOR_NONE,
      ),
    ),
  );
}

/**
 * Implements hook_field_settings_form().
 */
function wiredocs_file_field_widget_form(&$form, &$form_state, $field, $instance, $langcode, $items, $delta, $element) {
  $elements = file_field_widget_form($form, $form_state, $field, $instance, $langcode, $items, $delta, $element);
  foreach ($items as $item) {
    $elements[$delta]['#process'][] = 'wiredocs_file_field_widget_process';
    $delta++;
  }
  return $elements;
}


/**
 * An element #process callback for the file_generic field type.
 *
 * Expands the file_generic type to include the description and display fields.
 */
function wiredocs_file_field_widget_process($element, &$form_state, $form) {
  if (is_array($element) && isset($element['#file']) && isset($element['#file']->fid)) {
    $element['edit_button'] = array(
      '#type' => 'wiredocs_button',
      '#title' => t('Edit'),
      '#file' => $element['#file'],
      );
  }  
  return $element; 
}