<?php
/**
 * @file
 * This module creates one more button in addition to existing one (Add to cart
 * button). The new button adds product item to shopping cart and redirects user
 * to /checkout page.
 */

/**
 * Implements hook_form_alter().
 */
function commerce_one_click_buy_form_alter(&$form, &$form_state, $form_id) {
  if (strstr($form_id, 'commerce_cart_add_to_cart_form')) {
    $form['ocb_submit'] = array(
      '#type' => 'submit',
      '#name' => 'ocb',
      '#value' => t('One click buy'),
      '#submit' => array('_commerce_one_click_buy_submit'),
      '#weight' => '49',
    );
  }

}

/**
 * Adds an item to the shopping cart and redirect to checkout page.
 */
function _commerce_one_click_buy_submit($form, $form_state) {
  global $user;
  if (commerce_cart_product_add_by_id($form_state['default_product_id'], 1, TRUE, $user->uid)) {
    drupal_goto('checkout');
  }
  else {
    drupal_set_message(t('Error occured during adding product to cart! Try to use Add to cart button.'));
  }

}
