<?php

/**
 * @file
 * GPA Calculator module.
 */

/**
 * Implements hook_help().
 */
function gpa_calculator_help($path, $arg) {
  $output = '';
  switch ($path) {
    case "admin/help#gpa_calculator":
      $output = '<p>' . t("This module provides schools with a GPA calculator to use in a block.
  The gpa calculator form initially display 6 rows with 3 columns
  (Class/Course Name, Grade, Credits Earned). It has the ability to dynamically
  add more rows. The form also has a section for cumulative (past) GPA
  and Credits Earned as part of the calculation.") . '</p>';
      $output .= '<p>' . t("The description section under the header is configurable. Administrators also
  have the ability to customize the title by amending the title with a school name
  to personalize the calculator. Finally, the Grade select boxes themselves are
  configurable with validation to ensure the option values are numerical for
  correct calculations. If the Grades setting is left blank then the select
  options will be filled with hard coded values.") . '</p>';
      $output .= '<p>' . t("Configure user permissions in Administration > People > Permissions.
  Grant the Administer GPA Calculator permission to any roles that
  should have the ability to configure the GPA Calculator.  Customize the GPA Calculator in
  Administration > Configuration > GPA Calculator Administration > GPA Calculator settings") . '</p>';
      return $output;
  }
}

/**
 * Implements hook_permission().
 */
function gpa_calculator_permission() {
  return array(
    'administer gpa calculator' => array(
      'title' => t('Administer GPA Calculator'),
      'description' => t('Administer GPA Calculator'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function gpa_calculator_menu() {
  $items = array();

  // Create GPA admin category.
  $items['admin/config/gpa-calculator'] = array(
    'title' => 'GPA Calculator Administration',
    'description' => 'Administration pages for GPA Calculator.',
    'position' => 'right',
    'weight' => -5,
    'page callback' => 'system_admin_menu_block_page',
    'file' => 'system.admin.inc',
    'file path' => drupal_get_path('module', 'system'),
    'access arguments' => array('administer gpa calculator'),
  );

  $items['admin/config/gpa-calculator/gpa-calculator-settings'] = array(
    'title' => 'GPA Calculator Settings',
    'description' => 'Configure GPA Calculator Settings',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('gpa_calculator_settings_form'),
    'access arguments' => array('administer gpa calculator'),
    'file' => 'gpa_calculator.admin.inc',
  );

  return $items;
}

/**
 * Implements hook_block_info().
 */
function gpa_calculator_block_info() {
  $blocks = array();

  $blocks['gpa_calculator'] = array(
    'info' => 'GPA Calculator',
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function gpa_calculator_block_view($delta) {
  $blocks = array();

  switch ($delta) {
    case 'gpa_calculator':
      module_load_include('inc', 'gpa_calculator', 'gpa_calculator');

      $blocks['subject'] = t('@school GPA Calculator', array('@school' => variable_get('gpa_calculator_school_name', '')));
      $blocks['content'] = drupal_get_form('gpa_calculator_form');
      break;
  }
  return $blocks;
}
