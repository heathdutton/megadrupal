<?php

/**
 * Implements hook_page_alter().
 */
function metatag_term_view_page_alter(&$page) {
  // Check if the page is served by a view, ensure the view is taxonomy term view and the current view display is the normal page display.
  $view = views_get_page_view();
  if ((!empty($view))
    && (strpos($view->get_path(), 'taxonomy/term/') === 0)
    && ($view->display_handler->has_path())
    && ($view->display_handler->uses_breadcrumb())) {

    // Only single term pages are supported currently.
    $term = taxonomy_term_load(intval(arg(2)));
    if ($term !== FALSE) {
      metatag_entity_view($term, 'taxonomy_term', 'full', NULL);
      $page['content']['metatags'] = metatag_page_get_metatags();
    }
  }
}
