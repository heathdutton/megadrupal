<?php
/**
 * @file
 * Hooks and main functionality.
 */


/**
 * Implements hook_init().
 */
function title_case_init() {
  // Load the library file from the proper directory.
  drupal_add_js(title_case_js_path());

  // Prepare the values for JQuery.
  $selectors = str_replace("\n", ',', variable_get('title_case_selectors', ''));
  $exceptions = explode("\n", variable_get('title_case_exceptions', ''));

  // Send the values to JQuery.
  drupal_add_js(array(
    'title_case' => array(
      'selectors' => $selectors,
      'exceptions' => $exceptions,
    ),
  ), 'setting');
}


/**
 * Implements hook_menu().
 */
function title_case_menu() {
  $items = array();

  $items['admin/config/user-interface/title_case'] = array(
    'title' => 'Title Case',
    'description' => 'Configure how title cases are applied',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('title_case_settings_form'),
    'access arguments' => array('administer site configuration'),
    'file' => 'title_case.admin.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Returns the path to the To Title Case JavaScript file.
 *
 * @return mixed
 *   The path to the JavaScript file or FALSE if no file could be found.
 */
function title_case_js_path() {
  $result = FALSE;
  $filepath = libraries_get_path('to_title_case') . '/to-title-case.js';

  // Use the minified file if it exists to preserve bandwidth.
  if (file_exists($filepath)) {
    $result = $filepath;
  }

  return $result;
}
