<?php

/**
 * @file
 * Main module file for CookieCuttr.
 */

/**
 * Implements hook_menu().
 */
function cookiecuttr_menu() {
  $items['admin/config/user-interface/cookiecuttr'] = array(
    'title' => 'CookieCuttr configuration',
    'description' => 'Administer CookieCuttr settings',
    'page callback' => 'drupal_get_form',
    'access arguments' => array('administer cookiecuttr'),
    'page arguments' => array('cookiecuttr_config'),
    'type' => MENU_NORMAL_ITEM,
    'file' => 'cookiecuttr.admin.inc',
  );

  return $items;
}

/**
 * Implements hook_permission().
 */
function hook_permission() {
  return array(
    'administer cookiecuttr' => array(
      'title' => t('Administer CookieCuttr settings'),
    ),
  );
}

/**
 * Implements hook_preprocess_page().
 */
function cookiecuttr_preprocess_page(&$vars) {
  drupal_add_library('system', 'jquery.cookie');
  drupal_add_js(drupal_get_path('module', 'cookiecuttr') . '/js/jquery.cookiecuttr.js');
  drupal_add_js(drupal_get_path('module', 'cookiecuttr') . '/js/cookiecuttr.js');

  $settings = cookiecuttr_settings();

  drupal_add_js($settings, 'setting');

  drupal_add_css(drupal_get_path('module', 'cookiecuttr') . '/css/cookiecuttr.css');
}

/**
 * Get customisation options.
 *
 * @return array
 *   Settings to be provided to drupal_add_js().
 */
function cookiecuttr_settings() {

  $settings = array('cookieCuttr' => array());
  $variables = array(
    'cookieCutter' => 'cookiecuttr_hide_parts',
    'cookieAnalytics' => 'cookiecuttr_analytics',
    'cookieDeclineButton' => 'cookiecuttr_decline_button',
    'cookieAcceptButton' => 'cookiecuttr_accept_button',
    'cookieResetButton' => 'cookiecuttr_reset_button',
    'cookieOverlayEnabled' => 'cookiecuttr_overlay_enabled',
    'cookiePolicyLink' => 'cookiecuttr_policy_link',
    'cookieMessage' => 'cookiecuttr_message',
    'cookieAnalyticsMessage' => 'cookiecuttr_analytics_message',
    'cookieWhatAreTheyLink' => 'cookiecuttr_what_are_they_link',
    'cookieErrorMessage' => 'cookiecuttr_error_message',
    'cookieNotificationLocationBottom' => 'cookiecuttr_notification_location_bottom',
    'cookieDisable' => 'cookiecuttr_disable',
    'cookieAcceptButtonText' => 'cookiecuttr_accept_button_text',
    'cookieDeclineButtonText' => 'cookiecuttr_decline_button_text',
    'cookieResetButtonText' => 'cookiecuttr_reset_button_text',
    'cookieWhatAreLinkText' => 'cookiecuttr_what_are_link_text',
    'cookiePolicyPage' => 'cookiecuttr_policy_page',
    'cookiePolicyPageMessage' => 'cookiecuttr_policy_page_message',
    'cookieDiscreetLink' => 'cookiecuttr_discreet_link',
    'cookieDiscreetLinkText' => 'cookiecuttr_discreet_link_text',
    'cookieDiscreetPosition' => 'cookiecuttr_discreet_position',
    'cookieDomain' => 'cookiecuttr_domain',
  );

  foreach ($variables as $option => $variable_name) {
    $value = variable_get($variable_name);

    if (!empty($value) || $value === 0) {
      $settings['cookieCuttr'][$option] = $value;
    }
  }

  return $settings;
}
