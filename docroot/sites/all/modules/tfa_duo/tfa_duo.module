<?php
/**
 * Duo tfa module
 */


/**
 * Implements hook_tfa_api().
 */

function tfa_duo_tfa_api() {
  return array(
    'tfa_duo' => array(
      'class' => 'Tfaduo',
      'name' => 'Duo',
    ),

  );
}

function tfa_duo_form_tfa_admin_settings_alter(&$form, &$form_state, $form_id) {
  $form['tfa_duo_ikey'] = array(
    '#type' => 'textfield',
    '#title' => 'Duo Ikey',
    '#default_value' => variable_get('tfa_duo_ikey')
  );
  $form['tfa_duo_skey'] = array(
    '#type' => 'textfield',
    '#title' => 'Duo Skey',
    '#default_value' => variable_get('tfa_duo_skey')
  );
  $form['tfa_duo_host'] = array(
    '#type' => 'textfield',
    '#title' => 'Duo host',
    '#default_value' => variable_get('tfa_duo_host')
  );
  $form['#submit'][] = 'tfa_duo_admin_settings_submit';
}

function tfa_duo_admin_settings_submit($form, $form_state) {
  if (!empty($form_state['values']['tfa_duo_ikey'])) {
    variable_set('tfa_duo_ikey', $form_state['values']['tfa_duo_ikey']);
  }
  if (!empty($form_state['values']['tfa_duo_skey'])) {
    variable_set('tfa_duo_skey', $form_state['values']['tfa_duo_skey']);
  }
  if (!empty($form_state['values']['tfa_duo_host'])) {
    variable_set('tfa_duo_host', $form_state['values']['tfa_duo_host']);
  }
}

function tfa_duo_permission() {
  return array(
    'require duo' => array(
      'title' => t('Force the use of Duo Security'),
      'description' => t('This will require users to tfa via Duo Security.  If your duo account is setup to allow
                          enrollment, it will prompt'),
    ),
  );
}