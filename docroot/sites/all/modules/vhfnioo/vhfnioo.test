<?php
/**
 * @file
 * Testing the VHFNIOO functionality.
 */

/**
 * Class VhfniooTestCase.
 */
class VhfniooTestCase extends \ViewsSqlTest {

  /**
   * {@inheritdoc}
   */
  public static function getInfo() {
    return [
      'name' => t('Views Handler Filter Numeric (is one of)'),
      'group' => t('Views Handlers'),
      'description' => t('Test exposed forms functionality.'),
    ];
  }

  /**
   * {@inheritdoc}
   */
  public function setUp() {
    parent::setUp();
    module_enable(['vhfnioo', 'views_test']);
    // This view provided by "views_test" module.
    $view = views_get_view('test_filter_in_operator_ui');

    foreach ([
      // Extend default display by filter by "nid".
      'default' => ['node' => 'nid'],
    ] as $display => $fields) {
      foreach ($fields as $table => $field) {
        $view->display[$display]->display_options['filters'][$field] = [
          'id' => $field,
          'field' => $field,
          'table' => $table,
        ];
      }
    }

    views_save_view($view);
  }

  /**
   * Test MySQL "IN" operator.
   */
  public function testIsOneOfNumericExposedFilter() {
    $this->drupalLogin($this->drupalCreateUser(['administer views']));
    // @see \ViewsHandlersTest::testFilterInOperatorUi()
    $this->drupalGet('admin/structure/views/nojs/config-item/test_filter_in_operator_ui/default/filter/nid');

    $this->drupalPost(NULL, [
      'options[operator]' => 'in',
      'options[value][value]' => '  31  ,3,34,  2 ,,, 32',
    ], t('Apply'));

    $this->assertRaw('Content: Nid (one of 31, 3, 34, 2, 32)');
  }

}
