<?php

/**
 * @file
 * Login as Other module.
 */

/**
 * Implements hook_block_info().
 */
function login_as_other_block_info() {
  $blocks['login'] = array(
    'info' => t('User login (as other user)'),
    'cache' => DRUPAL_NO_CACHE,
  );

  return $blocks;
}

/**
 * Implements hook_block_configure().
 */
function login_as_other_block_configure($delta) {
  $form = array();
  if ($delta == 'login') {
    $form['login_as_other_block_description'] = array(
      '#type' => 'textfield',
      '#title' => t('Description'),
      '#description' => t('Text that will be displayed above the username field on the User Login (as another) block.'),
      '#default_value' => variable_get('login_as_other_block_description', t('Login as a different user.')),
    );
  }
  return $form;
}

/**
 * Implements hook_block_save().
 */
function login_as_other_block_save($delta, $edit) {
  if ($delta == 'login') {
    variable_set('login_as_other_block_description', $edit['login_as_other_block_description']);
  }
}

/**
 * Implements hook_block_view().
 */
function login_as_other_block_view($delta = '') {
  $block = array();

  switch ($delta) {
    case 'login':
      // Only show the block if the user is authenticated.
      if (!user_is_anonymous()) {
        // Get the user login block form.
        $user_login_form = drupal_get_form('user_login_block');

        // If a description is configured, display it.
        $description = variable_get('login_as_other_block_description', t('Login as a different user.'));
        if (!empty($description)) {
          $user_login_form['description'] = array(
            '#markup' => $description,
            '#weight' => -100,
          );
        }

        // Build the user login (as other) block.
        $block['subject'] = t('User login');
        $block['content'] = $user_login_form;
      }
      break;
  }
  return $block;
}
