<?php

/**
 * @file
 * Entity Lister Example module file.
 */

/**
 * Implements hook_menu().
 */
function entity_lister_example_menu() {

  $items['entity_lister_example/table'] = array(
    'title' => 'Tabular list',
    'page callback' => 'entity_lister_example_table_page',
    'access arguments' => array('administer site configuration'),
    'type' => MENU_NORMAL_ITEM,
    'file' => 'entity_lister_example.pages.inc',
  );

  return $items;

}

/**
 * Implements hook_preprocess_user_profile().
 */
function entity_lister_example_preprocess_user_profile(&$vars) {

  if ('entity_lister_example_table' == $vars['elements']['#view_mode']) {
    $vars['account'] = $vars['elements']['#account'];
    $vars['theme_hook_suggestions'][] = 'user_profile__' . $vars['elements']['#view_mode'];
  }

}

/**
 * Implements hook_entity_info_alter().
 */
function entity_lister_example_entity_info_alter(&$entity_info) {

  // A view mode for table rows.
  $entity_info['user']['view modes']['entity_lister_example_table'] = array(
    'label' => t('Demo Table'),
    'custom settings' => TRUE,
  );

}

/**
 * Demonstrate a filter form.
 */
function entity_lister_example_filter_form() {

  $form['#attributes']['id'] = 'entity-lister-example-filter';

  $form['#method'] = 'get';

  $attr['id'] = 'entity-lister-example-mail-filter';
  $attr['placeholder'] = t('Email contains');

  $form['filters']['mail'] = array(
    '#type' => 'textfield',
    '#size' => 20,
    '#default_value' => isset($_GET['mail']) ? check_plain($_GET['mail']) : '',
    '#attributes' => $attr,
  );

  // Add more filters to the form.
  // All filter elements should be added to $form['filters'] for compatibility
  // with theme_entity_lister_headers().
  // $form['filters']['something'] = array(
  //   '#type' => 'textfield',
  //   '#size' => 20,
  //   '#default_value' => isset($_GET['something']) ? check_plain($_GET['something']) : '',
  //   '#attributes' => array('id' => 'entity-lister-example-something-filter'),
  // );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Go'),
  );

  $url = url($_GET['q']);
  $form['reset'] = array(
    '#markup' => '<input class="form-submit" type="button" value="' . t('Reset') . '" id="filter-reset" onclick="javascript: window.location=\'' . $url . '\'">',
  );

  return $form;

}
