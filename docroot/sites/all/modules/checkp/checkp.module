<?php

/**
 * @file
 * An example implementation of the Checklist API.
 */

/**
 * Implements hook_checklistapi_checklist_info().
 *
 * Defines a checklist based on
 * @link http://buytaert.net/drupal-learning-curve Dries Buytaert's Drupal learning curve @endlink
 * .
 */
function checkp_checklistapi_checklist_info() {
  $definitions = array();

  $views = views_get_enabled_views();
  $checklist_data = array(
    '#title' => t('Performance checklist'),
    '#path' => 'admin/config/development/checkp',
    '#description' => t('implementation of website GTD checklist.'),
  );
  $views_en = module_exists('views');
  $viewsui_en = module_exists('views_ui');
  if ($views_en) {
    foreach ($views as $view_name => $view_object) {

      $checklist_data[$view_name] = array(
        '#title' => t('View name: ') . $view_object->human_name . '(' . $view_object->name . ')',
        '#description' => 'List of displays of view: ' . $view_object->human_name . ' with machine name: ' . '(' . $view_object->name . ')',
        '#path' => 'admin/structure/views/view/' . $view_object->name . '/edit',
      );

      foreach ($view_object->display as $view_display_name => $views_display) {
        $cache_values = '';
        if (isset($views_display->display_options['cache']) && $views_display->display_options['cache']['type'] != 'none') {
          $cache_values = '<pre>' . print_r($views_display->display_options['cache'], TRUE) . '</pre>';
        }
        $data = array(
          '#default_value' => $cache_values == '' ? FALSE : TRUE,
          '#title' => $views_display->display_title . ' : ' . $views_display->display_options['title'],
          '#description' => t('Checked means cache enabled') . $cache_values,
          'cache_set_page' => $viewsui_en ? array(
              '#text' => t('Change cache settings here'),
              '#path' => 'admin/structure/views/nojs/display/' . $view_name . '/' . $view_display_name . '/cache',
            ) : array('#text' => t('Enable views_ui module to see helpful links'), '#path' => 'admin/modules'),
          'display_edit_page' => $viewsui_en ? array(
              '#text' => t('Edit view display'),
              '#path' => 'admin/structure/views/view/' . $view_object->name . '/edit/' . $view_display_name,
            ) : FALSE,
        );
        $checklist_data[$view_name][$view_display_name] = $data;
      }

    }
  }

  $definitions['checkp'] = $checklist_data;
  return $definitions;
}
