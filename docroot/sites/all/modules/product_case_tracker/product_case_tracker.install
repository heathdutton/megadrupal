<?php

/**
 * @file
 * File to create database schema.
 */

/**
 * Implements hook_schema().
 */
function product_case_tracker_schema() {
  $schema['product_case_tracker'] = array(
    'description' => 'entries for timeline',
    'fields' => array(
      'csid' => array(
        'type' => 'serial',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'date_started' => array(
        'type' => 'int',
        'not null' => TRUE,
      ),
      'content_type_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
    ),
    'unique keys' => array(
      'nid' => array('nid'),
    ),
    'foreign keys' => array(
      'content_type' => array(
        'table' => 'product_case_tracker_fields',
        'columns' => array('content_type_name' => 'content_type_name'),
      ),
    ),
    'primary key' => array('csid'),
  );
  $schema['product_case_tracker_field_records'] = array(
    'description' => 'number of entries for a given field at the time of filling timeline entries',
    'fields' => array(
      'field_id' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'field_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'status_entries_id' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'status_entries_value' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
    ),
  );
  $schema['product_case_tracker_details'] = array(
    'description' => 'detailed entries for a case tracker',
    'fields' => array(
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'csid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'date_of_entry' => array(
        'type' => 'int',
        'not null' => TRUE,
      ),
      'current_status_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'current_status_key' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'timeline_step' => array(
        'type' => 'int',
        'unsigned' => TRUE,
      ),
      'correspondance_from' => array(
        'type' => 'varchar',
        'length' => '50',
      ),
      'email' => array(
        'type' => 'varchar',
        'length' => '600',
      ),
      'phone' => array(
        'type' => 'varchar',
        'length' => '600',
      ),
      'attachment' => array(
        'type' => 'varchar',
        'length' => '10',
      ),
    ),
    'foreign keys' => array(
      'nid' => array(
        'table' => 'product_case_tracker',
        'columns' => array('nid' => 'nid'),
      ),
    ),
  );
  $schema['product_case_tracker_conversation'] = array(
    'description' => 'entries for email and phone conversations',
    'fields' => array(
      'date_of_entry' => array(
        'type' => 'int',
        'not null' => TRUE,
      ),
      'csid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'email' => array(
        'type' => 'varchar',
        'length' => '10000',
      ),
      'phone' => array(
        'type' => 'varchar',
        'length' => '10000',
      ),
      'attachment' => array(
        'type' => 'varchar',
        'length' => '10',
      ),
      'originated_by' => array(
        'type' => 'varchar',
        'length' => '50',
        'not null' => TRUE,
      ),
    ),
    'foreign keys' => array(
      'nid' => array(
        'table' => 'product_case_tracker',
        'columns' => array('nid' => 'nid'),
      ),
    ),
  );
  $schema['product_case_tracker_fields'] = array(
    'description' => 'entries for fields in particular content type to associate a case tracker',
    'fields' => array(
      'field_id' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'field_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'content_type_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'option_selected' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'timeline' => array(
        'type' => 'int',
        'default' => 0,
        'not null' => TRUE,
      ),
    ),
    'primary key' => array('field_id'),
  );
  $schema['product_case_tracker_timeline'] = array(
    'description' => 'entries for timeline',
    'fields' => array(
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'content_type_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
    ),
    'primary key' => array('nid'),
  );
  $schema['product_case_tracker_timeline_details'] = array(
    'description' => 'detailed entries for timeline',
    'fields' => array(
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'content_type_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'status' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'date' => array(
        'type' => 'int',
        'not null' => TRUE,
      ),
    ),
    'foreign keys' => array(
      'nids' => array(
        'table' => 'product_case_tracker_timeline',
        'columns' => array('nid' => 'nid'),
      ),
    ),
  );
  $schema['product_case_tracker_artisan'] = array(
    'description' => 'autocomplete entries for artisans',
    'fields' => array(
      'aid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'owner' => array(
        'type' => 'varchar',
        'length' => '10',
        'not null' => TRUE,
        'default' => 'n',
      ),
    ),
  );
  $schema['product_case_tracker_customer'] = array(
    'description' => 'autocomplete entries for artisans',
    'fields' => array(
      'cid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
    ),
    'unique keys' => array(
      'nid' => array('nid'),
    ),
  );
  $schema['product_case_tracker_collabo_details'] = array(
    'description' => 'autocomplete entries for artisans',
    'fields' => array(
      'csid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'nid' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'collabo_name' => array(
        'type' => 'varchar',
        'length' => '100',
        'not null' => TRUE,
      ),
      'collabo_id' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
    ),
    'foreign keys' => array(
      'nids' => array(
        'table' => 'product_case_tracker',
        'columns' => array('nid' => 'nid'),
      ),
    ),
  );
  $schema['product_case_tracker_artisan_roles'] = array(
    'description' => 'autocomplete entries for artisans',
    'fields' => array(
      'id' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'name' => array(
        'type' => 'varchar',
        'length' => '150',
        'not null' => TRUE,
      ),
    ),
  );
  $schema['product_case_tracker_customer_roles'] = array(
    'description' => 'autocomplete entries for customers',
    'fields' => array(
      'id' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'name' => array(
        'type' => 'varchar',
        'length' => '150',
        'not null' => TRUE,
      ),
    ),
  );
  $schema['product_case_tracker_artisan_selected_roles'] = array(
    'description' => 'autocomplete entries for artisans',
    'fields' => array(
      'role' => array(
        'type' => 'varchar',
        'length' => '150',
        'not null' => TRUE,
      ),
    ),
  );
  $schema['product_case_tracker_customer_selected_roles'] = array(
    'description' => 'autocomplete entries for customers',
    'fields' => array(
      'role' => array(
        'type' => 'varchar',
        'length' => '150',
        'not null' => TRUE,
      ),
    ),
  );
  return $schema;
}

/**
 * Implements hook_uninstall().
 */
function product_case_tracker_uninstall() {

  // Delete all case tracker entries and its related data.
  db_drop_table('product_case_tracker');
  db_drop_table('product_case_tracker_detail');
  db_drop_table('product_case_tracker_fields');
  db_drop_table('product_case_tracker_field_records');
  db_drop_table('product_case_tracker_timeline');
  db_drop_table('product_case_tracker_timeline_details');
  db_drop_table('product_case_tracker_artisan');
  db_drop_table('product_case_tracker_customer');
  db_drop_table('product_case_tracker_conversation');
  db_drop_table('product_case_tracker_collabo_details');
  db_drop_table('product_case_tracker_artisan_selected_roles');
  db_drop_table('product_case_tracker_artisan_roles');
  db_drop_table('product_case_tracker_customer_selected_roles');
  db_drop_table('product_case_tracker_customer_roles');
}
