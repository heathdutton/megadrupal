<?php
/**
 * @file
 * Install, update, and uninstall functions for Sendtokindle.
 */

/**
 * Implements hook_enable().
 *
 * Create a field. Fields can be created without any needs to attach them to
 * entities.
 */
function send_file_to_kindle_enable() {
  $field = array(
    'field_name' => 'send_file_to_kindle',
    'type' => 'text',
  );
  field_create_field($field);

  // Bind field to entity bundle and build 'from' email to display for user.
  global $base_url;
  $parse = parse_url($base_url);
  $from_email = 'kindlemail@' . $parse['host'];
  $instance = array(
    'field_name' => $field['field_name'],
    'label' => t('Send-to-Kindle E-Mail Address') ,
    'description' => t('Note: using your Amazon account, you must configure your Kindle device to accept email from @from_mail otherwise the document will not show up on your Kindle.', array('@from_mail' => $from_email)),
    'entity_type' => 'user',
    'bundle' => 'user',
  );
  field_create_instance($instance);
}

/**
 * Implements hook_disable().
 *
 * Remove field from node bundle (content type) and then delete the field.
 */
function send_file_to_kindle_disable() {
  $instance = array(
    'field_name' => 'send_file_to_kindle',
    'entity_type' => 'user',
    'bundle' => 'user',
    'printed' => FALSE,
  );
  field_update_instance($instance);
  field_delete_field($instance['field_name']);
  drupal_set_message(t('Removed Send File to Kindle user profile field'), 'status');
}
