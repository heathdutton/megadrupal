<?php

/**
 * @file
 * Groupe node module.
 */

/**
 * Implements hook_entity_info_alter().
 */
function gcc_node_entity_info_alter(&$entity_info) {

  $entity_info['node']['gcc'] = array(

    'path' => 'node/%node',
    'entity position' => 1,
    'group' => TRUE,
    'group content' => TRUE,
  );
}

/* GCC Core Implementation */

/**
 * Implements hook_gcc_entity_info().
 */
function gcc_node_gcc_entity_info() {

  $entity_types = array();

  $entity_types['node'] = array(

    'path' => 'node/%node',
    'entity position' => 1,
    'group' => TRUE,
    'group content' => TRUE,
  );

  return $entity_types;
}

/**
 * Implements hook_gcc_entity_features().
 */
function gcc_node_gcc_entity_features($entity_type, $bundle) {

  $features = array();

  if ($entity_type == 'node') {

    $features['group'] = array(

      'description' => t('When enabled, %entity_type : %bundle can be used as group.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['group_content'] = array(

      'description' => t('When enabled, %entity_type : %bundle can be associated to one or more existing groups as group content', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['membership_type'] = array(

      'description' => t('When enabled, group of type %entity_type : %bundle can choose what set of membership informations to use for their new member.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['membership_content'] = array(

      'description' => t('When enabled, entity of type %entity_type : %bundle can be used as a memberhsips complementary informations.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['theme'] = array(

      'description' => t('When enabled, entity of type %entity_type : %bundle can choose a custom theme to display their pages.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['private'] = array(

      'description' => t('When enabled, entity of type %entity_type : %bundle can be made private.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['menu'] = array(

      'description' => t('When enabled, entity of type %entity_type : %bundle can create menu.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['contextual_block'] = array(

      'description' => t('When enabled, entity of type %entity_type : %bundle can configure the block layout.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );

    $features['domain'] = array(

      'description' => t('When enabled, %entity_type : %bundle can choose a custom domain.', array('%entity_type' => $entity_type, '%bundle' => $bundle)),
    );
  }

  return $features;
}

/* GCC Context Implementation */

/**
 * Implements hook_gcc_context_entity_detector().
 */
function gcc_node_gcc_context_entity_detector() {

  $detectors = array();

  $detectors['node'] = array(

    'title' => t('Node'),
    'description' => t('Allow to detecte node entity.'),
    'callback' => 'gcc_node_gcc_context_node_detector',
  );

  return $detectors;
}

/**
 * Entity detector for nodes.
 */
function gcc_node_gcc_context_node_detector($menu_item) {

  $path = substr($menu_item['path'], 0, strlen('node/%'));

  if ($path == 'node/%') {

    $node = node_load($menu_item['original_map'][1]);
    if ($node) {
      return array(

        'entity_type' => 'node',
        'entity' => $node,
      );
    }
  }
}
