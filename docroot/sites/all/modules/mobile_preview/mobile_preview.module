<?php

/**
 * @file
 * Allows content editors to easily preview a node on a mobile device.
 */

/**
 * Implements hook_permission().
 */
function mobile_preview_permission() {
  return array(
    'use mobile preview' => array(
      'title' => 'Use Mobile Preview',
    ),
  );
}

/**
 * Implements hook_menu().
 */
function mobile_preview_menu() {
  $items['node/%/mobile-preview'] = array(
    'title' => 'Mobile Preview',
    'page callback' => 'mobile_preview_preview',
    'page arguments' => array(1),
    'access arguments' => array('use mobile preview'),
    'type' => MENU_LOCAL_TASK,
  );
  return $items;
}

/**
 * Render the mobile preview page.
 *
 * @param int $nid
 *   The node ID to preview.
 *
 * @return mixed
 *   A Drupal render array or MENU_NOT_FOUND.
 */
function mobile_preview_preview($nid) {
  if (is_numeric($nid)) {
    return array(
      '#markup' => t('<div class="mobile-preview"><iframe src="@url"></iframe></div>', array('@url' => url('node/' . $nid))),
    );
  }
  else {
    return MENU_NOT_FOUND;
  }
}
