<?php
/**
 * @file
 * Cache Locale module.
 */

/**
 * Implements hook_flush_caches().
 */
function cache_locale_flush_caches() {
  return array('cache_locale');
}

/**
 * Implements hook_form_alter().
 */
function cache_locale_form_alter(&$form, $form_state, $form_id) {
  switch ($form_id) {
    case 'i18n_string_locale_translate_edit_form':
    case 'locale_translate_edit_form':
    case 'locale_translate_delete_form':
      $form['#submit'] = empty($form['#submit']) ? array() : $form['#submit'];
      array_unshift($form['#submit'], 'cache_locale_form_submit_clear_cache');
      break;
  }
}

/**
 * Submit handler for clearing the custom locale cache.
 */
function cache_locale_form_submit_clear_cache($form, &$form_state) {
  $bin = variable_get('cache_locale_bin', 'cache_locale');
  if ($bin != 'cache') {
    cache_clear_all('locale:', $bin, TRUE);
  }
}
