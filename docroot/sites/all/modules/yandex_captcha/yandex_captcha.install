<?php

/**
 * @file
 * Provides install, updated, and uninstall functions for Yandex.Captcha.
 */

/**
 * Implements hook_uninstall().
 */
function yandex_captcha_uninstall() {
  variable_del('yandex_captcha_key');
  variable_del('yandex_captcha_type');
  variable_del('yandex_captcha_refresh_image');
}

/**
 * Implements hook_requirements().
 */
function yandex_captcha_requirements($phase) {
  $requirements = array();
  $t = get_t();

  if ($phase == 'runtime') {
    $yandex_captcha_key = variable_get('yandex_captcha_key', NULL);

    if (empty($yandex_captcha_key)) {
      $requirements['yandex_captcha'] = array(
        'title' => $t('Yandex.Captcha'),
        'value' => $t('The Yandex CleanWeb API key was not found. Please fill key field on !url settings page. The key given to you when you register on Yandex services and get it on !api_url.',
          array(
            '!url' => l($t('Yandex.Captcha'), 'admin/config/people/captcha/yandex_captcha'),
            '!api_url' => l($t('API documentation area'), 'http://api.yandex.ru/cleanweb', array('attributes' => array('target' => '_blank'))),
          )
        ),
        'severity' => REQUIREMENT_ERROR,
      );
    }
  }

  return $requirements;
}
