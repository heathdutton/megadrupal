<?php

function link_to_self_field_formatter_field_formatter_info() {
  return array(
    'link_to_self' => array(
      'label' => t('Link to self'),
      'field types' => array('text'),
    ),
  );
}


function link_to_self_field_formatter_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $element = array();
  switch ($display['type']) {
    case 'link_to_self':
      foreach ($items as $delta => $item) {
        $uri = entity_uri($entity_type, $entity);
        $element[$delta] = array(
          '#theme' => 'link',
          '#text' => $item['safe_value'],
          '#path' => $uri['path'],
          '#options' => array(
            'attributes' => array(
              'class' => array('link-to-self'),
            ),
            'html' => false,
          ),
        );
      }

      break;
  }

  return $element;
}
