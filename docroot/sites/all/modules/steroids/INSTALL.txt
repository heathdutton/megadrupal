(12/1/2012: A very rough, first version of the INSTALL.txt)

This is a rough outline on how to install and configure steroids.

1. Install a webserver
======================

Pointing out the obvious, I know.
Make it listen to 127.0.0.1 on port 80.

2. Install Varnish
==================

Configure Varnish to listen on (most likely) your public ip on port 80.
This is the ip and port people will surf to, and should be what your webserver
was originally listening to.

Configure the admin port to listen on 127.0.0.1:2000
This is the port that will receive our purge commands.

Use one of the vcl's bundled with this module as your start for a new vcl, they
are in the root of the steroids module dir.

Edit the backend entry at the top of the vcl to point to your webserver's ip:port
Let's assume this is 127.0.0.1:80 like we've done in the prevous step.

If you restart Varnish and your webserver, you should now be able to surf to your
website and have X-Cache http header in the respone.

We'll come back to the vcl later, but continue for now.

3. Configure Drupal
===================

Add the following to the settings.php

$conf['reverse_proxy'] = TRUE;
$conf['reverse_proxy_addresses'] = array('127.0.0.1');
$conf['page_cache_invoke_hooks'] = FALSE;

Make sure the steroids module is enabled.

Configure the steroids module at /admin/config/development/steroids

- Configure Varnish

At the Varnish section, enter 127.0.0.1:2000 and the version you are using.
If you submit the form, it should not give you any errors. If you open the
Varnish tab again, you should set the status report display that Varnish is
indeed up and running.

- Configure Max age

This is pretty straight forward: set how long you want Varnish to keep cached
copies of node pages of a specific content type.

- Configure Expire

In most cases you should leave the 'Include base URL in expires' unchecked.

- Configure ESI

There's a section about ESI blocks in the README.txt, if you read that, this
part should be pretty straight forward.

- Configure Cache Bypass

For certain roles, like webmaster and administrators, you want Varnish to skip
the caching globally. This is done by setting a cookie with a unique value for
each role.

On this setting page you should check all the roles that need to be skipped for
caching and enter a cookie value in the form below it. This value needs to be
copied into the vcl so Varnish knows to exclude these pages from being served
cached content.

Open the vcl and look for the text "vcache-bypass-token". These lines need to be
edited to hold the same cookie value as you just entered in the settings form.
Make it a random 32 char string or similar, something that should not be easily
guessed. (this is not very secure, we know, but it's a simple trick to skip the
cache).

For each role you need to duplicate that line and enter the corresponding cookie
value you set in the steroids settings form.

4. That's it
============

If you restart Varnish now so it has the vcl changes you just made, your pages
should be cached by Varnish and editing pages should trigger expire/ban commands
to Varnish so your caches get cleared.


