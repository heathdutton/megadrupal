<?php
// $Id$

/**
 * @file:
 * This module provides integration between Drupal nodes and CollectiveAccess objects
 */

include_once('collectiveaccess_node.api.inc');

/**
 * Implementation of hook_menu().
 */
function collectiveaccess_node_menu() {
  $items = array();

  $items['admin/settings/collectiveaccess/node'] = array(
    'title' => 'Node settings',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('collectiveaccess_node_admin_settings'),
    'access arguments' => array('administer collectiveaccess'),
    'type' => MENU_LOCAL_TASK,
    'file' => 'collectiveaccess_node.admin.inc',
  );

  return $items;
}

/**
 * Implementation of hook_nodeapi().
 */
function collectiveaccess_node_nodeapi(&$node, $op, $a3 = NULL, $a4 = NULL) {
  if ($node->type == variable_get('collectiveaccess_node_contenttype', '')) {
    switch ($op) {
      case 'insert':
      case 'update':
        if ($ca_item_id = $node->ca_item_id) {
          collectiveaccess_node_add($node->nid, $ca_item_id);
        }
        break;
      case 'load':
        $node->ca_item_id = collectiveaccess_node_get_ca_item_id($node->nid);
        break;
      case 'delete':
        collectiveaccess_node_delete($nid);
        break;
    }
  }
}