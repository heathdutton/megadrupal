<?php

/**
 * Implements hook_menu().
 */
function freeipmi_menu() {
/*
ipmi-chassis         ipmi-console         ipmidetectd          ipmimonitoring       ipmi-pet             ipmi-raw             ipmi-sensors-config  
ipmi-chassis-config  ipmi-dcmi            ipmi-fru             ipmi-oem             ipmiping             ipmi-sel             
ipmiconsole          ipmidetect           ipmi-locate          ipmi-pef-config      ipmipower            ipmi-sensors         
*/
    $items = array();
    $items['admin/freeipmi'] = array(
        'title' => 'FreeIPMI',
        'position' => 'right',
        'weight' => -10,
        'page callback' => 'freeipmi_admin',
        'access arguments' => array('administer freeipmi'),
        'file' => 'freeipmi.admin.inc',
    );
    $items['admin/freeipmi/chassis'] = array(
        'type' => MENU_NORMAL_ITEM,
        'title' => 'Chassis',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('freeipmi_admin_chassis'),
        'access callback' => 'freeipmi_check_access',
        'access arguments' => array('administer chassis'),
        'file' => 'freeipmi.admin.inc',
    );
    $items['admin/freeipmi/power'] = array(
        'type' => MENU_NORMAL_ITEM,
        'title' => 'Power',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('freeipmi_admin_power'),
        'access callback' => 'freeipmi_check_access',
        'access arguments' => array('administer power'),
        'file' => 'freeipmi.admin.inc',
    );

    return $items;
}

/**
 * Implements hook_permission().
 */
function freeipmi_permission() {
    return array(
        'administer freeipmi' => array(
            'title' => t('Administer FreeIPMI'),
            'description' => t('Perform any FreeIPMI operations.'),
            'restrict access' => true,
        ),
        'administer chassis' => array(
            'title' => t('Administer Chassis'),
            'description' => t('Perform FreeIPMI chassis operations.'),
            'restrict access' => true,
        ),
        'administer power' => array(
            'title' => t('Administer Power'),
            'description' => t('Perform FreeIPMI power operations.'),
            'restrict access' => true,
        ),
    );
}

function freeipmi_check_access($perm, $account = null) {
    if (empty($account)) {
        global $user;
        $account = $user;
    }

    return user_access($perm, $account) || user_access('administer freeipmi', $account);
}
