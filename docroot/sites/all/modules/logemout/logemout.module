<?php

/**
 * @file
 * Log Em Out Module.
 */

/**
 * Implements hook_permission().
 */
function logemout_permission() {
  return array(
    'prevent multiple logins by user' => array(
      'title' => t('Prevent multiple logins by user'), 
      'description' => t('Logs out previous users using same username.'),
    ),
  );
}

/**
 * Implements hook_user_login().
 */
function logemout_user_login(&$edit, $account) {

  $ip_address = ip_address();
  $perm = user_access('prevent multiple logins by user');

  if (isset($account->uid) && isset($account->login) && $perm) {
    db_delete('sessions')
      ->condition('uid', $account->uid)
      ->condition('hostname', $ip_address, '!=')
      ->condition('timestamp', $account->login, '!=')
      ->execute();
  }
}