<?php

/**
 * Implements hook_menu().
 *
 */
function quiz_share_menu() {
	$items['admin/config/quiz-share'] = array(
    'title' => 'Quiz Share Configuration',
    'description' => 'Configure the Quiz Share Module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('quiz_share_admin_settings'),
    'access arguments' => array('administer site configuration'),
    'file' => 'quiz_share.admin.inc',
  );
  return $items;
}

/**
 * Implementation hook_quiz_finished().
 *
 * Prompts to share the result at the end of quiz.
 */
function quiz_share_quiz_finished($quiz, $score, $rid) {
  //dsm($quiz);
  $quiz = node_load($quiz->nid);
  $msg_name = "PLAYED";
  $msg_caption = $quiz->title;
  $share_image = "http://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Circle-question.svg/240px-Circle-question.svg.png";
  if ($score['percentage_score'] >= $quiz->pass_rate) {
    $msg_name = "PASSED!!";
  }
  if ($score['percentage_score'] < $quiz->pass_rate) {
    $msg_name = "FAILED!!";
  }
  drupal_add_js('http://connect.facebook.net/en_US/all.js', 'external');
  //https://developers.facebook.com/docs/reference/javascript/FB.ui/
  $script_code = 'jQuery(document).ready(function () {
	FB.init({ 
            appId:"'. variable_get('quiz_share_fb_appid', '') .'", cookie:true, 
            status:true, xfbml:true 
         });
     FB.ui({
        method: "feed",
        name: "'.$msg_name.'",
        link: "'.url("node/".$quiz->nid, array('absolute' => TRUE)).'",
        picture: "'.$share_image.'",
        caption: "'.$msg_caption.'",
        description: "'.strip_tags($quiz->body['und'][0]['value']).'"});
    });';
  //watchdog('quiz_share',$script_code);
  drupal_add_js($script_code, array('type' => 'inline', 'scope' => 'footer', 'weight' => 5));
}
