<?php

/**
 * @file revision_authorship.module
 * TODO: Enter file description here.
 */


/**
 * Implements hook_form_FORM_ID_alter().
 */
function revision_authorship_form_node_type_form_alter(&$form, &$form_state) {
  $form['workflow']['node_options']['#options']['revision_authorship'] = t('Preserve revision authorship');
}

/**
 * Implements hook_node_update().
 */
function revision_authorship_node_update($node) {
  global $user;

  // If the current user is the original revision user, we can skip the update.
  if (!$node->revision && $user->uid != $node->original->revision_uid) {
    $node_options = variable_get('node_options_' . $node->type, array());

    if (in_array('revision_authorship', $node_options)) {
      db_update('node_revision')
        ->fields(array('uid' => $node->original->revision_uid))
        ->condition('node_revision.vid', $node->vid)
        ->execute();
    }
  }
}
