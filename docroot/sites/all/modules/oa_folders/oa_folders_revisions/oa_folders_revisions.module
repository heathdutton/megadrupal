<?php
/**
 * @file
 * Code for the OpenAtrium Folders revisions module.
 */


/**
 * Implements hook_menu_alter().
 */
function oa_folders_revisions_menu_alter(&$items) {
  // We add the ctools_automodal option to the patched file_entity_revisions menu
  $items['file/%file/revisions']['modal'] = TRUE;
  $items['file/%file_entity_revision/revisions/%/view']['modal'] = TRUE;
  $items['file/%file_entity_revision/revisions/%/revert']['modal'] = TRUE;
  $items['file/%file_entity_revision/revisions/%/delete']['modal'] = TRUE;
}

/**
 * Implementation of hook_folder_toolbox()
 */
function oa_folders_revisions_folder_toolbox() {
  $items = array();
  $items[] = array(
    'op' => 'revisions',
    'type' => 'file',
    'title' => t('History'),
    'description' => t('Access file revisions.'),
    'glyphicon' => 'glyphicon glyphicon-time icon-time',
    'path' => 'file/!fid/revisions',
    'attributes' => array(),
    'verify' => TRUE,
  );
  return $items;
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function oa_folders_revisions_form_file_entity_edit_alter(&$form, &$form_state, $form_id) {
  // Set the revision checkbox to true
  if (isset($form['options']) && isset($form['options']['new_revision'])) {
    $form['options']['new_revision']['#default_value'] = TRUE;
  }
}
