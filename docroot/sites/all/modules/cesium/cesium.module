<?php

/**
 * @file
 * Main file of the Cesium module.
 */

/**
 * Implements hook_libraries_info().
 */
function cesium_libraries_info() {
  $libraries['cesium'] = array(
    'name' => 'Cesium',
    'vendor url' => 'http://cesiumjs.org',
    'download url' => 'http://cesiumjs.org/downloads.html',
    'version arguments' => array(
      'file' => 'package.json',
      'pattern' => '/((?:\d+\.?){2,3})/',
      'lines' => 3,
    ),
    'files' => array(
      'js' => array('Build/Cesium/Cesium.js'),
      'css' => array('Build/Cesium/Widgets/widgets.css'),
    ),
    'variants' => array(
      'minified' => array(
        'files' => array(
          'js' => array('Build/Cesium/Cesium.js'),
          'css' => array('Build/Cesium/Widgets/widgets.css'),
        ),
      ),
      'unminified' => array(
        'files' => array(
          'js' => array('Build/CesiumUnminified/Cesium.js'),
          'css' => array('Build/CesiumUnminified/Widgets/widgets.css'),
        ),
      ),
    ),
  );

  return $libraries;
}

/**
 * Implements hook_libraries_info_alter().
 */
function cesium_libraries_info_alter(&$libraries) {
  $library = libraries_detect('cesium');

  if ($library['installed'] == TRUE) {
    $data = "var CESIUM_BASE_URL = '" . url($library['library path'] . '/Build/Cesium/') . "';";
    $jsfile = file_unmanaged_save_data($data, 'public://cesium_base_url.js', FILE_EXISTS_REPLACE);

    $libraries['cesium']['files']['js'][$jsfile] = array(
      'data' => $jsfile,
      'weight' => 0,
      'group' => JS_LIBRARY,
    );
  }
}
