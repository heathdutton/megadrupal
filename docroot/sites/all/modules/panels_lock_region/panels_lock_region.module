<?php
/**
 * @file
 * Implements hooks needed for this module.
 */

/**
 * Implements hook_help().
 */
function panels_lock_region_help($path, $arg) {
  switch ($path) {
    // Generic help path for this module.
    case 'admin/help#panels_lock_region':
      return '<p>' . t('Display renderer plugin which allows privileged users to lock entire regions on a panel using the plugin.') . '</p>';
  }
}

/**
 * Implements hook_ctools_plugin_api().
 */
function panels_lock_region_ctools_plugin_api($module, $api) {
  if ($module == 'panels' && $api == 'pipelines') {
    return array(
      'version' => 1,
      'path' => drupal_get_path('module', 'panels_lock_region') . '/includes',
    );
  }
}

/**
 * Implements hook_ctools_plugin_directory().
 */
function panels_lock_region_ctools_plugin_directory($owner, $plugin_type) {
  if ($owner == 'panels' && $plugin_type == 'display_renderers') {
    return 'plugins/' . $plugin_type;
  }
}

/**
 * Implements hook_permission().
 */
function panels_lock_region_permission() {
  return array(
    'administer panels region lock' => array(
      'title' => t('Administer Selective In-Place Editor regions lock'),
      'description' => t('Allows lock and unlock panels regions when using Selective In-Place Editor renderer plugin.'),
    ),
  );
}

/**
 * Implements hook_theme().
 */
function panels_lock_region_theme() {
  return array(
    'panels_lock_region_region_buttons' => array(
      'file' => 'panels_lock_region.theme.inc',
      'variables' => array(
        'region_id' => NULL,
        'display' => NULL,
        'renderer' => NULL,
      ),
    ),
  );
}

/**
 * Implements hook_panels_display_save().
 */
function panels_lock_region_panels_display_save($display) {
  // If not region locks info is available.
  if (!isset($display->panel_settings['region_lock'])) {
    // Create lock info for each region.
    foreach ($display->panels as $region => $data) {
      $display->panel_settings['region_lock'][$region] = 'unlocked';
    }
    panels_save_display($display);
  }
}

/**
 * Auxiliary function to determine if a region is locked or not.
 *
 * @param object $display
 *   A panels display object.
 * @param string $region
 *   Name of the region to be evaluated as locked or unlocked.
 *
 * @return bool
 *   True if region is locked, False if not.
 */
function _panels_lock_region_region_is_locked($display, $region) {
  if (isset($display->panel_settings['region_lock'])) {
    return $display->panel_settings['region_lock'][$region] == 'locked';
  }

  return FALSE;
}
