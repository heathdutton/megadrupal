<?php

/**
 * @file
 * Lets users to view the permission key.
 *
 * Adds the permission key near the title, in the permissions overview page.
 */

/**
 * Implements hook_form_FORM_ID_alter().
 */
function permissions_helper_form_user_admin_permissions_alter(&$form, &$form_state, $form_id) {
  foreach ($form['permission'] as $permission_key => $permission) {
    if (!is_numeric($permission_key)) {
      $help = array(
        'help' => array(
          '#theme' => 'permission_help',
          '#permission' => $permission_key,
        ),
      );

      // Avoid to override an already defined suffix.
      if (empty($form['permission'][$permission_key]['#suffix'])) {
        $form['permission'][$permission_key]['#suffix'] = '';
      }

      $form['permission'][$permission_key]['#suffix'] .= render($help);
    }
  }
}

/**
 * Implements hook_theme().
 */
function permissions_helper_theme($existing, $type, $theme, $path) {
  return array(
    'permission_help' => array(
      'variables' => array(
        'permission' => NULL,
      ),
      'template' => 'permission-help',
      'path' => $path . '/templates',
    ),
  );
}
