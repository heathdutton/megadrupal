<?php
/**
 * @file
 * Install hooks for the Spam Record module.
 */

/**
 * Implements hook_enable().
 */
function spamrecord_enable() {
  // Rebuild the features data to pull in the new vocabulary.
  features_rebuild();

  // Check for a 'Phone call' taxonomy term in the spamrecord_msg_type
  // vocabulary.
  $vocabularies = taxonomy_vocabulary_get_names();
  $vid = $vocabularies['spamrecord_msg_type']->vid;
  $terms = taxonomy_term_load_multiple(array(), array('name' => 'Phone call', 'vid' => $vid));
  if ($vid && empty($terms)) {
    _spamrecord_runonce();
  }
}

/**
 * Add default taxonomy terms.
 * Used as a helper function with hook_enable, because hook_install runs too
 * early; the vocabulary created by the feature is required.
 */
function _spamrecord_runonce() {
  // Add taxonomy terms for the spamrecord_msg_type vocabulary:
  // Phone call, SMS, Fax.
  $terms = array(
    array(
      'name' => 'Phone call',
      'weight' => 0,
    ),
    array(
      'name' => 'SMS',
      'weight' => 1,
    ),
    array(
      'name' => 'Fax',
      'weight' => 2,
    ),
  );

  $vocabularies = taxonomy_vocabulary_get_names();
  $vid = $vocabularies['spamrecord_msg_type']->vid;

  foreach ($terms as $term) {
    $term = (object) $term;;
    $term->description = '';
    $term->format = filter_fallback_format();
    $term->vid = $vid;

    taxonomy_term_save($term);
  }
}
