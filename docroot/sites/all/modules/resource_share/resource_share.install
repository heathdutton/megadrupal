<?php
/**
 * @file
 * Install, update and uninstall functions for the Content API module.
 */

 
/**
* Implements hook_requirements()
* @return array if there is error, void if okay
*/

// Check if other modules implement hook services_resources and 
// prevent installation till they are removed.
function resource_share_requirements($phase) {
  if ($phase == 'install') {
    $modules_implementing = module_implements('services_resources');
  unset($modules_implementing[array_search('services', $modules_implementing)]);
  unset($modules_implementing[array_search('services_views', $modules_implementing)]);
  //unset the array element corresponding to the "services" module
    if (!empty($modules_implementing)) {
      $requirements['resource_share'] = array(
      'title'         => 'Modules need need to be disabled in order to install Resource Share',
      'description'    => 'THE ' . implode(' ', $modules_implementing) . ' MODULE(S) USE THE SAME HOOKS AS Resource Share AND NEED TO BE DISABLED FIRST',
      'severity'        => REQUIREMENT_ERROR
    );
  return $requirements;
  }
  }
  }


function resource_share_install() {
  variable_set('resource_share_limit', 10);
  variable_set('resource_share_cap', 200);
  variable_set('resource_share_batch', 200);
  variable_set('resource_share_require_authentication', 0);

  $user_roles = user_roles($membersonly = TRUE, $permission = NULL);
  variable_set('resource_share_roles', $user_roles);

  $content_share_default_fields = array(
    'nid' => 'nid',
    'type' => 'type',
    'created' => 'created',
    'title' => 'title',
    'body' => 'body',
    'teaser' => 'teaser',
    'taxonomy' => 'taxonomy',
  );
  variable_set('resource_share_resource_fields_auth', $content_share_default_fields);
  variable_set('resource_share_resource_fields_anon', $content_share_default_fields);
}

function resource_share_uninstall() {
// Drop content_share tables and delete variables from 'variables'
  variable_del('resource_share_limit');
  variable_del('resource_share_cap');
  variable_del('resource_share_batch');
  variable_del('resource_share_require_authentication');
  variable_del('resource_share_roles');
  variable_del('resource_share_resource_types_anon');
  variable_del('resource_share_resource_types_auth');
  variable_del('resource_share_resource_fields_anon');
  variable_del('resource_share_resource_fields_auth');
  variable_del('resource_share_expose_tables');
  variable_del('resource_share_tables');
}


  
