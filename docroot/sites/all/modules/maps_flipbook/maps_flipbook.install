<?php
/**
 * @file
 * Installation related functions for the MaPS Flipbook module.
 */

/**
 * Implements hook_field_schema().
 */
function maps_flipbook_field_schema($field) {
  return array(
    'columns' => array(
      'path' => array(
        'type' => 'varchar',
        'description' => 'The path to the images folder.',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'config_file' => array(
        'type' => 'varchar',
        'description' => 'The path to the configuration file, relative to the path.',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
    ),
    //'indexes' => array(
    //  'path' => array('path'),
    //),
  );
}

/**
 * Implements hook_update_N().
 *
 * Remove the full_path column from all "maps_flipbook" existing fields table.
 */
function maps_flipbook_update_7000() {
  foreach (field_info_fields() as $field_name => $field) {
    if ($field['type'] == 'maps_flipbook' && $field['storage']['type'] == 'field_sql_storage') {

      foreach ($field['storage']['details']['sql'] as $type => $table_info) {
        foreach ($table_info as $table_name => $columns) {
          db_drop_field($table_name, _field_sql_storage_columnname($field_name, 'full_path'));
        }
      }
    }
  }

  field_cache_clear();
}
