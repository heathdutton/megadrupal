<?php
/**
 * @file
 * Attach extra CSS and JS assets for specific nodes and types.
 * Naming conventions are:
 * /sites/all/themes/YOURTHEME/js/nodes/###.js
 * /sites/all/themes/YOURTHEME/css/nodes/###.css
 */

// Waiting for the correct in responce to this: http://drupal.org/node/1608960
define('CSS_CONTENT', 2100);
define('JS_CONTENT', 2100);

/**
 * Attach while node(s) are actaully loaded for viewing.
 */
function content_code_preprocess_node(&$vars) {

  $theme_path = drupal_get_path('theme', variable_get('theme_default', NULL));
  $add_css_options = array('type' => 'file', 'group' => CSS_CONTENT, 'preprocess' => FALSE);
  $add_js_options = array('type' => 'file', 'group' => JS_CONTENT, 'preprocess' => FALSE);

  // Add type specific CSS/JS files.
  $add_css_options['weight'] = 0;
  $add_js_options['weight'] = 0;
  static $addTypeCode;
  if (!isset($addTypeCode[$vars['node']->type])) { // Prevent multiple adds.
    $typeCSS = $theme_path . '/css/content-types/' . $vars['node']->type . '.css';
    $typeJS = $theme_path . '/js/content-types/' . $vars['node']->type . '.js';
    if (file_exists($typeCSS)) {
      drupal_add_css($typeCSS, $add_css_options);
    }
    if (file_exists($typeJS)) {
      drupal_add_js($typeJS, $add_js_options);
    }
    $addTypeCode[$vars['node']->type] = true;
  }

  // Add node specific CSS/JS files.
  $add_css_options['weight'] = 10;
  $add_js_options['weight'] = 10;
  $identifier = $vars['node']->nid;
  if (module_exists('i18n') && $vars['node']->tnid) { // Allow sharing CSS between translations.
    $identifier = $vars['node']->tnid;
  }
  static $addNodeCode;
  if (!isset($addNodeCode[$identifier])) { // Prevent multiple adds.
    $fileCSS = $theme_path . '/css/nodes/' . $identifier . '.css';
    $fileJS = $theme_path . '/js/nodes/' . $identifier . '.js';
    if (file_exists($fileCSS)) {
      drupal_add_css($fileCSS, $add_css_options);
    }
    if (file_exists($fileJS)) {
      drupal_add_js($fileJS, $add_js_options);
    }
    $addNodeCode[$identifier] = true;
  }

}
