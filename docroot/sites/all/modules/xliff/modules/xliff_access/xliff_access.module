<?php

// @todo: this module does not have any administrative interface nor any action
// to manage the node access.

/**
 * @file
 *   Node level access for XLIFF tools.
 */

/**
 * Implements hook_menu_alter().
 */
function xliff_access_menu_alter(&$items) {
  $items['node/%node/xliff']['access callback'] = 'xliff_access_export';
  $items['node/%node/xliff']['access arguments'] = array(1);
  $items['node/%node/xliff/import']['access callback'] = 'xliff_access_import';
  $items['node/%node/xliff/import']['access arguments'] = array(1);
}

/**
 * Altered menu access callback for XLIFF export.
 */
function xliff_access_export($node) {
  $denied = db_query('SELECT export_denied FROM {xliff_access} WHERE nid = :nid', array(':nid' => $node->nid))->fetchField();
  return user_access('xliff export') && !$denied;
}

/**
 * Altered menu access callback for XLIFF import.
 */
function xliff_access_import($node) {
  $denied = db_query('SELECT import_denied FROM {xliff_access} WHERE nid = :nid', array(':nid' => $node->nid))->fetchField();
  return user_access('xliff import') && !$denied;
}
