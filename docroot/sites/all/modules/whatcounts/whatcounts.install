<?php
// @file

/**
 * Implements hook_requirements()
 */
function whatcounts_requirements($phase) {
  $requirements = array();
  // Ensure translations don't break at install time
  $t = get_t();

  // Check if php curl extension is installed
  $severity = !in_array('curl', get_loaded_extensions()) ? REQUIREMENT_ERROR : REQUIREMENT_OK;
  $value = ($severity == REQUIREMENT_OK) ? 'Enabled' : 'Disabled';
  $requirements['curl'] = array(
    'title' => $t('cURL Support'), 
    'description' => $t('Displays the status of the PHP cURL extension'),
    'value' => $value,
    'severity' => $severity,
  );

  return $requirements;
}

/**
 * Install, update and uninstall functions for the WhatCounts module.
 */
function whatcounts_uninstall() {
  db_query("DELETE FROM {variable} WHERE name LIKE 'whatcounts_0_%'");
  db_query("DELETE FROM {variable} WHERE name LIKE 'whatcounts_1_%'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_address1'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_address2'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_age_verif_failed_url'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_allow_redirects'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_city'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_company'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_connect_timeout'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_coppa'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_coppa_message'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_country'");
  db_query("DELETE FROM {variable} WHERE name LIKE 'whatcounts_custom%'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_debug'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_default_format'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_display_format'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_dns_cache_timeout'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_domain'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_fax'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_first'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_global_optout'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_goto'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_header'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_last'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_listid'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_phone'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_pwd'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_realm'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_slid'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_ssl'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_ssl_verify_host'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_ssl_verify_peer'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_state'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_subscribe_button'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_subscribe_button_text'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_subscribe_image_button'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_subscribe_image_button_url'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_subscribe_url'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_unsubscribe_button'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_unsubscribe_button_text'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_unsubscribe_image_button'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_unsubscribe_image_button_url'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_unsubscribe_url'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_verbose'");
  db_query("DELETE FROM {variable} WHERE name = 'whatcounts_zip'");
}
