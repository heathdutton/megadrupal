<?php
/**
 * @file
 * Installation and update hooks for the Unique Queue module.
 */

/**
 * Implements hook_schema_alter().
 *
 * Adds the key and updated columns to the queue table.
 */
function unique_queue_schema_alter(&$schema) {
  $schema['queue']['fields']['unique_key'] = array(
    'type' => 'varchar',
    'length' => 255,
    'not null' => FALSE,
    'default' => NULL,
    'description' => 'Optional key for uniqueness.',
  );

  $schema['queue']['fields']['updated'] = array(
    'type' => 'int',
    'not null' => TRUE,
    'default' => 0,
    'description' => 'Timestamp when a unique queue item was last updated.',
  );
}

/**
 * Implements hook_install().
 *
 * Adds the new fields to the queue table in order to maintain uniqueness.
 */
function unique_queue_install() {
  $schema = array();
  unique_queue_schema_alter($schema);
  foreach ($schema['queue']['fields'] as $field_name => $field) {
    db_add_field('queue', $field_name, $field);
  }
}

/**
 * Implements hook_uninstall().
 *
 * Removes the added fields from the queue table.
 */
function unique_queue_uninstall() {
  $schema = array();
  unique_queue_schema_alter($schema);
  foreach ($schema['queue']['fields'] as $field_name => $field) {
    db_drop_field('queue', $field_name);
  }
}
