<?php

/**
 * Implements hook_uninstall().
 */
function ws_slideshow_uninstall() {
  //
  db_delete('variable')
    ->condition('name', db_like('ws_slideshow_') . '%', 'LIKE')
    ->execute();
}

/**
 * Implements hook_install().
 */
function ws_slideshow_install() {
  //set default values for /ws-slideshow
  variable_set('ws_slideshow_width', 630);
	variable_set('ws_slideshow_height', 450);
	variable_set('ws_slideshow_thumb_width', 50);
	variable_set('ws_slideshow_thumb_height', 50);

	//prepare directories - albums, thumbs
  // !!! file_default_scheme var is empty if not saved media file system
  $file_default_scheme = variable_get('file_default_scheme', '') ? variable_get('file_default_scheme', '') : 'public';
  $albums_dest = $file_default_scheme . '://ws-slideshow/albums/';
  file_prepare_directory($albums_dest, $options = FILE_CREATE_DIRECTORY);

	$thumbs_dest = variable_get('file_default_scheme', '') . '://ws-slideshow/images/ws_slideshow_thumbs';
  file_prepare_directory($thumbs_dest, $options = FILE_CREATE_DIRECTORY);

	//create node type
  $t = get_t();

  $node_ws = array(
    'type' => 'node_ws_slideshow',
    'name' => $t('WS slideshow node'),
    'base' => 'node_content',
    'description' => $t('This is an WS Slideshow node.'),
    'title_label' => 'Album name',
    'custom' => TRUE,
  );

  $content_type = node_type_set_defaults($node_ws);

  // Save the content type
  node_type_save($content_type);

  //create field file
  if (!field_info_field('field_ws_file')) {
    $field = array(
      'field_name' => 'field_ws_file',
      'type' => 'file',
      'cardinality' => '-1',
    );
    field_create_field($field);

    $bundles = array('node_ws_slideshow');
    // Create the instance on bundles.
    foreach($bundles AS $bundle) {
      $instance = array(
        'field_name' => 'field_ws_file',
        'entity_type' => 'node',
        'label' => 'WS Slidesow file',
        'bundle' => $bundle,
        'required' => TRUE,
        'widget' => array(
          'type' => 'file',
	        'settings' => array(
	          'filefield_sources' => array(
	            'filefield_sources' => array(
		            'plupload' => 'plupload',
	            ),
	            'source_attach' => array(
		            'path' => 'file_attach',
		            'absolute' => 0,
		            'attach_mode' => 'move',
	            ),
	          ),
	        ),
        ),
	      'settings' => array(
	        'file_extensions' => 'jpg gif png',
	        'file_directory' => 'ws-slideshow/images',
					'description_field' => 1,
	      ),
	      'display' => array(
	        'default' => array(
	          'label' => 'hidden',
	          'type' => 'field_ws_slideshow',
	        ),
	      ),
      );

			field_create_instance($instance);
    }
  }
}
