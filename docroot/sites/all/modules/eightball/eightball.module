<?php
// $Id: eightball.module,v 1.3 2009/04/22 18:12:45 sunsetbill Exp $

/**
 * @file
 * eightball module displays a silly little 8-ball widget
 */

/**
* Display help and module info
* @param section  -- which section of the site we're displaying help
* @return help  -- text for section
*/
function eightball_help($section = '') {
  $output = '';

  switch ($section) {
    case "admin/help#eightball";
      $output = '<p>'. t("Help text here") .'<p>';
  }

  return $output;
}


/**
* Implements hook_perm
* valid permissions for eightball module
* @return array  --An array of valid permissions
*/
function eightball_permission() {
 return array(
    'access eightball' => array(
      'title' => t('Access Eightball'),
      'description' => t('Use the magic 8-ball'),
    ),
  );
}

/**
 * Implements hook_init()
 */
function eightball_init() {
  $path = drupal_get_path('module', 'eightball');
  drupal_add_js($path .'/eightball.js');
  drupal_add_css($path .'/eightball.css');
  drupal_add_js(array('eightball' => array('path' => $path)), 'setting');
}

/**
 * Implements hook_menu()
 */
function eightball_menu() {
  $items = array();
  $items['eightball'] = array(
    'title' => 'answer',
    'page callback' => 'eightball_answer',
    'access arguments' => array('access eightball'),
    'type' => MENU_CALLBACK,
  );
  return $items;
}


/**
 * callback eightball_answer
 */
function eightball_answer() {
  $random = (rand(1,20));
  $query = "SELECT answer FROM eightball_responses where rid=:rid";
  $result = db_query($query, array(':rid' => $random))->fetchField();
  print $result;
}


/**
  * Implements hook_block_info
  */
function eightball_block_info() {
  $blocks['eightball'] = array(
    'info' => t('Eightball'),
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function eightball_block_view($delta='') {
  global $base_url;
  $block = array();
  $path = $base_url . '/' . drupal_get_path('module', 'eightball');
  $block_content = '<span onclick="eightball()">&nbsp;</span>';

  $block['content'] = theme('eightball', array('block' => $block_content));

  return $block;
}

/**
 * Implements hook_theme
 * @return array
 */

function eightball_theme($existing, $type, $theme, $path) {
  return array(
    'eightball' => array(
      'render element' => array(),
      'template' => 'theme/eightball',
    ),
  );
}
