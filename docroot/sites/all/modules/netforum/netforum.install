<?php

/**
 * @file
 * The netFORUM xWeb Interface installation file
 *
 *  Defines a schema for installing the module
 *
 */


/**
 * Implements hook_schema().
 */
function netforum_schema() {
  $schema['netforum_request_cache'] = array(
    'description' => 'Caches xWeb requests locally',
    'fields' => array(
      'user_name' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
      ),
      'wsdl_loc' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
      ),
      'request' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
      ),
      'arguments' => array(
        'type' => 'text',
        'not null' => FALSE,
      ),
      'arguments_sha1_hash' => array(
        'type' => 'varchar',
        'length' => 40,
        'not null' => FALSE,
      ),
      'response' => array(
        'type' => 'text',
        'size' => 'big',
        'not null' => FALSE,
      ),
      'add_date' => array(
        'mysql_type' => 'DATETIME',
        'pgsql_type' => 'timestamp without time zone',
        'not null' => TRUE,
      ),
    ),
    'indexes' => array(
      'request' => array('request'),
      'arguments_sha1_hash' => array('arguments_sha1_hash'),
    ),
    'primary key' => array('add_date'),
  );

  $schema['netforum_object_cache'] = array(
    'description' => 'Caches a list of objects available in netFORUM',
    'fields' => array(
      'obj_name' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
      ),
      'obj_key' => array(
        'type' => 'varchar',
        'length' => 36,
        'not null' => TRUE,
      ),
      'obj_key_field' => array(
        'type' => 'varchar',
        'length' => 60,
        'not null' => FALSE,
      ),
      'obj_prefix' => array(
        'type' => 'varchar',
        'length' => 3,
        'not null' => TRUE,
      ),
      'obj_defaultcolumns' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
      ),
      'obj_defaultorderby' => array(
        'type' => 'varchar',
        'length' => 255,
        'not null' => FALSE,
      ),
      'data' => array(
        'type' => 'text',
        'size' => 'big',
        'not null' => FALSE,
      ),
    ),
    'indexes' => array(
      'obj_key' => array('obj_key'),
    ),
    'primary key' => array('obj_name'),
  );

  return $schema;
}

/**
 * Uninstal the Drupal module, clear out any variables
 */
function netforum_uninstall() {
  // Remove tables.
  // TODO The drupal_(un)install_schema functions are called automatically in D7.
  // drupal_uninstall_schema('netforum')

  variable_del('netforum_cache_max');
  variable_del('netforum_cache_default');
  variable_del('netforum_wsdl_url');
  variable_del('netforum_xweb_username');
  variable_del('netforum_xweb_password');
  variable_del('netforum_verify_availability');
  variable_del('netforum_verify_length');
  variable_del('netforum_verify_timeout');
  variable_del('netforum_slow_query_limit');
}
