<?php

/**
 * @file
 * uc_cck_access_acl module install file.
 */


/**
 * Implements hook_install().
 */
function uc_cck_access_acl_install() {
  // Alter the acl_node table to add an data field for node grants
  $ret = array();
  db_add_field('acl_node', 'uc_cck_access_acl_data', array('type' => 'varchar', 'length' => 255, 'not null' => FALSE));

  // User convenience - Install our handler if there is no handler
  $node_handler = variable_get('ucca_node_handler', '');
  if (!$node_handler || !function_exists($node_handler)) {
    variable_set('ucca_node_handler', 'uc_cck_access_acl_ucca_node_handler');
  }

  drupal_set_message(t("UC CCK Access ACL module has been enabled. You can edit it's settings at !link",
    array('!link' => l('Administer > Store administration > Configuration > Product settings > Product features ', 'admin/store/settings/products/edit/features' ) )
  ));
}

/**
 * Implements hook_uninstall().
 */
function uc_cck_access_acl_uninstall() {
  // User convenience - Uninstall the handler if it is ours
  $node_handler = variable_get('ucca_node_handler', '');
  if ($node_handler == 'uc_cck_access_acl_ucca_node_handler') {
    variable_del('ucca_node_handler');
  }

  // Remove records from acl, acl_node, acl_user tables
  @db_query("DELETE FROM {acl_user} WHERE acl_id IN (SELECT acl_id FROM {acl} WHERE module = 'uc_cck_access_acl')");
  @db_query("DELETE FROM {acl_node} WHERE acl_id IN (SELECT acl_id FROM {acl} WHERE module = 'uc_cck_access_acl')");
  @db_query("DELETE FROM {acl} WHERE module = 'uc_cck_access_acl'");

  // We can't remove acl/acl_node/acl_user records for module 'content_access' that we created.
  // Admin can clear those using content_access module.

  // Remove data field from acl_node table
  $ret = array();
  db_drop_field('acl_node', 'uc_cck_access_acl_data');
}

/**
 * Implementation of hook_update_N().
 * Add data field to acl_node table.
 */
function UNUSED_uc_cck_access_acl_update_6001() {
  $ret = array();
  db_add_field('acl_node', 'uc_cck_access_acl_data', array('type' => 'varchar', 'length' => 255, 'not null' => FALSE));
  return $ret;
}

