<?php

/**
 * @file
 * This module transform an org file to nodes.
 */

/**
 * Implements hook_permission().
 */
function orgmode_permission() {
  return array(
    'view upload orgmode page' => array(
      'title' => t('View upload orgmode page'),
      'description' => t('Can upload orgmode file.'),
    ),
    'administer orgmode' => array(
      'title' => t('Administer Orgmode'),
      'description' => t('Perform administration tasks on orgmode.'),
      'restrict access' => TRUE,
    ),
  );
}

/**
 * Implements hook_menu().
 */
function orgmode_menu() {
  $items = array();

  $items['orgmode'] = array(
    'title' => 'Orgmode Import',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('orgmode_form_upload'),
    'access arguments' => array('view upload orgmode page'),
    'description' => 'Org Mode Import',
    'file' => 'orgmode.inc',
    'weight' => 10,
  );

  $items['node/%/export-to-org'] = array(
    'title' => 'Export to org',
    'page callback' => 'orgmode_export',
    'page arguments' => array(1),
    'access arguments' => array('access simple page'),
    'file' => 'orgmode.inc',
    'type' => MENU_LOCAL_TASK,
    'context' => MENU_CONTEXT_PAGE | MENU_CONTEXT_INLINE,
  );
  
  $items['admin/config/content/orgmode'] = array(
    'title' => 'Administer Orgmode',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('orgmode_form_settings'),
    'description' => 'Options by default in new orgmode nodes',
    'access arguments' => array('administer orgmode'),
    'file' => 'orgmode.inc',
    'weight' => 10,
  );

  return $items;
}

/**
 * Implements hook_help().
 */
function orgmode_help($arg, $path = 'admin/help#orgmode') {
  switch ($path) {
    case 'admin/help#orgmode':
      $output = t('<p>The orgmode drupal module is able to import single files, such as
articles, and transform it in nodes. <a href=@url1>Orgmode</a> is a popular format for take notes, TODOs, articles, or books. Orgmode is to <a href=@url2>GNU Emacs</a>, than GNU Emacs is to the operating system.', array('@url1' => 'http://www.orgmode.org', '@url2' => 'https://www.gnu.org/software/emacs/'));
      $output .= t("<p>It doesn't need dependencies such as gnu/emacs or another drupal modules.</p>");
      $output .= t("<p>It manages urls, files and headlines.</p>");
      $output .= t("<p>Read the <a href='@url'>README.org</a> file in the Orgmode module directory.</p>", array('@url' => "/" . drupal_get_path('module', 'orgmode') .  "/README.org")) . '</p>';
      return $output;
  }
}
