<?php
function commerce_usermerge_usermerge_merge_users($user_to_delete, $user_to_keep) {
  if (module_exists('commerce_order')) {
    db_update('commerce_order')
      ->fields(array(
              'uid' => $user_to_keep->uid,
      ))
      ->condition('uid', $user_to_delete->uid, '=')
      ->execute();

    db_update('commerce_order_revision')
      ->fields(array(
              'revision_uid' => $user_to_keep->uid,
      ))
      ->condition('revision_uid', $user_to_delete->uid, '=')
      ->execute();
  }

  if (module_exists('commerce_invoice')) {
    db_update('commerce_invoice')
      ->fields(array(
              'uid' => $user_to_keep->uid,
      ))
      ->condition('uid', $user_to_delete->uid, '=')
      ->execute();
  }

  if (module_exists('commerce_addressbook')) {
    db_update('commerce_addressbook_defaults')
      ->fields(array(
              'uid' => $user_to_keep->uid,
      ))
      ->condition('uid', $user_to_delete->uid, '=')
      ->execute();
  }

  if (module_exists('commerce_customer')) {
    db_update('commerce_customer_profile')
      ->fields(array(
              'uid' => $user_to_keep->uid,
      ))
      ->condition('uid', $user_to_delete->uid, '=')
      ->execute();

    db_update('commerce_customer_profile_revision')
      ->fields(array(
              'revision_uid' => $user_to_keep->uid,
      ))
      ->condition('revision_uid', $user_to_delete->uid, '=')
      ->execute();
  }
}

