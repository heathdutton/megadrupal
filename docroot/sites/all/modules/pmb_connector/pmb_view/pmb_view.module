<?php

/**
 * @file
 * PMB main module.
 */

require_once(drupal_get_path('module', 'pmb') . '/pmb.class_data.inc');

/**
 * Implements hook_permission().
 */
function pmb_view_permission() {
  return array(
    'PMB view notice' => array(
      'title' => t('View notices'),
    ),
    'PMB view author' => array(
      'title' => t('View authors'),
    ),
    'PMB view serie' => array(
      'title' => t('View series'),
    ),
    'PMB view publisher' => array(
      'title' => t('View publishers'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function pmb_view_menu() {
  $items = array();

  // Type 'MENU_NORMAL_ITEM' and hidden 'TRUE' is preferred to (MENU_CALLBACK)
  // in order to keep activated current tab (catalog).
  $items['catalog/record/%'] = array(
    'title' => 'View record',
    'description' => 'View a record',
    'page callback' => 'pmb_view_notice',
    'page arguments' => array(2),
    'access arguments' => array('PMB view notice'),
    'file' => 'pmb_view.notice.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/external_record/%'] = array(
    'title' => 'View external record',
    'description' => 'View an external record',
    'page callback' => 'pmb_view_notice_external',
    'page arguments' => array(2),
    'access arguments' => array('PMB view notice'),
    'file' => 'pmb_view.notice.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/serial/%'] = array(
    'title' => 'View serial',
    'description' => 'View a serial',
    'page callback' => 'pmb_view_serial',
    'page arguments' => array(2),
    'access arguments' => array('PMB view notice'),
    'file' => 'pmb_view.notice.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/issue/%'] = array(
    'title' => 'View issue',
    'description' => 'View an issue',
    'page callback' => 'pmb_view_bulletin',
    'page arguments' => array(2),
    'access arguments' => array('PMB view notice'),
    'file' => 'pmb_view.notice.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/author/%'] = array(
    'title' => 'View author',
    'description' => 'View an author',
    'page callback' => 'pmb_view_author',
    'page arguments' => array(2),
    'access arguments' => array('PMB view author'),
    'file' => 'pmb_view.author.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/publisher/%'] = array(
    'title' => 'View publisher',
    'description' => 'View a publisher',
    'page callback' => 'pmb_view_publisher',
    'page arguments' => array(2),
    'access arguments' => array('PMB view publisher'),
    'file' => 'pmb_view.publisher.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/serie/%'] = array(
    'title' => 'View serie',
    'description' => 'View a serie',
    'page callback' => 'pmb_view_serie',
    'page arguments' => array(2),
    'access arguments' => array('PMB view serie'),
    'file' => 'pmb_view.serie.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );
  $items['catalog/subserie/%'] = array(
    'title' => 'View sub-serie',
    'description' => 'View a sub-serie',
    'page callback' => 'pmb_view_subserie',
    'page arguments' => array(2),
    'access arguments' => array('PMB view serie'),
    'file' => 'pmb_view.subserie.inc',
    'type' => MENU_NORMAL_ITEM,
    'hidden' => TRUE,
  );

  return $items;
}

/**
 * Implements hook_theme().
 */
function pmb_view_theme() {
  return array(
    'pmb_view_notice' => array(
      'variables' => array(
        'notice' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_notice_info' => array(
      'variables' => array(
        'notice' => NULL,
        'info' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_notice_external' => array(
      'variables' => array(
        'notice' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_serial' => array(
      'variables' => array(
        'notice' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_bulletin' => array(
      'variables' => array(
        'bulletin' => NULL,
        'serial' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_notice_display' => array(
      'variables' => array(
        'notice' => NULL,
        'display_type' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_notice_external_display' => array(
      'variables' => array(
        'notice' => NULL,
        'display_type' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_author' => array(
      'variables' => array(
        'author' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_publisher' => array(
      'variables' => array(
        'publisher' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_serie' => array(
      'variables' => array(
        'serie' => NULL,
        'parent_publisher' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
    'pmb_view_subserie' => array(
      'variables' => array(
        'subserie' => NULL,
        'parent_serie' => NULL,
        'parameters' => NULL,
      ),
      'file' => 'pmb_view.templates.inc',
    ),
  );
}

/**
 * Implements hook_form_FORM_ID_alter().
 *
 * Extends PMB admin configuration with view display settings.
 *
 * @ingroup forms
 * @see pmb_admin_form()
 * @see pmb_view_admin_form()
 */
function pmb_view_form_pmb_admin_form_alter(&$form, &$form_state) {
  require_once(drupal_get_path('module', 'pmb_view') . '/pmb_view.admin.inc');
  $form['tab'] = array_merge_recursive($form['tab'], pmb_view_admin_form());
}
