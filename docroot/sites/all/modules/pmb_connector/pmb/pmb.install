<?php

/**
 * @file
 * Install, update and uninstall functions for the PMB module.
 */

/**
 * Implements hook_install().
 */
function pmb_install() {
  drupal_set_message(filter_xss(st("PMB Connector module has been installed. You can now access your PMB/PhpMyBibli catalog through Drupal. Before that, you need to link your catalog under <a href=\"!link_settings\">Administer > Site configuration > PMB Connector</a> module settings and to set rights under <a href=\"!link_permissions\">Administer > User management > Permissions</a>.<br /> Your comments are welcomed on the !link_module module page.", array(
    '!link_settings' => url('admin/config/pmb_connector'),
    '!link_permissions' => url('admin/people/permissions', array('fragment' => 'module-pmb')),
    '!link_module' => l(st('PMB Connector'), 'http://drupal.org/project/pmb_connector'),
  ))));
}

/**
 * Implements hook_uninstall().
 *
 * @todo To be divided into sub-modules.
 */
function pmb_uninstall() {
  // Simple DB query to get the names of PMB Connector variables.
  $results = db_select('variable', 'v')
    ->fields('v', array('name'))
    ->condition('name', 'pmb_%', 'LIKE')
    ->execute();
  foreach ($results as $result) {
    variable_del($result->name);
  }

  drupal_set_message(filter_xss(st("PMB Connector: All user preferences have been removed. Thanks for using this module!<br /> Your comments are welcomed on the !link_module module page.", array(
    '!link_module' => l('PMB Connector', 'http://drupal.org/project/pmb_connector'),
  ))));
}

/**
 * Implements hook_schema().
 */
function pmb_schema() {
  $schema = array();
  $schema['cache_pmb_connector'] = drupal_get_schema_unprocessed('system', 'cache');
  $schema['cache_pmb_connector']['description'] = 'Cache data obtained with the PMB webservice.';

  return $schema;
}
