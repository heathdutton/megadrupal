Installing Commerce ePDQ
========================

Version warning
---------------
There's more than one version of the Barclaycard ePDQ gateway. Check that you're
trying to integrate the one that this module supports. It's referred to as
version 5.9 in the ePDQ CPI Integration Guide.

If you are trying to integrate the right payment gateway, the epdq.co.uk URL
given in (4) below should make sense.

See http://drupal.org/node/1790230


How to install
--------------

1. Enable the module.
2. Configure the site-wide module settings at:
   admin/commerce/config/epdq
3. Configure a Commerce payment method rule for ePDQ, at:
   admin/commerce/config/payment-methods
4. Configure the ePDQ gateway at:
   https://cpiadmin.epdq.co.uk/cgi-bin/CcxBarclaysEpdqAdminTool.e


Locations of settings
---------------------

1. Site-wide Commerce ePDQ module configuration form at:
   admin/commerce/config/epdq
2. Payment method rule configuration
   * Go to admin/commerce/config/payment-methods then click "edit" for the
     Barclays ePDQ rule, and then click "edit" for the "Enabling payment
     method..." action.
3. Barclaycard ePDQ CPI Administration Tool:
   https://cpiadmin.epdq.co.uk/cgi-bin/CcxBarclaysEpdqAdminTool.e
4. Barclaycard / "ClearCommerce" store administration:
   https://secure2.epdq.co.uk/cgi-bin/ClearCommerce_Engine/

Explanation of settings
-----------------------
The most important settings you'll need relevant to this module are in (3)
above. They are:

* Client ID, User name, and Password: You will have used these to sign in to
  the ePDQ admin screens, and you'll need to enter them again to save or change
  settings.
* Pass-phrase: This is sent by your Drupal site to the ePDQ encryption tool, as
  part of commerce_epdq_encrypt(). It's a salt. Enter a long string in plain
  text. You also have to set this as the "CPI passphrase" in settings form (2)
  above.
* Allowed URL: This is the HTTP referrer that must be sent by the customer's
  browser when the customer is redirected to the payment interface. This is a
  bit of a problem. Barclays, in their wisdom, will only allow you to set a
  single, static Allowed URL. However, Drupal Commerce likes to redirect
  customers from a dynamic URL (checkout/%commerce_order). To solve this I've
  included an unholy workaround in this module, which performs a second
  redirect. The "Allowed URL" you should set is:
  https://example.com/commerce-epdq/pay
* Continue Option 1-4: These have to do with various card security measures,
  they're up to you.
* POST Order result: Set to "Yes".
* POST URL: This should be https://example.com/commerce-epdq/response
* POST User name: Set this in (1) above. The default is epdq.
* POST Password: You have to set this in (1) above. These two settings are the
  information the ePDQ server uses to authenticate when it posts transaction
  information back to your site.
* POST Email: This is an email address where reports are sent if the ePDQ server
  encounters errors when posting to the response URL, i.e. if it gets a response
  error code or times out.
