<?php

/**
 * @file
 * Tests the integration between Bronto API and Abandon Cart.
 */

/**
 * Tests the Abandon Cart functionality for Commerce Notifications.
 */
class BrontoAPICommerceNotificationTest extends DrupalWebTestCase {

  /**
   * User interface information for this Simpletest.
   */
  public static function getInfo() {
    return array(
      'name' => 'Bronto API Commerce Notification Test',
      'description' => 'Tests Commerce Notification with Bronto.',
      'group' => 'Bronto',
    );
  }

  /**
   * Sets up the test environment for Simpletest.
   */
  public function setUp() {
    parent::setUp(array(
      'brontoapi',
        )
    );
  }

  /**
   * Tests Commerce Notifications for Abandon Cart.
   */
  public function testBrontoCommerceNotify() {
    $brontoapi_token = $conf['brontoapi_token'];
    variable_set("brontoapi_token", $brontoapi_token);
    $brontoapi_msg_id = $conf['brontoapi_msg_id'];
    variable_set("brontoapi_msg_id", $brontoapi_msg_id);
    $email = variable_get('site_mail', ini_get('sendmail_from'));
    variable_set("brontoapi_default_from", $email);
    variable_set("brontoapi_default_from_name", "Developer");

    $result = brontoapi_mail_message($email, variable_get("brontoapi_msg_id"));
    $this->assertTrue($result, "Response received");
  }

}
