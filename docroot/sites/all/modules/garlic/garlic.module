<?php

/**
 * @file
 * Adds the garlic.js library to Drupal and enable basic toggling on entities
 */

define(GARLIC_DEBUG, variable_get('garlic_debug', FALSE));

/**
 * Implements hook_libraries_info().
 */
function garlic_libraries_info() {
  // Garlic
  $libraries['garlic'] = array(
    'name' => "Garlic.js",
    'vendor url' => 'http://garlicjs.org/',
    'download url' => 'http://garlicjs.org/',
    'path' => 'garlic',
    'version arguments' => array(
      'file' => 'dist/garlic.min.js',
      'pattern' => '/(\d+\.\d+\.\d+)/',
      'lines' => 1,
    ),
    'files' => array(
      'js' => array(
        'dist/garlic.min.js'
      )
    ),
    'variants' => array(
      'minified' => array(
        'files' => array(
          'js' => array(
            'dist/garlic.min.js'
          ),
        ),
      ),
      'source' => array(
        'files' => array(
          'js' => array(
            'garlic.js'
          ),
        ),
      ),
    ),
  );
  return $libraries;
}

/**
 * Implements hook_library().
 */
function garlic_library() {
  // Garlic
  $libraries['garlic'] = array(
    'title' => 'Garlic',
    'website' => 'http://garlicjs.org',
    'version' => '1.2.0',
    'js' => array(
      libraries_get_path('garlic') . '/garlic.js' => array(),
    ),
  );
  return $libraries;
}

/**
 * Implements hook_form_alter().
 */
function garlic_form_alter(&$form, &$form_state, $form_id) {
  if (isset($form['#attributes']['data-persist']) && 'garlic' == $form['#attributes']['data-persist']) {
    $form['#attached']['library'][] = array('garlic', 'garlic');
  }
}