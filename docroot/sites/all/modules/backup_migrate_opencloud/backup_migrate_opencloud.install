<?php
/**
 * @file
 * Install hooks for the Backup and Migrate Rackspace OpenCloud module
 */

/**
 * Implementation of hook_requirements
 */
function backup_migrate_opencloud_requirements($phase) {
  $t = get_t();
  $reqs = array();

  switch ($phase) {
    case 'runtime':
      $lib_detected = libraries_detect('php-opencloud');
      $reqs['php-opencloud'] = array(
        'title' => $t('PHP SDK for OpenStack/Rackspace APIs'),
        'value' => empty($lib_detected['installed']) ? $t('Missing') : $t('Present'),
        'severity' => empty($lib_detected['installed']) ? REQUIREMENT_ERROR : REQUIREMENT_OK,
      );
      if ($reqs['php-opencloud']['severity'] != REQUIREMENT_OK) {
        $reqs['php-opencloud']['description'] = $t('PHP SDK for OpenStack/Rackspace APIs has not been installed');
      }

    case 'install':
      $reqs['php-curl'] = array(
        'title' => $t('PHP curl library'),
        'value' => !function_exists('curl_init') ? $t('Missing') : $t('Present'),
        'severity' => !function_exists('curl_init') ? REQUIREMENT_ERROR : REQUIREMENT_OK,
      );
      if ($reqs['php-curl']['severity'] != REQUIREMENT_OK) {
        $reqs['php-curl']['description'] = $t('The PHP curl library has not been installed');
      }
      break;
  }

  return $reqs;
}
