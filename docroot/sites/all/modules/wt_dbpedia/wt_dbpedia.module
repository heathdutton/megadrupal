<?php

/**
 * @file
 * Module file for DBpedia Web Taxonomy
 *
 * Use http://dbpedia.org as a web taxonomy.
 */

/**
 * Implements hook_web_taxonomy_info().
 */
function wt_dbpedia_web_taxonomy_info() {
  $info = array();
  $path = drupal_get_path('module', 'wt_dbpedia') . '/plugins';
  $info['dbpedia'] = array(
    'name' => 'DBpedia',
    'description' => t('Entries from DBpedia.'),
    'handler' => array(
      'parent' => 'WebTaxonomy',
      'class' => 'WtDbpedia',
      'file' => 'WtDbpedia.inc',
      'path' => $path,
    ),
  );
  return $info;
}

/**
 * Format web_tid as a link to the source taxonomy entry.
 *
 * Necessary to make 'rel' attribute work.
 */
function wt_dbpedia_preprocess_taxonomy_term(&$variables) {
  // For rdf mapping type 'rel', values should be urls which can
  // be safely formatted as links.
  if (isset($variables['rdf_mapping']['web_tid']) && $variables['rdf_mapping']['web_tid']['type'] == 'rel') {
    $url = $variables['web_tid'][0]['value'];
    $variables['content']['web_tid'][0]['#markup'] = l($url, $url);
  }
}
