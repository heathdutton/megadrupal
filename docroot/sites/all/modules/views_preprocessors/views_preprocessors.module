<?php

/**
 * Implementation of hook_theme_registry_alter().
 *
 * Adds support for preprocessors for each defined view.
 * A module with the name myModule can implement a preprocessor for a view
 * called 'myView' by implementing the following preprocessor
 * (note the double underscore):
 *
 * myModule_preprocess_views_view__myView(&$vars) { ... }
 *
 * @param array $theme_registry
 *   The theme registry array passed by reference.
 *
 * @return void
 */
function views_preprocessors_theme_registry_alter(&$theme_registry) {
  // get a list of modules
  $modules = module_list();

  $views = views_get_all_views();

  foreach($modules as $module) {
    foreach($views as $view_name => $view) {
      $theme_registry_key = 'views_view__' . $view_name;
      $function = $module . '_preprocess_' . $theme_registry_key;
      if (!function_exists($function)) {
        continue;
      }

      if (!isset($theme_registry[$theme_registry_key])) {
        $theme_registry[$theme_registry_key] = array();
      }

      // add in the defaults
      $theme_registry[$theme_registry_key] += $theme_registry['views_view'];

      // add the preprocessor function
      $theme_registry[$theme_registry_key]['preprocess functions'][] = $function;
    }
  }
}
