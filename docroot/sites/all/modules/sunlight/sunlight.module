<?php

/**
 * Convenience function for accessing Sunlight APIs.
 */
function sunlight($provider, $resource) {
  static $adapter, $apikey, $furrybear, $providers;
  if (!$adapter) {
    $adapter = new FurryBear\Http\Adapter\Curl();
    $apikey = variable_get('sunlight_apikey', '');
    $furrybear = new FurryBear\FurryBear();
    $output = new FurryBear\Output\Strategy\JsonToObject();
    $furrybear->registerOutput($output);
  }
  if (!isset($providers[$provider])) {
    $provider_class = "FurryBear\Provider\Source\Sunlight$provider";
    $providers[$provider] = new $provider_class($adapter, $apikey);
  }
  $furrybear->registerProvider($providers[$provider]);
  return $furrybear->$resource;
}

/**
 * Implements hook_menu().
 */
function sunlight_menu() {
  $items['admin/config/services/sunlight'] = array(
    'title' => 'Sunlight APIs',
    'description' => 'Configure Sunlight data services.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('sunlight_admin'),
    'access arguments' => array('administer site configuration'),
    'file' => 'sunlight.admin.inc',
  );
  return $items;
}

/**
 * Implements hook_xautoload($api).
 */
function sunlight_xautoload($api) {
  $api->namespaceRoot('FurryBear', 'vendor/lobostome/furry-bear/src');
}
