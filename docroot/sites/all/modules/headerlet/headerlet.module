<?php
/**
 * @file
 */

/**
 * Implements hook_boot().
 */
function headerlet_boot() {
  if ($banner = variable_get('headerlet_banner', '')) {
    $header = check_plain(variable_get('headerlet_header', 'Headerlet'));
    $lines = explode("\n", $banner);
    $digits = (int)log(count($lines), 10) + 1;
    $count = 0;

    foreach ($lines as $line) {
      $value = strip_tags($line);
      $format = "%0{$digits}d";
      $number = sprintf($format, $count);

      drupal_add_http_header('X-' . $header . '-' . $number, $value);
      $count++;
    }
  }
}

/**
 * Implements hook_permission().
 */
function headerlet_permission() {
  return array(
    'administer headerlet' => array(
      'title' => t('Administer Headerlet'),
      'description' => t('Change settings for the headerlet module.'),
      'restrict access' => TRUE,
    ),
  );
}

/**
 * Implemements hook_menu().
 */
function headerlet_menu() {
  $items['admin/config/system/headerlet'] = array(
    'title' => t('Configure Headerlet'),
    'description' => t('Change settings for the headerlet module.'),
    'access arguments' => array('administer headerlet'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('headerlet_settings_form'),
    'file' => 'headerlet.admin.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  return $items;
}
