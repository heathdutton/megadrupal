<?php

class XtoolsCoreCallableWebTestCase extends XtoolsWebTestCase {

  static function getInfo() {
    return array(
      'name' => "Drupal core callables",
      'group' => 'Xtools For Drupal Core',
    );
  }

  function setUp() {
    parent::setUp(array('xtools'));
  }

  function modules() {
    static $modules;

    if (!isset($modules)) {
      // Find all modules.
      $modules = file_scan_directory('modules', '#\.module$#', array(
        'recurse' => TRUE,
        'key' => 'name',
      ));
      // Filter out any modules whose dependencies cannot be met.
      foreach ($modules as $module) {
        $info = drupal_parse_info_file(dirname($module->uri) . '/' . $module->name . '.info');
        if (isset($info['dependencies'])) {
          foreach ($info['dependencies'] as $dependency) {
            if (!isset($modules[$dependency])) {
              unset($modules[$module->name]);
              break;
            }
          }
        }
      }
      $modules = array_keys($modules);
    }

    return $modules;
  }

  function testCoreHookReturnValue() {
    $this->XtoolsAssertCallables($this->modules(), array('drupal'));
  }
}