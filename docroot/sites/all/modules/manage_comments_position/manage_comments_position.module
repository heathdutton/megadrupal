<?php


//Running cache_clear_all() from here doesn't seem to work. Running a drush cc all does, however.
//@TODO: Figure out a way to refresh field_extra_fields when a node type newly enables comments. 

// /**
//  * Implements hook_form_FORM_ID_alter().
//  */
// function manage_comments_position_form_node_type_form_alter(&$form, &$form_state, $form_id) {
//   //hook_field_extra_fields() caches its extras, so if we change the comment default mode for a node type, we need to refresh the cache.
//   $form_state['original_comment_default_mode'] = variable_get('comment_' . $type->type, COMMENT_NODE_OPEN);
//   $form['#submit'][] = '_manage_comments_position_form_node_type_form_submit';
// }
// 
// function _manage_comments_position_form_node_type_form_submit(&$form, &$form_state) {
//   if ($form_state['values']['comment_default_mode'] != $form_state['original_comment_default_mode']) {
//     cache_clear_all();
//   }
// }


/**
 * Implements hook_field_extra_fields().
 */
function manage_comments_position_field_extra_fields() {
  $extra = array();
  
  foreach (node_type_get_types() as $type) {
    $extra['node'][$type->type] = array(
      'display' => array(
        'comments' => array(
          'label' => t('Comments'),
          'description' => t('Comments and Comment Form'),
          'weight' => 0,
        ),
      )
    );
  }
  
  return $extra;
}

