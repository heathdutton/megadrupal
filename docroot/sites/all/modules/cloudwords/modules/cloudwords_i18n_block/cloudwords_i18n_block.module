<?php

/**
 * @file
 * Integrates Cloudwords with i18n_block.module.
 */

/**
 * Implements hook_cloudwords_translatable_info().
 */
function cloudwords_i18n_block_cloudwords_translatable_info() {
  return array(
    'block' => array(
      'controller class' => 'CloudwordsI18nBlockSource',
    ),
  );
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function cloudwords_i18n_block_form_block_add_block_form_alter(&$form, &$form_state) {
  cloudwords_i18n_block_form_block_admin_configure_alter($form, $form_state);
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function cloudwords_i18n_block_form_block_admin_configure_alter(&$form, &$form_state) {
  $form['#submit'][] = 'cloudwords_i18n_block_form_block_admin_configure_submit';
}

/**
 * Form submit handler for block configuration form.
 */
function cloudwords_i18n_block_form_block_admin_configure_submit(&$form, &$form_state) {

  $type = $form_state['values']['module'];
  $objectid = $form_state['values']['delta'];
  $label = $form_state['values']['info'];

  if (!empty($form_state['values']['i18n_mode']) && $form_state['values']['i18n_mode'] == 1) {
    cloudwords_i18n_ensure_translatables('blocks', $type, $objectid, $label);
  }

  // This block is not translatable. Delete any existing translatables.
  else {
    cloudwords_translatable_delete_by_property(array(
      'textgroup' => 'blocks',
      'type' => $type,
      'objectid' => $objectid,
    ));
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function cloudwords_i18n_block_form_block_custom_block_delete_alter(&$form, &$form_state) {
  $form['#submit'][] = 'cloudwords_i18n_block_form_block_custom_block_delete_submit';
}

/**
 * Form submit handler for custom block delete form.
 */
function cloudwords_i18n_block_form_block_custom_block_delete_submit($form, &$form_state) {
  cloudwords_translatable_delete_by_property(array(
    'textgroup' => 'blocks',
    'type' => 'block',
    'objectid' => $form_state['values']['bid'],
  ));
}

/**
 * Implements hook_cloudwords_refresh_translatables().
 */
function cloudwords_i18n_block_cloudwords_refresh_translatables(&$context) {
  cloudwords_i18n_refresh_strings('blocks', 'block');
}
