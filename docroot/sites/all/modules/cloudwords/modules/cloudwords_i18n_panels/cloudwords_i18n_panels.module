<?php

/**
 * @file
 * Integrates Cloudwords with i18n_panels.module.
 */


/**
 * Implements hook_cloudwords_translatable_info().
 */
function cloudwords_i18n_panels_cloudwords_translatable_info() {
  return array(
    'pane_configuration' => array(
      'controller class' => 'CloudwordsI18nPanelsSource',
    ),
  );
}

/**
 * Implements hook_panels_pane_insert().
 */
function cloudwords_i18n_panels_panels_pane_insert($pane) {
  if($pane->type == 'custom'){
    cloudwords_i18n_panels_panels_pane_update($pane);
  }
}
/**
 * Implements hook_panels_pane_insert().
 */
function cloudwords_i18n_panels_panels_pane_update($pane) {

  if($pane->type == 'custom'){
    if(strlen($pane->configuration['admin_title']) > 0) {
      $title = $pane->configuration['admin_title'];
    }elseif(strlen($pane->configuration['title']) > 0){
      $title = $pane->configuration['title'];      
    }else{
      $title = substr(strip_tags($pane->configuration['body']), 0, 60);       
    }
    cloudwords_i18n_ensure_translatables('panels', 'pane_configuration', $pane->uuid, $title);
    /*
    $translatable_type = 'panel_pane_custom';
    $objectid = $pane->pid;
    //$pane_entity =   entity_load_single('panels_pane', $pane->pid);
    dsm($pane);
    
    $translatables = cloudwords_get_translatables_by_property(array(
      'textgroup' => $pane->type,
      'type' => $translatable_type,
      'objectid' => $objectid,
    ), 'language');

    foreach (cloudwords_language_list() as $langcode => $language) {
      if(!isset($translatables[$langcode]) && language_default()->language != $langcode){    
        $translatables[$langcode] = cloudwords_translatable_create(array(
          'textgroup' => $pane->type,
          'type' => $translatable_type,
          'objectid' => $objectid,
          'language' => $langcode,
          'label' => $pane->configuration['title'],
          'status' => CLOUDWORDS_QUEUE_NOT_IN_QUEUE,
        ));
      }
    }
    
    foreach ($translatables as $translatable) {
      //$translatable->status = $queue_status;
      $translatable->save();
    }    
     * */         
  }


  
  
}

/**
 * Implements hook_cloudwords_refresh_translatables().
 */
function cloudwords_i18n_panels_cloudwords_refresh_translatables(&$context) {
  cloudwords_i18n_refresh_strings('panels', 'pane_configuration');
}
