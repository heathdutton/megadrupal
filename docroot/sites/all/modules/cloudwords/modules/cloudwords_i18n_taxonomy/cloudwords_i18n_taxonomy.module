<?php

/**
 * @file
 * Integrates Cloudwords with i18n_taxonomy.module.
 */

/**
 * Implements hook_cloudwords_translatable_info().
 */
function cloudwords_i18n_taxonomy_cloudwords_translatable_info() {
  return array(
    'taxonomy_term' => array(
      'controller class' => 'CloudwordsI18nStringSource',
    ),
    'taxonomy_vocabulary' => array(
      'controller class' => 'CloudwordsI18nStringSource',
    ),
  );
}

/**
 * Implements hook_taxonomy_vocabulary_insert().
 */
function cloudwords_i18n_taxonomy_taxonomy_vocabulary_insert($vocabulary) {
  cloudwords_i18n_taxonomy_taxonomy_vocabulary_update($vocabulary);
}

/**
 * Implements hook_taxonomy_vocabulary_update().
 */
function cloudwords_i18n_taxonomy_taxonomy_vocabulary_update($vocabulary) {
  cloudwords_i18n_ensure_translatables('taxonomy', 'taxonomy_vocabulary', $vocabulary->vid, $vocabulary->name);
}

/**
 * Implements hook_taxonomy_vocabulary_delete().
 */
function cloudwords_i18n_taxonomy_taxonomy_vocabulary_delete($vocabulary) {
  cloudwords_translatable_delete_by_property(array(
    'textgroup' => 'taxonomy',
    'type' => 'taxonomy_vocabulary',
    'objectid' => $vocabulary->vid,
  ));
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function cloudwords_i18n_taxonomy_form_taxonomy_form_vocabulary_alter(&$form, &$form_state) {
  if (!empty($form_state['vocabulary']->vid) && empty($form_state['triggering_element'])) {
    $args = array(
      'textgroup' => 'taxonomy',
      'type' => 'taxonomy_vocabulary',
      'objectid' => $form_state['vocabulary']->vid,
    );
    cloudwords_outdated_form($form, $form_state, $args);
  }
}

/**
 * Implements hook_taxonomy_term_insert().
 */
function cloudwords_i18n_taxonomy_taxonomy_term_insert($term) {
  cloudwords_i18n_taxonomy_taxonomy_term_update($term);
}

/**
 * Implements hook_taxonomy_term_update().
 */
function cloudwords_i18n_taxonomy_taxonomy_term_update($term) {
  $vocabulary = taxonomy_vocabulary_load($term->vid);
  if ($vocabulary->i18n_mode == 1) {
    cloudwords_i18n_ensure_translatables('taxonomy', 'taxonomy_term', $term->tid, $term->name);
  }
}

/**
 * Implements hook_taxonomy_term_delete().
 */
function cloudwords_i18n_taxonomy_taxonomy_term_delete($term) {
  cloudwords_translatable_delete_by_property(array(
    'textgroup' => 'taxonomy',
    'type' => 'taxonomy_term',
    'objectid' => $term->tid,
  ));
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function cloudwords_i18n_taxonomy_form_taxonomy_form_term_alter(&$form, &$form_state) {
  if (!empty($form_state['term']->tid) && empty($form_state['triggering_element'])) {
    $args = array(
      'textgroup' => 'taxonomy',
      'type' => 'taxonomy_term',
      'objectid' => $form_state['term']->tid,
    );
    cloudwords_outdated_form($form, $form_state, $args);
  }
}

/**
 * Implements hook_cloudwords_refresh_translatables().
 */
function cloudwords_i18n_taxonomy_cloudwords_refresh_translatables(&$context) {
  cloudwords_i18n_refresh_strings('taxonomy', 'term', 'taxonomy_term');
  cloudwords_i18n_refresh_strings('taxonomy', 'vocabulary', 'taxonomy_vocabulary');
}
