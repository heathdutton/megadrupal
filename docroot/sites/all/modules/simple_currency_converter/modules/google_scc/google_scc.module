<?php

/**
 * @file
 * Extends the simple currency converter module.
 */

/**
 * Implements hook_simple_currency_converter_feed().
 */
function google_scc_simple_currency_converter_feed($feeds) {
  $feeds['google_scc'] = 'Google Finance Converter';
  return $feeds;
}

/**
 * Calculate the conversion rate.
 */
function google_scc_simple_currency_converter_request_feed($from_currency, $to_currency, $amount) {
  $from_currency = urlencode($from_currency);
  $to_currency = urlencode($to_currency);
  $amount = urlencode($amount);

  $url = "http://www.google.com/finance/converter?a=$amount&from=$from_currency&to=$to_currency";

  $data = drupal_http_request($url);
  $rawdata = $data->data;
  if (!$data || !strpos($rawdata, $to_currency)) {
    return NULL;
  }
  $data = explode('bld>', $rawdata);
  $data = explode($to_currency, $data[1]);

  $amount = trim($data[0]);
  $amount = round($amount, 5);

  return $amount;
}

/**
 * Available currency.
 */
function google_scc_return_codes() {
  return array(
    'AED',
    'AFN',
    'ANG',
    'AOA',
    'ARS',
    'AUD',
    'AWG',
    'AZN',
    'BAM',
    'BBD',
    'BDT',
    'BGN',
    'BHD',
    'BIF',
    'BMD',
    'BND',
    'BOB',
    'BRL',
    'BSD',
    'BTN',
    'BWP',
    'BYR',
    'BZD',
    'CAD',
    'CDF',
    'CHF',
    'CLP',
    'CNY',
    'COP',
    'CRC',
    'CUP',
    'CVE',
    'CZK',
    'DJF',
    'DKK',
    'DOP',
    'DZD',
    'EGP',
    'ERN',
    'ETB',
    'EUR',
    'FJD',
    'FKP',
    'GBP',
    'GHS',
    'GIP',
    'GMD',
    'GNF',
    'GTQ',
    'GYD',
    'HKD',
    'HNL',
    'HRK',
    'HTG',
    'HUF',
    'IDR',
    'ILS',
    'INR',
    'IRR',
    'ISK',
    'JMD',
    'JOD',
    'JPY',
    'KES',
    'KGS',
    'KMF',
    'KRW',
    'KWD',
    'KYD',
    'KZT',
    'LAK',
    'LBP',
    'LKR',
    'LRD',
    'LSL',
    'LTL',
    'LVL',
    'LYD',
    'MAD',
    'MDL',
    'MKD',
    'MMK',
    'MNT',
    'MOP',
    'MRO',
    'MUR',
    'MXN',
    'MYR',
    'MZN',
    'NAD',
    'NGN',
    'NIO',
    'NOK',
    'NPR',
    'NZD',
    'PAB',
    'PEN',
    'PGK',
    'PHP',
    'PKR',
    'PLN',
    'PYG',
    'QAR',
    'RON',
    'RSD',
    'RUB',
    'SAR',
    'SBD',
    'SCR',
    'SEK',
    'SGD',
    'SHP',
    'SLL',
    'SOS',
    'SRD',
    'STD',
    'SYP',
    'SZL',
    'THB',
    'TND',
    'TOP',
    'TRY',
    'TTD',
    'TWD',
    'TZS',
    'UAH',
    'UGX',
    'USD',
    'UYU',
    'VEF',
    'VND',
    'VUV',
    'WST',
    'XAF',
    'XCD',
    'XOF',
    'XPF',
    'YER',
    'ZAR',
    'ZMK',
  );
}
