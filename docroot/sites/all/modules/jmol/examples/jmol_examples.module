<?php

/**
 * @file
 * This file contains example code to programatically create mutiple
 * pages with one or more Jmol applets.
 * This whole example create three new pages with Jmol applets.
 */

/**
 * Implements hook_libraries_info().
 */
function jmol_examples_libraries_info() {
  $libraries['jmol'] = array(
    'name' => 'Jmol library',
    'vendor url' => 'http://http://jmol.sourceforge.net',
    'download url' => 'http://sourceforge.net/projects/jmol/files/latest/download?source=files',
    'version arguments' => array(
      'file' => 'CHANGES.txt',
      'pattern' => '@___version=([0-9\.]+)@',
      'lines' => 50,
      'cols' => 20,
    ),
  );
  return $libraries;
}

/**
 * Implements hook_menu().
 *
 * Menu callback entry for three Jmol pages, this creates landing URLs to view
 * the Jmol applet at e.g. @link http://example.com/jmol1 @endlink.
 */
function jmol_examples_menu() {
  $items['jmol1'] = array(
    'title'           => 'Jmol structure view',
    'page callback'   => 'jmol_examples_firstpage',
    'access callback' => TRUE,
    'type'            => MENU_CALLBACK,
  );
  $items['jmol2'] = array(
    'title'           => 'Jmol structure view',
    'page callback'   => 'jmol_examples_secondpage',
    'access callback' => TRUE,
    'type'            => MENU_CALLBACK,
  );
  $items['jmol3'] = array(
    'title'           => 'Jmol structure view',
    'page callback'   => 'jmol_examples_thirdpage',
    'access callback' => TRUE,
    'type'            => MENU_CALLBACK,
  );
  return $items;
}

/**
 * Page callback.
 *
 * Page callback for a basic Jmol page, this tells Drupal what to display on
 * the landing page.
 * This function generates data on @link http://example.com/jmol1 @endlink.
 */
function jmol_examples_firstpage() {
  global $base_url;
  // Get the Jmol javascript library path.
  $jmoldir = libraries_get_path('jmol');
  drupal_add_js($jmoldir . '/Jmol.js');
  $jmolpath = $base_url . '/' . $jmoldir;
  // First applet contains helix.pdb located in /files subfolder of
  // the Jmol module folder.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/helix.pdb";
  $initcommand = 'wireframe ONLY;';
  $output  = '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= '</script>';
  // Second applet contains 1crn.pdb.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/1crn.pdb";
  $initcommand = 'wireframe ONLY;';
  $output .= '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= '</script>';
  return $output;
}

/**
 * Page callback.
 *
 * This function generates data on @link http://example.com/jmol2 @endlink.
 * Additionally this function adds CSS style to display the
 * Jmol radiobuttons inline.
 */
function jmol_examples_secondpage() {
  global $base_url;

  // The following code is css style code for displaying
  // jmolRadioGroup buttons inline instead of on top of each other.
  $css = '';
  // Number of applets on this page.
  $napplets = 2;
  // Number of radiobuttons per applet (considering same amount
  // of buttons in all applets).
  $nbuttons = 3;
  for ($i = 0; $i < $napplets; $i++) {
    for ($j = 0; $j < $nbuttons; $j++) {
      $css .= 'label[for=jmolRadioGroup' . $i . '_' . $j . '] {display:inline}';
    }
  }
  drupal_add_css($data = $css, $type = 'inline');

  // Get the Jmol javascript library path.
  $jmoldir = libraries_get_path('jmol');
  drupal_add_js($jmoldir . '/Jmol.js');
  $jmolpath = $base_url . '/' . $jmoldir;
  // First applet contains 1crn.pdb.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/1crn.pdb";
  $initcommand = 'wireframe ONLY;';
  $output  = '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= 'jmolBr();';
  $output .= 'jmolBr();';
  $output .= '</script>';
  // Second applet contains helix.pdb.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/helix.pdb";
  $initcommand = 'wireframe ONLY;';
  $output .= '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= '</script>';
  return $output;
}

/**
 * Page callback.
 *
 * This function generates data on @link http://example.com/jmol3 @endlink.
 */
function jmol_examples_thirdpage() {
  global $base_url;
  // Get the Jmol javascript library path.
  $jmoldir = libraries_get_path('jmol');
  drupal_add_js($jmoldir . '/Jmol.js');
  $jmolpath = $base_url . '/' . $jmoldir;
  // First applet contains 1crn.pdb.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/1crn.pdb";
  $initcommand = 'wireframe ONLY;';
  $output  = '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= '</script>';
  // Second applet contains helix.pdb.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/helix.pdb";
  $initcommand = 'wireframe ONLY;';
  $output .= '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= '</script>';
  // Third applet contains 1crn.pdb.
  $pdbpath = $base_url . '/' . drupal_get_path("module", "jmol") . "/files" . "/1crn.pdb";
  $initcommand = 'wireframe ONLY;';
  $output .= '<script type="text/javascript">';
  $output .= 'jmolInitialize("' . $jmolpath . '");';
  $output .= 'jmolApplet(400, "load ' . $pdbpath . ';' . $initcommand . '");';
  $output .= 'jmolBr();';
  $output .= 'jmolHtml("Style ");';
  $output .= 'jmolRadioGroup([["' . $initcommand . '", "Wireframe","checked"],["wireframe ONLY;wireframe 0.5;", "Sticks"],["spacefill ONLY", "Balls"]]);';
  $output .= '</script>';
  return $output;
}
