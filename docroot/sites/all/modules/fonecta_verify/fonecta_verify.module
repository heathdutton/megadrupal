<?php

/**
 * Implements hook_help().
 */
function fonecta_verify_help($path, $arg) {
  switch ($path) {
    case 'admin/help#fonecta_verify':
      return t('The module provides functionality to fetch company information from the finnish Fonecta database. To use the module, you must first obtain the necessary credentials from Fonecta. After configuring the module settings, the functionality of the module will be available at /company_search.');

    case 'admin/config/fonecta_verify':
      return t('<p>This page provides access to the Fonecta modules settings. Please make sure that you know what you are doing as any changes beyond the defaults might cause serious malfunctionality!</p>');
  }
}

/**
 * Implements hook_permission().
 */
function fonecta_verify_permission() {
  return array(
    'administer fonecta verify' => array(
      'title' => t('Administer Fonecta verify'),
    ),
    'use fonecta verify' => array(
      'title' => t('Use Fonecta verify'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function fonecta_verify_menu() {

  $items = array();

  $items['company_search'] = array(
    'title' => t('Add a new company - verify the company name'),
    'page callback' => 'fonecta_verify_page',
    'file' => 'includes/fonecta_verify_page.inc',
    'access arguments' => array('use fonecta verify'),
    'expanded' => TRUE,
  );

  $items['company_search/verify'] = array(
    'title' => t('Add a new company - choose your company'),
    'page callback' => 'fonecta_verify_page',
    'access arguments' => array('use fonecta verify'),
    'file' => 'includes/fonecta_verify_page.inc',
    'expanded' => TRUE,
  );

  $items['admin/config/fonecta_verify'] = array(
    'title' => 'Fonecta verify',
    'description' => 'Control Fonecta verify module settings.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('fonecta_verify_admin_settings'),
    'access arguments' => array('administer fonecta verify'),
  );

  return $items;
}

/**
 * Form builder; Configure user settings for this site.
 *
 * @ingroup forms
 * @see system_settings_form()
 */
function fonecta_verify_admin_settings($form) {

  $form['name_search'] = array(
    '#type' => 'fieldset',
    '#title' => t('Name search'),
    '#description' => t('The details of your service type as provided by Fonecta. Please do not touch these unless you are sure of what you are doing!'),
    '#collapsible' => TRUE,
    '#collapsed' => TRUE,
    '#weight' => 1,
  );

  $form['connection'] = array(
    '#type' => 'fieldset',
    '#title' => t('Connection settings'),
    '#description' => t('The details of your connection settings as provided by Fonecta.'),
    '#collapsible' => TRUE,
    '#collapsed' => FALSE,
    '#weight' => 0,
  );

  $form['name_search']['fonecta_service_name_id'] = array(
    '#type' => 'textfield',
    '#title' => t('Service name ID'),
    '#default_value' => variable_get('fonecta_service_name_id', 'SN001'),
    '#description' => t('The service name ID provided by Fonecta'),
    '#required' => TRUE,
  );

  $form['name_search']['fonecta_service_category_id'] = array(
    '#type' => 'textfield',
    '#title' => t('Service category ID'),
    '#default_value' => variable_get('fonecta_service_category_id', 'DIS'),
    '#description' => t('The service category ID provided by Fonecta'),
    '#required' => TRUE,
  );

  $form['name_search']['fonecta_service_class_id'] = array(
    '#type' => 'textfield',
    '#title' => t('Service class ID'),
    '#default_value' => variable_get('fonecta_service_class_id', 'SC001'),
    '#description' => t('The service class ID provided by Fonecta'),
    '#required' => TRUE,
  );

  $form['name_search']['fonecta_origin_country'] = array(
    '#type' => 'textfield',
    '#title' => t('Origin country'),
    '#default_value' => variable_get('fonecta_origin_country', 'FIN'),
    '#description' => t('The origin country where you are connecting from, for example "FIN".'),
    '#required' => TRUE,
  );

  $form['name_search']['fonecta_customer_type'] = array(
    '#type' => 'textfield',
    '#title' => t('Customer type'),
    '#default_value' => variable_get('fonecta_customer_type', 'B'),
    '#description' => t('Your Fonecta customer type'),
    '#required' => TRUE,
  );

  $form['connection']['fonecta_username'] = array(
    '#type' => 'textfield',
    '#title' => t('Username'),
    '#default_value' => variable_get('fonecta_username', ''),
    '#required' => TRUE,
  );

  $form['connection']['fonecta_password'] = array(
    '#type' => 'password',
    '#title' => t('Password'),
    '#default_value' => variable_get('fonecta_password', ''),
    '#required' => TRUE,
  );

  $form['connection']['fonecta_base_url'] = array(
    '#type' => 'textfield',
    '#title' => t('Service base URL'),
    '#default_value' => variable_get('fonecta_base_url', 'http://idea.fonecta.com:2030/Core3_0/Find'),
    '#required' => TRUE,
  );

  return system_settings_form($form);
}

/**
 * Implements hook_theme().
 */
function fonecta_verify_theme() {
  
  $path = drupal_get_path('module', 'fonecta_verify');
  
  $theme['main_page'] = array(
    'variables' => array('content' => NULL, 'form' => NULL),
    'template' => 'fonecta_verify',
    'path' => $path,
  );

  return $theme;
}
