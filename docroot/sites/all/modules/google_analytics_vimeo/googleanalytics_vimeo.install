<?php
/**
 * @file
 * Google Analytics Vimeo Install file.
 */

/**
 * Implements hook_requirements().
 */
function googleanalytics_vimeo_requirements($phase) {
  $requirements = array();

  if ($phase == 'runtime') {
    $t = get_t();
    $library = libraries_detect('vimeo.ga.js');
    $error_message = isset($library['error message']) ? $library['error message'] : '';

    if (empty($library['installed'])) {
      $requirements['vimeo_ga_js'] = array(
        'title' => $t('Google Analytics Vimeo Video Tracking Library'),
        'value' => $t('Not installed'),
        'severity' => REQUIREMENT_ERROR,
        'description' => $t('!error You need to download the !vimeo.ga.js, extract the archive and place the vimeo.ga.js directory in the %path directory on your server.', array(
            '!error' => $error_message,
            '!vimeo.ga.js' => l($t('Google Analytics Vimeo Video Tracking Library'), $library['download url']),
            '%path' => libraries_get_path('vimeo.ga.js'),
          )
        ),
      );
    }
    else {
      $requirements['vimeo_ga_js'] = array(
        'title' => $t('Google Analytics Vimeo Video Tracking Library'),
        'severity' => REQUIREMENT_OK,
        'value' => $t('Installed'),
      );
    }
  }

  return $requirements;
}

/**
 * Implements hook_install().
 */
function googleanalytics_vimeo_install() {
  $library = libraries_detect('vimeo.ga.js');
  if (isset($library['error message'])) {
    drupal_set_message($library['error message'], 'error');
  }
}

/**
 * Implements hook_uninstall().
 */
function googleanalytics_vimeo_uninstall() {
  variable_del('googleanalytics_vimeo_progress25');
  variable_del('googleanalytics_vimeo_progress50');
  variable_del('googleanalytics_vimeo_progress75');
  variable_del('googleanalytics_vimeo_videoPlayed');
  variable_del('googleanalytics_vimeo_videoPaused');
  variable_del('googleanalytics_vimeo_videoResumed');
  variable_del('googleanalytics_vimeo_videoSeeking');
  variable_del('googleanalytics_vimeo_videoCompleted');
  variable_del('googleanalytics_vimeo_visibility_options');
  variable_del('googleanalytics_vimeo_visibility_pages');
}
