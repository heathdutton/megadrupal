<?php

/**
 * Implements hook_enable().
 */
function enhanced_imagelist_enable() {
  // New module weights in core: put enhanced_imagelist as higher than imagecacheflush, so it will be the final override.
  if (module_exists('imagestyleflush')) {
    watchdog('enhanced_imagelist', 'imagestyleflush found');
      // get the weight of imagecacheflush
    $query = db_select('system', 's')
      ->condition('type', 'module')
      ->condition('name', 'imagestyleflush');
    $query->addField('s', 'weight', 'weight');
    $result = $query->execute();
    $imagestyleflush_weight = $result->fetchField();
    // save weight for uninstall
    variable_set('enhanced_imagelist_imagestyleflush_weight', $imagestyleflush_weight);

    // set enhanced_imagelist to a higher weight
    watchdog('enhanced_imagelist', 'setting weight to ' . ($imagestyleflush_weight + 1));
    db_update('system')
      ->fields(array(
        'weight' => ($imagestyleflush_weight + 1),
      ))
      ->condition('type', 'module')
      ->condition('name', 'enhanced_imagelist')
      ->execute();
  }
  else {
    watchdog('enhanced_imagelist', 'imagestyleflush not found');
  }
}


/**
 * Implements hook_uninstall().
 */
function enhanced_imagelist_uninstall() {
  db_query("DELETE FROM {variable} WHERE name LIKE 'enhanced_imagelist_%'");
  cache_clear_all('variables', 'cache');
}

