<?php

/**
 * @file
 * Integrates with Po.st social sharing service.
 */

/**
 * Implements hook_permission().
 */
function post_permission() {
  return array(
    'administer post settings' => array(
      'title' => t('Administer Post Settings'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function post_menu() {
  $items['admin/config/content/post'] = array(
    'title' => 'Po.st Settings',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('post_settings'),
    'access arguments' => array('administer post settings'),
    'file' => 'post.admin.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  return $items;
}

/**
 * Implements hook_theme().
 */
function post_theme() {
  return array(
    'post_button' => array(
      'variables' => array('settings' => NULL),
      'file' => 'post.theme.inc',
      'template' => 'post_button',
    ),
  );
}

/**
 * Implements hook_node_view().
 *
 * Adds Po.st sharing widget to node.
 */
function post_node_view($node, $view_mode, $langcode) {
  $settings = variable_get('post_settings', array('content_types' => array()));

  if ($view_mode == 'full' && in_array($node->type, $settings['content_types'])) {
    // Check to make sure one of the widget styles is enabled.
    if (isset($settings['post']) || isset($settings['buttons']) || isset($settings['expanded']) || isset($settings['vertical'])) {
      $node->content['post_button'] = array(
        '#theme' => 'post_button',
        '#settings' => $settings,
        '#weight' => isset($settings['weight']) ? check_plain($settings['weight']) : '-1',
      );
    }
  }
}
