<?php

/**
 * @file
 * Installation, requirements and uninstallation functions for the JSONP
 * SPARQL module.
 */

/**
 * Implements hook_uninstall().
 */
function jsonp_sparql_uninstall() {
  // Remove all jsonp_sparql variables from database.
  db_query("DELETE FROM {variable} WHERE name LIKE 'jsonp_sparql_%'");
  cache_clear_all('variables', 'cache');
}

/**
 * Implements hook_requirements().
 */
function jsonp_sparql_requirements($phase) {
  $requirements = array();

  if ($phase == 'runtime') {
    $t = get_t();

    $path = libraries_get_path('jquery.jsonp');
    if (file_exists($path . '/jquery-jsonp.min.js') || file_exists($path . '/jquery-jsonp.js')) {
      $requirements['jsonp_sparql_jsonp_plugin'] = array(
        'title'     => $t('JQuery JSONP plugin'),
        'severity'  => REQUIREMENT_OK,
        'value'     => $t('Installed'),
      );
    }
    else {
      $requirements['jsonp_sparql_jsonp_plugin'] = array(
        'title'       => $t('JQuery JSONP plugin'),
        'value'       => $t('Not found'),
        'severity'    => REQUIREMENT_ERROR,
        'description' => $t('You need to download the !name and move the downloaded js file into the %path folder of your server. Remember to rename the to exclude the version number (i.e jquery-jsonp.min.js instead of jquery-jsonp-2.2.1.min.js)', array(
          '!name' => l($t('JQuery JSONP plugin'), 'http://code.google.com/p/jquery-jsonp/downloads/list'),
          '%path' => $path)
        ),
      );
    }
  }
  return $requirements;
}
