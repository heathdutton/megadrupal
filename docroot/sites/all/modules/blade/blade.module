<?php
/**
 * @file
 * Extend drupal template with Laravel Blade template.
 */


/**
 * Implements phptemplate_render_template().
 */
function phptemplate_render_template($template_file, $variables) {
  if (!class_exists("\\Philo\\Blade\\Blade")) {
    drupal_set_message("You must install package Laravel-Blade at https://github.com/PhiloNL/Laravel-Blade", 'error');
    return theme_render_template($template_file, $variables);
  }
  else {
    return blade_render_template($template_file, $variables);
  }
}

/**
 * Render template with variables.
 * @param  string $template_file Template file path.
 * @param  array $variables      Template variables.
 * @return string                Rendered template
 */
function blade_render_template($template_file, $variables){
    $public_path   = variable_get('file_public_path', conf_path() . '/files');
    $cache         = drupal_realpath($public_path . "/blade");
    $template_info = pathinfo($template_file);
    $blade         = new Philo\Blade\Blade($template_info['dirname'], $cache);
    $blade->view()->addExtension('tpl.php', 'blade');

    ob_start();
    print $blade->view()->make(str_replace('.tpl', '', $template_info['filename']), $variables);

    return ob_get_clean();
}
