<?php

/**
 * @file
 * Install, update and uninstall functions for the clientcert module.
 */

/**
 * Implements hook_uninstall().
 */
function clientcert_uninstall() {
  variable_del('clientcert_debug');
}

/**
 * Implements hook_schema().
 */
function clientcert_schema() {
  $schema = array();

  $schema['clientcert'] = array(
    'description' => 'The base table for clientcert items.',
    'fields' => array(
      'ccid' => array(
        'description' => 'The primary identifier for an clientcert item.',
        'type' => 'serial',
        'unsigned' => TRUE,
        'not null' => TRUE,
      ),
      'created' => array(
        'description' => 'Unix timestamp when the clientcert item was created.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'changed' => array(
        'description' => 'Unix timestamp when the clientcert item was most recently saved.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'title' => array(
        'description' => 'The title for a clientcert item.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'uid' => array(
        'description' => 'The.user ID where the clientcert item belongs to.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'cert' => array(
        'description' => 'PEM-encoded client certificate.',
        'type' => 'text',
        'size' => 'normal',
        'not null' => TRUE,
      ),
      'cert_hash' => array(
        'description' => 'Calculated hash of client certificate.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
        'default' => '',
      ),
      'verify' => array(
        'description' => 'Servers verify report.',
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
      ),
      'serial' => array(
        'description' => "Serial of the client's certificate.",
        'type' => 'varchar',
        'length' => 255,
        'not null' => TRUE,
      ),
      'dn_subject' => array(
        'description' => "Subject DN in client's certificate",
        'type' => 'text',
        'size' => 'tiny',
        'not null' => TRUE,
      ),
      'dn_issuer' => array(
        'description' => "Issuer DN of client's certificate.",
        'type' => 'text',
        'size' => 'tiny',
        'not null' => TRUE,
      ),
      'validity_start' => array(
        'description' => "Unix timestamp: Validity of client's certificate (start time).",
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'validity_end' => array(
        'description' => "Unix timestamp: Validity of client's certificate (end time).",
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'status' => array(
        'description' => 'Boolean indicating whether the clientcert item is active.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'status_login' => array(
        'description' => 'Boolean indicating whether the clientcert item can be used for login.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 1,
      ),
      'status_encrypt' => array(
        'description' => 'Boolean indicating whether the clientcert item can be used for encryption.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'status_public' => array(
        'description' => 'Boolean indicating whether the client certificate can be presented to others.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
    ),
    'primary key' => array('ccid'),
  );

  return $schema;
}
