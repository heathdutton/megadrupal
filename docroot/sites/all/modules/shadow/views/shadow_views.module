<?php

/**
 * Implements of hook_views_pre_execute().
 */
function shadow_views_views_pre_execute(&$view) {
  $guid = $view->name . ':' . $view->current_display;
  $description = t('Views query');
  
  $original = (string) $view->build_info['query'];
  
  shadow($view->build_info['query'], $guid, $description);
  
  $new = (string) $view->build_info['query'];
  
  if ($new != $original) {
    $view->build_info['count_query'] = $view->build_info['query']->countQuery();
  }
}
