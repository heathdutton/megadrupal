<?php

/**
 * Implements hook_help().
 */
function prh_search_help($path, $arg) {
  switch ($path) {
    case 'admin/help#prh_search':
      return t('The module provides functionality to fetch company information from the finnish Fonecta database. To use the module, you must first obtain the necessary credentials from Fonecta. After configuring the module settings, the functionality of the module will be available at /company_search.');

    case 'admin/config/prh_search':
      return t('<p>This page provides access to the Fonecta modules settings. Please make sure that you know what you are doing as any changes beyond the defaults might cause serious malfunctionality!</p>');
  }
}

/**
 * Implements hook_permission().
 */
function prh_search_permission() {
  return array(
    'administer prh search' => array(
      'title' => t('Administer PRH search'),
    ),
    'use prh search' => array(
      'title' => t('Use PRH search'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function prh_search_menu() {

  $items = array();

  $items['association_search'] = array(
    'title' => t('Add a new Association - verify the association name'),
    'page callback' => 'prh_search_page',
    'file' => 'includes/prh_search_page.inc',
    'access arguments' => array('use prh search'),
    'expanded' => TRUE,
  );

  $items['admin/config/prh_search'] = array(
    'title' => 'PRH search',
    'description' => 'Control PRH search module settings.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('prh_search_admin_settings'),
    'access arguments' => array('administer prh search'),
  );

  return $items;
}

/**
 * Form builder; Configure user settings for this site.
 *
 * @ingroup forms
 * @see system_settings_form()
 */
function prh_search_admin_settings($form) {

  $form['prh_association_search_url'] = array(
    '#type' => 'textfield',
    '#title' => t('Association search URL'),
    '#default_value' => variable_get('prh_association_search_url', 'https://yhdistysrekisteri.prh.fi/kysely/nimikysely.htx'),
    '#description' => t('The service category ID provided by PRH'),
    '#required' => TRUE,
  );

  $form['prh_username'] = array(
    '#type' => 'textfield',
    '#title' => t('Username'),
    '#default_value' => variable_get('prh_username', ''),
    '#required' => TRUE,
  );

  $form['prh_password'] = array(
    '#type' => 'password',
    '#title' => t('Password'),
    '#default_value' => variable_get('prh_password', ''),
    '#required' => TRUE,
  );

  return system_settings_form($form);
}

/**
 * Implements hook_theme().
 */
function prh_search_theme() {

  $path = drupal_get_path('module', 'prh_search');

  $theme['main_page'] = array(
    'variables' => array('content' => NULL, 'form' => NULL),
    'template' => 'prh_search',
    'path' => $path,
  );

  return $theme;
}
