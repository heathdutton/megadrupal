<?php

/**
 * @file
 * Tests for the Yandex XML module.
 */

/**
 * Yandex XML test case.
 */
class YandexXMLWebTestCase extends DrupalWebTestCase {

  /**
   * Test case definition.
   */
  public static function getInfo() {
    return array(
      'name' => 'Yandex XML functionality',
      'description' => 'Yandex search engine queries.',
      'group' => 'Yandex XML',
    );
  }

  /**
   * Test preparation.
   */
  public function setUp() {
    parent::setUp('yandex_xml');

    $this->admin_user = $this->drupalCreateUser(array(
      'administer yandex xml',
    ));
  }

  /**
   * Test administration interface.
   */
  public function testSettingsForm() {
    $this->drupalLogin($this->admin_user);

    $edit['yandex_xml_search_url'] = 'http://xmlsearch.yandex.ru/xmlsearch?user=USERNAME&key=KEY';
    $edit['yandex_xml_grpoups_on_page'] = mt_rand(1, 100);
    $edit['yandex_xml_site_autodetect'] = (bool) mt_rand(0, 1);
    $edit['yandex_xml_site_url'] = 'http://drupal.org/node';

    // We cannot save this settings because we haven't a valid search url.
    $this->drupalPost('admin/config/search/yandex_xml', $edit, t('Save configuration'));
    $this->assertText(t('Search request failed'));

  }

}
