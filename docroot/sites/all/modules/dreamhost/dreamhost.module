<?php

/**
 * @file
 * The Dreamhost Drupal module.
 */

/**
 * Implements hook_help().
 */
function dreamhost_help($path, $arg) {
  switch ($path) {
  case 'admin/help#dreamhost':
    $output = '<p>'. t('Integration with <a href="@dreamhost">Dreamhost</a> web hosting.', array('@dreamhost' => 'http://dreamhost.com')) .'</p>';
    return $output;
  case 'admin/config/services/dreamhost':
    return '<p>'. t('The following provides the general configuration options for the <a href="@dreamhost">Dreamhost</a> web hosting.', array('@dreamhost' => 'http://dreamhost.com')) .'</p>';
  }
}

/**
 * Implements hook_permission().
 */
function dreamhost_permission() {
  return array(
    'administer dreamhost' => array(
      'title' => t('Administer Dreamhost'),
      'description' => t('Perform administrative actions with Dreamhost.'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function dreamhost_menu() {
  $items['admin/config/services/dreamhost'] = array(
    'title' => 'Dreamhost',
    'description' => 'Provides configuration options for Dreamhost.',
    'access arguments' => array('administer dreamhost'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('dreamhost_admin_settings'),
    'file' => 'dreamhost.admin.inc',
  );
  $items['admin/config/services/dreamhost/general'] = array(
    'title' => 'General',
    'description' => 'Provides general configuration options for Dreamhost.',
    'access arguments' => array('administer dreamhost'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('dreamhost_admin_settings'),
    'file' => 'dreamhost.admin.inc',
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => -5,
  );
  return $items;
}

/**
 * Makes a call to the Dreamhost API.
 *
 * Returns NULL if it can't reach the Dreamhost API.
 */
function dreamhost($cmd, array $args = array()) {
  static $dreamhost = NULL;
  if (!isset($dreamhost)) {
    $key = variable_get('dreamhost_key', '');
    module_load_include('php', 'dreamhost');
    $dreamhost = empty($key) ? FALSE : new Dreamhost($key);
  }
  if ($dreamhost) {
    try {
      return $dreamhost->call($cmd, $args);
    }
    catch (Exception $ex) {
      watchdog('dreamhost', (string)$ex, array(), WATCHDOG_ERROR, $_GET['q']);
    }
  }
  return NULL;
}

