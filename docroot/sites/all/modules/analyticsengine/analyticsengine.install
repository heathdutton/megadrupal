<?php

/**
 * @file
 * Installation file for Analytics Engine.
 */

/**
 * Implements hook_install().
 */
function analyticsengine_install() {
  // This module needs to be heavier than Google Analytics so that the
  // Analytics Engine code gets added to the page after Google Analytics.
  $weight = db_select('system', 's')
    ->fields('s', array('weight'))
    ->condition('name', 'googleanalytics', '=')
    ->execute()
    ->fetchField();
  db_update('system')
    ->fields(array('weight' => $weight + 1))
    ->condition('name', 'analyticsengine', '=')
    ->execute();
}

/**
 * Implements hook_requirements().
 */
function analyticsengine_requirements($phase) {
  $requirements = array();
  $t = get_t();

  if ($phase == 'runtime') {
    if (variable_get('analyticsengine_account', '') == '') {
      $requirements['analyticsengine'] = array(
        'title' => $t('Analytics Engine'),
        'description' => $t('Analytics Engine has not been configured yet. Please configure its settings from the <a href="@url">Analytics Engine settings page</a>.', array('@url' => url('admin/config/system/analyticsengine'))),
        'severity' => REQUIREMENT_ERROR,
        'value' => $t('Not configured'),
      );
    }
  }

  return $requirements;
}
