<?php

/**
 * @file
 * Implement lr_social_profile_data support for Drupal
 */
/**
 * Implements hook_init() Add dialog js.
 */
function lr_social_profile_data_init() {
  if (variable_get('lr_social_profile_data_show_profile') == 1) {
    drupal_add_library('system', 'ui.dialog');
    drupal_add_js(drupal_get_path('module', 'lr_social_profile_data') . '/js/lr_social_profile_data.modal.js');
    drupal_add_js(array(
      'lr_social_profile_data' => array(
        'defaults' => 'width:960;height:auto;position:[center,60]',
        'selector' => 'content',
        'title' => '',
      ),
    ), 'setting');
  }
}

/**
 * Implements hook_views_api().
 *
 * @return array Add views api in advance module
 */
function lr_social_profile_data_views_api() {
  return array(
    'api' => 2,
    'path' => drupal_get_path('module', 'lr_social_profile_data') . '/views',
  );
}

/**
 * Implements hook_permission().
 *
 * Responed to Define user permissions.
 *
 * @return array An array of permission settings
 */
function lr_social_profile_data_permission() {
  return array(
    'administer social profile data' => array(
      'title' => t('Administer Social Profile Data settings'),
      'restrict access' => TRUE,
    ),
  );
}

/**
 * Implements hook_menu().
 *
 * Responed to url handling for lr_social_profile_data module.
 *
 * @return array An array of menu items
 */
function lr_social_profile_data_menu() {
  $file_path = drupal_get_path('module', 'lr_social_profile_data');
  $items['admin/config/people/userregistration/socialprofiledata'] = array(
    'title' => 'Social Profile Data',
    'description' => 'advance_social_sharing Share settings.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('lr_social_profile_data_settings_form'),
    'access arguments' => array('administer social profile data'),
    'type' => MENU_LOCAL_TASK,
    'weight' => 4,
    'file path' => $file_path,
    'file' => 'includes/lr_social_profile_data.admin.inc',
  );
  $items['lr_social_profile_data/ajax/userprofile/%'] = array(
    'title' => '',
    'page callback' => 'lr_social_profile_data_ajax_user_profile',
    'page arguments' => array(1, 3),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );
  return $items;
}

/**
 * Delete loginradius database tables.
 *
 * @param  string $table_name Database table name
 * @param int $user_id User ID
 */
function lr_social_profile_data_delete($table_name, $user_id) {
  try {
    db_delete($table_name)
      ->condition('user_id', $user_id)
      ->execute();
  }
  catch (Exception $e) {
    watchdog_exception('type', $e);
  }
}

/**
 * Insert extended data into database loginradius tables.
 *
 * @param string $table_name Database table name
 * @param array $data_values Data values that will insert in table
 */
function lr_social_profile_data_insert($table_name, $data_values) {
  if (!empty($data_values) && is_array($data_values)) {
    try {
      return $temp_id = db_insert($table_name)
        ->fields(array_keys($data_values))
        ->values($data_values)
        ->execute();
    }
    catch (Exception $e) {
      watchdog_exception('type', $e);
    }
  }
}

/**
 * Insert extended data into database loginradius tables.
 *
 * @param string $table_name Database table name
 * @param array $data_values Data values that will insert in table
 */
function lr_social_profile_data_insert_array_values($table_name, $user_id, $method_name, $data_values, $provider) {
  if (!empty($data_values) && is_array($data_values)) {
    $insert = db_insert($table_name);
    foreach ($data_values as $data_value) {
      $data_value->provider = $provider;
      $post_data_value = $method_name($user_id, $data_value);
      $insert->fields(array_keys($post_data_value));
      $insert->values($post_data_value);
    }
    $insert->execute();
  }
}

/**
 * Update user data in loginradius database table.
 *
 * @param string $table_name Database table name
 * @param int $user_id User ID
 * @param array $data_values Data values that will update in table
 */
function lr_social_profile_data_update($table_name, $user_id, $data_values) {
  try {
    db_update($table_name)
      ->fields($data_values)
      ->condition('user_id', $user_id)
      ->execute();
  }
  catch (Exception $e) {
    watchdog_exception('type', $e);
  }
}

/**
 * Get extended user profile data from user profile.
 *
 * @param int $user_id User ID
 * @param object $userprofile User profile data
 * @return array contain data values of extended profile data
 */
function lr_social_profile_data_get_extended_profile($user_id, $userprofile) {
  return array(
    'user_id' => $user_id,
    'website' => ((isset($userprofile->Website) && lr_social_profile_data_check_array_and_object($userprofile->Website)) ? $userprofile->Website : ''),
    'favicon' => ((isset($userprofile->Favicon) && lr_social_profile_data_check_array_and_object($userprofile->Favicon)) ? $userprofile->Favicon : ''),
    'industry' => ((isset($userprofile->Industry) && lr_social_profile_data_check_array_and_object($userprofile->Industry)) ? $userprofile->Industry : ''),
    'about' => ((isset($userprofile->About) && lr_social_profile_data_check_array_and_object($userprofile->About)) ? $userprofile->About : ''),
    'timezone' => ((isset($userprofile->TimeZone) && lr_social_profile_data_check_array_and_object($userprofile->TimeZone)) ? $userprofile->TimeZone : ''),
    'verified' => ((isset($userprofile->Verified) && lr_social_profile_data_check_array_and_object($userprofile->Verified)) ? $userprofile->Verified : ''),
    'last_profile_update' => ((isset($userprofile->UpdatedTime) && lr_social_profile_data_check_array_and_object($userprofile->UpdatedTime)) ? $userprofile->UpdatedTime : ''),
    'created' => ((isset($userprofile->Created) && lr_social_profile_data_check_array_and_object($userprofile->Created)) ? $userprofile->Created : ''),
    'relationship_status' => ((isset($userprofile->RelationshipStatus) && lr_social_profile_data_check_array_and_object($userprofile->RelationshipStatus)) ? $userprofile->RelationshipStatus : ''),
    'quote' => ((isset($userprofile->Quota) && lr_social_profile_data_check_array_and_object($userprofile->Quota)) ? $userprofile->Quota : ''),
    'interested_in' => ((isset($userprofile->InterestedIn) && lr_social_profile_data_check_array_and_object($userprofile->InterestedIn)) ? $userprofile->InterestedIn : ''),
    'interests' => ((isset($userprofile->Interests) && lr_social_profile_data_check_array_and_object($userprofile->Interests)) ? $userprofile->Interests : ''),
    'religion' => ((isset($userprofile->Religion) && lr_social_profile_data_check_array_and_object($userprofile->Religion)) ? $userprofile->Religion : ''),
    'political_view' => ((isset($userprofile->Political) && lr_social_profile_data_check_array_and_object($userprofile->Political)) ? $userprofile->Political : ''),
    'https_image_url' => ((isset($userprofile->HttpsImageUrl) && lr_social_profile_data_check_array_and_object($userprofile->HttpsImageUrl)) ? $userprofile->HttpsImageUrl : ''),
    'followers_count' => ((isset($userprofile->FollowersCount) && lr_social_profile_data_check_array_and_object($userprofile->FollowersCount)) ? $userprofile->FollowersCount : 0),
    'friends_count' => ((isset($userprofile->FriendsCount) && lr_social_profile_data_check_array_and_object($userprofile->FriendsCount)) ? $userprofile->FriendsCount : ''),
    'is_geo_enabled' => ((isset($userprofile->IsGeoEnabled) && lr_social_profile_data_check_array_and_object($userprofile->IsGeoEnabled)) ? $userprofile->IsGeoEnabled : ''),
    'total_status_count' => ((isset($userprofile->TotalStatusesCount) && lr_social_profile_data_check_array_and_object($userprofile->TotalStatusesCount)) ? $userprofile->TotalStatusesCount : 0),
    'number_of_recommenders' => ((isset($userprofile->NumRecommenders) && lr_social_profile_data_check_array_and_object($userprofile->NumRecommenders)) ? $userprofile->NumRecommenders : 0),
    'honors' => ((isset($userprofile->Honors) && lr_social_profile_data_check_array_and_object($userprofile->Honors)) ? $userprofile->Honors : ''),
    'associations' => ((isset($userprofile->Associations) && lr_social_profile_data_check_array_and_object($userprofile->Associations)) ? $userprofile->Associations : ''),
    'hirable' => ((isset($userprofile->Hireable) && !empty($userprofile->Hireable) && lr_social_profile_data_check_array_and_object($userprofile->Hireable)) ? $userprofile->Hireable : 0),
    'repository_url' => ((isset($userprofile->Country->Name) && lr_social_profile_data_check_array_and_object($userprofile->Country->Name)) ? $userprofile->Country->Name : ''),
    'age' => ((isset($userprofile->Age) && lr_social_profile_data_check_array_and_object($userprofile->Age)) ? $userprofile->Age : 0),
    'professional_headline' => ((isset($userprofile->ProfessionalHeadline) && lr_social_profile_data_check_array_and_object($userprofile->ProfessionalHeadline)) ? $userprofile->ProfessionalHeadline : ''),
    'provider_access_token' => ((isset($userprofile->ProviderAccessCredential->AccessToken) && lr_social_profile_data_check_array_and_object($userprofile->ProviderAccessCredential->AccessToken)) ? serialize($userprofile->ProviderAccessCredential->AccessToken) : ''),
    'provider_token_secret' => ((isset($userprofile->ProviderAccessCredential->TokenSecret) && lr_social_profile_data_check_array_and_object($userprofile->ProviderAccessCredential->TokenSecret)) ? $userprofile->ProviderAccessCredential->TokenSecret : ''),
  );
}

/**
 * Get extended location data from user profile.
 *
 * @param int $user_id User ID
 * @param object $userprofile User profile data
 * @return array conatin data values of entended location data
 */
function lr_social_profile_data_get_extended_location($user_id, $userprofile) {
  return array(
    'user_id' => $user_id,
    'main_address' => ((isset($userprofile->MainAddress) && lr_social_profile_data_check_array_and_object($userprofile->MainAddress)) ? $userprofile->MainAddress : ''),
    'hometown' => ((isset($userprofile->HomeTown) && lr_social_profile_data_check_array_and_object($userprofile->HomeTown)) ? $userprofile->HomeTown : ''),
    'state' => ((isset($userprofile->State) && lr_social_profile_data_check_array_and_object($userprofile->State)) ? $userprofile->State : ''),
    'city' => ((isset($userprofile->City) && lr_social_profile_data_check_array_and_object($userprofile->City)) ? $userprofile->City : ''),
    'local_city' => ((isset($userprofile->LocalCity) && lr_social_profile_data_check_array_and_object($userprofile->LocalCity) && $userprofile->LocalCity != 'unknown') ? $userprofile->LocalCity : ''),
    'profile_city' => ((isset($userprofile->ProfileCity) && lr_social_profile_data_check_array_and_object($userprofile->ProfileCity)) ? $userprofile->ProfileCity : ''),
    'profile_url' => ((isset($userprofile->ProfileUrl) && lr_social_profile_data_check_array_and_object($userprofile->ProfileUrl)) ? $userprofile->ProfileUrl : ''),
    'local_language' => ((isset($userprofile->LocalLanguage) && lr_social_profile_data_check_array_and_object($userprofile->LocalLanguage) && $userprofile->LocalLanguage != 'unknown') ? $userprofile->LocalLanguage : ''),
    'language' => ((isset($userprofile->Language) && lr_social_profile_data_check_array_and_object($userprofile->Language) && $userprofile->Language != 'unknown') ? $userprofile->Language : ''),
  );
}

/**
 * Get basic user profile data from user profile.
 *
 * @param int $user_id User ID
 * @param object $userprofile User profile data
 * @return array conatin data values of basic profile data
 */
function lr_social_profile_data_get_basic_profile($user_id, $userprofile) {
  return array(
    'user_id' => $user_id,
    'provider' => ((isset($userprofile->Provider) && lr_social_profile_data_check_array_and_object($userprofile->Provider)) ? $userprofile->Provider : ''),
    'provider_id' => ((isset($userprofile->ID) && lr_social_profile_data_check_array_and_object($userprofile->ID)) ? $userprofile->ID : ''),
    'prefix' => ((isset($userprofile->Prefix) && lr_social_profile_data_check_array_and_object($userprofile->Prefix)) ? $userprofile->Prefix : ''),
    'first_name' => ((isset($userprofile->FirstName) && lr_social_profile_data_check_array_and_object($userprofile->FirstName)) ? $userprofile->FirstName : ''),
    'middle_name' => ((isset($userprofile->MiddleName) && lr_social_profile_data_check_array_and_object($userprofile->MiddleName)) ? $userprofile->MiddleName : ''),
    'last_name' => ((isset($userprofile->LastName) && lr_social_profile_data_check_array_and_object($userprofile->LastName)) ? $userprofile->LastName : ''),
    'suffix' => ((isset($userprofile->Suffix) && lr_social_profile_data_check_array_and_object($userprofile->Suffix)) ? $userprofile->Suffix : ''),
    'full_name' => ((isset($userprofile->FullName) && lr_social_profile_data_check_array_and_object($userprofile->FullName)) ? $userprofile->FullName : ''),
    'nick_name' => ((isset($userprofile->NickName) && lr_social_profile_data_check_array_and_object($userprofile->NickName)) ? $userprofile->NickName : ''),
    'profile_name' => ((isset($userprofile->ProfileName) && lr_social_profile_data_check_array_and_object($userprofile->ProfileName)) ? $userprofile->ProfileName : ''),
    'birth_date' => ((isset($userprofile->BirthDate) && lr_social_profile_data_check_array_and_object($userprofile->BirthDate)) ? $userprofile->BirthDate : ''),
    'gender' => ((isset($userprofile->Gender) && lr_social_profile_data_check_array_and_object($userprofile->Gender)) ? $userprofile->Gender : ''),
    'country_code' => ((isset($userprofile->Country->Code) && lr_social_profile_data_check_array_and_object($userprofile->Country->Code) && $userprofile->Country->Code != "unknown") ? $userprofile->Country->Code : ''),
    'country_name' => ((isset($userprofile->Country->Name) && lr_social_profile_data_check_array_and_object($userprofile->Country->Name) && $userprofile->Country->Name != "unknown") ? $userprofile->Country->Name : ''),
    'thumbnail_image_url' => ((isset($userprofile->ImageUrl) && lr_social_profile_data_check_array_and_object($userprofile->ImageUrl)) ? $userprofile->ImageUrl : ''),
    'image_url' => ((isset($userprofile->ImageUrl) && lr_social_profile_data_check_array_and_object($userprofile->ImageUrl)) ? $userprofile->ImageUrl : ''),
    'local_country' => ((isset($userprofile->LocalCountry) && lr_social_profile_data_check_array_and_object($userprofile->LocalCountry) && $userprofile->LocalCountry != 'unknown') ? $userprofile->LocalCountry : ''),
    'profile_country' => ((isset($userprofile->ProfileCountry) && lr_social_profile_data_check_array_and_object($userprofile->ProfileCountry) && $userprofile->ProfileCountry != 'unknown') ? $userprofile->ProfileCountry : ''),
  );
}

/**
 * Get company data from user profile.
 *
 * @param object $data User's company inofrmation
 * @return array conatin data values of basic profile data
 */
function lr_social_profile_data_get_company($data) {
  return array(
    'company_name' => (isset($data->Company->Name) ? $data->Company->Name : ''),
    'company_type' => (isset($data->Company->Type) ? $data->Company->Type : ''),
    'industry' => (isset($data->Company->Industry) ? $data->Company->Industry : ''),
  );
}

/**
 * Get position data from user profile
 *
 * @param int $user_id User ID
 * @param object $data Information of user's Position iin company
 * @param type $temp_id Id inserted in comapny
 * @return array contain data values of position information in company of user
 */
function lr_social_profile_data_get_position($user_id, $data, $temp_id) {
  return array(
    'user_id' => $user_id,
    'position' => (isset($data->Position) ? $data->Position : ''),
    'summary' => (isset($data->Summary) ? $data->Summary : ''),
    'start_date' => (isset($data->StartDate) ? $data->StartDate : ''),
    'end_date' => (isset($data->EndDate) ? $data->EndDate : ''),
    'is_current' => (isset($data->IsCurrent) ? $data->IsCurrent : ''),
    'company' => (isset($temp_id)) ? $temp_id : NULL,
    'location' => (isset($data->Location) ? $data->Location : ''),
  );
}

/**
 * Get education data from user profile.
 *
 * @param int $user_id User ID
 * @param object $education User's education data
 * @return array Contain data values of user's education
 */
function lr_social_profile_data_get_education($user_id, $education) {
  return array(
    'user_id' => $user_id,
    'school' => (isset($education->School) ? $education->School : ''),
    'year' => (isset($education->Year) ? $education->Year : ''),
    'type' => (isset($education->Type) ? $education->Type : ''),
    'notes' => (isset($education->Notes) ? $education->Notes : ''),
    'activities' => (isset($education->Activities) ? $education->Activities : ''),
    'degree' => (isset($education->Degree) ? $education->Degree : ''),
    'field_of_study' => (isset($education->fieldofstudy) ? $education->fieldofstudy : ''),
    'start_date' => (isset($education->StartDate) ? $education->StartDate : ''),
    'end_date' => (isset($education->EndDate) ? $education->EndDate : ''),
  );
}

/**
 * Get phone number data from user profile.
 *
 * @param int $user_id User Id
 * @param object $data User's phone number
 * @return array Contain data values of user's phone number
 */
function lr_social_profile_data_get_phone_number($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'number_type' => (isset($data->PhoneType) ? $data->PhoneType : ''),
    'phone_number' => (isset($data->PhoneNumber) ? $data->PhoneNumber : ''),
  );
}

/**
 * Get im account data from user profile.
 *
 * @param int $user_id
 * @param object $data user's im account information
 * @return array Contain data values of user's im accounts
 */
function lr_social_profile_data_get_im_account($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'account_type' => (isset($data->AccountType) ? $data->AccountType : ''),
    'account_username' => (isset($data->AccountName) ? $data->AccountName : ''),
  );
}

/**
 * Get address data from user profile
 *
 * @param int $user_id User ID
 * @param object $data user's address information
 * @return array Contain data values of user's address information
 */
function lr_social_profile_data_get_address($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'type' => (isset($data->Type) ? $data->Type : ''),
    'address_line1' => (isset($data->Address1) ? $data->Address1 : ''),
    'address_line2' => (isset($data->Address2) ? $data->Address2 : ''),
    'city' => (isset($data->City) ? $data->City : ''),
    'state' => (isset($data->State) ? $data->State : ''),
    'postal_code' => (isset($data->PostalCode) ? $data->PostalCode : ''),
    'region' => (isset($data->Region) ? $data->Region : ''),
  );
}

/**
 * Get sports data from user profile
 *
 * @param int $user_id User ID
 * @param object $data sports information
 * @return array Contain data values of user's sport information
 */
function lr_social_profile_data_get_sports($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'sport_id' => (isset($data->Id) ? $data->Id : ''),
    'sport' => (isset($data->Name) ? $data->Name : ''),
  );
}

/**
 * Get inspirational people data from user profile
 *
 * @param int $user_id User ID
 * @param object $data inspirational people information
 * @return array Contain data values of user's inspirational people information
 */
function lr_social_profile_data_get_inspirational_people($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'social_id' => (isset($data->Id) ? $data->Id : ''),
    'name' => (isset($data->Name) ? $data->Name : ''),
  );
}

/**
 * Get skills data from user profile
 *
 * @param int $user_id User ID
 * @param object $data User's skills information
 * @return array Contain data values of user's skills information
 */
function lr_social_profile_data_get_skills($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'skill_id' => (isset($data->Id) ? $data->Id : ''),
    'name' => (isset($data->Name) ? $data->Name : ''),
  );
}

/**
 * Get current status data from user profile
 *
 * @param int $user_id User ID
 * @param object $data usr's current status
 * @return array Contain data values of current status
 */
function lr_social_profile_data_get_current_status($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'status_id' => (isset($data->Id) ? $data->Id : ''),
    'status' => (isset($data->Text) ? $data->Text : ''),
    'source' => (isset($data->Source) ? $data->Source : ''),
    'created_date' => (isset($data->CreatedDate) ? $data->CreatedDate : ''),
  );
}

/**
 * Get certification data from user profile
 *
 * @param int $user_id User ID
 * @param object $data certification daat from user profile
 * @return array Contain data values of certification
 */
function lr_social_profile_data_get_certification($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'certification_id' => (isset($data->Id) ? $data->Id : ''),
    'certification_name' => (isset($data->Name) ? $data->Name : ''),
    'authority' => (isset($data->Authority) ? $data->Authority : ''),
    'license_number' => (isset($data->Number) ? $data->Number : ''),
    'start_date' => (isset($data->StartDate) ? $data->StartDate : ''),
    'end_date' => (isset($data->EndDate) ? $data->EndDate : ''),
  );
}

/**
 * Get course data from user profile
 *
 * @param int $user_id User ID
 * @param object $data course data from userprofile
 * @return array Contain data values of course
 */
function lr_social_profile_data_get_course($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'course_id' => (isset($data->Id) ? $data->Id : ''),
    'course' => (isset($data->Name) ? $data->Name : ''),
    'course_number' => (isset($data->Number) ? $data->Number : ''),
  );
}

/**
 * Get volunteer data from user profile.
 *
 * @param int $user_id User ID
 * @param object $data volunteer data from user profile
 * @return array Contain data values of volunteer
 */
function lr_social_profile_data_get_volunteer($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'volunteer_id' => (isset($data->Id) ? $data->Id : ''),
    'role' => (isset($data->Role) ? $data->Role : ''),
    'organization' => (isset($data->Organization) ? $data->Organization : ''),
    'cause' => (isset($data->Cause) ? $data->Cause : ''),
  );
}

/**
 * Get recommendation data from user profile.
 * @param int $user_id User ID
 * @param object $data Recommendation Received data from userprofile
 * @return array Contain data values of recommendation
 */
function lr_social_profile_data_get_recommendation_received($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'recommendation_id' => (isset($data->Id) ? $data->Id : ''),
    'recommendation_type' => (isset($data->RecommendationType) ? $data->RecommendationType : ''),
    'recommendation_text' => (isset($data->RecommendationText) ? $data->RecommendationText : ''),
    'recommender' => (isset($data->Recommender) ? $data->Recommender : ''),
  );
}

/**
 * Get language data from user profile
 *
 * @param int $user_id User ID
 * @param object $data Language data rom user profile
 * @return array Contain data values of language
 */
function lr_social_profile_data_get_language($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'language_id' => (isset($data->Id) ? $data->Id : ''),
    'language' => (isset($data->Name) ? $data->Name : ''),
  );
}

/**
 * Get patent data from user profile
 *
 * @param int $user_id User ID
 * @param object $data user's patent information
 * @return array Contain data values of patent information
 */
function lr_social_profile_data_get_patent($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'patent_id' => (isset($data->Id) ? $data->Id : ''),
    'title' => (isset($data->Title) ? $data->Title : ''),
    'date' => (isset($data->Date) ? $data->Date : ''),
  );
}

/**
 * Get favorites things data from user profile.
 *
 * @param int $user_id User ID
 * @param object $data user's favorite things
 * @return array Contain data values of favorite things
 */
function lr_social_profile_data_get_favorite_things($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'social_id' => (isset($data->Id) ? $data->Id : ''),
    'name' => (isset($data->Name) ? $data->Name : ''),
    'type' => (isset($data->Type) ? $data->Type : ''),
  );
}

/**
 * Get games data from user profile.
 *
 * @param int $user_id User ID
 * @param object $game User's game data
 * @return array Contain data values of user's game
 */
function lr_social_profile_data_get_games($user_id, $game) {
  return array(
    'user_id' => $user_id,
    'game_id' => (isset($game->Id) ? $game->Id : ''),
    'category' => (isset($game->Category) ? $game->Category : ''),
    'name' => (isset($game->Name) ? $game->Name : ''),
    'created_date' => (isset($game->CreatedDate) ? $game->CreatedDate : ''),
  );
}

/**
 * Get television shows data from user profile.
 *
 * @param int $user_id User ID
 * @param object $television User's television show data
 * @return array Contain data values of user's television show
 */
function lr_social_profile_data_get_television_show($user_id, $television) {
  return array(
    'user_id' => $user_id,
    'television_id' => (isset($television->Id) ? $television->Id : ''),
    'category' => (isset($television->Category) ? $television->Category : ''),
    'name' => (isset($television->Name) ? $television->Name : ''),
    'created_date' => (isset($television->CreatedDate) ? $television->CreatedDate : ''),
  );
}

/**
 * Get movie data from user profile.
 *
 * @param int $user_id User ID
 * @param object $movie User's movie  data
 * @return array Contain data values of user's movie
 */
function lr_social_profile_data_get_movies($user_id, $movie) {
  return array(
    'user_id' => $user_id,
    'movie_id' => (isset($movie->Id) ? $movie->Id : ''),
    'category' => (isset($movie->Category) ? $movie->Category : ''),
    'name' => (isset($movie->Name) ? $movie->Name : ''),
    'created_date' => (isset($movie->CreatedDate) ? $movie->CreatedDate : ''),
  );
}

/**
 * Get book data from user profile.
 *
 * @param int $user_id User ID
 * @param object $book User's book  data
 * @return array Contain data values of user's book
 */
function lr_social_profile_data_get_book($user_id, $book) {
  return array(
    'user_id' => $user_id,
    'book_id' => (isset($book->Id) ? $book->Id : ''),
    'category' => (isset($book->Category) ? $book->Category : ''),
    'name' => (isset($book->Name) ? $book->Name : ''),
    'created_date' => (isset($book->CreatedDate) ? $book->CreatedDate : ''),
  );
}

/**
 * Get contact data from user profile
 *
 * @param int $user_id User ID
 * @param string $provider Social Network
 * @param object $contact User's contact
 * @return array Contain data values of user's contacts
 */
function lr_social_profile_data_get_contact($user_id, $contact) {
  return array(
    'user_id' => $user_id,
    'provider' => (isset($contact->provider) ? $contact->provider : ''),
    'name' => (isset($contact->Name) ? $contact->Name : ''),
    'email' => (isset($contact->EmailID) ? $contact->EmailID : ''),
    'phone_number' => (isset($contact->PhoneNumber) ? $contact->PhoneNumber : ''),
    'social_id' => (isset($contact->ID) ? $contact->ID : ''),
    'profile_url' => (isset($contact->ProfileUrl) ? $contact->ProfileUrl : ''),
    'image_url' => (isset($contact->ImageUrl) ? $contact->ImageUrl : ''),
    'status' => (isset($contact->Status) ? $contact->Status : ''),
    'industry' => (isset($contact->Industry) ? $contact->Industry : ''),
    'country' => (isset($contact->Country) ? $contact->Country : ''),
    'gender' => (isset($contact->Gender) ? $contact->Gender : ''),
    'location' => (isset($contact->Location) ? $contact->Location : ''),
    'birth_date' => (isset($contact->DateOfBirth) ? $contact->DateOfBirth : ''),
  );
}

/**
 * Get facebook event data from user profile
 *
 * @param int $user_id User ID
 * @param object $event Facebook event
 * @return array Contain data values of facebook event
 */
function lr_social_profile_data_get_facebook_event($user_id, $event) {
  return array(
    'user_id' => $user_id,
    'event_id' => (isset($event->ID) ? $event->ID : ''),
    'owner_id' => (isset($event->OwnerId) ? $event->OwnerId : ''),
    'owner_name' => (isset($event->OwnerName) ? $event->OwnerName : ''),
    'description' => (isset($event->Description) ? $event->Description : ''),
    'event' => (isset($event->Name) ? $event->Name : ''),
    'start_time' => (isset($event->StartTime) ? $event->StartTime : ''),
    'updated_date' => (isset($event->UpdatedDate) ? $event->UpdatedDate : ''),
    'end_time' => (isset($event->EndTime) ? $event->EndTime : ''),
    'privacy' => (isset($event->Privacy) ? $event->Privacy : ''),
    'rsvp_status' => (isset($event->RsvpStatus) ? $event->RsvpStatus : ''),
    'location' => (isset($event->Location) ? $event->Location : ''),
  );
}

/**
 * Get facebook post data from user profile
 *
 * @param int $user_id User ID
 * @param object $post Facebook Post
 * @return array Contain data values of facebook post
 */
function lr_social_profile_data_get_facebook_post($user_id, $post) {
  return array(
    'user_id' => $user_id,
    'post_id' => (isset($post->ID) ? $post->ID : ''),
    'from_name' => (isset($post->Name) ? $post->Name : ''),
    'title' => (isset($post->Title) ? $post->Title : ''),
    'start_time' => (isset($post->StartTime) ? $post->StartTime : ''),
    'update_time' => (isset($post->UpdateTime) ? $post->UpdateTime : ''),
    'message' => (isset($post->Message) ? $post->Message : ''),
    'place' => (isset($post->Place) ? $post->Place : ''),
    'picture' => (isset($post->Picture) ? $post->Picture : ''),
    'likes' => (isset($post->Likes) ? $post->Likes : 0),
    'shares' => (isset($post->Shares) ? $post->Shares : 0),
  );
}

/**
 * Get company data from user profile
 *
 * @param int $user_id User ID
 * @param object $company user's company at linkedin social network
 * @return array Contain data values of user's comapny at LinkedIn social network.
 */
function lr_social_profile_data_get_linkedin_company($user_id, $company) {
  return array(
    'user_id' => $user_id,
    'company_id' => (isset($company->ID) ? $company->ID : ''),
    'company_name' => (isset($company->Name) ? $company->Name : ''),
  );
}

/**
 * Get status data from user profile
 *
 * @param int $user_id User ID
 * @param string $provider Social Network
 * @param object $data user's status information at social network
 * @return array Contain data values of user's status information
 */
function lr_social_profile_data_get_status($user_id, $data) {
  return array(
    'user_id' => $user_id,
    'provider' => (isset($data->provider) ? $data->provider : ''),
    'status_id' => (isset($data->Id) ? $data->Id : ''),
    'status' => (isset($data->Text) ? $data->Text : ''),
    'date_time' => (isset($data->DateTime) ? $data->DateTime : ''),
    'likes' => (isset($data->Likes) ? $data->Likes : ''),
    'place' => (isset($data->Place) ? $data->Place : ''),
    'source' => (isset($data->Source) ? $data->Source : ''),
    'image_url' => (isset($data->ImageUrl) ? $data->ImageUrl : ''),
    'link_url' => (isset($data->LinkUrl) ? $data->LinkUrl : ''),
  );
}

/**
 * Get twitter mention data from user profile.
 *
 * @param int $user_id User ID
 * @param object $mention user's twitter mention
 * @return array Contain data values of user's twitter mentions information
 */
function lr_social_profile_data_get_twitter_mentions($user_id, $mention) {
  return array(
    'user_id' => $user_id,
    'mention_id' => (isset($mention->Id) ? $mention->Id : ''),
    'tweet' => (isset($mention->Text) ? $mention->Text : ''),
    'date_time' => (isset($mention->DateTime) ? $mention->DateTime : ''),
    'likes' => (isset($mention->Likes) ? $mention->Likes : ''),
    'place' => (isset($mention->Place) ? $mention->Place : ''),
    'source' => (isset($mention->Source) ? $mention->Source : ''),
    'image_url' => (isset($mention->ImageUrl) ? $mention->ImageUrl : ''),
    'link_url' => (isset($mention->LinkUrl) ? $mention->LinkUrl : ''),
    'mentioned_by' => (isset($mention->Name) ? $mention->Name : ''),
  );
}

/**
 * Get group data from user profile.
 *
 * @param int $user_id User ID
 * @param string $provider Social network
 * @param object $group User's group information
 * @return array Contain data values of user's group information
 */
function lr_social_profile_data_get_group($user_id, $group) {
  return array(
    'user_id' => $user_id,
    'provider' => (isset($group->provider) ? $group->provider : ''),
    'group_id' => (isset($group->ID) ? $group->ID : ''),
    'group_name' => (isset($group->Name) ? $group->Name : ''),
    'email' => (isset($group->Email) ? $group->Email : ''),
    'group_description' => (isset($group->Description) ? $group->Description : ''),
    'country' => (isset($group->Country) ? $group->Country : ''),
    'postal_code' => (isset($group->PostalCode) ? $group->PostalCode : ''),
    'logo' => (isset($group->Logo) ? $group->Logo : ''),
    'image_url' => (isset($group->Image) ? $group->Image : ''),
    'member_count' => (isset($group->MemberCount) ? $group->MemberCount : 0),
  );
}

/**
 *  Get callback function for save extended data in particular table.
 *
 * @param $key table name
 * @return mixed
 */
function lr_social_profile_data_get_properties_callabck($key) {
  $result = array(
    'loginradius_education' => 'lr_social_profile_data_get_education',
    'loginradius_phone_numbers' => 'lr_social_profile_data_get_phone_number',
    'loginradius_IMaccounts' => 'lr_social_profile_data_get_im_account',
    'loginradius_addresses' => 'lr_social_profile_data_get_address',
    'loginradius_sports' => 'lr_social_profile_data_get_sports',
    'loginradius_inspirational_people' => 'lr_social_profile_data_get_inspirational_people',
    'loginradius_skills' => 'lr_social_profile_data_get_skills',
    'loginradius_current_status' => 'lr_social_profile_data_get_current_status',
    'loginradius_certifications' => 'lr_social_profile_data_get_certification',
    'loginradius_courses' => 'lr_social_profile_data_get_course',
    'loginradius_volunteer' => 'lr_social_profile_data_get_volunteer',
    'loginradius_recommendations_received' => 'lr_social_profile_data_get_recommendation_received',
    'loginradius_languages' => 'lr_social_profile_data_get_language',
    'loginradius_patents' => 'lr_social_profile_data_get_patent',
    'loginradius_favorites' => 'lr_social_profile_data_get_favorite_things',
    'loginradius_games' => 'lr_social_profile_data_get_games',
    'loginradius_television_show' => 'lr_social_profile_data_get_television_show',
    'loginradius_books' => 'lr_social_profile_data_get_book',
    'loginradius_movies' => 'lr_social_profile_data_get_movies',
  );
  return $result[$key];
}

/**
 * Delete data from database if exist and Save data into database.
 *
 * @param $key pass table name
 * @param $user_id user id
 * @param $data insertion data
 */
function lr_social_profile_data_save_premium_data($key, $user_id, $data) {
  lr_social_profile_data_delete($key, $user_id);

  foreach ($data as $value) {
    $callback = lr_social_profile_data_get_properties_callabck($key);
    $result = $callback($user_id, $value);
    lr_social_profile_data_insert($key, $result);
  }
}

/**
 * @param $obj LoginRadius Object
 * @param $lr_token LoginRadius token
 * @param $user_id user id
 * @param $key key to detect method and table name.
 *
 * Save premium data provider wise.
 */
function lr_social_profile_data_save_premium_data_by_provider($obj, $lr_token, $user_id, $key, $provider) {
  $result = array(
    'facebook_posts' => array(
      "loginradiusGetPosts",
      "lr_social_profile_data_get_facebook_post",
      "loginradius_facebook_posts",
    ),
    'lr_contacts' => array(
      "loginradiusGetContacts",
      "lr_social_profile_data_get_contact",
      "loginradius_contacts",
    ),
    'followed_companies_on' => array(
      "loginradiusGetFollowedCompanies",
      "lr_social_profile_data_get_linkedin_company",
      "loginradius_linkedin_companies",
    ),
    'status_message' => array(
      "loginradiusGetStatus",
      "lr_social_profile_data_get_status",
      "loginradius_status",
    ),
    'twitter_mentions' => array(
      "loginradiusGetMentions",
      "lr_social_profile_data_get_twitter_mentions",
      "loginradius_twitter_mentions",
    ),
    'lr_groups' => array(
      "loginradiusGetGroups",
      "lr_social_profile_data_get_group",
      "loginradius_groups",
    ),
    'facebook_profile_events' => array(
      "loginradiusGetEvents",
      "lr_social_profile_data_get_facebook_event",
      "loginradius_facebook_events",
    ),

  );
  if (isset($result[$key]) && db_table_exists($result[$key][2])) {
    $posts = $obj->$result[$key][0]($lr_token);
    if ($result[$key][0] == 'loginradiusGetContacts') {
      $posts = isset($posts->Data) ? $posts->Data : '';
    }
    if (is_array($posts) && count($posts) > 0) {
      lr_social_profile_data_delete($result[$key][2], $user_id);
      lr_social_profile_data_insert_array_values($result[$key][2], $user_id, $result[$key][1], $posts, $provider);
    }
  }
}

/**
 * Show data in Sub table.
 *
 * @param array $array Collection of userprofile data
 * @param boolean $sub_table true , if show inside table
 * @return string A renderable html table.
 */
function lr_social_profile_data_show($array, $sub_table = FALSE) {
  $style = '';
  $output = '<table id="sociallogin_userprofile_table"  cellspacing="0" style="word-break: break-all;">';
  $count = 1;

  if ($sub_table) {
    $output .= '<tfoot>';

    foreach ($array as $temp) {
      if (($count % 2) == 0) {
        $style = 'style="background-color:#fcfcfc"';
      }
      foreach ($temp as $key => $val) {
        $output .= '<tr ' . $style . '>';

        if ($key == 'user_id') {
          continue;
        }
        else {
          $output .= '<th scope="col" class="manage-colum">' . ucfirst($key) . '</th>';

          if ($key == 'picture' && !empty($val)) {
            $output .= '<th scope="col" class="manage-colum"><img height="60" width="60" src= "' . (isset($val) ? $val : '') . '" /></th>';
          }
          else {
            $output .= '<th scope="col" class="manage-colum">' . ucfirst($val) . '</th>';
          }
        }

        $output .= '</tr>';
      }

      $count++;
    }
  }
  else {
    $output .= '<thead><tr>';

    foreach ($array as $key) {
      foreach (array_keys((array) $key) as $value) {
        if ($value == 'user_id' || $value == 'provider') {
          continue;
        }

        $value = str_replace('_', ' ', $value);
        $output .= '<th scope="col"><strong>' . ucfirst($value) . '</strong></th>';
      }
      break;
    }

    $output .= '</tr>
      </thead>
     <tfoot>';

    foreach ($array as $contact) {
      if (($count % 2) == 0) {
        $style = 'style="background-color:#fcfcfc"';
      }
      $output .= '<tr ' . $style . '>';

      foreach ($contact as $key => $val) {
        if ($key == 'user_id' || $key == 'provider') {
          continue;
        }
        elseif ($key == 'provider_access_token') {
          $val = unserialize($val);
        }
        elseif ($key == 'company' && $val != NULL && $val != '') {
          // Companies.
          $companies_result = db_query("SELECT * FROM {loginradius_companies} WHERE id = :uid", array(':uid' => $val));
          $companies = $companies_result->fetchAll();

          if (count($companies) > 0) {
            $output .= '<th scope="col" class="manage-colum">' . lr_social_profile_data_show($companies) . '</th>';
            continue;
          }
        }
        else {
          if (!empty($val) && ($key == 'image_url' || $key == 'picture')) {
            $val = '<img height="50" width="50" src= "' . (isset($val) ? $val : '') . '" />';
          }

          $output .= '<th scope="col" class="manage-colum">' . ucfirst($val) . '</th>';
        }
      }

      $output .= '</tr>';
      $count++;
    }
  }

  $output .= '</tfoot></table>';
  return $output;
}

/**
 * Check table exits in database.
 * Check data exist iin database for specific user
 *
 * @param string $table_name Database table name
 * @param int $user_id User ID
 * @param int $tab_number Where to show user profile data in admin page
 * @return array|string Rendered html form to show extended profile data
 */
function lr_social_profile_data_check_data_in_table($table_name, $user_id, $tab_number) {
  $tabs = array(
    1 => 'Basic User Profile Data',
    2 => 'Extended Location Data',
    3 => 'Extended Profile Data',
    4 => 'Followed Companies',
    5 => 'Facebook Profile Events',
    6 => 'Status Messages',
    7 => 'Facebook Posts',
    8 => 'Twitter Mentions',
    9 => 'Groups',
    10 => 'Contacts/Friends Data',
    11 => 'Videos',
    12 => 'Facebook Likes',
    13 => 'Photos',
    14 => 'Albums',
  );

  if (db_table_exists($table_name)) {
    $basic_result = db_query("SELECT * FROM {" . $table_name . "} WHERE user_id = :uid", array(':uid' => $user_id));
    $basic_user_profile_data = $basic_result->fetchAll();

    if (isset($basic_user_profile_data) && count($basic_user_profile_data) > 0) {
      $data['output'] = '<li><a href="#tabs-' . $tab_number . '">' . $tabs[$tab_number] . '</a></li>';
      $data['user_profile'] = $basic_user_profile_data;
      return $data;
    }
  }
}

/**
 * Show extended data for specific user to admin
 *
 * @param type $tab_number Where to show user profile data in admin page
 * @param string $table_name Database table name
 * @param object $user_profile User profile data
 * @return string  Rendered html form to show user profile data at admin page
 */
function lr_social_profile_data_get_extended_data_to_show($tab_number, $table_name, $user_profile) {
  $output = '';

  if ($table_name == 'loginradius_basic_profile_data' || $table_name == 'loginradius_extended_profile_data') {
    return;
  }
  elseif (isset($user_profile[$table_name]) && count($user_profile[$table_name]) > 0) {
    $output .= '<div id="tabs-' . $tab_number . '">';
    $output .= lr_social_profile_data_show($user_profile[$table_name]);
    $output .= '</div>';
  }

  return $output;
}

/**
 * Show data in same tabs in basic profile data and extended profile data.
 *
 * @param array $data Contain table name and heading value of tab
 * @param int $user_id User Id
 * @param array $profile_data Contain profile data
 * @param boolean $show True, if you want to show data in same tab
 * @return string Rendered html form
 */
function lr_social_profile_data_show_data_in_same_tabs($data, $user_id, $profile_data, $show) {
  $output = '';

  foreach ($data as $key => $value) {
    $show_result = $show;

    if ($value == 'loginradius_basic_profile_data' || $value == 'loginradius_extended_profile_data') {
      $show_result = TRUE;
      $result = $profile_data;
    }
    else {
      $data_result = db_query("SELECT * FROM {" . $value . "} WHERE user_id = :uid", array(':uid' => $user_id));
      $result = $data_result->fetchAll();
    }

    if (isset($result) && count($result) > 0) {
      $output .= '<h2>' . $key . '</h2>';
      $output .= lr_social_profile_data_show($result, $show_result);
    }
  }

  return $output;
}

/**
 * Show User Profile at Dialog box
 *
 * @param type $js JS enabled
 * @param type $user_id User ID
 * @return string Conatin user profile data in renderable html form
 */
function lr_social_profile_data_ajax_user_profile($js = NULL, $user_id = NULL) {
  drupal_add_library('system', 'ui.tabs');
  drupal_add_js('jQuery(document).ready(function() {
    jQuery("#lr_tabs").tabs();
   });', 'inline');
  $no_profile_data = TRUE;
  $output = '';
  $output .= '<div id="lr_tabs"><ul>';
  $tables = array(
    'loginradius_basic_profile_data',
    'loginradius_extended_location_data',
    'loginradius_extended_profile_data',
    'loginradius_linkedin_companies',
    'loginradius_facebook_events',
    'loginradius_status',
    'loginradius_facebook_posts',
    'loginradius_twitter_mentions',
    'loginradius_groups',
    'loginradius_contacts',
    'loginradius_videos',
    'loginradius_likes',
    'loginradius_photos',
    'loginradius_albums',
  );

  foreach ($tables as $key => $value) {
    if ($result = lr_social_profile_data_check_data_in_table($value, $user_id, ($key + 1))) {
      $no_profile_data = FALSE;
      $output .= $result['output'];
      $user_profile[$value] = $result['user_profile'];
    }
  }

  $output .= '</ul>';

  if ($no_profile_data) {
    $output .= '<strong>Profile data not found.</strong>';
  }

  if (isset($user_profile['loginradius_basic_profile_data']) && count($user_profile['loginradius_basic_profile_data']) > 0) {
    $output .= '<div id="tabs-1">';
    $data = array(
      'General' => 'loginradius_basic_profile_data',
      'Email' => 'loginradius_emails',
    );
    $output .= lr_social_profile_data_show_data_in_same_tabs($data, $user_id, $user_profile['loginradius_basic_profile_data'], TRUE);
    $output .= '</div>';
  }

  if (isset($user_profile['loginradius_extended_profile_data']) && count($user_profile['loginradius_extended_profile_data']) > 0) {
    $output .= '<div id="tabs-3">';
    $data = array(
      'General' => 'loginradius_extended_profile_data',
      'Positions' => 'loginradius_positions',
      'Education' => 'loginradius_education',
      'Phone Numbers' => 'loginradius_phone_numbers',
      'IM Accounts' => 'loginradius_IMaccounts',
      'Addresses' => 'loginradius_addresses',
      'Sports' => 'loginradius_sports',
      'Inspirational People' => 'loginradius_inspirational_people',
      'Skills' => 'loginradius_skills',
      'Current Status' => 'loginradius_current_status',
      'Certifications' => 'loginradius_certifications',
      'Courses' => 'loginradius_courses',
      'Volunteer' => 'loginradius_volunteer',
      'Recommendations Recieved' => 'loginradius_recommendations_received',
      'Languages' => 'loginradius_languages',
      'Patents' => 'loginradius_patents',
      'Favorites' => 'loginradius_favorites',
      'Books' => 'loginradius_books',
      'Games' => 'loginradius_games',
      'Television Shows' => 'loginradius_television_show',
      'Movies' => 'loginradius_movies',
    );
    $output .= lr_social_profile_data_show_data_in_same_tabs($data, $user_id, $user_profile['loginradius_extended_profile_data'], FALSE);
    $output .= '</div>';
  }
  if (isset($user_profile)) {
    foreach ($tables as $tab_number => $table_name) {
      $output .= lr_social_profile_data_get_extended_data_to_show(($tab_number + 1), $table_name, $user_profile);
    }
  }

  $output .= '</div>';
  return $output;
}

/**
 * Save extended profile data into database.
 *
 * @param int $user_id
 * @param object $userprofile User Profile information
 */
function lr_social_profile_data_save($user_id, $userprofile) {
  $obj = new LoginRadius();
  $lr_social_profile_data_profile_selection = array();
  $data_array = variable_get('lr_social_profile_data_profile_selection');

  if (isset($data_array) && is_array($data_array)) {
    $lr_social_profile_data_profile_selection = explode(',', implode(',', variable_get('lr_social_profile_data_profile_selection')));
  }
  if (in_array('basic_profile_data', $lr_social_profile_data_profile_selection) && db_table_exists('loginradius_basic_profile_data')) {
    $basic_profile_data_values = lr_social_profile_data_get_basic_profile($user_id, $userprofile);

    if (!db_query('SELECT user_id FROM {loginradius_basic_profile_data} WHERE user_id = :id', array('id' => $user_id))->fetchField()) {
      lr_social_profile_data_insert('loginradius_basic_profile_data', $basic_profile_data_values);

      // Emails.
      if (db_table_exists('loginradius_emails') && count($userprofile->Email) > 0) {
        try {
          $insert = db_insert('loginradius_emails');
          foreach ($userprofile->Email as $lr_email) {
            $email_data_values = array(
              'user_id' => $user_id,
              'email_type' => (isset($lr_email->Type) ? $lr_email->Type : ''),
              'email' => (isset($lr_email->Value) ? $lr_email->Value : ''),
            );
            $insert->fields(array_keys($email_data_values));
            $insert->values($email_data_values);
          }
          $insert->execute();
        } catch (Exception $e) {
          watchdog_exception('type', $e);
        }
      }
    }
    else {
      lr_social_profile_data_update('loginradius_basic_profile_data', $user_id, $basic_profile_data_values);
    }
  }

  if (in_array('extended_location_data', $lr_social_profile_data_profile_selection) && db_table_exists('loginradius_extended_location_data')) {
    $extended_location_data_values = lr_social_profile_data_get_extended_location($user_id, $userprofile);

    if (!db_query('SELECT user_id FROM {loginradius_extended_location_data} WHERE user_id = :id', array('id' => $user_id))->fetchField()) {
      lr_social_profile_data_insert('loginradius_extended_location_data', $extended_location_data_values);
    }
    else {
      lr_social_profile_data_update('loginradius_extended_location_data', $user_id, $extended_location_data_values);
    }
  }

  // Insert extended profile data if option is selected.
  if (in_array('extended_profile_data', $lr_social_profile_data_profile_selection) && db_table_exists('loginradius_extended_profile_data')) {
    $extended_profile_data_values = lr_social_profile_data_get_extended_profile($user_id, $userprofile);

    if (!db_query('SELECT user_id FROM {loginradius_extended_profile_data} WHERE user_id = :id', array('id' => $user_id))->fetchField()) {
      lr_social_profile_data_insert('loginradius_extended_profile_data', $extended_profile_data_values);
    }
    else {
      lr_social_profile_data_update('loginradius_extended_profile_data', $user_id, $extended_profile_data_values);
    }

    // Positions.
    if (!empty($userprofile->Positions) && count($userprofile->Positions) > 0) {
      foreach ($userprofile->Positions as $lr_position) {

        // Companies.
        if (isset($lr_position->Company) && db_table_exists('loginradius_companies')) {
          $company_data_value = lr_social_profile_data_get_company($lr_position);
          $temp_id = lr_social_profile_data_insert('loginradius_companies', $company_data_value);
        }

        // Positions.
        $positions_data_value = lr_social_profile_data_get_position($user_id, $lr_position, $temp_id);
        lr_social_profile_data_insert('loginradius_positions', $positions_data_value);
      }
    }
    $userprofile_extended_keys = array(
      'Educations' => 'loginradius_education',
      'PhoneNumbers' => 'loginradius_phone_numbers',
      'IMAccounts' => 'loginradius_IMaccounts',
      'Addresses' => 'loginradius_addresses',
      'Sports' => 'loginradius_sports',
      'InspirationalPeople' => 'loginradius_inspirational_people',
      'Skills' => 'loginradius_skills',
      'CurrentStatus' => 'loginradius_current_status',
      'Certifications' => 'loginradius_certifications',
      'Courses' => 'loginradius_courses',
      'Volunteer' => 'loginradius_volunteer',
      'RecommendationsReceived' => 'loginradius_recommendations_received',
      'Languages' => 'loginradius_languages',
      'Patents' => 'loginradius_patents',
      'FavoriteThings' => 'loginradius_favorites',
      'Games' => 'loginradius_games',
      'TeleVisionShow' => 'loginradius_television_show',
      'Books' => 'loginradius_books',
      'Movies' => 'loginradius_movies',
    );

    foreach ($userprofile_extended_keys as $key => $userprofile_data_table) {
      if (!empty($userprofile->$key) && count($userprofile->$key) > 0 && db_table_exists($userprofile_data_table)) {
        lr_social_profile_data_save_premium_data($userprofile_data_table, $user_id, $userprofile->$key);
      }
    }
  }

  $lr_token = '';
  if (isset($userprofile->widget_token) && !empty($userprofile->widget_token)) {
    $lr_token = trim($userprofile->widget_token);
  }

  $provider_premium_data = array(
    'lr_contacts' => array(
      'twitter',
      'facebook',
      'linkedin',
      'google',
      'yahoo',
      'live',
    ),
    'facebook_profile_events' => array('facebook'),
    'facebook_posts' => array('facebook'),
    'followed_companies_on' => array('facebook', 'linkedin'),
    'status_message' => array('twitter', 'facebook', 'linkedin'),
    'twitter_mentions' => array('twitter'),
    'lr_groups' => array('facebook', 'linkedin'),
  );
  foreach ($provider_premium_data as $key => $value) {
    if (in_array($userprofile->Provider, $value) && in_array($key, $lr_social_profile_data_profile_selection)) {
      lr_social_profile_data_save_premium_data_by_provider($obj, $lr_token, $user_id, $key, $userprofile->Provider);
    }
  }
}

/**
 * Implementation of hook_form_BASE_FORM_ID_alter().
 *
 * @param array $form Nested array of form elements that comprise the form.
 * @param array $form_state A keyed array containing the current state of the form
 * @param string $form_id A unique string identifying the form
 */
function lr_social_profile_data_form_user_admin_account_alter(&$form, &$form_state, $form_id) {
  if (variable_get('lr_social_profile_data_show_profile') == 1) {
    drupal_add_library('system', 'ui.tabs');
    $options = array(
      'attributes' => array(
        'class' => 'lr_social_profile_data',
        'rel' => 'nofollow',
      ),
    );
    $options['attributes']['title'] = t('User Profile Data');
    $uid_column = array(
      'uid' => array(
        'data' => 'Profile Data',
        'field' => 'view',
      ),
    );
    $form['accounts']['#header'] = $form['accounts']['#header'] + $uid_column;

    foreach ($form['accounts']['#options'] as $key => $value) {
      // This will have all user profile object which can be used below instead of $key.
      $user_profile = user_load($key);
      $admin_access = 0;

      foreach ($user_profile->roles as $keyd => $value) {
        if (isset($value) && $value == 'administrator') {
          $admin_access = 1;
        }
      }

      if ($admin_access != 1) {
        $links = l(t('View'), 'lr_social_profile_data/ajax/userprofile/' . $user_profile->uid, $options);
        $form['accounts']['#options'][$key]['uid'] = $links;
      }
      else {
        $form['accounts']['#options'][$key]['uid'] = '';
      }
    }
  }
}

/**
 * check data variable is array of object.
 *
 * @param $value
 * @return bool
 */
function lr_social_profile_data_check_array_and_object($value) {
  if (!is_array($value) && !is_object($value)) {
    return TRUE;
  }
  return FALSE;
}

/**
 * Update data using hook add_existing_user_save.
 *
 * @param $userprofile
 * @param $account
 */
function lr_social_profile_data_add_existing_user_save($userprofile, $account) {
  if (variable_get('lr_social_login_update_profile') == 1) {
    lr_social_profile_data_save($account->uid, $userprofile);
  }
}

/**
 * Update user data using hook add_user_data_after_save.
 *
 * @param $account
 * @param $userprofile
 */
function lr_social_profile_data_add_user_data_after_save($account, $userprofile) {
  lr_social_profile_data_save($account->uid, $userprofile);
}
