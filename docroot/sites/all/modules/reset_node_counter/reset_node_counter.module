<?php

/**
 * @file reset_node_counter module
 */

/**
 * Implements hook_help().
 */
function reset_node_counter_help($path, $arg) {
  $output = '';  
  switch ($path) {
    case "admin/help#reset_node_counter_":
      $output = '<p>'.  t("Reset node counter") .'</p>';
      break;
  }
  return $output;
}

/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */
function reset_node_counter_form_node_form_alter(&$form, &$form_state, $form_id) {
  $form['options']['reset_node_counter'] = array(
    '#type' => 'checkbox',
    '#title' => t('Reset node counter'),
    '#default_value' => 0,
  );
  $form['actions']['submit']['#submit'][] = 'reset_node_counter_submit';
}

/**
 * Additional form submit function.
 */
function reset_node_counter_submit($form) {
  if ($form['options']['reset_node_counter']['#value']) {
    reset_node_counter_reset($form['nid']['#value']);   
  }
}

/**
 * Callback for resetting a counter for a node.
 *
 * @param int $nid 
 *   Node id of correspoding node.
 */
function reset_node_counter_reset($nid) {
  db_delete('node_counter')
    ->condition('nid', $nid)
    ->execute();
} 
