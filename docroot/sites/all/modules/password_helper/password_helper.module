<?php
/**
 * @file
 *
 * provides a javascript based password generator that helps to create a user password.
 *
 * @author Dennis BrÃ¼cke (blackice2999) | TWD - team:Werbedesign UG
 * @see http://drupal.org/user/413429
 * @see http://team-wd.de
 */

/**
 * Implementation of hook_element_info_alter()
 * insert form field processing function to add javascript library
 *
 * @param $type
 */
function password_helper_element_info_alter(&$type) {
  if (isset($type['password_confirm'])) {
    $type['password_confirm']['#process'][] = 'password_helper_password_confirm';
  }
}

/**
 * Field #process: password_confirm
 * adds the javascript settings and the easypassgen library
 *
 * @param $element
 * @return mixed
 */
function password_helper_password_confirm($element) {
  global $user;

  $js_settings = array(
    'password_helper' => array(
      'syllables' => 4,
      'numbers' => true,
      'specialchars' => true
    )
  );

  $element['#attached']['library'][] = array('password_helper', 'password_helper');
  // Ensure settings are only added once per page.
  static $already_added = FALSE;
  if (!$already_added) {
    $already_added = TRUE;
    $element['#attached']['js'][] = array('data' => $js_settings, 'type' => 'setting');
  }

  return $element;
}

/**
 * Implementation hook_library()
 * registers the module javascript / css an the easypassgen jquery plugin
 *
 * @return array
 */
function password_helper_library() {
  $libraries = array();
  $base_path = (module_exists('libraries')) ? libraries_get_path('jquery.easypassgen') : 'sites/all/libraries/jquery.easypassgen';

  $libraries['password_helper'] = array(
    'title' => 'Password helper',
    'website' => 'http://team-wd.de',
    'version' => '1.0.0',
    'js' => array(
      drupal_get_path('module', 'password_helper') . '/js/password_helper.d7.init.js' => array(),
    ),
    'css' => array(
      drupal_get_path('module', 'password_helper') . '/css/password_helper.css' => array(
        'type' => 'file',
        'media' => 'screen',
      ),
    ),
    'dependencies' => array(
      array('password_helper', 'jquery.easypassgen'),
    ),
  );

  $libraries['jquery.easypassgen'] = array(
    'title' => 'Easy Password Generator for jQuery v1.4.',
    'website' => 'http://code.google.com/p/jquery-easypassgen/',
    'version' => '1.0.0',
    'js' => array(
      $base_path . '/jquery.easypassgen.js' => array(),
    ),
  );

  return $libraries;
}