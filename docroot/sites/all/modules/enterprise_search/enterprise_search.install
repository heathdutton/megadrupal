<?php
/**
 * @file
 * Enterprise search install file.
 */

/**
 * Implements hook_uninstall().
 */
function enterprise_search_uninstall() {
  variable_del("a12_find_apachesolr_core");
  variable_del("a12_find_apachesolr_index");
}

/**
 * Implements hook_disable().
 *
 * Remove A12 Find server from the Solr config page.
 */
function enterprise_search_disable() {
  // Remove Find from the list of Apache Solr environments.
  $environments = apachesolr_load_all_environments();
  foreach ($environments as $environment) {
    if ($environment['env_id'] == "find") {
      apachesolr_environment_delete($environment['env_id']);
    }
  }
  $environments = apachesolr_load_all_environments();

  // Re-insert the default Apache Solr environment if there are no environments
  // left over. If there are no environments the Apache Solr module does some
  // strange things.
  if (empty($environments)) {
    db_insert('apachesolr_environment')->fields(array(
      'env_id' => 'solr',
      'name' => 'localhost server',
      'url' => 'http://localhost:8983/solr',
    ))->execute();
  }
}

/**
 * Implements hook_enable().
 */
function enterprise_search_enable() {
  enterprise_search_refresh_solr_settings();
  variable_set('search_active_modules', array('apachesolr_search' => 'apachesolr_search'));
  variable_set('search_default_module', 'apachesolr_search');
  drupal_set_message(t("Enterprise search set as default Solr server."));
}

/**
 * Implements hook_update_N().
 *
 * Refresh Solr settings. As the service class was changed the we need to
 * update the stored class name in the database.
 */
function enterprise_search_update_7001($node) {
  enterprise_search_refresh_solr_settings();
}
