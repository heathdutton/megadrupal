<?php

function entity_enqueue_entity($queue_name, $nid, $entity_type, $data = array()) {
  return _entity_enqueue_entity($queue_name, $nid, $entity_type, $data);
}

function entity_enqueue_file_fid($queue_name, $fid, $data = array()) {
  return _entity_enqueue_entity($queue_name, $fid, 'file', $data);
}

function entity_enqueue_node_nid($queue_name, $nid, $data = array()) {
  return _entity_enqueue_entity($queue_name, $nid, 'node', $data);
}

function entity_enqueue_user_uid($queue_name, $uid, $data = array()) {
  return _entity_enqueue_entity($queue_name, $uid, 'user', $data);
}

function entity_enqueue_enqueue_efq($queue_name, EntityFieldQuery $efq) {
  //@todo
}

function _entity_enqueue_entity($queue_name, $entity_id, $entity_type, $data = array()) {

  $queue = DrupalQueue::get($queue_name);
  $queue->createQueue();

  // Do it this way to ensure these keys never get overwritten by $data()
  $data['entity_id']   = $entity_id;
  $data['entity_type'] = $entity_type;

  $result_ok = $queue->createItem($data);

  if (drupal_is_cli()) {
    $dt_args = array(
      '@queue_name'  => $queue_name,
      '@entity_type' => $entity_type,
      '@entity_id'   => $entity_id,
    );
    if ($result_ok) {
      drush_log(dt('Entity \'@entity_type:@entity_id\' enqueued into \'@queue_name\'.', $dt_args), 'ok');
    } else {
      drush_log(dt('Failed enqueuing \'@entity_type:@entity_id\' into \'@queue_name\'.', $dt_args), 'error');
    }
  }
  
  return $result_ok;

}
