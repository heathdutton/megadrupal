<?php

/**
 * @file
 * Install, update, and uninstall functions for OKVideo.
 */

/**
 * Implements hook_uninstall().
 */
function okvideo_uninstall() {
  $variables = array(
    'okvideo_id',
    'okvideo_vol',
    'okvideo_loop',
    'okvideo_captions',
    'okvideo_annotations',
    'okvideo_autoplay',
    'okvideo_hd',
    'okvideo_adproof',
    'okvideo_debug',
  );
  foreach ($variables as $variable) {
    variable_del($variable);
  }
}

/**
 * Implements hook_requirements().
 */
function okvideo_requirements($phase) {
  $requirements = array();
  $t = get_t();
  switch ($phase) {
    case 'runtime':

      if (($library = libraries_detect('okvideo')) && !empty($library['installed'])) {

        $requirements['okvideo_version'] = array(
          'title' => $t('OKVideo'),
          'value' => $library['name'] . ' - v' . $library['version'],
          'description' => $t('To check for newer versions go to <a href="@vendor_url" target="_blank">@vendor_url</a>.', array('@vendor_url' => $library['vendor url'])),
          'severity' => REQUIREMENT_OK,
        );
      }
      else {
        $requirements['okvideo_library'] = array(
          'title' => $t('OKVideo'),
          'value' => '',
          'description' => $t('OKVideo plugin was not detected. Please follow the instructions on the <a href="!url" target="_blank">OKVideo project page</a> to install the OKVideo plugin.', array("!url" => url('https://www.drupal.org/sandbox/kyletaylored/2482929'))),
          'severity' => REQUIREMENT_ERROR,
        );
      }
      break;

    default:
      break;
  }

  return $requirements;
}
