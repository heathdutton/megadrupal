<?php
/**
 * Implements hook_init().
 */
function custom_mouse_pointer_init() {
  global $base_url;
  global $_file_public_path;  
  $_file_public_path = variable_get('file_public_path', conf_path() . '/files');
  drupal_add_css('.cursor_preview {
	width:25px;
	height:25px;
	padding-left:5px;
	margin-top:5px;
	}', 'inline');
  
switch(variable_get('custom_pointer', '0')) {

  case (1):
    drupal_add_css('body {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/arrow1.png), progress !important;}', 'inline');
    drupal_add_css('a:hover, label {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/arrow2.png), progress !important;}', 'inline'); 
  break;
  
  case (2):    
    drupal_add_css('body {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/drupal1.png), progress !important;}', 'inline');
    drupal_add_css('a:hover, label {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/drupal2.png), progress !important;}', 'inline'); 
  break;
  
  case (3):    
    drupal_add_css('body {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/space1.png), progress !important;}', 'inline');
    drupal_add_css('a:hover, label {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/space2.png), progress !important;}', 'inline'); 
  break;
  
  case (4):    
    drupal_add_css('body {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/start1.png), progress !important;}', 'inline');
    drupal_add_css('a:hover, label {cursor: url(' . $base_url . '/' . drupal_get_path('module', 'custom_mouse_pointer') . '/images/start2.png), progress !important;}', 'inline'); 
  break;
  
  case (5):  
    drupal_add_css('body {cursor: url(' . $base_url . '/' . $_file_public_path . '/cursor_active.png), progress !important;}', 'inline');
    drupal_add_css('a:hover, label {cursor: url(' . $base_url . '/' . $_file_public_path . '/cursor_notactive.png), progress !important;}', 'inline');
  break;
  
}
}
/**
 * Implements hook_form_alter().
 */
function custom_mouse_pointer_form_alter(&$form, &$form_state, $form_id) {
  global $_file_public_path;
  
  if (($form_id == 'system_theme_settings') && ($_GET['q'] == 'admin/appearance/settings')) {
  
  $active = array(
  
    0 => t('Default'),
  
    1 => theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/arrow1.png',
    'attributes' => array('class' => 'cursor_preview'))) . theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/arrow2.png',
    'attributes' => array('class' => 'cursor_preview'))),
  
    2 => theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/drupal1.png',
    'attributes' => array('class' => 'cursor_preview'))) . theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/drupal2.png',
    'attributes' => array('class' => 'cursor_preview'))),
  
    3 => theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/space1.png',
    'attributes' => array('class' => 'cursor_preview'))) . theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/space2.png',
    'attributes' => array('class' => 'cursor_preview'))),
  
    4 => theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/start1.png',
    'attributes' => array('class' => 'cursor_preview'))) . theme_image(array(
    'path' => drupal_get_path('module', 'custom_mouse_pointer') . '/images/start2.png',
    'attributes' => array('class' => 'cursor_preview'))),
  );
  
  if (file_exists ($_file_public_path . '/cursor_active.png') && file_exists($_file_public_path . '/cursor_notactive.png') ) {
  
  $active[5] = theme_image(array(
    'path' => $_file_public_path . '/cursor_active.png',
    'attributes' => array('class' => 'cursor_preview'))) . theme_image(array(
    'path' => $_file_public_path . '/cursor_notactive.png',
    'attributes' => array('class' => 'cursor_preview')));

  drupal_add_js('jQuery(document).ready(function () {	
	jQuery(".cursor_preview:last").after(" (uploaded by user)");	
	});', 'inline');

  }
  
  $form['cursor'] = array(
    '#type' => 'fieldset', 
    '#title' => t('Custom mouse pointer'),
  );
  
  $form['cursor']['active_cursor'] = array(
    '#type' => 'radios',
    '#default_value' => variable_get('custom_pointer', '0'),
    '#options' => $active,
    '#description' => t('Select mouse pointer view.'),
  );
  
  $form['cursor']['upload_active'] = array(
    '#name' => 'files[upload]',
    '#type' => 'file',
    '#title' => t('Upload your active mouse pointer *.cur or *.png'),
  );
  
  $form['cursor']['upload_notactive'] = array(
    '#name' => 'files[upload2]',
    '#type' => 'file',
    '#title' => t('Upload your not active mouse pointer *.cur or *.png'),
  );
  
  $form['#submit'][] = 'custom_mouse_pointer_form_submit';
  
  }  
  return $form;
}

/**
 * Submit function to save pointer settings.
 */
function custom_mouse_pointer_form_submit($form, &$form_state) {
  global $_file_public_path;

  if (isset($form['cursor']['active_cursor'])) {
    variable_set('custom_pointer', $form_state['input']['active_cursor']);
  }
  
  if (isset($form['cursor']['upload_active'])) {
    $validators = array('file_validate_extensions' => array('png cur'), 'file_validate_size' => array(1024 * 1024), );
    $file = file_save_upload('upload', $validators);
    @copy( $file->destination , $_file_public_path . '/cursor_active.png');
  }
  
  if (isset($form['cursor']['upload_notactive'])) {
    $validators = array('file_validate_extensions' => array('png cur'), 'file_validate_size' => array(1024 * 1024), );
    $file = file_save_upload('upload2', $validators);
    @copy( $file->destination , $_file_public_path . '/cursor_notactive.png');
  }  
}