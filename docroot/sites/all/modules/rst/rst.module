<?php

/**
 * @file
 * Provides a reStructuredText input filter.
 */

/**
 * Implements hook_help().
 */
function rst_help($path, $arg) {
  switch ($path) {
    case 'admin/help#rst':
      return t('<p>The reStructuredText filter allows you to enter content using <a href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>, a simple plain-text syntax that is transformed into valid XHTML.</p>');
  }
}

/**
 * Implements hook_filter_info().
 */
function rst_filter_info() {
  $filters['filter_rst'] = array(
    'title' => t('reStructuredText'),
    'description' => t('Allows content to be submitted using reStructuredText Text Format, a simple plain-text syntax that is filtered into valid XHTML.'),
    'process callback' => '_filter_rst',
    'settings callback' => '_filter_rst_settings',
    'tips callback'  => '_filter_rst_tips',
  );
  return $filters;
}

/**
 * Filter process callback.
 */
function _filter_rst($text, $format) {
  if (!empty($text)) {
    $parser = new Drupal\rst\Parser();
    $text = $parser->parse($text);
  }
  return $text;
}

/**
 * Filter tips callback.
 */
function _filter_rst_tips($format, $long = FALSE) {
  return l(t("reStructuredText Quick Reference"), "http://docutils.sourceforge.net/docs/user/rst/quickref.html");
}

/**
 * Filter settings callback.
 */
function _filter_rst_settings($form, &$form_state, $filter, $format, $defaults) {
  $settings['rst_wrapper'] = array(
    '#type' => 'fieldset',
    '#title' => t('ReSTructured Text'),
  );
  $links = array(
    '<a href="https://github.com/Gregwar/RST">https://github.com/Gregwar/RST</a>',
  );
  $settings['rst_wrapper']['rst_status'] = array(
    '#title' => t('Thanks'),
    '#type' => 'item',
    '#markup' => theme('item_list', array('items' => $links)),
  );
  return $settings;
}
