<?php

/**
 * @file
 * Allows any site owner to add multi-lingual feedback tab to any page in a
 * simple and easy way.
 */

/**
 * Implements hook_init().
 *
 * Adds javascript for the tab at the end of the page.
 */
function mlft_init() {
  $form_id = variable_get('mlft_form_id', '');
  $enabled = variable_get('mlft_enabled', 0);
  if (!empty($enabled) && !empty($form_id)) {
    drupal_add_js("var _ohtConfig = { debug : true, v : 0.1, mscp : ('https:' == document.location.protocol ? 'https://' : 'http://') + 'owsassets.onehourtranslation.com/build/0.1', services:{ mlft : { formid : $form_id, src : 'http://www.onehourtranslation.com' } } }; (function() { var oscr = document.createElement('script'); oscr.type = 'text/javascript'; oscr.async = true; oscr.src = _ohtConfig.mscp+'/all.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(oscr, s); })(); document.write('<a href=\"http://www.onehourtranslation.com/\" class=\"oht_ref\">Translation Services</a>');",
      array('type' => 'inline', 'scope' => 'footer'));
  }
}

/**
 * Implements hook_menu().
 */
function mlft_menu() {
  $items['admin/config/user-interface/mlft'] = array(
    'title' => 'Multi Lingual Feedback Tab settings',
    'description' => 'Settings for Multi Lingual Feedback Tab from www.onhourtranslation.com',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('mlft_admin_settings_form'),
    'access arguments' => array('administer mlft'),
  );

  return $items;
}

/**
 * Implements hook_permission().
 */
function mlft_permission() {
  return array(
    'administer mlft' => array(
      'title' => t('Administer Multi Lingual Feedback Tab'),
    ),
  );
}

/**
 * Callback for admin/config/user-interface/mlft.
 */
function mlft_admin_settings_form() {
  $form = array();

  $form['mlft_enabled'] = array(
    '#type' => 'checkbox',
    '#title' => t('Enable/Disable Multi Lingual feedback Tab'),
    '#default_value' => (int) variable_get('mlft_enabled', 0),
  );
  $form['mlft_form_id'] = array(
    '#type' => 'textfield',
    '#title' => t('Enter Form ID for MLFT'),
    '#description' => t("If you don't have FormID, you should create new feedback form on <a href='https://www.onehourtranslation.com/mlf' target='_blank'>www.onehourtranslation.com</a>."),
    '#default_value' => check_plain(variable_get('mlft_form_id', '')),
  );

  return system_settings_form($form);
}
