<?php

/**
 * @file
 * Component Installer Drupal module.
 */

/**
 * Implements hook_composer_json_alter().
 *
 * Registers the correct Component directory and Base URL.
 */
function component_installer_composer_json_alter(&$json) {
  $uri = 'public://component_installer';
  $json['config']['component-dir'] = drupal_realpath($uri);
  $json['config']['component-baseurl'] = file_create_url($uri);
}

/**
 * Implements hook_css_alter().
 *
 * Adds the require.css file to the page.
 */
function component_installer_css_alter(&$css) {
  $file = 'public://component_installer/require.css';
  $css[$file] = array(
    'weight' => 0,
    'group' => CSS_DEFAULT,
    'type' => 'file',
    'media' => 'all',
    'every_page' => TRUE,
    'preprocess' => TRUE,
    'data' => $file,
    'browsers' => array(
      'IE' => TRUE,
      '!IE' => TRUE,
    ),
  );
}

/**
 * Implements hook_js_alter().
 *
 * Adds the require.js file to the page.
 */
function component_installer_js_alter(&$javascript) {
  $file = 'public://component_installer/require.js';
  $javascript[$file] = drupal_js_defaults($file);
  // Make require.js the first file that's loaded.
  $javascript[$file]['weight'] = -10000;
  $javascript[$file]['group'] = JS_LIBRARY + JS_LIBRARY;
}

/**
 * Implements hook_library_alter().
 *
 * Make component_installer.js appear right after jQuery's inclusion.
 */
function component_installer_library_alter(&$libraries, $module) {
  if ($module == 'system') {
    $file = drupal_get_path('module', 'component_installer') . '/component_installer.js';
    $libraries['jquery']['js'][$file] = $libraries['jquery']['js']['misc/jquery.js'];
    $libraries['jquery']['js'][$file]['data'] = $file;
  }
}
