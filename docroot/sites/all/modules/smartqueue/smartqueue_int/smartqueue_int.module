<?php

/**
 * @file
 * SmartQueue Interactive module code.
 */

/**
 * Implements hook_menu().
 */
function smartqueue_int_menu() {
  $items['smartqueue-int/ajax/process'] = array(
    'title' => 'SmartQueue Interactive Process',
    'type' => MENU_CALLBACK,
    'page callback' => 'smartqueue_int_ajax_process',
    'access callback' => 'user_is_logged_in',
    'delivery callback' => 'drupal_json_output',
    'file' => 'smartqueue_int.ajax.inc',
  );

  return $items;
}

/**
 * Implements hook_page_build().
 */
function smartqueue_int_page_build(&$page) {

  // Attempt to process queued items for this user.
  $p = new SmartQueueInteractiveProcessor();
  $result = $p->process();

  // If there are still items remaining, setup JS to keep processing.
  if (!$result) {
    $js =  drupal_get_path('module', 'smartqueue_int') . '/smartqueue_int.js';
    $page['page_bottom']['smartqueue_int']['#attached']['js'][] = $js;
  }

}
