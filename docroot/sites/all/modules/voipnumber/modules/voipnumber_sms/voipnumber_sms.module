<?php

/**
 * Implementation of hook_get_voip_numbers().
 *
 * Returns numbers provided by SMS Framework module (http://drupal.org/project/smsframework)
 */
function voipnumber_sms_get_voip_numbers($id, $type) {
  $numbers = array();
  switch ($type) {
    case 'user':
      $account = user_load($id);
      if (isset($account->sms_user)) {
        $number = $account->sms_user[0]['number'];
        $name = 'SMS Framework (' . $number . ')';
        $voipnumber = new VoipNumber();
        $voipnumber->setNumber($number);
        $voipnumber->setType(VOIPNUMBER_SMS);
        $voipnumber->setName($name);
        $voipnumber->setUid($id);
        $numbers[] = $voipnumber;
      }
      return $numbers;
      break;

    case 'uids':
      $uids = array();
      $query = db_select('sms_user', 's')
        ->fields('s', array('uid'))
        ->condition('number' , $id)
        ->execute();
      while ($temp = $query->fetchAssoc()) {
        if ($temp['uid'] != "") {
          $uids[$temp['uid']] = $temp['uid'];
        }
      }
      return $uids;
      break;
  }
}
