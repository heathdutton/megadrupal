<?php

/**
 * Implements hook_enable().
 */
function paas_enable() {
  $cache_class_before_paas = variable_get('cache_default_class', 'DrupalDatabaseCache');
  variable_set('cache_class_before_paas', $cache_class_before_paas);
  variable_set('cache_default_class', 'PaasCache');
}

/**
 * Implements hook_disable().
 */
function paas_disable() {
  variable_set('cache_default_class', variable_get('cache_class_before_paas', 'DrupalDatabaseCache'));
}

/**
 * Implements hook_uninstall().
 */
function paas_uninstall() {
  variable_del('paas_secret');
  variable_del('paas_metrics');
}

/**
 * Implements hook_schema().
 */
function paas_schema() {
  $schema = array();
  
  if ($dh = opendir(dirname(__FILE__) . '/metrics')) {
    while (FALSE != ($file = readdir($dh))) {
      if (preg_match('/^(.*)\\.inc$/', $file, $match)) {
        include_once(dirname(__FILE__) . "/metrics/$file");
        $function = "paas_metric_{$match[1]}_schema";
        if (function_exists($function)) {
          $schema += $function();
        }
      }
    }
  }
  return $schema;
}
