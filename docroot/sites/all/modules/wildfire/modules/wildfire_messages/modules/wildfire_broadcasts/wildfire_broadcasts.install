<?php
/**
 * @file
 *  wildfire_broadcasts.install
 *
 * Installation functions for Wildfire Broadcasts
 *
 * @author Craig Jones <craig@tiger-fish.com>
 * @author Chris Cohen <chris.cohen@tiger-fish.com>
 */

/**
 * Implements hook_install().
 */
function wildfire_broadcasts_install() {

}

/**
 * Implements hook_uninstall().
 */
function wildfire_broadcasts_uninstall() {

}

/**
 * Implements hook_schema().
 */
function wildfire_broadcasts_schema() {
  /**
   * This should be representative of the NOW schema, not the START schema
   * See: http://drupal.org/node/146862
   *
   * It is expected that the hook_update_X() functions will update existing
   * installations to match this schema, they aren't incremental updates
   * from this schema
   */
  $schema = array();
  $t = get_t();

  $schema['wildfire_broadcasts'] = array(
    'description' => $t('A list of broadcasts.'),
    'fields' => array(
      'mid' => array(
        'type' => 'serial',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'description' => $t('The auto-incrementing message ID.'),
      ),
      'name' => array(
        'type' => 'varchar',
        'length' => 128,
        'not null' => TRUE,
        'default' => 'New broadcast',
        'description' => $t('The human-readable name of the broadcast.'),
      ),
      'created' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
        'description' => $t('UNIX timestamp when the broadcast was created.'),
      ),
      'lastsent' => array(
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
        'description' => $t('UNIX timestamp when the broadcast was last sent.'),
      ),
      'subject' => array(
        'type' => 'varchar',
        'length' => 128,
        'not null' => TRUE,
        'default' => '',
        'description' => $t('The subject of the email.'),
      ),
      'template' => array(
        'type' => 'varchar',
        'length' => 128,
        'not null' => TRUE,
        'default' => '',
        'description' => $t('The template to use when sending.'),
      ),
      'from_name' => array(
        'type' => 'varchar',
        'description' => $t('The name of the broadcast sender.'),
        'not null' => TRUE,
        'length' => 95,
        'default' => 'Wildfire',
      ),
      'from_email' => array(
        'type' => 'varchar',
        'description' => $t('The email of the broadcast sender.'),
        'not null' => TRUE,
        'length' => 160,
        'default' => '',
      ),
      'reply_name' => array(
        'type' => 'varchar',
        'description' => $t('The name of the person to act as a reply-to.'),
        'not null' => TRUE,
        'length' => 128,
        'default' => 'Wildfire',
      ),
      'reply_email' => array(
        'type' => 'varchar',
        'description' => $t('The email address of the person to act as a reply-to.'),
        'not null' => TRUE,
        'length' => 128,
        'default' => '',
      ),
    ),
    'primary key' => array('mid'),
  );

  return $schema;

}

/**
 * Remove "editors_note" field that should have gone away a long time ago
 */
function wildfire_broadcasts_update_7201() {

  db_drop_field('wildfire_broadcasts', 'editors_note');

}
