<?php

/**
 * @file
 * archibald_help module install file.
 */

/**
 * Implements hook_install().
 *
 * Because this is a new module in D7, hook_update_N() doesn't help D6
 * users who upgrade to run the migration path. So, we try that here as
 * the module is being installed.
 */
function archibald_stats_install() {
    $query = db_select('role', 'r');
    $query->fields('r', array('rid', 'name'));
    $query->condition('r.name', array('archibald editor', 'archibald publisher'), 'IN');
    $result = $query->execute();

    $roles = array();
    foreach ($result as $row) {
        $roles[$row->name] = $row->rid;
    }

    user_role_grant_permissions($roles['archibald editor'], array('view archibald stats'));
    user_role_grant_permissions($roles['archibald publisher'], array('view archibald stats'));

    // Give right to edit right licenses to Administrators
    $vocabulary_name = '';
    $result = db_query("SELECT vid FROM {taxonomy_vocabulary} WHERE machine_name = 'rights_licenses'");
    $rec = $result->fetchAssoc();
    if ( $rec ) {
        user_role_grant_permissions(3, array('edit terms in ' . $rec['vid'], 'delete terms in ' . $rec['vid']));
    }

}