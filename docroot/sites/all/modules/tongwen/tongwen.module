<?php
/**
 * Implements hook_init().
 */
function tongwen_init(){
  global $base_url,$base_path,$language;
  $path = drupal_get_path('module','tongwen')."/";
  $libs_path = drupal_get_path('module','tongwen')."/libs/";
  drupal_add_library('system', 'jquery.cookie');
  drupal_add_js($libs_path."tongwen_core.js");
  drupal_add_js($libs_path."tongwen_table_t2s.js");
  drupal_add_js($libs_path."tongwen_table_s2t.js");
  drupal_add_js($path."tongwen.js");
  
  $lang = $language->language;
  switch($language) {
    case 'zh-hant':
      $lang = 'zh-TW';
      break;
    case 'zh-hans':
      $lang = 'zh-CN';
      break;
  }
  drupal_add_js(array('tongwen' => array('language' => $lang)), 'setting');
}

/**
 * Implements hook_library().
 */
function tongwen_library() {
  $libraries = array();

  $libs = libraries_get_libraries();

  if (array_key_exists('jquery.cookie', $libs)) {
    $path = $libs['jquery.cookie'];

    $libraries['cookie'] = array(
      'title' => 'jQuery Cookie',
      'website' => 'https://github.com/carhartl/jquery-cookie/',
      'version' => '1.4.1',
      'js' => array($path . '/jquery.cookie.min.js' => array())
    );
  }

  return $libraries;
}

/**
 * Implements hook_block_info().
 */
function tongwen_block_info() {
  $blocks['switch_links'] = array(
    'info' => t('TongWen: Switch between Traditional and Simplified Chinese.'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function tongwen_block_view($delta = 'switch_links') {
  $block = array();

  switch ($delta) {
    case 'switch_links':
      $block['subject'] = t('Switch Chinese');
      $block['content'] = tongwen_item();
      break;
  }

  return $block;
}

function tongwen_item(){
  $items['tongwen_s2t'] = array(
    'title' => '繁體中文',
    'href' => $_GET['q'],
    'fragment' => 'traditional-chinese',
    'query' => drupal_get_query_parameters(),
  );
  $items['tongwen_t2s'] = array(
    'title' => '簡體中文',
    'href' => $_GET['q'],
    'fragment' => 'simplify-chinese',
    'query' => drupal_get_query_parameters(),
  );

  return theme('links', array('links' => $items));
}

