<?php

/**
 * @file
 * OpenTags module file.
 */

/**
 * The OpenTags module path.
 */
define('OPENTAGS_MODULE_PATH', drupal_get_path('module', 'opentags'));

/**
 * Implements hook_help().
 */
function opentags_help($path, $arg) {
  switch ($path) {
    case 'admin/help#opentags':
      $output = '';
      $output .= '<p>' . t('OpenTags is a submodule of <a href="@metatag">
        Metatag</a> module. Therefore, it utilises all the features of Metatag
        module.',
        array('@metatag' => 'https://www.drupal.org/project/metatag')) . '</p>';
      $output .= '<p>' . t('To add OpenTags metadata, go to "Meta tags" tab at
        bottom of the content editing page. Then expand "OpenTags" tab.') . '</p>';
      $output .= '<p>' . t('The OpenTags module provides two types of widget:') . '</p>';
      $output .= '<ul>';
      $output .= '<li>' . t('Drop down list. This widget is used for single
        value metadata.') . '</li>';
      $output .= '<li>' . t('Auto combo widget. This widget is similar to a
        combination of auto complete widget and drop down list widget.
        It allows you to select values from a list as well as auto complete
        as you type.');
      $output .= '<ul>';
      $output .= '<li>' . t('Click "Browse", single click on the element to
        expand sub categories terms and double click to select the term. Some
        element may not be selectable (Dark grey background), as they are only
        used for categorisation purposes.') . '</li>';
      $output .= '<li>' . t('Type the term value in the text box, the auto
        complete feature will list suggested terms based on the value you typed.
        The suggest list will also show the categories of the terms if the terms
        have a multi-level hierarchy. Select the value from the suggest list or
        type in the full term and press Enter key.') . '</li>';
      $output .= '<li>' . t('To delete a term, click the delete button (X) on
        the term tag.') . '</li>';
      $output .= '</ul></li>';
      $output .= '</ul>';
      $output .= '<p>' . t('To apply default metadata settings, go to page
        <a href="@configure">admin/config/search/metatags</a>. Please check the
        <a href="@metatag">Metatag</a> module documentation for more details.',
        array(
          '@configure' => url('admin/config/search/metatags'),
          '@metatag' => 'https://www.drupal.org/project/metatag',
        )) . '</p>';
      return $output;
  }
}

/**
 * Implements hook_ctools_plugin_api().
 */
function opentags_ctools_plugin_api($owner, $api) {
  if ($owner == 'metatag' && $api == 'metatag') {
    return array('version' => 1);
  }
}

/**
 * Implements hook_menu().
 */
function opentags_menu() {
  // Create get terms data service page. This page will accept vocabulary name
  // as the query string and return the JSON object of the terms, which can be
  // used to feed OpenTags widgets.
  $items['opentags/services/get-terms-data'] = array(
    'title' => 'Get Terms',
    'page callback' => 'opentags_service_get_terms_data',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
    'file' => 'opentags.services.inc',
  );

  // This page is used to active the Batch API to create related taxonomy terms.
  $items['opentags/create-taxonomy'] = array(
    'title' => 'Create OpenTags Taxonomy',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('opentags_batch_create_taxonomy_form'),
    'access arguments' => array('administer modules'),
    'theme callback' => 'variable_get',
    'theme arguments' => array('admin_theme'),
    'type' => MENU_CALLBACK,
    'file' => 'opentags.batch.inc',
  );
  return $items;
}
