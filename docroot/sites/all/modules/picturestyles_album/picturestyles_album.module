<?php

/**
 * @file
 * Album Picture style
 *
 * Module file for the Album picture style. This allows users to format
 * images in a manner similar to what people see in their facebook
 * picture albums.
 *
 * Currently this module only uses the first three images on an
 * image field. Additional images and layouts are planned if our
 * team can get the appropriate user stories in a sprint. Or,
 * alternatively, someone like you decides to contribute!
 * 
 */

//field formatter include needed globally
module_load_include('inc', 'picturestyles_album', 'picturestyles_album.field');


function picturestyles_album_help($path, $arg) {
  switch ($path) {
   case 'admin/help#picturestyles_album':
     $output = '';
     $output .= '<h3>' . t('Album Picture Style') . '</h3>';
     $output .= '<p>' . t('Module file for the Album picture style. This allows
                          users to format images in a manner similar to what people
                          see in their facebook picture albums.') . '</p>';     
     $output .= '<p>' . t("Currently this module only uses the first three
                          images on an image field. Additional images and
                          layouts are planned if our team can get the appropriate
                          user stories in a sprint. Or, alternatively, someone
                          like you decides to contribute!") . '<p>';
    return $output;
   }
}


/**
  * This is the theme function that specifies the template file.
  * 'render element' is important because it's different for
  * fields (uses 'element')
  *
  * You can take the template and CSS and put it inside your
  * own theme to make customizations.
 */

function picturestyles_album_theme($existing, $type, $theme, $path) {
  return array(
    'album' => array(
      'render element' => 'element',
      'path' => drupal_get_path('module', 'picturestyles_album'),
      'template' => 'album'
      ),
    );
}

/**
 * The preprocess function assembles the three images as a combined
 * set of markup.
 */

function picturestyles_album_preprocess_album(&$variables) {
  drupal_add_css(drupal_get_path('module', 'picturestyles_album') . '/album.css');

  if (isset($variables['element']['#images'])) {

    foreach ($variables['element']['#images'] as $delta => $image) {

        $params = array(
          'style_name' => $image['#image_style'],
          'path' => $image['#item']['uri'],
          'alt' => $image['#item']['alt'],
          'title' => $image['#item']['title'],
          //create a class with same name as image style
          'attributes' => array(
                                'class' =>  $image['#image_style'],
                                ),

        );

      $variables['images'][$delta] = theme('image_style', $params);
    }
  }

}


function picturestyles_album_image_default_styles() {

  $file = module_load_include('inc', 'picturestyles_album', 'picturestyles_album.styles');
  $styles = _picturestyles_album_image_default_styles();
  
  return $styles;
  
}
