<?php

/**
 * @file
 * Creates the main pages for this module only admin side.
 */

/**
 * Implements hook_menu().
 */
function dbtables_menu() {
  $items['admin/content/dbtables'] = array(
    'title' => 'DBTables',
    'description' => 'DBTables',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('dbtables_options_form'),
    'access arguments' => array('administer dbtables'),
    'file' => 'includes/dbtables.form.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  $items['admin/content/dbtables/%dbtable/view'] = array(
    'title' => 'DBTables View',
    'description' => 'DBTables View',
    'page callback' => '_dbtables_get_theme_page',
    'page arguments' => array('dbtables_view', 3),
    'access arguments' => array('administer dbtables'),
    'type' => MENU_NORMAL_ITEM,
  );

  $items['admin/content/dbtables/%dbtable/info'] = array(
    'title' => 'DBTables Info',
    'description' => 'DBTables Info',
    'page callback' => '_dbtables_get_theme_page',
    'page arguments' => array('dbtables_info', 3),
    'access arguments' => array('administer dbtables'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Implements hook_theme().
 */
function dbtables_theme($existing, $type, $theme, $path) {
  $defaults = array(
    'file' => 'dbtables.theme.inc',
  );

  return array(
    'dbtables_view' => array(
      'variables' => array('dbtable' => NULL),
      'template' => 'themes/dbtables-view',
    ) + $defaults,
    'dbtables_info' => array(
      'variables' => array('dbtable' => NULL),
      'template' => 'themes/dbtables-info',
    ) + $defaults,
    'dbtables_tabs' => array(
      'variables' => array('tab' => 0),
      'template' => 'themes/dbtables-tabs',
    ) + $defaults,
  );
}

/**
 * Returns dbtables_view or dbtables_info theme.
 *
 * @param string $theme
 *   Name of a specific theme.
 * @param array|null $dbtable
 *   Data of a specific table.
 *
 * @return string
 *   An HTML string representing the themed output.
 */
function _dbtables_get_theme_page($theme, $dbtable) {
  $variables = array('dbtable' => $dbtable);
  return theme($theme, $variables);
}

/**
 * Defines dbtable as a Wildcard.
 *
 * @param string $dbtable
 *   The table name that has to be loaded.
 *
 * @return array|null
 *   It returns the schema of a specific table if it exists, otherwise NULL.
 */
function dbtable_load($dbtable) {
  $schema = drupal_get_schema();
  return (isset($schema[$dbtable])) ? $schema[$dbtable] : NULL;
}

/**
 * Implements hook_perm().
 */
function dbtables_perm() {
  $perms = array('administer dbtables');

  return $perms;
}
