<?php

/**
 * Implements hook_menu().
 */
function tracekit_menu() {
  $items = array();

  $items['admin/reports/tracekit/details/%'] = array(
    'title' => 'TraceKit report details',
    'description' => 'Shows a single TraceKit report.',
    'page callback' => 'tracekit_report_details',
    'page arguments' => array(4),
    'access arguments' => array('view tracekit reports'),
    'file' => 'tracekit.admin.inc',
  );

  $items['tracekit/collect'] = array(
    'title' => 'Collect TraceKit reports',
    'description' => 'Endpoint for TraceKit report subscribers.',
    'page callback' => 'tracekit_collect',
    'access arguments' => array('collect tracekit reports'),
    'file' => 'tracekit.pages.inc',
    'type' => MENU_CALLBACK
  );

  return $items;
}

/**
 * Implements hook_permission().
 */
function tracekit_permission() {
  return array(
    'collect tracekit reports' => array(
      'title' => t('Collect TraceKit reports'),
      'description' => t('Send TraceKit reports from the client to the server.'),
      'restrict access' => TRUE,
    ),
    'view tracekit reports' => array(
      'title' => t('View TraceKit reports'),
      'description' => t('View collected TraceKit reports.'),
      'restrict access' => TRUE,
    ),
  );
}

/**
 * Implements hook_cron().
 */
function tracekit_cron() {
  db_delete('tracekit_report')
    ->condition('created', strtotime("-30 days"), '<')
    ->execute();
}

/**
 * Implement hook_views_api().
 */
function tracekit_views_api() {
  return array(
    'api' => 3.0,
    'path' => drupal_get_path('module', 'tracekit') .'/views'
  );
}
