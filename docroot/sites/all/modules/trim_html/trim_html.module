<?php

/**
 * @file
 * Trim HTML module.
 *
 * Getting rid of trailing HTML "whitespaces" (e.g. <p> </p>) using a text
 * filter.
 *
 * This is useful when using a WYISIWYG editor for instance.
 */

/**
 * Implements hook_filter_info().
 */
function trim_html_filter_info() {
  $filters = array();
  $filters['trim_html'] = array(
    'title' => t('Trim html'),
    'process callback' => '_trim_html_process',
    'tips callback' => '_trim_html_tips',
  );
  return $filters;
}

/**
 * Tips callback.
 */
function _trim_html_tips($filter, $format, $long) {
  return t('Trailing html "whitespaces" (e.g. &lt;p>&lt;/p>) are removed.');
}

/**
 * Text filter process callback.
 */
function _trim_html_process($text, $filter, $format, $langcode, $cache, $cache_id) {
  // Remove all <br/> and empty (i.e. containing only whitespace or &nbsp;)
  // <p> tags from the end of $text.
  $pattern = '/((\s*<\s*p\s*>(&nbsp;|\s)*<\s*\/p\s*>\s*)|(\s*<\s*br\s*\/\s*>\s*))*$/';
  return preg_replace($pattern, '', $text);
}
