<?php

/**
 * @file
 * Language checker.
 */

/**
 * Implements hook_permission().
 */
function langcheck_permission() {
  return array(
    'administer language checker' => array(
      'title' => t('Administer language checker'),
    ),
    'start a new language check' => array(
      'title' => t('Start a new language check'),
    ),
    'access language check results' => array(
      'title' => t('Access language check results'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function langcheck_menu() {
  $items = array();
  $items['admin/config/development/langcheck'] = array(
    'title' => 'Language checker',
    'description' => 'Administration interface for language checker',
    'access arguments' => array('administer language checker'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('langcheck_settings_form'),
    'file' => 'langcheck.form.settings.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  $items['admin/reports/langcheck'] = array(
    'title' => 'Language checker',
    'description' => 'Display result',
    'page callback' => 'langcheck_check_batch_result_page',
    'access arguments' => array('access language check results'),
    'file' => 'langcheck.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  $items['admin/reports/langcheck/start-instant'] = array(
    'title' => 'Language checker - instant',
    'description' => 'Check all installed modules for translation percentage. One step process. (Resource hungry)',
    'page callback' => 'langcheck_check_instant_start',
    'access arguments' => array('start a new language check'),
    'type' => MENU_CALLBACK,
    'file' => 'langcheck.inc',
  );
  $items['admin/reports/langcheck/start-batch'] = array(
    'title' => 'Language checker - batch',
    'description' => 'Check all installed modules for translation percentage. Batch process',
    'page callback' => 'langcheck_check_batch_start',
    'access arguments' => array('start a new language check'),
    'type' => MENU_CALLBACK,
    'file' => 'langcheck.inc',
  );
  return $items;
}

/**
 * Implements hook_theme().
 */
function langcheck_theme() {
  return array(
    'langcheck_check_batch_result' => array(
      'variables' => array(
        'time_start' => NULL,
        'time_end' => NULL,
        'count_languages' => NULL,
        'count_modules' => NULL,
        'sum_languages' => NULL,
        'sum_modules' => NULL,
        'data_module' => NULL,
        'language_names' => NULL,
        'excluded_modules' => NULL,
      ),
      'file' => 'langcheck.theme.inc',
    ),
  );
}

/**
 * Default settings: 3 languages and 10 files in one go, with no exclusions.
 */
function _langcheck_default_values($key) {
  switch ($key) {
    case 'langcheck_settings':
      return array(
        'check_batch' => array(
          'num_of_langs' => 3,
          'num_of_files' => 10,
          'exclusions' => array(),
        ),
      );
    default:
      throw new Exception("Unknown key: {$key}");
  }
}
