<?php

/**
 * @file
 * Module file for "Cricket Score Widget".
 */

/**
 * Implements hook_block_info().
 *
 * Provides one block named 'Cricket Score Widget' that is globally cached.
 */
function cricket_score_widget_block_info() {
  $blocks['cricketscore'] = array(
    'info' => t('Cricket Score Widget'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 *
 * Renders a HTML-span containing the cricket score information.
 */
function cricket_score_widget_block_view($delta = '') {
  $block = array();
  switch ($delta) {
    case 'cricketscore':
      $width = variable_get('cricket_score_widget_width', 300);
      $height = variable_get('cricket_score_widget_height', 250);
      $output = '<object height="' . $height . '" width="' . $width . '"><param value="http://static.cricinfo.com/db/SUPPORT/ADVERTS/TESTING/WIDGETS/stat_cric/300x250_APR/liveScores.swf" name="movie"><embed height="' . $height . '" width="' . $width . '" src="http://static.cricinfo.com/db/SUPPORT/ADVERTS/TESTING/WIDGETS/stat_cric/300x250_APR/liveScores.swf"></object>';
      // Create the block.
      $block['subject'] = t('Cricket Score');
      $block['content'] = $output;
      break;
  }
  return $block;
}

/**
 * Implements hook_block_configure().
 *
 * Creates the form data to set the width and height of widget.
 */
function cricket_score_widget_block_configure($delta = '') {
  $form = array();
  if ($delta == 'cricketscore') {

    // Plain text field for the width of the widget.
    $width = variable_get('cricket_score_widget_width', 300);
    $form['cricket_score_block_width'] = array(
      '#type' => 'textfield',
      '#title' => t('Width'),
      '#size' => 4,
      '#description' => t('Width of the Widget in Pixel. Minimium value is 210'),
      '#default_value' => $width,
    );

    // Plain text field for the height of the widget.
    $height = variable_get('cricket_score_widget_height', 250);
    $form['cricket_score_block_height'] = array(
      '#type' => 'textfield',
      '#title' => t('Height'),
      '#size' => 4,
      '#description' => t('Height of the Widget in Pixel. Minimium value is 175'),
      '#default_value' => $height,
    );
  }
  return $form;
}

/**
 * Implements hook_block_save().
 *
 * Stores the width and height of the widget.
 */
function cricket_score_widget_block_save($delta = '', $edit = array()) {
  if ($delta == 'cricketscore') {
    $width = intval($edit['cricket_score_block_width']);
    $height = intval($edit['cricket_score_block_height']);
    if ($width < 210) {
      $width = 210;
    }
    if ($height < 175) {
      $height = 175;
    }
    variable_set('cricket_score_widget_width', $width);
    variable_set('cricket_score_widget_height', $height);
  }
}