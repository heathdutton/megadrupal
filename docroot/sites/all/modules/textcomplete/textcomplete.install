<?php

/**
 * @file
 * Requirements for the textcomplete module.
 */

/**
 * Implements hook_requirements().
 */
function textcomplete_requirements($phase) {
  $requirements = array();
  $t = get_t();
  // Check on the installation status of the geocomplete library. Note that
  // we do not do this check during the 'install' phase as the libraries API
  // functions will not always be available then (if installing Drupal via an
  // install profile, etc.).
  if ($phase == 'runtime') {
    $library = libraries_detect('textcomplete');
    $requirements['textcomplete'] = array(
      'title' => $t('Autocomplete for Textarea library'),
    );
    if ($library['installed']) {
      $requirements['textcomplete']['value'] = $library['version'];
      $requirements['textcomplete']['severity'] = REQUIREMENT_OK;
    }
    else {
      $requirements['textcomplete']['value'] = $library['error'];
      $requirements['textcomplete']['description'] = $library['error message'];
      $requirements['textcomplete']['severity'] = REQUIREMENT_ERROR;
    }

    // Check if the site is running >= jQuery 1.7
    if (($library = drupal_get_library('system', 'jquery')) && $library['version'] >= 1.7) {
      $requirements['textcomplete_jquery'] = array(
        'title' => t('Textcomplete jQuery version'),
        'value' => t('jQuery @version', array('@version' => $library['version'])),
        'severity' => REQUIREMENT_OK,
      );
    }
    else {
      $destination = drupal_get_destination();
      $requirements['textcomplete_jquery'] = array(
        'title' => t('Textcomplete jQuery version'),
        'value' => t('jQuery @version', array('@version' => $library['version'])),
        'description' => t('Textcomplete requires jQuery 1.7 or greater. Configure <a href="@jquery_update">jQuery Update</a>.', array('@jquery_update' => url('admin/config/development/jquery_update', array('query' => $destination)))),
        'severity' => REQUIREMENT_ERROR,
      );
    }

  }
  return $requirements;
}
