<?php

/**
 * @file
 * This is the file description for Comment Stats module.
 *
 * This module powers comment reports and functionality. Comment Stats provides
 * a deep view to comment analysis.
 */

/**
 * Implements hook_menu().
 */
function comment_stats_menu() {
  $items['admin/content/commentstats'] = array(
    'title' => 'Comment Stats',
    'description' => "Manage your comments stats.",
    'page callback' => 'comment_stats_admin_overview',
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for comment stats'),
    'type' => MENU_LOCAL_TASK,
    'file' => 'comment_stats_admin_overview.inc',
  );
  $items['admin/content/commentstats/dashboard'] = array(
    'title' => 'Comment Stats Dashboard',
    'description' => "Comments stats dashboard",
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => -10,
  );
  $items['admin/content/commentstats/config'] = array(
    'title' => 'Comment Stats Configuration',
    'description' => "Comment stats configuration",
    'page callback' => 'drupal_get_form',
    'page arguments' => array('comment_stats_admin_config_form'),
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for comment stats configurations'),
    'type' => MENU_LOCAL_TASK | MENU_NORMAL_ITEM,
    'file' => 'comment_stats.admin.inc',
  );
  $items['admin/content/commentstats/users/%'] = array(
    'title' => 'Users: Comment Stats',
    'description' => "Users details involved in discussion",
    'page callback' => 'comment_stats_admin_overview_users',
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for user details in comment stats'),
    'type' => MENU_CALLBACK,
    'file' => 'comment_stats_admin_overview.inc',
  );
  $items['admin/content/commentstats/posts/%'] = array(
    'title' => 'Posts: Comment Stats',
    'description' => "Posts details involved in discussion",
    'page callback' => 'comment_stats_admin_overview_posts',
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for posts in comment stats'),
    'type' => MENU_CALLBACK,
    'file' => 'comment_stats_admin_overview.inc',
  );
  $items['admin/content/commentstats/replies/%'] = array(
    'title' => 'Replies: Comment Stats',
    'description' => "Replies details involved in discussion",
    'page callback' => 'comment_stats_admin_overview_replies',
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for replies in comment stats'),
    'type' => MENU_CALLBACK,
    'file' => 'comment_stats_admin_overview.inc',
  );
  $items['admin/content/commentstats/unapproved/%'] = array(
    'title' => 'Unapproved Comments: Comment Stats',
    'description' => "Unapproved comments involved in discussion",
    'page callback' => 'comment_stats_admin_overview_unapproved',
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for unapproved comments in comment stats'),
    'type' => MENU_CALLBACK,
    'file' => 'comment_stats_admin_overview.inc',
  );
  $items['admin/content/commentstats/comments/view/%/%'] = array(
    'title' => 'Comments View: Comment Stats',
    'description' => "Userwise comments view",
    'page callback' => 'comment_stats_admin_overview_comments',
    'access callback' => 'comment_stats_access',
    'access arguments' => array('access for viewing comments'),
    'type' => MENU_CALLBACK,
    'file' => 'comment_stats_admin_overview.inc',
  );

  return $items;
}

/**
 * Implements hook_permission().
 */
function comment_stats_permission() {

  return array(
    'access for comment stats' => array(
      'title' => t('Provide access for display comment stats dashboard'),
      'description' => t('Provide access for display comment stats dashboard'),
    ),
    'access for comment stats configurations' => array(
      'title' => t('Provide access for comment stats configuration'),
      'description' => t('Provide access for comment stats configuration'),
    ),
    'access for user details in comment stats' => array(
      'title' => t('Provide access to view user details in comment stats'),
      'description' => t('Provide access to view user details in comment stats'),
    ),
    'access for posts in comment stats' => array(
      'title' => t('Provide access for viewing posts in comment stats'),
      'description' => t('Provide access for viewing posts in comment stats'),
    ),
    'access for replies in comment stats' => array(
      'title' => t('Provide access for viewing replies in comment stats'),
      'description' => t('Provide access for viewing replies in comment stats'),
    ),
    'access for unapproved comments in comment stats' => array(
      'title' => t('Provide access for viewing unapproved comments in comment stats'),
      'description' => t('Provide access for viewing unapproved comments in comment stats'),
    ),
    'access for viewing comments' => array(
      'title' => t('Provide access for viewing comments'),
      'description' => t('Provide access for viewing comments'),
    ),
  );

}

/**
 * Implements hook_theme().
 */
function comment_stats_theme() {
  return array(
    'comment_stats_admin_overview_comments' => array(
      'template' => 'templates/user-comments-view',
    ),
  );
}

/**
 * Implements hook_access().
 */
function comment_stats_access($string, $account = NULL) {
  global $user;
  if (!isset($account)) {
    $account = $user;
  }
  // User #1 has all privileges:
  if ($account->uid == 1) {
    return TRUE;
  }
  static $drupal_static_fast;
  if (!isset($drupal_static_fast)) {
    $drupal_static_fast['perm'] = &drupal_static(__FUNCTION__);
  }
  $perm = &$drupal_static_fast['perm'];
  if (!isset($perm[$account->uid])) {
    $role_permissions = user_role_permissions($account->roles);

    $perms = array();
    foreach ($role_permissions as $one_role) {
      $perms += $one_role;
    }
    $perm[$account->uid] = $perms;
  }

  return isset($perm[$account->uid][$string]);
}

/**
 * Builds breadcrumbs.
 */
function comment_stats_build_breadcrumbs() {
  $breadcrumb = array();
  $breadcrumb[] = l(t('Home'), '<front>');
  $breadcrumb[] = l(t('Administration'), 'admin');
  $breadcrumb[] = l(t('Comment Stats'), 'admin/content/commentstats');
  drupal_set_breadcrumb($breadcrumb);
}
