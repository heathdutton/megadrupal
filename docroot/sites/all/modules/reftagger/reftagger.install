<?php

/**
 * @file
 * Install, update and uninstall functions for the reftagger module.
 *
 */

/**
 * Implementation of hook_uninstall().
 */
function reftagger_uninstall() {
  $names = db_query(
    "SELECT name FROM {variable} WHERE name LIKE :pattern",
    array(':pattern' => db_like('reftagger_') . '%'))
  ->fetchCol();

  array_map('variable_del', $names);
}

/**
 * Remove deprecated variables used in old version.
 */
function reftagger_update_7200(&$sandbox) {
  $names = array(
    'reftagger_cp_versions',
    'reftagger_cp_template',
    'reftagger_cachejs',
    'reftagger_last_cachejs',
    'reftagger_css_override',
    'reftagger_libronix_bible_version',
  );
  array_map('variable_del', $names);

  $to_migrate = array(
    'reftagger_libronix_icon_link' => 'reftagger_logos_icon_link',
    'reftagger_libronix_icon_add' => 'reftagger_logos_icon_add',
  );
  foreach ($to_migrate as $old => $new) {
    $value = variable_get($old);
    if (isset($value)) {
      variable_set($new, $value);
    }
  }

  // The icon type's value should be changed to 'dark' for 0 and 'light' for 1.
  $icon_type = variable_get('reftagger_libronix_icon_type');
  if (isset($icon_type)) {
    variable_set('reftagger_logos_icon_type', $icon_type == 0 ? 'dark' : 'light');
  }
}
