<?php

/**
 * @file
 * This is a module file implements Trigger & Action to revert
 * an existing node to original copy.
 */

/**
 * Implements hook_action_info().
 */
function live_revision_action_info() {
  return array(
    'live_revision_revert_original_node_action' => array(
      'type' => 'node',
      'label' => t('Action-to-revert-node:'),
      'configurable' => FALSE,
      'triggers' => array('node_update', 'node_presave'),
    ),
  );
}

/**
 * Action call-back to execute for the node-update trigger.
 */
function live_revision_revert_original_node_action($node, $context) {
  $options = variable_get('node_options_' . $node->type);
  if (in_array('revert_original_node', $options)) { 
    // Below condition ensures to revert a node to orignal
    // version during update of an existing node.
    // Updated version will not be published until and unless
    // it's revert back to any version.
    if (!$node->is_new && $node->original->vid == $node->old_vid) {
      node_save($node->original);
    }
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function live_revision_form_node_type_form_alter(&$form, &$form_state, $form_id) {
  $form['workflow']['node_options']['#options']['revert_original_node'] =  t('Revert to Original Node');
}
