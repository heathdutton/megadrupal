<?php
/**
 * Test class.
 */
class PicasaSlideshowFilterTestCase extends DrupalWebTestCase {
  protected $profile = 'testing';
  protected $user;
  protected $contentType;
  protected $picasa_album_id = '5594661276816655633';
  protected $picasa_user = 'vejleih';

  public static function getInfo() {
    return array(
      'name' => t('Picasa Slideshow Filter Tests'),
      'description' => t('Tests for the Picasa Webalbum Filter module.'),
      'group' => t('Input filters'),
    );
  }

  /**
   * Setup stuff.
   */
  public function setUp() {
    parent::setUp('picasa_slideshow_filter');

    // Create a content type to test the filters (with default format)
    $this->contentType = $this->drupalCreateContentType();

    // Create and log in our user.
    $this->user = $this->drupalCreateUser(array(
      'create ' . $this->contentType->type . ' content',
      'administer filters',
    ));
    $this->drupalLogin($this->user);
  }
  
  /**
   * Testing the embedded scribd option.
   */
  function testEmbedStyle() {
    // Turn on our input filter
    $edit = array(
      'filters[picasa_slideshow_filter][status]' => 1,
    );
    $this->drupalPost('admin/config/content/formats/plain_text', $edit, t('Save configuration'));

    // Create a test node
    $langcode = LANGUAGE_NONE;
    $edit = array(
      "title" => $this->randomName(),
      "body[$langcode][0][value]" => 'Hello! [picasa_slideshow id='.$this->picasa_album_id.' user='.$this->picasa_user.']',
    );
    $result = $this->drupalPost('node/add/' . $this->contentType->type, $edit, t('Save'));
    $this->assertResponse(200);
    $this->assertRaw("Hello! ");
    $this->assertRaw('<embed type="application/x-shockwave-flash" src="https://picasaweb.google.com/s/c/bin/slideshow.swf" width="400" height="267" flashvars="host=picasaweb.google.com&amp;hl=en_US&amp;feat=flashalbum&amp;RGB=0x000000&amp;feed=https%3A%2F%2Fpicasaweb.google.com%2Fdata%2Ffeed%2Fapi%2Fuser%2Fvejleih%2Falbumid%2F5594661276816655633%3Falt%3Drss%26kind%3Dphoto%26hl%3DDen_US%26captions%3D%26noautoplay%3D1" pluginspage="http://www.macromedia.com/go/getflashplayer">
</embed>');
    $this->verbose($result);
  }
}
