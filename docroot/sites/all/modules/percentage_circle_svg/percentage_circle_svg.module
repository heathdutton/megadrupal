<?php
/**
 * @file
 * Percentage Circle Svg module.
 */

use PercentageCircleSvg\PercentageCircleSvg;

/**
 * Implements hook_menu().
 */
function percentage_circle_svg_menu() {
  // SVG examples page.
  $items['admin/config/media/percentage-circle-svg'] = array(
    'title' => 'Percentage Circle Svg Examples',
    'description' => 'Percentage Circle Svg Examples',
    'page callback' => '_percentage_circle_svg_menu_example_page',
    'access arguments' => array('access administration pages'),
  );

  return $items;
}

/**
 * Callback function for 'admin/config/percentage-circle-svg'.
 *
 * @return string
 *   The html output.
 */
function _percentage_circle_svg_menu_example_page() {
  $vars_1 = array(
    'radius' => 50,
    'percentage' => 25,
    'label_color' => 'grey',
    'span_color' => 'grey',
  );

  $vars_2 = array(
    'radius' => 150,
    'percentage' => 70,
    'stroke_width' => 20,
    'donut_mask_color' => '#056322',
    'circle_color' => 'green',
  );

  $vars_3 = array('radius' => 100, 'percentage' => 100);

  $vars_4 = array(
    'radius' => 100,
    'percentage' => 75,
    'stroke_width' => 40,
    'donut_mask_color' => 'brown',
    'circle_color' => 'pink',
  );

  $vars_5 = array(
    'radius' => 200,
    'percentage' => 33,
    'stroke_width' => 20,
  );

  $vars_6 = array(
    'radius' => 70,
    'percentage' => 66,
    'stroke_width' => 5,
    'donut_mask_color' => 'purple',
    'circle_color' => 'pink',
  );

  $vars_7 = array(
    'radius' => 50,
    'percentage' => 25,
    'stroke_width' => 30,
    'donut_mask_color' => 'grey',
    'circle_color' => 'black',
    'label_color' => 'white',
    'span_color' => 'white',
    'color_mask' => 'none',
  );

  $output = theme('percentage_circle_svg', $vars_1);
  $output .= theme('percentage_circle_svg', $vars_2);
  $output .= theme('percentage_circle_svg', $vars_3);
  $output .= theme('percentage_circle_svg', $vars_4);
  $output .= theme('percentage_circle_svg', $vars_5);
  $output .= theme('percentage_circle_svg', $vars_6);
  $output .= theme('percentage_circle_svg', $vars_7);
  $output .= '<br />';

  for ($i = 0; $i <= 100; $i++) {
    $output .= theme('percentage_circle_svg', array(
      'radius' => 55,
      'percentage' => $i,
      )
    );
  }
  return $output;
}

/**
 * Implements hook_theme().
 */
function percentage_circle_svg_theme($existing, $type, $theme, $path) {
  return array(
    'percentage_circle_svg' => array(
      'variables' => array(
        'radius' => NULL,
        'percentage' => 30,
        'stroke_width' => 10,
        'donut_mask_color' => 'black',
        'circle_color' => 'red',
        'span_color' => 'black',
        'label_color' => 'black',
        'color_mask' => 'black',
      ),
    ),
  );
}

/**
 * Theme for a Percentage Svg.
 *
 * @param array $variables
 *   An associative array.
 *
 * @return string
 *   The Percentage Svg.
 */
function theme_percentage_circle_svg($variables) {
  $output = '';
  if (isset($variables['radius'])) {
    $library = libraries_load('percentage-circle-svg');
    if ($library) {
      $svg = new PercentageCircleSvg(
        $variables['radius'],
        $variables['percentage'],
        $variables['stroke_width'],
        $variables['donut_mask_color'],
        $variables['circle_color'],
        $variables['span_color'],
        $variables['label_color'],
        $variables['color_mask']
      );
      $output = $svg->getSvg();
    }
  }
  return $output;
}


/**
 * Implements hook_libraries_info().
 */
function percentage_circle_svg_libraries_info() {
  $libraries['percentage-circle-svg'] = array(
    'name' => 'Percentage Circle Svg',
    'vendor url' => 'https://github.com/geberele/PercentageCircleSvg',
    'download url' => 'https://github.com/geberele/PercentageCircleSvg',
    'version arguments' => array(
      'file' => 'README.md',
      'pattern' => '/Version (\d+[\.\d+]++)/',
      'lines' => 5,
    ),
    'files' => array(
      'php' => array('PercentageCircleSvg.php'),
    ),
  );

  return $libraries;
}
