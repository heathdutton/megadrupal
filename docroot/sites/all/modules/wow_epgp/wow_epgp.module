<?php

/**
 * @file
 * EPGP is an Effort/Gear reward system and addon for World of Warcraft.
 */

/**
 * Implements hook_menu().
 */
function wow_epgp_menu() {
  $items = array();

  $items['epgp'] = array(
    'title' => 'EPGP data',
    'page callback' => 'wow_epgp_page',
    'access arguments' => array('view epgp data'),
    'file' => 'wow_epgp.pages.inc',
  );

  $items['character/%wow_character_uri/%/%/epgp'] = array(
    'title' => 'EPGP history',
    'title callback' => 'wow_epgp_character_history_page_title',
    'title arguments' => array(1),
    'load arguments' => array(2, 3),
    'page callback' => 'wow_epgp_character_history_page',
    'page arguments' => array(1),
    'access arguments' => array('view epgp data'),
    'file' => 'wow_epgp.pages.inc',
  );

//   $items['admin/wow/epgp'] = array(
//     'title' => 'EPGP',
//     'description' => 'Manage EPGP, import data.',
//     'page callback' => 'epgp_admin',
//     'page arguments' => array('list'),
//     'access arguments' => array('administer wow epgp'),
//     'type' => MENU_LOCAL_TASK,
//     'file' => 'wow_epgp.admin.inc',
//   );
//   $items['admin/wow/epgp/history'] = array(
//     'title' => 'History',
//     'description' => 'See the history of Effort Points / Gear Points',
//     'access arguments' => array('administer wow epgp'),
//     'type' => MENU_DEFAULT_LOCAL_TASK,
//     'file' => 'wow_epgp.admin.inc',
//   );

  $items['admin/wow/epgp'] = array(
    'title' => 'EPGP',
    'description' => 'Import EPGP data from the World of Warcraft Add-on.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('wow_epgp_bulk_import'),
    'access arguments' => array('import epgp data'),
    'type' => MENU_LOCAL_TASK,
    'file' => 'wow_epgp.admin.inc',
  );

  return $items;
}

/**
 * Implements hook_help().
 */
function wow_epgp_help($path, $arg) {
  switch ($path) {
    case 'admin/help#epgp':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('EPGP is a relational reward system for World of Warcraft. It is an alternative DKP system in which your loot buying power is defined by the ratio of your effort and rewards points instead of their difference. In plain English, in a traditional DKP system you receive effort points that increase your DKP pool and spend them to receive loot which decreases your DKP pool. The person with the largest DKP pool has the most buying power. In EPGP, you receive effort points but you also receive loot points. These are separate from each other and your buying power is defined by your effort points divided by your loot/gear points.') . '</p>';
      $output .= '<h3>' . t('Uses') . '</h3>';
      $output .= '<p>' . t('EPGP is implemented as an addon which you can download from the project\'s <a href="@website">website</a> or <a href="@curse">curse.com</a>. The addon can work completely in game, using your guild\'s officer notes to store its data. The drupal module complements the addon to provide a convenient way to access your EPGP data out of the game and at the same time protect it against accidental loss.', array('@website' => 'http://code.google.com/p/epgp/', '@curse' => 'http://wow.curse.com/downloads/wow-addons/details/epgp-dkp-reloaded.aspx')) . '</p>';
      $output .= '<p>' . t('You can find more information about the EPGP system and addon on the EPGP <a href="@website">website</a>.', array('@website' => 'http://www.epgpweb.com/')) . '</p>';
      return $output;
  }
}

/**
 * Implements hook_permission().
 */
function wow_epgp_permission() {
  return array(
    'administer wow epgp' => array(
      'title' => t('Administer EPGP data'),
    ),
    'import epgp data' => array(
      'title' => t('Import EPGP data'),
      'restrict access' => TRUE,
    ),
    'view epgp data' => array(
      'title' => t('View EPGP data'),
    ),
  );
}

/**
 * Title callback for the history page.
 */
function wow_epgp_character_history_page_title($character) {
  return t("!name's EPGP history", array('!name' => $character->name));
}
