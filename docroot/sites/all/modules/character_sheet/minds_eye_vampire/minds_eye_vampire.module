<?php
/**
 * @file
 * Code for the Minds Eye Vampire Sheet feature.
 */

include_once 'minds_eye_vampire.features.inc';

/**
 * Implements hook_character_sheet_register_systems().
 */
function minds_eye_vampire_character_sheet_register_systems() {
  $xp_types = array('me_v_xp'); // Only the one type.
  foreach ($xp_types as $key => $type) {
    $xp_types[$key] = trim($type);
  }
  $system['minds_eye_vampire'] = array(
    'name' => 'Mind\'s Eye 3e Vampire',
    'description' => 'Mind\'s Eye 3e Vampire System.',
    'xp' => array(
      'types' => $xp_types,
    ),
  );
  return $system;
}

/**
 * Implements hook_node_view().
 */
function white_wolf_character_sheets_node_view($node, $view_mode = 'full', $langcode) {
  if ($node->type  == 'me_v_character_sheet' && $view_mode == 'full' ) {
  drupal_add_css(drupal_get_path('module', 'minds_eye_vampire') .
    '/css/minds_eye_vampire.css');
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function minds_eye_vampire_form_node_form_alter(&$form, &$form_state, $form_id) {
  // Check to see if this node type is a rpg chatroom.
  if ($form['#node']->type == 'me_v_character_sheet') {
    $form['#after_build'][] = '_minds_eye_vampire_form_node_form_alter_after_build';
  }
}

/**
 * After build handler.
 */
function _minds_eye_vampire_form_node_form_alter_after_build($form, $form_state) {
  drupal_add_css(drupal_get_path('module', 'minds_eye_vampire') .
    '/css/minds_eye_vampire.css');
  return $form;
}