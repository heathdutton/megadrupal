<?php

/**
 * @file
 * Enables the requiring and hiding of designated modules at admin/modules.
 */

/**
 * Implements hook_help().
 */
function systemmask_help($path, $arg) {
  switch ($path) {
    case 'admin/build/modules#description':
      return t('Enable the requiring and hiding of designated modules at admin/build/modules.');
  }
}

function systemmask_system_info_alter(&$info, $file, $type) {
  // We always require and hide ourself.
  if($file->name == "systemmask") {
    $info['hidden'] = 1;
    return;
  }
  
  $masked = variable_get('systemmask_system', array());
  if (is_array($masked['modules']) && is_array($masked['modules']['required']) && in_array($file->name, $masked['modules']['required'])) {
    $info['required'] = 1;
  }
  elseif (is_array($masked['modules']) && is_array($masked['modules']['hidden']) && in_array($file->name, $masked['modules']['hidden'])) {
    $info['hidden'] = 1;
  }
}