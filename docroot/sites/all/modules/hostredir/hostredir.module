<?php

/**
 * @file
 * Allows you to 301 redirect any domain to any other domain.
 */

/**
 * Implements hook_menu().
 */
function hostredir_menu() {
  $items = array();
  $items['admin/config/search/hostredir'] = array(
    'title' => 'Host Redirect',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('hostredir_form_admin'),
    'access callback' => 'user_access',
    'access arguments' => array('administer site configuration'),
    'file' => 'hostredir.admin.inc',
  );
  return $items;
}

/**
 * Implements hook_init().
 */
function hostredir_init() {
  // Don't redirect when using drush.
  if (drupal_is_cli()) {
    return;
  }
  $redirects = variable_get('hostredir_redirects', array());
  global $is_https;
  if (isset($redirects[$_SERVER['HTTP_HOST']])) {
    $proto = $is_https ? 'https://' : 'http://';
    drupal_goto($proto . $redirects[$_SERVER['HTTP_HOST']] . $_SERVER['REQUEST_URI'], array(), 301);
  }
}

/**
 * Implements hook_theme().
 */
function hostredir_theme($existing, $type, $theme, $path) {
  return array(
    'hostredir_form_admin' => array(
      'render element' => 'form',
      'file' => 'hostredir.admin.inc',
    ),
  );
}
