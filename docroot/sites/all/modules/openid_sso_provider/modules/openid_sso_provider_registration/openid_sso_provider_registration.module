<?php


/**
 *  @file
 */


/**
 * Implements hook_mail_alter()
 */
function openid_sso_provider_registration_mail_alter(&$message) {

  switch ($message['id']) {
    case 'user_register_no_approval_required':
    case 'user_register_pending_approval':
    case 'user_status_activated':
      openid_sso_provider_registration_mail_body(openid_sso_provider_get_origin(),  $message);
      break;
  }
}

/**
 * Replaces message body by settings, if configured.
 */
function openid_sso_provider_registration_mail_body($origin_rp, &$message) {

  if (!isset($origin_rp->override_standard_emails)) {
    return;
  }
  if ($origin_rp->override_standard_emails[LANGUAGE_NONE][0]['value'] == 0) {
    return;
  }

  switch ($message['id']) {
    case 'user_register_no_approval_required':
      if (!empty($origin_rp->email_no_approval_required)) {
        $message['body'][0] = $origin_rp->email_no_approval_required[LANGUAGE_NONE][0]['value'];
      }
      break;
    case 'user_register_pending_approval':
      if (!empty($origin_rp->email_pending_approval)) {
        $message['body'][0] = $origin_rp->email_no_approval_required[LANGUAGE_NONE][0]['value'];
      }
      break;
    case 'user_status_activated':
      if (!empty($origin_rp->email_activated)) {
        $message['body'][0] = $origin_rp->email_no_approval_required[LANGUAGE_NONE][0]['value'];
      }
      break;
  }
}


/**
 * Implements hook_form_alter().
 */
function openid_sso_provider_registration_form_alter(&$form, &$form_state, $form_id) {

  if ($form_id == 'openid_sso_provider_rps_form') {

    // Show textfields only if checkbox for override is enabled.
    $form['email_pending_approval']['#states'] =
    $form['email_no_approval_required']['#states'] =
    $form['email_activated']['#states'] = array(
      'visible' => array(
        ':input[name="override_standard_emails[und]"]' => array(
          'checked' => TRUE,
        ),
      ),
    );
  }
}
