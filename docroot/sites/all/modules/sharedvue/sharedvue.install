<?php

/**
 * @file
 * Install and update routines for the SharedVue module.
 */

/**
 * Implements hook_install().
 */
function sharedvue_install() {
  // Grant users who can "access content" access to view the syndicated
  // content pages. We have defined our own permission so that site builders
  // can deny access to it if they wish, but by default we want to duplicate
  // the current "access content" permission

  // Grab all instances of the access content permission
  $result = db_query("SELECT * FROM {role_permission} WHERE permission='access content'");

  // Loop over the grants
  foreach ($result as $row) {

    // And grant our permission to the same roles
    db_insert('role_permission')
      ->fields(array(
          'rid' => $row->rid,
          'permission' => 'access syndicated sharedvue content',
          'module' => 'sharedvue',
        ))
        ->execute();
  }
}

/**
 * Implements hook_uninstall().
 */
function sharedvue_uninstall() {
  variable_del('sharedvue_base_url');
  variable_del('sharedvue_suppress_title');
  variable_del('sharedvue_endpoints');
}
