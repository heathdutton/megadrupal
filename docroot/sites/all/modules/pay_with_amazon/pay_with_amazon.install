<?php

/**
 * @file
 * Install, update and uninstall functions for Pay With Amazon module.
 */

/**
 * Implements hook_requirements().
 */
function pay_with_amazon_requirements($phase) {
  $requirements = array();

  // Ensure translations don't break during installation.
  $t = get_t();

  if ($phase == 'runtime') {
    $merchant_id = variable_get('pay_with_amazon_merchantid', '');
    $access_key_id = variable_get('pay_with_amazon_access_key_id', '');
    $secret_key_id = variable_get('pay_with_amazon_secret_key_id', '');

    if (empty($merchant_id) || empty($access_key_id) || empty($secret_key_id)) {
      $requirements['pay_with_amazon_credentials'] = array(
        'title' => $t('Pay With Amazon Credentials'),
        'description' => $t('Please configure Pay With Amazon Credentails admin/commerce/config/payment-methods/pay-with-amazon'),
        'severity' => REQUIREMENT_WARNING,
      );
    }
  }

  if ($phase == 'install') {
    // Check if pay_with_amazon library is included.
    if (module_exists('libraries') && !libraries_get_path('pay_with_amazon')) {
      $requirements['pay_with_amazon_library'] = array(
        'title' => $t('Pay With Amazon Library'),
        'description' => $t('Pay with Amazon Library is not copied to libraries folder. Download this library from <a hre="@url">@url</a> and copy the pay with amazon library into sites/all/libraries folder', array('@url' => 'https://github.com/nkgokul/paywithamazonfordrupal')),
        'severity' => REQUIREMENT_ERROR,
      );
    }
  }
  return $requirements;
}
