<?php

/**
 * @file
 * Contains class iDEALTestiDEALVersion3PaymentMethodControllerWebTestCase.
 */

/**
 * Tests iDEALVersion3PaymentMethodController functionality.
 */
class iDEALTestiDEALVersion3PaymentMethodControllerWebTestCase extends PaymentWebTestCase {

  static function getInfo() {
    return array(
      'description' => '',
      'name' => 'iDEALVersion3PaymentMethodController functionality',
      'group' => 'iDEAL',
      'dependencies' => array('ideal_test'),
    );
  }

  function setUp(array $modules = array()) {
    parent::setUp($modules + array('ideal_test'));
  }

  /**
   * Test the token and token code functionality.
   */
  function testEncryption() {
    $dir = drupal_get_path('module', 'ideal_test') . '/encryption/';
  	$payment_method = $this->paymentMethodCreate(2, payment_method_controller_load('iDEALVersion3PaymentMethodController'));

	  // Test a private key of an incorrect length.
  	$payment_method->controller_data['merchant_private_key_path'] = $dir . 'ideal_merchant_private_key_v3.pem';
	  try {
      $payment_method->controller->merchantPrivateKey($payment_method);
  	  $valid = TRUE;
    }
    catch (PaymentException $e) {
  	  $valid = FALSE;
    }
  	$this->assertFalse($valid);
  }
}