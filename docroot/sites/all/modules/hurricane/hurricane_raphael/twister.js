/**
 * @file
 * Hurricane "Twister" renderer.
 */
(function($){
  var shapes = {
    1: 'M64,0C28.71,0,0,28.71,0,64c0,35.29,28.71,64,64,64c35.29,0,64-28.71,64-64C128,28.71,99.29,0,64,0z M74,106.84V57.25H54v49.59C34.542,102.299,20,84.821,20,64c0-24.262,19.738-44,44-44s44,19.738,44,44C108,84.821,93.458,102.299,74,106.84z',
    2: 'M89.139,21.652c-5.936-3.702-11.532-5.161-17.131-8.862C68.536,10.434,63.721,4.824,59.69,0c-0.784,7.741-3.135,10.882-5.822,13.126c-5.71,4.487-9.292,5.834-14.22,8.526C35.506,23.785,13,37.248,13,66.193c0,28.944,24.297,50.262,51.282,50.262c26.985,0,50.385-19.634,50.385-49.365C114.667,37.359,92.722,23.896,89.139,21.652zM89.784,105.897c-0.559,0.56-5.709,4.149-11.756,4.711c-6.046,0.561-14.22,0.897-19.146-3.59c-0.783-0.786-0.56-1.908,0-2.355c0.559-0.449,1.008-0.786,1.679-0.786c0.672,0,0.56,0,0.896,0.226c2.24,1.795,5.601,3.252,12.766,3.252c7.164,0,12.202-2.02,14.442-3.702c1.008-0.786,1.456-0.111,1.568,0.337C90.345,104.438,90.568,105.11,89.784,105.897zM70.19,95.688c1.232-1.123,3.247-2.919,5.151-3.703c1.902-0.785,2.91-0.674,4.702-0.674s3.696,0.113,5.039,1.011c1.342,0.897,2.127,2.918,2.575,4.039s0,1.794-0.897,2.243c-0.782,0.448-0.894,0.225-1.678-1.234s-1.456-2.917-5.375-2.917c-3.918,0-5.151,1.347-7.054,2.917c-1.903,1.571-2.575,2.133-3.247,1.234S68.959,96.809,70.19,95.688z M99.862,96.584C95.831,96.249,87.77,83.683,82.62,83.457c-6.495-0.226-20.603,13.576-31.687,13.576c-6.719,0-8.733-1.01-10.974-2.469c-3.359-2.355-5.039-5.945-4.927-10.882c0.112-8.752,8.286-16.942,18.587-17.054c13.1-0.111,22.17,13.015,28.777,12.902c5.598-0.111,16.347-11.108,21.608-11.108c5.599,0,7.165,5.836,7.165,9.312c0,3.479-1.12,9.762-3.805,13.688C104.677,95.351,102.997,96.809,99.862,96.584z',
    3: 'M68.057,113.981c-1.376,0.133-2.786,0.223-4.236,0.223l0,0c-1.295,0-2.555-0.07-3.783-0.178l0,0l-10.636,13.86l-2.616-0.753c-3.069-0.873-6.052-1.97-8.919-3.284l0,0l-2.486-1.143l0.641-17.41c-2.261-1.603-4.371-3.389-6.323-5.348l0,0l-16.817,3.663l-1.535-2.287c-1.802-2.686-3.336-5.498-4.699-8.344l0,0l-1.183-2.484l11.419-12.812c-0.714-2.715-1.187-5.514-1.43-8.369l0,0L0.323,61.205l0.275-2.748c0.324-3.288,0.951-6.434,1.701-9.456l0,0l0.668-2.683l16.877-2.369c1.203-2.574,2.621-5.015,4.216-7.31l0,0L17.62,20.567l1.946-1.929c2.284-2.259,4.73-4.303,7.282-6.171l0,0l2.211-1.618l14.569,9.275c2.454-1.145,5.021-2.089,7.683-2.813l0,0l5.28-16.614l2.723-0.208c1.465-0.112,3.042-0.239,4.754-0.239l0,0c1.708,0,3.281,0.126,4.747,0.239l0,0l2.723,0.208l5.338,16.787c2.56,0.724,5.037,1.648,7.416,2.769l0,0l14.771-9.408l2.219,1.618c2.551,1.868,5.001,3.916,7.281,6.164l0,0l1.952,1.929l-6.637,16.554c1.445,2.132,2.748,4.385,3.864,6.759l0,0l17.402,2.442l0.677,2.684c0.762,3.017,1.384,6.164,1.701,9.456l0,0l0.274,2.747L112.14,69.59c-0.235,2.604-0.652,5.167-1.275,7.663l0,0l11.797,13.215l-1.187,2.498c-1.356,2.854-2.884,5.674-4.693,8.351l0,0l-1.534,2.28l-17.235-3.746c-1.825,1.853-3.803,3.558-5.917,5.098l0,0l0.656,17.751l-2.491,1.143c-2.872,1.311-5.848,2.41-8.917,3.284l0,0l-2.625,0.753L68.057,113.981L68.057,113.981z M81.734,118.429c0.919-0.311,1.823-0.645,2.719-1.001l0,0l-0.617-16.767l1.94-1.262c2.905-1.912,5.549-4.204,7.898-6.81l0,0l1.562-1.735l16.308,3.539c0.488-0.829,0.963-1.679,1.42-2.545l0,0l-11.154-12.506l0.692-2.233c0.985-3.215,1.545-6.665,1.711-10.267l0,0l0.101-2.344l14.816-7.938c-0.154-0.96-0.332-1.917-0.536-2.873l0,0l-16.483-2.312l-0.888-2.166c-1.323-3.232-3.077-6.258-5.172-9.051l0,0L94.668,38.3l6.269-15.638c-0.726-0.646-1.471-1.273-2.236-1.88l0,0l-13.992,8.907l-2.062-1.101c-3.053-1.63-6.354-2.866-9.837-3.671l0,0l-2.252-0.521L65.502,8.502c-0.49-0.024-0.969-0.036-1.434-0.036l0,0c-0.475,0-0.951,0.012-1.445,0.036l0,0l-5.02,15.791l-2.284,0.493c-3.544,0.772-6.921,2.027-10.068,3.679l0,0l-2.057,1.083l-13.769-8.766c-0.761,0.607-1.505,1.235-2.227,1.88l0,0l6.103,15.227l-1.434,1.864c-2.234,2.912-4.094,6.098-5.488,9.523l0,0l-0.882,2.171l-15.954,2.24c-0.204,0.956-0.382,1.913-0.532,2.873l0,0l14.302,7.668l0.089,2.359c0.15,3.816,0.777,7.475,1.859,10.896l0,0l0.71,2.25L15.169,91.849c0.455,0.87,0.927,1.721,1.422,2.549l0,0l15.86-3.461l1.58,1.736c2.435,2.698,5.213,5.046,8.274,6.994l0,0l1.976,1.252l-0.603,16.509c0.896,0.356,1.804,0.69,2.723,1.001l0,0l10.041-13.092l2.292,0.288c1.729,0.222,3.413,0.366,5.09,0.366l0,0c1.801,0,3.621-0.161,5.48-0.427l0,0l2.312-0.33L81.734,118.429L81.734,118.429z M86.312,84.436l2.211,3.444l-14.025,9.252l-4.978-7.764l0,0c-1.812,0.447-3.714,0.71-5.696,0.71l0,0c-13.705,0-24.811-11.265-24.811-25.145l0,0c0-13.895,11.106-25.156,24.811-25.156l0,0c13.689,0,24.799,11.261,24.799,25.156l0,0c0,5.705-1.891,10.988-5.062,15.212l0,0L86.312,84.436 M76.875,85.764l0.438-0.285l-3.997-6.238l2.315-2.348c3.03-3.08,4.889-7.28,4.889-11.959l0,0c-0.016-9.354-7.485-16.927-16.699-16.942l0,0c-9.233,0.016-16.695,7.581-16.711,16.942l0,0c0.016,9.342,7.485,16.916,16.711,16.932l0,0c2.061,0,4.046-0.427,5.966-1.176l0,0l3.062-1.19L76.875,85.764L76.875,85.764z',
    4: 'M109.723,64.002c-0.046,25.247-20.471,45.67-45.718,45.715c-13.141,0-24.913-5.559-33.257-14.436l10.807-7.533L0.271,68.4l3.888,45.426l11.458-7.99C27.341,119.391,44.677,128,64,128c35.357,0,64-28.641,64-63.998H109.723z M64.005,18.292c13.146,0,24.918,5.564,33.269,14.442l-10.807,7.538l41.282,19.337l-3.897-45.42l-11.452,7.99C100.668,8.626,83.338,0,64.005,0C28.658,0.005,0.005,28.657,0,64.002h18.292C18.333,38.762,38.763,18.333,64.005,18.292z',
    5: 'M59.734,9.738c2.348-4.984,6.188-4.984,8.536,0l10.842,23.015c2.344,4.981,8.559,9.717,13.809,10.517l24.218,3.689c5.248,0.8,6.435,4.629,2.635,8.511L102.246,73.38c-3.798,3.887-6.169,11.538-5.278,17.021l4.144,25.289c0.895,5.483-2.215,7.846-6.911,5.262l-21.667-11.944c-4.697-2.586-12.374-2.586-17.07,0l-21.67,11.944c-4.696,2.584-7.798,0.222-6.904-5.262l4.138-25.289c0.896-5.483-1.481-13.14-5.275-17.021L8.225,55.469c-3.799-3.881-2.612-7.707,2.637-8.511L35.09,43.27c5.245-0.8,11.458-5.536,13.808-10.517L59.734,9.738z',
    6: 'M64,0C28.654,0,0,28.654,0,64c0,35.347,28.654,64,64,64c35.347,0,64-28.653,64-64C128,28.654,99.347,0,64,0zM100.926,59.455c-6.388,7.351-16.316,9.782-25.032,6.987l-31.65,36.397c-3.374,3.876-9.244,4.271-13.118,0.901c-3.877-3.369-4.286-9.242-0.917-13.117l31.695-36.438c-3.931-8.211-2.892-18.336,3.467-25.646c6.021-6.934,15.205-9.472,23.549-7.371L76.79,35.312l3.97,11.542l11.985,2.328l12.158-14.178C108.199,42.992,106.987,52.495,100.926,59.455z',
    7: 'M64,0C28.654,0,0,28.654,0,64c0,35.346,28.654,64,64,64s64-28.654,64-64C128,28.654,99.346,0,64,0zM84.824,26.021c4.112,0,7.434,6.53,7.434,14.584c0,8.054-3.329,14.588-7.434,14.588s-7.433-6.53-7.433-14.583C77.392,32.555,80.725,26.021,84.824,26.021z M42.441,26.021c4.104,0,7.433,6.53,7.433,14.584c0,8.054-3.324,14.588-7.433,14.588c-4.109,0-7.433-6.53-7.433-14.583C35.008,32.555,38.336,26.021,42.441,26.021z M64.092,108.033c-12.65,0-24.495-7.735-34.693-21.185c10.555,6.887,22.11,10.727,34.232,10.727c12.87,0,25.104-4.315,36.173-12.038C89.391,99.808,77.167,108.033,64.092,108.033z',
    8: 'M64.003,0C28.656,0.004,0.009,28.645,0,63.999C0.009,99.352,28.656,127.988,64.003,128C99.353,127.988,128,99.352,128,63.999C128,28.645,99.353,0.004,64.003,0z M64.003,113.363c-27.261-0.024-49.323-22.11-49.371-49.365c0.048-27.256,22.109-49.318,49.371-49.372c27.254,0.054,49.321,22.116,49.368,49.369C113.324,91.253,91.268,113.339,64.003,113.363z M30.48,63.999c-0.004-2.689-2.186-4.872-4.881-4.875c-2.697,0-4.876,2.186-4.876,4.875c0,2.715,2.19,4.876,4.876,4.876C28.29,68.875,30.476,66.714,30.48,63.999z M28.306,78.982c-2.331,1.363-3.131,4.307-1.781,6.651c1.34,2.352,4.336,3.128,6.657,1.771c2.335-1.309,3.133-4.3,1.788-6.651C33.625,78.414,30.642,77.631,28.306,78.982z M33.187,40.57c-2.335-1.333-5.316-0.55-6.662,1.795c-1.345,2.324-0.541,5.314,1.781,6.648c2.336,1.356,5.314,0.555,6.665-1.772C36.311,44.895,35.513,41.93,33.187,40.57zM99.705,49.013c2.333-1.332,3.133-4.324,1.785-6.648c-1.338-2.345-4.338-3.128-6.661-1.795c-2.333,1.363-3.129,4.353-1.781,6.674C94.391,49.565,97.372,50.372,99.705,49.013z M47.239,93.021c-2.331-1.31-5.31-0.526-6.662,1.818c-1.34,2.307-0.541,5.295,1.786,6.646c2.331,1.356,5.319,0.523,6.655-1.771C50.37,97.369,49.57,94.378,47.239,93.021zM47.239,34.954c2.336-1.333,3.131-4.323,1.786-6.646c-1.348-2.325-4.331-3.129-6.662-1.796c-2.331,1.356-3.131,4.347-1.786,6.671C41.93,35.51,44.908,36.312,47.239,34.954z M99.715,78.982c-2.343-1.352-5.329-0.568-6.667,1.771c-1.343,2.352-0.552,5.343,1.791,6.651c2.323,1.352,5.305,0.575,6.651-1.771C102.838,83.289,102.038,80.339,99.715,78.982zM85.644,26.512c-2.329-1.333-5.319-0.525-6.652,1.796c-1.343,2.33-0.543,5.315,1.781,6.649c2.323,1.355,5.309,0.553,6.661-1.771C88.781,30.862,87.981,27.868,85.644,26.512z M102.419,59.124c-2.704,0.006-4.886,2.192-4.886,4.875c0.01,2.666,2.19,4.876,4.886,4.876c2.686,0,4.876-2.161,4.876-4.876C107.295,61.312,105.104,59.124,102.419,59.124z M64.008,20.732c-2.69,0-4.876,2.163-4.876,4.875L56.86,61.39l-14.647,9.581c-2.331,1.315-3.131,4.303-1.781,6.643c1.341,2.351,4.336,3.134,6.657,1.776l16.114-8.154c0.265,0.023,0.526,0.101,0.805,0.101c4.041,0,7.316-3.312,7.316-7.337l-2.438-38.392C68.887,22.895,66.701,20.732,64.008,20.732z M64.008,97.518c-2.69,0-4.876,2.206-4.876,4.875c0,2.715,2.186,4.875,4.876,4.875c2.693,0,4.878-2.16,4.878-4.875C68.887,99.724,66.701,97.518,64.008,97.518z M80.772,93.021c-2.334,1.357-3.134,4.349-1.781,6.693c1.338,2.301,4.323,3.135,6.657,1.771c2.333-1.352,3.133-4.352,1.785-6.646C86.081,92.494,83.105,91.711,80.772,93.021z',
    9: 'M128,110.961L93.67,76.63c4.622-7.619,7.342-16.543,7.342-26.112C101.012,22.612,78.406,0.01,50.504,0C22.604,0.01,0,22.612,0,50.514c0,27.883,22.604,50.49,50.505,50.49c9.58,0,18.501-2.714,26.124-7.339L110.978,128L128,110.961zM19.264,50.514c0.028-17.254,13.983-31.203,31.242-31.246C67.746,19.312,81.72,33.26,81.748,50.514C81.71,67.758,67.746,81.713,50.505,81.751C33.246,81.71,19.292,67.758,19.264,50.514z'
  };

  $.hurricane.twister = $.hurricane.raphael.extend({
    setup: function(options) {
      if (!shapes[options['font-weight']]) {
        throw new Exception('Hurrican Twister: No shape for index ' + options['font-weight'] + 'found.');
      }
      // TODO: Find better fix for vml rotation center.
      this.center = document.addEventListener ? 64 : 62.5;

      if (options['letter-spacing'] === 1) {
        options['letter-spacing'] = 0;
      }

      this.shape = this.paper.path(shapes[options['font-weight']]);
      this.opacity = 1 - options['word-spacing'] / 100;
      this.active = options['color'];
      this.inactive = options['background-color'];
      this.speed = 1000 / (options['line-height'] / 25);
      this.deg = (360 * options['letter-spacing'] / 25);
      this.step = 0;

      this.options = options;
      this.shape.attr({
        transform: 'r' + (this.deg * ++this.step) + ',' + this.center + ',' + this.center,
        stroke: 'none',
        fill: this.inactive,
        opacity: this.opacity
      });

      this.stopped = true;
      this.direction = false;
      this.callParent(options);
    },

    tick: function() {
      var that = this;
      this.shape.animate({
        transform: 'r' + (this.deg * ++this.step) + ',' + this.center + ',' + this.center,
        opacity: this.direction ? 1.0 : this.opacity
      }, this.speed, 'linear', function(){
        that.direction = !that.direction;
        if (!that.stopped) {
          that.tick();
        }
        else {
          that.shape.animate({
            fill: that.inactive,
            opacity: that.opacity
          },300, '>');
        }
      });
    },

    start: function() {
      if (!this.stopped) { return; }
      this.stopped = false;
      var that = this;
      this.shape.animate({
        fill: this.active
      }, 300, '<', function(){
        that.tick();
      });
    },

    stop: function() {
      this.stopped = true;
    }
  });
}(jQuery));
