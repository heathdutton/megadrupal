<?php
/**
 * @file core file of the module.
 *
 */

/**
 * Export all users data to file. Users with id 0 and 1 skipped.
 *
 * @see _phoenix_resurrect()
 */
function _phoenix_save() {
  $filename = drupal_get_path('module', 'phoenix') . '/data/users.dat';
  //if (!is_writable($filename) {}

  $result = entity_load('user');
  $save = array();
  foreach ($result as $item) {
    // Do not need to export anonymous and user#1.
    if ($item->uid > 1) {
      $save[$item->uid] = $item;
    }
  }

  $data = serialize($save);

  if (!file_put_contents($filename, $data)) {
    watchdog('phoenix', 'Error saving users to %file', array('%file' => $filename), WATCHDOG_ERROR);
    return FALSE;
  }
  watchdog('phoenix', '!count users saved.', array('!count' => count($save)), WATCHDOG_INFO);
  return count($save);
}
