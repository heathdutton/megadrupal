<?php
/**
 * @file
 * Integrates jquery_oembed_all library.
 */

/**
 * Implements hook_menu().
 */
function jquery_oembed_all_menu() {
  $items = array();

  $items['admin/config/content/jquery_oembed_all'] = array(
    'title' => 'jQuery oEmbed All settings',
    'description' => 'Configuration for jQuery Oembed All module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('jquery_oembed_all_form'),
    'access arguments' => array('access administration pages'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Implements hook_init().
 */
function jquery_oembed_all_init() {
  // Add jquery.oembed.
  libraries_load('jquery.oembed');

  // Add DOM selector.
  $selector = variable_get('jquery_oembed_all_selector', '.node-type-article');
  $js_settings = array('jqueryOembedAllSelector' => $selector);
  drupal_add_js(array('jqueryOembedAll' => $js_settings), 'setting');

  // Add custom script.
  drupal_add_js(drupal_get_path('module', 'jquery_oembed_all') . '/jquery_oembed_all.load.js');
}

/**
 * Implements hook_libraries_info().
 */
function jquery_oembed_all_libraries_info() {
  $libraries['jquery.oembed'] = array(
    'name' => 'jquery.oembed',
    'vendor url' => 'https://github.com/nfl/jquery-oembed-all',
    'download url' => 'https://github.com/nfl/jquery-oembed-all',
    'version arguments' => array(
      'file' => 'CHANGELOG',
      'pattern' => '@^==\s(.*)\s==@',
      'lines' => 3,
    ),
    'files' => array(
      'js' => array(
        'jquery.oembed.js',
      ),
      'css' => array(
        'jquery.oembed.css',
      ),
    ),
  );

  return $libraries;
}

/**
 * Page callback: jQuery oEmbed All settings.
 *
 * @see jquery_oembed_all_menu()
 */
function jquery_oembed_all_form($form, &$form_state) {
  $form['jquery_oembed_all_selector'] = array(
    '#type' => 'textfield',
    '#title' => t('Selector to use for jQuery oEmbed All'),
    '#default_value' => variable_get('jquery_oembed_all_selector', '.node-type-article'),
    '#size' => 20,
    '#maxlength' => 256,
    '#description' => t('A CSS selector, such as .node-type-article.'),
    '#required' => TRUE,
  );

  return system_settings_form($form);
}
