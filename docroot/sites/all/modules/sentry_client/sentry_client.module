<?php
// $Id: sentry_client.module,v 1.1.6.5 2010/09/15 10:25:16 nevergone Exp $

/**
 * @file
 * Lightweight client side reporting functions.
 */

/**
 * Implements hook_menu().
 */
function sentry_client_menu() {
  $items = array();
  $items['admin/config/system/sentry_client'] = array(
    'title' => 'Sentry client configuration',
    'description' => 'Sentry client key properties.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('sentry_client_settings_form'),
    'access arguments' => array('administer sentry client'),
  );
  return $items;
}

/**
 * Implements hook_permission().
 */
function sentry_client_permission() {
  return array(
    'administer sentry client' =>  array(
      'title' => t('Administer sentry client'),
    ),
  );
}

/**
 * Module settings form.
 */
function sentry_client_settings_form() {
  global $user;
  $form = array();
  $form['sentry_client_key'] = array(
    '#type' => 'textfield',
    '#title' => t('Sentry key'),
    '#default_value' => variable_get('sentry_client_key', ''),
    '#description' => t('Copy the key from your profile page on the sentry server (user/!uid/edit, look for Authentication key under Sentry credentials), so no unauthorized servers can access your site.', array('!uid' => $user->uid)),
  );
  return system_settings_form($form);
}

/**
 * Implements hook_xmlrpc().
 */
function sentry_client_xmlrpc() {
  module_load_include('inc', 'sentry_client', 'sentry_client_xmlrpc');
  $methods[] = array(
    'drupalSentry.hash',
    'xmlc_sentry_client_hash',
    array('struct', 'string'),
    t('Return hashes of all Drupal files.'),
  );

  $methods[] = array(
    'drupalSentry.updateStatus',
    'xmlc_sentry_client_update_status',
    array('struct', 'string'), // return struct, argument: string
    t('After key validation returns state and detailed status information.'),
  );

  $methods[] = array(
    'drupalSentry.coreStatus',
    'xmlc_sentry_client_core_status',
    array('int', 'string'),
    t('Return client status information.'),
  );

  $methods[] = array(
    'drupalSentry.requirementsStatus',
    'xmlc_sentry_client_requirements_status',
    array('struct', 'string'),
    t('Return the overall status report generated by hook_requirements on client.'),
  );

  $methods[] = array(
    'drupalSentry.offlineStatus',
    'xmlc_sentry_client_offline_status',
    array('int', 'string'),
    t('Check if site is in offline mode.'),
  );

  $methods[] = array(
    'drupalSentry.seoVariables',
    'xmlc_sentry_client_seo_variables',
    array('struct', 'string'),
    t('Return a number of SEO related variables.'),
  );

  $methods[] = array(
    'drupalSentry.performanceVariables',
    'xmlc_sentry_client_performance_variables',
    array('struct', 'string'),
    t('Return a number of performance related variables.'),
  );
  return $methods;
}
