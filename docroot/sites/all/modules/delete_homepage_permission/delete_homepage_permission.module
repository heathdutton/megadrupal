<?php
/**
 * @file
 * Delete Homepage Permission module file.
 */

/**
 * Implements hook_form_alter().
 */
function delete_homepage_permission_form_alter(&$form, &$form_state, $form_id) {
  $nid = isset($form['nid']['#value']) ? $form['nid']['#value'] : NULL;
  $front_nid = delete_homepage_permission_get_front_id();

  if (!is_null($nid)) {
    if ($front_nid == $nid) {
      $form['actions']['delete']['#access'] = user_access('delete homepage node');
    }
  }

  if ($form_id == 'node_delete_confirm') {
    if ($front_nid == $nid) {
      drupal_set_message('You cannot delete the homepage!', 'error');
      $form['actions']['submit']['#access'] = user_access('delete homepage node');
      $form['actions']['delete']['#access'] = user_access('delete homepage node');
    }
  }
}

/**
 * Get the nid of the homepage.
 *
 * @return int
 *   The nid of the homepage.
 */
function delete_homepage_permission_get_front_id() {
  $front = explode('/', variable_get('site_frontpage', 'node'));

  return isset($front[1]) ? $front[1] : NULL;
}

/**
 * Implements hook_permission().
 */
function delete_homepage_permission_permission() {
  return array(
    'delete homepage node' => array(
      'title' => t('Delete Homepage Node'),
      'description' => t('Allows a user to delete the node marked as front.'),
    ),
  );
}
