<?php

/**
 * @file
 * Adds a Drupal CSV output handler.
 */

/**
 * Standard csv output handler.
 *
 * @param array $data
 *   Array of arrays, where the outer array represents the "table"
 *   and each inner array is a "row", containing values for each
 *   "column".
 * @param string $filename
 *   (Optional) filename to suggest to the client, defaults to
 *   "file.csv" (and may usually be altered by the client).
 * @param char $delimiter
 *   (Optional) character that separates columns from each other.
 *   Defaults to the standard (comma).
 */
function drupal_csv_output($data, $filename = 'file.csv', $delimiter = ',') {
  drupal_add_http_header('Content-Type', 'text/csv');
  drupal_add_http_header('Content-Disposition', "attachment;filename=${filename}");

  $fp = fopen('php://output', 'w');
  foreach((array) $data as $line) {
    fputcsv($fp, $line, $delimiter);
  }
  fclose($fp);
  drupal_exit();
}

/**
 * Shorthand wrapper for Excel compliant "csv" output.
 *
 * Calls the main output handler, yet with a fixed delimiter
 * (";", which is MS Excel compliant).
 *
 * @see drupal_csv_output().
 */
function drupal_csv_excel_output($data, $filename = 'excel.csv') {
  drupal_csv_output($data, $filename, ';');
}
